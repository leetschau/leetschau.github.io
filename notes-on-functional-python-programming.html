<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Li Chao" />
        <meta name="copyright" content="Li Chao" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="functional programming, python, Tech, " />

<meta property="og:title" content="Notes on Functional Python Programming "/>
<meta property="og:url" content="/notes-on-functional-python-programming.html" />
<meta property="og:description" content="Chapter 2 If we provide two methods with the same name, the second one is retained because of the strict evaluation order. 在一个类中，如果定义了两个名称一样的方法，后一个会覆盖前一个， 下面是一个示例： $ cat &lt;&lt; EOF &gt; test.py class Test: def ma(self): print(&#39;m1&#39;) def ma(self): print(&#39;m2&#39;) test_same_method = &#39;&#39;&#39; &gt;&gt;&gt; Test().ma() m2 &#39;&#39;&#39; __test__ = { &#39;Same_method&#39;: test_same_method } def …" />
<meta property="og:site_name" content="DarkMatter in Cyberspace" />
<meta property="og:article:author" content="Li Chao" />
<meta property="og:article:published_time" content="2016-11-17T16:54:23+08:00" />
<meta property="" content="2018-10-05T10:25:53+08:00" />
<meta name="twitter:title" content="Notes on Functional Python Programming ">
<meta name="twitter:description" content="Chapter 2 If we provide two methods with the same name, the second one is retained because of the strict evaluation order. 在一个类中，如果定义了两个名称一样的方法，后一个会覆盖前一个， 下面是一个示例： $ cat &lt;&lt; EOF &gt; test.py class Test: def ma(self): print(&#39;m1&#39;) def ma(self): print(&#39;m2&#39;) test_same_method = &#39;&#39;&#39; &gt;&gt;&gt; Test().ma() m2 &#39;&#39;&#39; __test__ = { &#39;Same_method&#39;: test_same_method } def …">

        <title>Notes on Functional Python Programming  · DarkMatter in Cyberspace
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/custom.css" media="screen">
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="/"><span class=site-name>DarkMatter in Cyberspace</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="">Home</a></li>
                            <li ><a href="/categories.html">Categories</a></li>
                            <li ><a href="/tags.html">Tags</a></li>
                            <li ><a href="/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="/notes-on-functional-python-programming.html"> Notes on Functional Python Programming  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            <hr>
<h1>Chapter 2</h1>
<blockquote>
<p>If we provide two methods with the same name,
the second one is retained because of the strict evaluation order.</p>
</blockquote>
<p>在一个类中，如果定义了两个名称一样的方法，后一个会覆盖前一个，
下面是一个示例：</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">cat</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span> <span class="o">&gt;</span> <span class="n">test</span><span class="o">.</span><span class="n">py</span>
<span class="k">class</span> <span class="nc">Test</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">ma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;m1&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;m2&#39;</span><span class="p">)</span>

<span class="n">test_same_method</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&gt;&gt;&gt; Test().ma()</span>
<span class="s1">m2</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">__test__</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Same_method&#39;</span><span class="p">:</span> <span class="n">test_same_method</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>
<span class="n">EOF</span>
<span class="err">$</span> <span class="n">python3</span> <span class="n">test</span><span class="o">.</span><span class="n">py</span>
<span class="o">...</span>
<span class="n">Test</span> <span class="n">passed</span><span class="o">.</span>
</pre></div>


<h1>Chapter 3</h1>
<h2>doctest</h2>
<p>doctest能够将函数的docstring作为测试依据，非常方便，
基本的方法是<a href="https://docs.python.org/3.4/library/doctest.html#doctest.testmod"><code>doctest.testmod()</code></a>，
testmod是test module的意思。 </p>
<p>不用参数特别指定的情况下，<code>testmod</code>测试当前模块中所有的函数，
以及在<code>__test__</code>字典里定义的测试。</p>
<p><code>__test__</code>的结构是：<code>{ 'test_name1': 'test_str1', 'test_name2': 'test_str2', ... }</code>.
其中<code>test_str</code>是一段完整的测试docstring，参考第2章中的示例。</p>
<p>如果<code>testmod()</code>中不带<code>verbose</code>参数，只有在测试失败时才打印测试报告，
如果<code>doctest.testmod(verbose=True)</code>，则不论成功失败都打印测试报告。</p>
<p>Python用<code>python -i &lt;fileanme.py&gt;</code>把脚本加载到console中，以方便生成测试docstring.</p>
<p>IPython有个<code>%doctest_mod</code>，方便进行doctest，具体Google 'ipython doctest mode'.</p>
<h2>namedtuple</h2>
<p><a href="https://docs.python.org/3/library/collections.html#collections.namedtuple">namedtuple</a>
对象是一组key-value对，key是字符串，
value可以是任何类型的对象（namedtuple的定义中并不指定value的类型），
所以既可以给namedtuple对象属性赋值tuple或者namedtuple形成一个完全immutalbe的对象，
也可以给namedtuple对象属性赋值list或者dict，形成一种“半可变”对象，
例如下面就是一个半可变对象：</p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; Pet = namedtuple(&#39;Pet&#39;, &#39;name age&#39;)
&gt;&gt;&gt; kitty = Pet(&#39;kitty&#39;, 3)
&gt;&gt;&gt; puppy = Pet(&#39;puppy&#39;, 5)
&gt;&gt;&gt; People = namedtuple(&#39;People&#39;, &#39;name age pets&#39;)
&gt;&gt;&gt; leo = People(&#39;Leo&#39;, 23, [kitty, puppy])
&gt;&gt;&gt; leo
People(name=&#39;Leo&#39;, age=23, pets=[Pet(name=&#39;kitty&#39;, age=3), Pet(name=&#39;puppy&#39;, age=5)])
&gt;&gt;&gt; leo.name
&#39;Leo&#39;
&gt;&gt;&gt; leo.age = 33
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
AttributeError: can&#39;t set attribute
&gt;&gt;&gt; leo.pets
[Pet(name=&#39;kitty&#39;, age=3), Pet(name=&#39;puppy&#39;, age=5)]
&gt;&gt;&gt; leo.pets[1].name
&#39;puppy&#39;
&gt;&gt;&gt; leo.pets.append(&#39;panda&#39;)
&gt;&gt;&gt; leo.pets
[Pet(name=&#39;kitty&#39;, age=3), Pet(name=&#39;puppy&#39;, age=5), &#39;panda&#39;]
</pre></div>


<p>namedtuple对象leo的name和age是不可变的，
pets属性则是可变的list，可以在上面append任意类型数据。</p>
<p>与dict相比，namedtuple的优势首先是immutable的，其次可以使用点号引用属性。</p>
<p>根据文档，声明namedtuple的key列表<code>field_names</code>时，
既可以写成<code>'name age'</code>，也可以写成<code>['name', 'age']</code>，二者是等价的。</p>
<p>JavaScript ES6中的<code>const</code>关键字能够防止变量被rebinding，
不能保证变量本身不变，例如给一个const对象添加属性是合法的：</p>
<div class="highlight"><pre><span></span>const foo = {};
foo.bar = 42;
console.log(foo.bar);  // 42
</pre></div>


<p>所以const只能保证简单变量如果数值、字符串不变（不能rebinding），无法保证对象不变
（但声明为const的对象在可读性性上仍然有优势）。
Python无法保证简单量不变（没有防止rebinding的机制），
但可以用namedtuple生成严格意义上的immutable object，二者各有千秋。</p>
<h2>函数参数列表中的星号</h2>
<p>怎样理解下面代码中的<code>Pair(*row[n*2:n*2+2])</code>？</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="n">Pair</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;Pair&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">series</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">row_iter</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">row_iter</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">Pair</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="n">n</span><span class="o">*</span><span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
</pre></div>


<p>首先看如何在调用函数时使用星号：</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">bar</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;foo: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">foo</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;bar: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">bar</span><span class="p">)</span>

<span class="n">pms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;p1&#39;</span><span class="p">,</span> <span class="s1">&#39;p2&#39;</span><span class="p">]</span>
<span class="n">test_same_method</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&gt;&gt;&gt; myfunc(*pms)</span>
<span class="s1">foo: p1</span>
<span class="s1">bar: p2</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">__test__</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Same_method&#39;</span><span class="p">:</span> <span class="n">test_same_method</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>
</pre></div>


<p>可知星号的作用是把作为输入参数的list展开成多个参数，
再被送给函数处理。</p>
<p>上面代码中<code>row[n*2:n*2+2]</code>的值是一个长度为2的list，假设是<code>[2.32 8.23]</code>，
那么<code>Pair(*row[n*2:n*2+2])</code>实际上是<code>Pair(2.32, 8.23)</code>。</p>
<h1>Chapter 4</h1>
<h2>iterable vs list</h2>
<p><code>iterable</code>是可迭代的对象，可以通过<code>iter()</code>或者自己的<code>__iter__()</code>方法转变为迭代器(iterator).
<code>iterable</code>可以是有状态的，也可以是无状态的，例如字符串和list都是iterable，
但前者是无状态的（immutale)，后者是mutable的。</p>
<p><code>iterator</code>是迭代器，是有状态的，它的内部指针记录了当前值，<code>iterator</code>也是一种<code>iterable</code>。
每次<code>next(iterator1)</code>，就返回<code>iterator1</code>的内部指针指向的当前元素，然后指针后移一位。
类似于FIFO的队列，而list的<code>pop()</code>方法可以看作是LIFO的栈，</p>
<p>它们之间的关系是：
对<code>iterable</code>使用<code>iter()</code>函数，得到lazy的<code>iterator</code>，
对<code>iterator</code>使用<code>list()</code>函数，得到eager的list，即：</p>
<div class="highlight"><pre><span></span>iter(iterable) -&gt; iterator (lazy)
list(iterator) -&gt; list (eager)
</pre></div>


<p>而生成器(generator)是迭代器的一种，
生成器(generator)包含两种子类型：generator function, generator expression.
前者是包含<code>yield</code>关键字的函数，后者是形如<code>(x*x for x in range(3))</code>这样的表达式，
List comprehension, such as <code>mylist = [x*x for x in range(3)]</code> is just a syntax sugar for</p>
<div class="highlight"><pre><span></span>my_ge = (x*x for x in range(3))
mylist = list(my_ge)`
</pre></div>


<p>由于generator是一种iterator，所以可以用下面的方法对其取值：</p>
<div class="highlight"><pre><span></span>In [1]: aa = (x*x for x in range(3))

In [2]: aa?
Type:        generator
String form: &lt;generator object &lt;genexpr&gt; at 0x7f226a1184c8&gt;
Docstring:   &lt;no docstring&gt;

In [3]: next(aa)
Out[3]: 0

In [4]: list(aa)
Out[4]: [1, 4]

In [5]: list(x*x for x in range(3))
Out[5]: [0, 1, 4]

In [6]: list((x*x for x in range(3)))
Out[6]: [0, 1, 4]
</pre></div>


<p>参考：</p>
<ul>
<li>
<p><a href="http://stackoverflow.com/questions/9884132/what-exactly-are-pythons-iterator-iterable-and-iteration-protocols">What exactly are Python's iterator, iterable, and iteration protocols?</a>:</p>
</li>
<li>
<p><a href="http://nvie.com/posts/iterators-vs-generators/">Iterables vs. Iterators vs. Generators</a></p>
</li>
</ul>
<p>下面代码演示了二者的关系，</p>
<div class="highlight"><pre><span></span>In [1]: s = &#39;cat&#39;

In [2]: sit = s.__iter__()

In [3]: next(sit)
Out[3]: &#39;c&#39;

In [4]: next(sit)
Out[4]: &#39;a&#39;

In [5]: sit2 = iter(s)

In [6]: next(sit2)
Out[6]: &#39;c&#39;

In [7]: next(sit2)
Out[7]: &#39;a&#39;

In [8]: sit?
Type:        str_iterator
String form: &lt;str_iterator object at 0x7fdc48a19940&gt;
Docstring:   &lt;no docstring&gt;

In [9]: sit2?
Type:        str_iterator
String form: &lt;str_iterator object at 0x7fdc48a1add8&gt;
Docstring:   &lt;no docstring&gt;
</pre></div>


<p>下面是对P68代码的分析：</p>
<div class="highlight"><pre><span></span>$ ipython
Python <span class="m">3</span>.4.3 <span class="o">(</span>default, Nov <span class="m">17</span> <span class="m">2016</span>, <span class="m">01</span>:08:31<span class="o">)</span>

In <span class="o">[</span><span class="m">1</span><span class="o">]</span>: def legs<span class="o">(</span>lat_lon_iter<span class="o">)</span>:
   ...:     <span class="nv">begin</span> <span class="o">=</span> next<span class="o">(</span>lat_lon_iter<span class="o">)</span>
   ...:     print<span class="o">(</span><span class="s1">&#39;begin: %s&#39;</span> % begin<span class="o">)</span>
   ...:     <span class="k">for</span> end in lat_lon_iter:
   ...:         print<span class="o">(</span><span class="s1">&#39;end: %s&#39;</span> % end<span class="o">)</span>
   ...:         yield begin, end
   ...:         print<span class="o">(</span><span class="s1">&#39;begin, end after yield: %s, %s&#39;</span> % <span class="o">(</span>begin, end<span class="o">))</span>
   ...:         <span class="nv">begin</span> <span class="o">=</span> end
   ...:         print<span class="o">(</span><span class="s1">&#39;begin, end after begin=end: %s, %s&#39;</span> % <span class="o">(</span>begin, end<span class="o">))</span>
   ...:

In <span class="o">[</span><span class="m">2</span><span class="o">]</span>: list<span class="o">(</span>legs<span class="o">(</span>x <span class="k">for</span> x in range<span class="o">(</span><span class="m">3</span><span class="o">)))</span>
begin: <span class="m">0</span>
end: <span class="m">1</span>
begin, end after yield: <span class="m">0</span>, <span class="m">1</span>
begin, end after <span class="nv">begin</span><span class="o">=</span>end: <span class="m">1</span>, <span class="m">1</span>
end: <span class="m">2</span>
begin, end after yield: <span class="m">1</span>, <span class="m">2</span>
begin, end after <span class="nv">begin</span><span class="o">=</span>end: <span class="m">2</span>, <span class="m">2</span>
Out<span class="o">[</span><span class="m">2</span><span class="o">]</span>: <span class="o">[(</span><span class="m">0</span>, <span class="m">1</span><span class="o">)</span>, <span class="o">(</span><span class="m">1</span>, <span class="m">2</span><span class="o">)]</span>

In <span class="o">[</span><span class="m">3</span><span class="o">]</span>: list<span class="o">(</span>legs<span class="o">(</span>iter<span class="o">([</span><span class="m">0</span>,1,2<span class="o">])))</span>
begin: <span class="m">0</span>
end: <span class="m">1</span>
begin, end after yield: <span class="m">0</span>, <span class="m">1</span>
begin, end after <span class="nv">begin</span><span class="o">=</span>end: <span class="m">1</span>, <span class="m">1</span>
end: <span class="m">2</span>
begin, end after yield: <span class="m">1</span>, <span class="m">2</span>
begin, end after <span class="nv">begin</span><span class="o">=</span>end: <span class="m">2</span>, <span class="m">2</span>
Out<span class="o">[</span><span class="m">3</span><span class="o">]</span>: <span class="o">[(</span><span class="m">0</span>, <span class="m">1</span><span class="o">)</span>, <span class="o">(</span><span class="m">1</span>, <span class="m">2</span><span class="o">)]</span>

In <span class="o">[</span><span class="m">4</span><span class="o">]</span>: list<span class="o">(</span>legs<span class="o">([</span><span class="m">0</span>,1,2<span class="o">]))</span>
---------------------------------------------------------------------------
TypeError                                 Traceback <span class="o">(</span>most recent call last<span class="o">)</span>
&lt;ipython-input-4-543b79d86b01&gt; in &lt;module&gt;<span class="o">()</span>
----&gt; <span class="m">1</span> list<span class="o">(</span>legs<span class="o">([</span><span class="m">0</span>,1,2<span class="o">]))</span>

&lt;ipython-input-1-53eedac44550&gt; in legs<span class="o">(</span>lat_lon_iter<span class="o">)</span>
      <span class="m">1</span> def legs<span class="o">(</span>lat_lon_iter<span class="o">)</span>:
----&gt; <span class="m">2</span>     <span class="nv">begin</span> <span class="o">=</span> next<span class="o">(</span>lat_lon_iter<span class="o">)</span>
      <span class="m">3</span>     print<span class="o">(</span><span class="s1">&#39;begin: %s&#39;</span> % begin<span class="o">)</span>
      <span class="m">4</span>     <span class="k">for</span> end in lat_lon_iter:
      <span class="m">5</span>         print<span class="o">(</span><span class="s1">&#39;end: %s&#39;</span> % end<span class="o">)</span>

TypeError: <span class="s1">&#39;list&#39;</span> object is not an iterator

In <span class="o">[</span><span class="m">5</span><span class="o">]</span>: <span class="nv">myit</span> <span class="o">=</span> legs<span class="o">(</span>x <span class="k">for</span> x in range<span class="o">(</span><span class="m">3</span><span class="o">))</span>

In <span class="o">[</span><span class="m">6</span><span class="o">]</span>: next<span class="o">(</span>myit<span class="o">)</span>
begin: <span class="m">0</span>
end: <span class="m">1</span>
Out<span class="o">[</span><span class="m">6</span><span class="o">]</span>: <span class="o">(</span><span class="m">0</span>, <span class="m">1</span><span class="o">)</span>

In <span class="o">[</span><span class="m">7</span><span class="o">]</span>: next<span class="o">(</span>myit<span class="o">)</span>
begin, end after yield: <span class="m">0</span>, <span class="m">1</span>
begin, end after <span class="nv">begin</span><span class="o">=</span>end: <span class="m">1</span>, <span class="m">1</span>
end: <span class="m">2</span>
Out<span class="o">[</span><span class="m">7</span><span class="o">]</span>: <span class="o">(</span><span class="m">1</span>, <span class="m">2</span><span class="o">)</span>

In <span class="o">[</span><span class="m">8</span><span class="o">]</span>: next<span class="o">(</span>myit<span class="o">)</span>
begin, end after yield: <span class="m">1</span>, <span class="m">2</span>
begin, end after <span class="nv">begin</span><span class="o">=</span>end: <span class="m">2</span>, <span class="m">2</span>
---------------------------------------------------------------------------
StopIteration                             Traceback <span class="o">(</span>most recent call last<span class="o">)</span>
&lt;ipython-input-8-410d07518a3f&gt; in &lt;module&gt;<span class="o">()</span>
----&gt; <span class="m">1</span> next<span class="o">(</span>myit<span class="o">)</span>

StopIteration:

In <span class="o">[</span><span class="m">9</span><span class="o">]</span>:
</pre></div>


<h1>Chapter 5</h1>
<h2>range object</h2>
<p>P95. <code>range</code> in Python 3 is lazy, immutable. It is <strong>not</strong> a generator,
and can be used multiple times.</p>
<p>See <a href="http://stackoverflow.com/questions/13092267/if-range-is-a-generator-in-python-3-3-why-can-i-not-call-next-on-a-range">If range() is a generator in Python 3.3, why can I not call next() on a range?</a>
for details.</p>
<h1>Chapter 7</h1>
<p>关于 Spearman rank-order correlation 一节的计算公式和具体含义，参考 <a href="https://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient#Example">Spearman's rank correlation coefficient</a>
的 <em>Example</em> 一节，给出了一个智商和看电视时间长度关系的例子很直观。</p>
<p>第1版第157页示例代码错误：
<code>rank_x= tuple(ranker(pairs, key=lambda x:x[0] ))</code>和
<code>rank_xy= (ranker(rank_x, key=lambda x:x[1] ))</code>中的<code>ranker</code>函数应为<code>rank_data</code>。</p>
<h2><code>rank_data</code>函数分析</h2>
<p><code>rank_data</code>函数的职责是做pattern matching：</p>
<ol>
<li>
<p>用<code>if</code>分支语句将输入数据转为<code>rerank</code>函数的输入格式交给<code>rerank</code>函数处理；</p>
</li>
<li>
<p>将<code>rerank</code>函数返回结果第1项（<code>float</code>类型的rank排序值）插入到返回结果第2项
   （<code>Rank_Data</code>对象）的<code>rank_seq</code>属性中。</p>
</li>
</ol>
<h2><code>rerank</code>函数分析</h2>
<p>输入是由<code>Rank_Data</code>组成的tuple，输出是一个iterator，
元素形如<code>(2.5, Rank_Data(rank_seq=(), raw=(3, 1.2)))</code>，验证如下：</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">cd</span> <span class="err">$</span><span class="n">FPP_CODE_SAMPLE</span><span class="o">/</span><span class="n">Chapter_7</span>
<span class="err">$</span> <span class="n">ipython</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ch07_ex4</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="n">obj</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">pairs</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">),</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">),</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">ranked</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Rank_Data</span><span class="p">((),</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">ranked</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">32</span><span class="p">]:</span> 
<span class="p">(</span><span class="n">Rank_Data</span><span class="p">(</span><span class="n">rank_seq</span><span class="o">=</span><span class="p">(),</span> <span class="n">raw</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)),</span>
 <span class="n">Rank_Data</span><span class="p">(</span><span class="n">rank_seq</span><span class="o">=</span><span class="p">(),</span> <span class="n">raw</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)),</span>
 <span class="n">Rank_Data</span><span class="p">(</span><span class="n">rank_seq</span><span class="o">=</span><span class="p">(),</span> <span class="n">raw</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)),</span>
 <span class="n">Rank_Data</span><span class="p">(</span><span class="n">rank_seq</span><span class="o">=</span><span class="p">(),</span> <span class="n">raw</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">)),</span>
 <span class="n">Rank_Data</span><span class="p">(</span><span class="n">rank_seq</span><span class="o">=</span><span class="p">(),</span> <span class="n">raw</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">18</span><span class="p">)))</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">reRank</span> <span class="o">=</span> <span class="n">rerank</span><span class="p">(</span><span class="n">ranked</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">reRank</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">34</span><span class="p">]:</span> 
<span class="p">[(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Rank_Data</span><span class="p">(</span><span class="n">rank_seq</span><span class="o">=</span><span class="p">(),</span> <span class="n">raw</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">))),</span>
 <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">Rank_Data</span><span class="p">(</span><span class="n">rank_seq</span><span class="o">=</span><span class="p">(),</span> <span class="n">raw</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">))),</span>
 <span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">Rank_Data</span><span class="p">(</span><span class="n">rank_seq</span><span class="o">=</span><span class="p">(),</span> <span class="n">raw</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">))),</span>
 <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">Rank_Data</span><span class="p">(</span><span class="n">rank_seq</span><span class="o">=</span><span class="p">(),</span> <span class="n">raw</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">))),</span>
 <span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">Rank_Data</span><span class="p">(</span><span class="n">rank_seq</span><span class="o">=</span><span class="p">(),</span> <span class="n">raw</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">18</span><span class="p">)))]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">reRank_y</span> <span class="o">=</span> <span class="n">rerank</span><span class="p">(</span><span class="n">ranked</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">reRank_y</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">37</span><span class="p">]:</span> 
<span class="p">[(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Rank_Data</span><span class="p">(</span><span class="n">rank_seq</span><span class="o">=</span><span class="p">(),</span> <span class="n">raw</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">))),</span>
 <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">Rank_Data</span><span class="p">(</span><span class="n">rank_seq</span><span class="o">=</span><span class="p">(),</span> <span class="n">raw</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">))),</span>
 <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">Rank_Data</span><span class="p">(</span><span class="n">rank_seq</span><span class="o">=</span><span class="p">(),</span> <span class="n">raw</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">))),</span>
 <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">Rank_Data</span><span class="p">(</span><span class="n">rank_seq</span><span class="o">=</span><span class="p">(),</span> <span class="n">raw</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">))),</span>
 <span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">Rank_Data</span><span class="p">(</span><span class="n">rank_seq</span><span class="o">=</span><span class="p">(),</span> <span class="n">raw</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">18</span><span class="p">)))]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">reRank_y</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="p">[]</span>
</pre></div>


<p>更详细的分析见<a href="https://github.com/leetschau/functional-python-programming/blob/master/Chapter_7/ch07_ex4.py#L53">rerank函数docstring</a>.</p>
<h2>Coroutine in Python</h2>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">cat</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span> <span class="o">&gt;</span> <span class="n">coro</span><span class="o">.</span><span class="n">py</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="k">def</span> <span class="nf">fib</span><span class="p">():</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">b</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">fg</span> <span class="o">=</span> <span class="n">fib</span><span class="p">()</span>
<span class="n">f10</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">fg</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">f10</span><span class="p">))</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">coro</span><span class="o">.</span><span class="n">py</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">55</span><span class="p">]</span>
</pre></div>


<h1>Chapter 8</h1>
<p>本章用到的函数示例：
http://docspy3zh.readthedocs.io/en/latest/library/itertools.html#module-itertools</p>
<p>P169: 演示打开多个文件的源代码多出一行，在译文中被去掉：</p>
<div class="highlight"><pre><span></span>readers = map(lambda f: csv.reader(f, delimiter=&#39;\t&#39;), files)
</pre></div>


<p>因为这行代码在本页下面被提出来，上面不应该先写出来，
且一段代码中有相邻的两个<code>readers</code>变量也不合理。</p>
<p>P170，<code>groupby()</code>函数只能处理按<code>key</code>排好序的序列，
如果没有排好序，<code>groupby()</code>将返回错误结果，示例：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">groupby</span>
<span class="n">things</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;animal&quot;</span><span class="p">,</span> <span class="s2">&quot;bear&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;plant&quot;</span><span class="p">,</span> <span class="s2">&quot;cactus&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;vehicle&quot;</span><span class="p">,</span> <span class="s2">&quot;speed boat&quot;</span><span class="p">),</span>
          <span class="p">(</span><span class="s2">&quot;vehicle&quot;</span><span class="p">,</span> <span class="s2">&quot;school bus&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;animal&quot;</span><span class="p">,</span> <span class="s2">&quot;duck&quot;</span><span class="p">)]</span>
<span class="n">types</span> <span class="o">=</span> <span class="n">groupby</span><span class="p">(</span><span class="n">things</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;-------- a new type ---------&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;key: </span><span class="si">%s</span><span class="s1">, thing: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">thing</span><span class="p">))</span>
<span class="n">sortedthings</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">things</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sortedtypes</span> <span class="o">=</span> <span class="n">groupby</span><span class="p">(</span><span class="n">sortedthings</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">sortedtypes</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;-------- a sorted type ---------&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;key: </span><span class="si">%s</span><span class="s1">, thing: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">thing</span><span class="p">))</span>
</pre></div>


<p>P175: </p>
<div class="highlight"><pre><span></span>filterfalse = lambda pred, iterable:
    filter(lambda x: not pred(x), iterable)
</pre></div>


<p>上面代码中，<code>pred</code>和<code>iterable</code>是输入参数，返回值是
<code>filter(lambda x: not pred(x), iterable)</code>.
参考<a href="https://docs.python.org/3/library/functions.html#filter">filter函数定义</a>,
上面的返回值可以写为：</p>
<div class="highlight"><pre><span></span>mypred = lambda x: not pred(x)
(item for item in iterable if mypred(item))
</pre></div>


<p>P178:</p>
<p>对<code>take</code>的表述有误，<code>function(0)</code>和<code>function(1)</code>后面还有更多值，
见https://docs.python.org/2/library/itertools.html#recipes</p>
<p><code>consume()</code>函数用法比较特别，它类似于<code>listobj.append()</code>函数，
最终结果不是通过返回值得到，而是直接修改输入参数的状态（例如上面的listobj对象）：</p>
<div class="highlight"><pre><span></span>myiter = iter(range(15))
consume(myiter, 7)
list(myiter)
</pre></div>


<p>而不是：</p>
<div class="highlight"><pre><span></span>myiter = iter(range(15))
res = consume(myiter, 7)
list(res)
</pre></div>


<h1>Chapter 9</h1>
<h2>像素数据格式</h2>
<p><code>pixel_subset</code>是一个tuple，其中每个元素又是一个tuple，
包含两部分：坐标和颜色值（用RGB三元组表示）。</p>
<div class="highlight"><pre><span></span>In [41]: pixel_subset
Out[41]:
(((0, 0), (92, 139, 195)),
 ((0, 1), (92, 139, 195)),
 ((0, 2), (92, 139, 195)),
 ((0, 3), (91, 138, 194)),
 ((0, 4), (91, 138, 194)),
 ((0, 5), (91, 138, 194)),
 ((0, 6), (91, 138, 194)),
 ((0, 7), (91, 138, 194)),
 ((0, 8), (92, 139, 195)),
 ((0, 9), (93, 140, 196)))
</pre></div>


<h2><code>combinations()</code> vs <code>combinations_with_replacement()</code></h2>
<p>早晨翻译了一页FPP，为了对比 <code>itertools</code> 模块中 <code>combinations()</code> 和
<code>combinations_with_replacement()</code> 函数的区别
（首先参考了<a href="https://docs.python.org/3/library/itertools.html">itertools doc</a>），
在华硕笔记本上安装了 Python3 版本的 <em>miniconda</em> (<code>choco install miniconda3</code>)，
安装完后 <code>conda</code> 不会被加进 <code>%PATH%</code>，而是在启动菜单里新建了一个快捷方式，
内容为 <code>%windir%\system32\cmd.exe "/K" C:\ProgramData\Miniconda3\Scripts\activate.bat C:\ProgramData\Miniconda3</code>，
启动它进入的是 <code>conda</code> 的 <em>root</em> 环境，新建一个 <em>fpp</em> 环境，
用 <code>conda</code> 安装 <code>python</code> 和 <code>ipython</code> 就可以使用 <em>IPython</em> 了
（比安装完整的 Anaconda 更精简），下面是两个函数的对比：</p>
<div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span><span class="p">,</span> <span class="n">combinations_with_replacement</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations_with_replacement</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span>
<span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
</pre></div>


<h2>make_color_map() 函数分析</h2>
<p><code>colors = get_colors()</code> 从"crayola.gpl"文件中加载颜色值，<code>colors</code>是一个tuple，
元素形如：<code>Color(rgb=(247, 83, 148), name='Violet Red')</code></p>
<div class="highlight"><pre><span></span>best = (min((euclidean(rgb, c), rgb, c) for c in colors)
         for rgb in product(bit3, bit3, bit3))
</pre></div>


<p>这里<code>best</code>的含义是：对每一个给定的<code>rgb</code>值，与<code>colors</code>中的每种颜色（的RGB值）
逐一比较，求出其中距离最短的值。这里利用了<code>min()</code>函数比较tuple时的取值特点：
<code>min((x0, y0, z0), (x1, y1, z1), …, (xn, yn, zn))</code>返回的tuple是x值最小的那个元素，
而与y, z的大小无关，例如</p>
<div class="highlight"><pre><span></span>»&gt;&gt; min((1, 20, 30), (1, 2, 3), (0.2, 1, 1))
(0.2, 1, 1)
</pre></div>


<p>然后利用for语句生成与每个RGB颜色最接近的Crayola颜色的值，例如下面的<code>best</code>的一个
元素表达的是：对RGB颜色<code>(0, 0, 0)</code>，与它最接近的Crayola颜色是名字为'Black'，
RGB为<code>(0, 0, 0)</code>的颜色：</p>
<div class="highlight"><pre><span></span>»&gt;&gt; best.next()
(0.0, (0, 0, 0), Color(rgb=(0, 0, 0), name=&#39;Black&#39;))
</pre></div>


<p>接下来以RGB颜色为key，以对应的Crayola颜色为value形成一个数据字典：
<code>color_map = dict((b[1], b[2].rgb) for b in best)</code>，例如：</p>
<div class="highlight"><pre><span></span>»&gt;&gt; color_map[(0, 64, 64)]
(26, 72, 118)
</pre></div>


<p>运行以上测试的方法为：<code>python -m Chapter_9.ch09_ex1</code>.</p>
<h2>permutations &amp; combinations</h2>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">permutations</span><span class="p">,</span> <span class="n">combinations</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">permutations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
<span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
</pre></div>


<p><code>permutations()</code>返回序列的所有排列，<code>combinations()</code>返回序列的所有组合，
<code>enumerate()</code>返回一组二元tuple，其中第一个元素是序列值的下标，第二个元素是序列值。</p>
<h2>'Generating all combinations' 一节代码分析</h2>
<p>对应源代码为 <em>Chapter_9/ch09_ex3.py</em>.</p>
<p>s7, s43等数据源都是一维list，格式为
<code>['', '2001', …, '2017', '', 'X', '1.2', …, '83', '', 'Y', '123', …, '93.6']</code>
详见http://www.tylervigen.com/view_correlation?id=7</p>
<p>但实际上是一个3行(n + 1)列的表格，第一行是表头，第二行是变量X的值，
第三行是变量Y的值，每一列是一个具体的年份，例如：</p>
<div class="highlight"><pre><span></span> | 2001 | 2002 | 2003 | 2017
</pre></div>


<p>---- | ---- | ---- | ---- | ----
 X   | 1.2  | 24.3 | 3.8  | 83
 Y   | 123  | 4.3  | 382  | 93.6</p>
<p>被<code>column_data()</code>处理后变为如下形式：</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">source</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">column_data</span><span class="p">(</span><span class="n">s7</span><span class="p">,</span> <span class="n">s3890</span><span class="p">,</span> <span class="n">s43</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pprint</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<span class="p">[(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Per capita consumption of cheese (US)Pounds (USDA)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Number of people who died by becoming tangled in their bedsheetsDeaths &#39;</span>
  <span class="s1">&#39;(US) (CDC)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;year&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Per capita consumption of mozzarella cheese (US)Pounds (USDA)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Civil engineering doctorates awarded (US)Degrees awarded (National &#39;</span>
  <span class="s1">&#39;Science Foundation)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;year&#39;</span><span class="p">,</span>
  <span class="s1">&#39;US crude oil imports from VenezuelaMillions of barrels (Dept. of Energy)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Per capita consumption of high fructose corn syrup (US)Pounds (USDA)&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;2000&#39;</span><span class="p">,</span> <span class="s1">&#39;29.8&#39;</span><span class="p">,</span> <span class="s1">&#39;327&#39;</span><span class="p">,</span> <span class="s1">&#39;2000&#39;</span><span class="p">,</span> <span class="s1">&#39;9.3&#39;</span><span class="p">,</span> <span class="s1">&#39;480&#39;</span><span class="p">,</span> <span class="s1">&#39;2000&#39;</span><span class="p">,</span> <span class="s1">&#39;446&#39;</span><span class="p">,</span> <span class="s1">&#39;62.6&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;2001&#39;</span><span class="p">,</span> <span class="s1">&#39;30.1&#39;</span><span class="p">,</span> <span class="s1">&#39;456&#39;</span><span class="p">,</span> <span class="s1">&#39;2001&#39;</span><span class="p">,</span> <span class="s1">&#39;9.7&#39;</span><span class="p">,</span> <span class="s1">&#39;501&#39;</span><span class="p">,</span> <span class="s1">&#39;2001&#39;</span><span class="p">,</span> <span class="s1">&#39;471&#39;</span><span class="p">,</span> <span class="s1">&#39;62.5&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;2002&#39;</span><span class="p">,</span> <span class="s1">&#39;30.5&#39;</span><span class="p">,</span> <span class="s1">&#39;509&#39;</span><span class="p">,</span> <span class="s1">&#39;2002&#39;</span><span class="p">,</span> <span class="s1">&#39;9.7&#39;</span><span class="p">,</span> <span class="s1">&#39;540&#39;</span><span class="p">,</span> <span class="s1">&#39;2002&#39;</span><span class="p">,</span> <span class="s1">&#39;438&#39;</span><span class="p">,</span> <span class="s1">&#39;62.8&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;2003&#39;</span><span class="p">,</span> <span class="s1">&#39;30.6&#39;</span><span class="p">,</span> <span class="s1">&#39;497&#39;</span><span class="p">,</span> <span class="s1">&#39;2003&#39;</span><span class="p">,</span> <span class="s1">&#39;9.7&#39;</span><span class="p">,</span> <span class="s1">&#39;552&#39;</span><span class="p">,</span> <span class="s1">&#39;2003&#39;</span><span class="p">,</span> <span class="s1">&#39;436&#39;</span><span class="p">,</span> <span class="s1">&#39;60.9&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;2004&#39;</span><span class="p">,</span> <span class="s1">&#39;31.3&#39;</span><span class="p">,</span> <span class="s1">&#39;596&#39;</span><span class="p">,</span> <span class="s1">&#39;2004&#39;</span><span class="p">,</span> <span class="s1">&#39;9.9&#39;</span><span class="p">,</span> <span class="s1">&#39;547&#39;</span><span class="p">,</span> <span class="s1">&#39;2004&#39;</span><span class="p">,</span> <span class="s1">&#39;473&#39;</span><span class="p">,</span> <span class="s1">&#39;59.8&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;2005&#39;</span><span class="p">,</span> <span class="s1">&#39;31.7&#39;</span><span class="p">,</span> <span class="s1">&#39;573&#39;</span><span class="p">,</span> <span class="s1">&#39;2005&#39;</span><span class="p">,</span> <span class="s1">&#39;10.2&#39;</span><span class="p">,</span> <span class="s1">&#39;622&#39;</span><span class="p">,</span> <span class="s1">&#39;2005&#39;</span><span class="p">,</span> <span class="s1">&#39;449&#39;</span><span class="p">,</span> <span class="s1">&#39;59.1&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;2006&#39;</span><span class="p">,</span> <span class="s1">&#39;32.6&#39;</span><span class="p">,</span> <span class="s1">&#39;661&#39;</span><span class="p">,</span> <span class="s1">&#39;2006&#39;</span><span class="p">,</span> <span class="s1">&#39;10.5&#39;</span><span class="p">,</span> <span class="s1">&#39;655&#39;</span><span class="p">,</span> <span class="s1">&#39;2006&#39;</span><span class="p">,</span> <span class="s1">&#39;416&#39;</span><span class="p">,</span> <span class="s1">&#39;58.2&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;2007&#39;</span><span class="p">,</span> <span class="s1">&#39;33.1&#39;</span><span class="p">,</span> <span class="s1">&#39;741&#39;</span><span class="p">,</span> <span class="s1">&#39;2007&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="s1">&#39;701&#39;</span><span class="p">,</span> <span class="s1">&#39;2007&#39;</span><span class="p">,</span> <span class="s1">&#39;420&#39;</span><span class="p">,</span> <span class="s1">&#39;56.1&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;2008&#39;</span><span class="p">,</span> <span class="s1">&#39;32.7&#39;</span><span class="p">,</span> <span class="s1">&#39;809&#39;</span><span class="p">,</span> <span class="s1">&#39;2008&#39;</span><span class="p">,</span> <span class="s1">&#39;10.6&#39;</span><span class="p">,</span> <span class="s1">&#39;712&#39;</span><span class="p">,</span> <span class="s1">&#39;2008&#39;</span><span class="p">,</span> <span class="s1">&#39;381&#39;</span><span class="p">,</span> <span class="s1">&#39;53&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;2009&#39;</span><span class="p">,</span> <span class="s1">&#39;32.8&#39;</span><span class="p">,</span> <span class="s1">&#39;717&#39;</span><span class="p">,</span> <span class="s1">&#39;2009&#39;</span><span class="p">,</span> <span class="s1">&#39;10.6&#39;</span><span class="p">,</span> <span class="s1">&#39;708&#39;</span><span class="p">,</span> <span class="s1">&#39;2009&#39;</span><span class="p">,</span> <span class="s1">&#39;352&#39;</span><span class="p">,</span> <span class="s1">&#39;50.1&#39;</span><span class="p">)]</span>
</pre></div>


<p>也就是3个数据源纵向合并形成一个二维表。<code>multi_corr(source)</code>函数计算<code>source</code>中
任意两列的相关系数（其中3个重复的<code>year</code>列彼此间的相关系数为1，被去掉），
计算结果格式为（元素中第3个值为相关系数）：
<code>[('X1', 'X2', 0.98), ('X3', 'X5', 0.96), … ]</code>.
完整代码：</p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; results = list(multi_corr(source))
&gt;&gt;&gt; results[0]
(&#39;year&#39;, &#39;Per capita consumption of cheese (US)Pounds (USDA)&#39;, 0.9630127825658988)
&gt;&gt;&gt; print( &quot;{2: 4.2f}: {0} vs {1}&quot;.format(*results[0]) )
 0.96: year vs Per capita consumption of cheese (US)Pounds (USDA)
</pre></div>


<h2><code>product()</code> 与 <code>permutations()</code> 的区别</h2>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; list(product(range(3), range(4)))
[(0, 0), (0, 1), (0, 2), (0, 3), (1, 0), (1, 1), (1, 2), (1, 3), (2, 0), (2, 1), (2, 2), (2, 3)]
&gt;&gt;&gt; list(permutations(range(3), 2))
[(0, 1), (0, 2), (1, 0), (1, 2), (2, 0), (2, 1)]
</pre></div>


<p>可以看到<code>product()</code>的参数是 n 个集合，<code>permutations()</code>的参数是一个集合和一个长度值，
前者可以看作多个集合组成的多重<code>for</code>循环，后者返回一个几个内部的所有排列。</p>
            
            
            <hr/>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2016-11-17T16:54:23+08:00">Nov 17, 2016</time>

<h4>Last Updated</h4>
<time datetime="2018-10-05T10:25:53+08:00">Oct 5, 2018</time>

            <h4>Category</h4>
            <a class="category-link" href="/categories.html#tech-ref">Tech</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="/tags.html#functional-programming-ref">functional programming
                    <span>9</span>
</a></li>
                <li><a href="/tags.html#python-ref">python
                    <span>116</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="#" title="My You can add links in your config file Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-you can add links in your config file sidebar-social-links"></i></a>
    <a href="#" title="My Another social link Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-another social link sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>