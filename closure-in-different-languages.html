<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Li Chao" />
        <meta name="copyright" content="Li Chao" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="closure, python, ruby, javascript, scala, Tech, " />

<meta property="og:title" content="Closure in Different Languages "/>
<meta property="og:url" content="http://leetschau.github.io/closure-in-different-languages.html" />
<meta property="og:description" content="The following code snippets compare closures in several languages. First is closure in javascript. Here I use nvm to run javascript code. $ cat closure.js function extent() { var n = 0; return function() { n++; console.log(&#34;n=&#34; + n); } } extent()(); extent()(); f = extent(); console.log(&#34;-----&#34;); //console.log(extent.uniqueId()); f(); f(); $ nvm …" />
<meta property="og:site_name" content="DarkMatter in Cyberspace" />
<meta property="og:article:author" content="Li Chao" />
<meta property="og:article:published_time" content="2014-08-20T10:39:48+08:00" />
<meta property="" content="2014-08-20T10:39:48+08:00" />
<meta name="twitter:title" content="Closure in Different Languages ">
<meta name="twitter:description" content="The following code snippets compare closures in several languages. First is closure in javascript. Here I use nvm to run javascript code. $ cat closure.js function extent() { var n = 0; return function() { n++; console.log(&#34;n=&#34; + n); } } extent()(); extent()(); f = extent(); console.log(&#34;-----&#34;); //console.log(extent.uniqueId()); f(); f(); $ nvm …">

        <title>Closure in Different Languages  · DarkMatter in Cyberspace
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://leetschau.github.io/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://leetschau.github.io/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://leetschau.github.io/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://leetschau.github.io/theme/css/custom.css" media="screen">
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://leetschau.github.io/"><span class=site-name>DarkMatter in Cyberspace</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://leetschau.github.io">Home</a></li>
                            <li ><a href="http://leetschau.github.io/categories.html">Categories</a></li>
                            <li ><a href="http://leetschau.github.io/tags.html">Tags</a></li>
                            <li ><a href="http://leetschau.github.io/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://leetschau.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="http://leetschau.github.io/closure-in-different-languages.html"> Closure in Different Languages  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            <hr>
<p>The following code snippets compare closures in several languages.</p>
<p>First is closure in javascript.
Here I use <a href="https://github.com/creationix/nvm">nvm</a> to run javascript code.</p>
<div class="highlight"><pre><span></span>$ <span class="nv">cat</span> <span class="nv">closure</span>.<span class="nv">js</span>
<span class="nv">function</span> <span class="nv">extent</span><span class="ss">()</span> {
    <span class="nv">var</span> <span class="nv">n</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">;</span>
    <span class="k">return</span> <span class="nv">function</span><span class="ss">()</span> {
        <span class="nv">n</span><span class="o">++</span><span class="c1">;</span>
        <span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">n=</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nv">n</span><span class="ss">)</span><span class="c1">;</span>
    }
}

<span class="nv">extent</span><span class="ss">()()</span><span class="c1">;</span>
<span class="nv">extent</span><span class="ss">()()</span><span class="c1">;</span>
<span class="nv">f</span> <span class="o">=</span> <span class="nv">extent</span><span class="ss">()</span><span class="c1">;</span>
<span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">-----</span><span class="s2">&quot;</span><span class="ss">)</span><span class="c1">;</span>
<span class="o">//</span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="nv">extent</span>.<span class="nv">uniqueId</span><span class="ss">())</span><span class="c1">;</span>
<span class="nv">f</span><span class="ss">()</span><span class="c1">;</span>
<span class="nv">f</span><span class="ss">()</span><span class="c1">;</span>

$ <span class="nv">nvm</span> <span class="nv">alias</span> <span class="nv">default</span> <span class="mi">0</span>.<span class="mi">10</span>
$ <span class="nv">nvm</span> <span class="nv">run</span> <span class="nv">closure</span>.<span class="nv">js</span>
<span class="nv">Running</span> <span class="nv">node</span> <span class="nv">v0</span>.<span class="mi">10</span>.<span class="mi">30</span>
<span class="nv">n</span><span class="o">=</span><span class="mi">1</span>
<span class="nv">n</span><span class="o">=</span><span class="mi">1</span>
<span class="o">-----</span>
<span class="nv">n</span><span class="o">=</span><span class="mi">1</span>
<span class="nv">n</span><span class="o">=</span><span class="mi">2</span>
</pre></div>


<p>In above example, the closure is <code>function() { n++; console.log... }</code>.
It's bound to variable "f". The local variable "n" is "closed" into closure.
Its lifetime is the same with "f".
So after the first execution of f, its inner state is saved.</p>
<p>For Python, nested function can only access variables in outer scope,
but can't reassign (modify) them.
So I use list as a workaround.
In Python 3, there is a new keyword "nonlocal" to remove this restriction.</p>
<div class="highlight"><pre><span></span>$ <span class="nv">cat</span> <span class="nv">closure</span>.<span class="nv">py2</span>.<span class="nv">py</span>
<span class="nv">def</span> <span class="nv">extent</span><span class="ss">()</span>:
    <span class="nv">n</span> <span class="o">=</span> [<span class="mi">0</span>]
    <span class="nv">def</span> <span class="nv">afun</span><span class="ss">()</span>:
        <span class="nv">n</span>[<span class="mi">0</span>] <span class="o">+=</span> <span class="mi">1</span>
        <span class="nv">print</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">n=</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nv">str</span><span class="ss">(</span><span class="nv">n</span>[<span class="mi">0</span>]<span class="ss">))</span>
    <span class="k">return</span> <span class="nv">afun</span>

<span class="nv">extent</span><span class="ss">()()</span>
<span class="nv">extent</span><span class="ss">()()</span>
<span class="nv">print</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">-----</span><span class="s1">&#39;</span><span class="ss">)</span>
<span class="nv">f</span> <span class="o">=</span> <span class="nv">extent</span><span class="ss">()</span>
<span class="nv">f</span><span class="ss">()</span>
<span class="nv">f</span><span class="ss">()</span>
<span class="nv">print</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">type of f is %s, its id is %d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="ss">(</span><span class="nv">type</span><span class="ss">(</span><span class="nv">f</span><span class="ss">)</span>, <span class="nv">id</span><span class="ss">(</span><span class="nv">f</span><span class="ss">)))</span>

$ <span class="nv">python</span> <span class="nv">closure</span>.<span class="nv">py2</span>.<span class="nv">py</span> 
<span class="nv">n</span><span class="o">=</span><span class="mi">1</span>
<span class="nv">n</span><span class="o">=</span><span class="mi">1</span>
<span class="o">-----</span>
<span class="nv">n</span><span class="o">=</span><span class="mi">1</span>
<span class="nv">n</span><span class="o">=</span><span class="mi">2</span>
<span class="nv">type</span> <span class="nv">of</span> <span class="nv">f</span> <span class="nv">is</span> <span class="o">&lt;</span><span class="nv">type</span> <span class="s1">&#39;</span><span class="s">function</span><span class="s1">&#39;</span><span class="o">&gt;</span>, <span class="nv">its</span> <span class="nv">id</span> <span class="nv">is</span> <span class="mi">140403684898408</span>

$ <span class="nv">cat</span> <span class="nv">closure</span>.<span class="nv">py3</span>.<span class="nv">py</span>
<span class="nv">def</span> <span class="nv">extent</span><span class="ss">()</span>:
    <span class="nv">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nv">def</span> <span class="nv">afun</span><span class="ss">()</span>:
        <span class="nv">nonlocal</span> <span class="nv">n</span>
        <span class="nv">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nv">print</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">n=</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nv">str</span><span class="ss">(</span><span class="nv">n</span><span class="ss">))</span>
    <span class="k">return</span> <span class="nv">afun</span>

<span class="nv">extent</span><span class="ss">()()</span>
<span class="nv">extent</span><span class="ss">()()</span>
<span class="nv">f</span> <span class="o">=</span> <span class="nv">extent</span><span class="ss">()</span>
<span class="nv">print</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">----</span><span class="s1">&#39;</span><span class="ss">)</span>
<span class="nv">f</span><span class="ss">()</span>
<span class="nv">f</span><span class="ss">()</span>
<span class="nv">print</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">type of f is %s, its id is %d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="ss">(</span><span class="nv">type</span><span class="ss">(</span><span class="nv">f</span><span class="ss">)</span>, <span class="nv">id</span><span class="ss">(</span><span class="nv">f</span><span class="ss">)))</span>

[<span class="mi">0</span>] <span class="nv">python3</span> <span class="nv">closure</span>.<span class="nv">py3</span>.<span class="nv">py</span>
<span class="nv">n</span><span class="o">=</span><span class="mi">1</span>
<span class="nv">n</span><span class="o">=</span><span class="mi">1</span>
<span class="o">----</span>
<span class="nv">n</span><span class="o">=</span><span class="mi">1</span>
<span class="nv">n</span><span class="o">=</span><span class="mi">2</span>
<span class="nv">type</span> <span class="nv">of</span> <span class="nv">f</span> <span class="nv">is</span> <span class="o">&lt;</span><span class="nv">class</span> <span class="s1">&#39;</span><span class="s">function</span><span class="s1">&#39;</span><span class="o">&gt;</span>, <span class="nv">its</span> <span class="nv">id</span> <span class="nv">is</span> <span class="mi">139914425096528</span>
</pre></div>


<p>The Ruby environment used here is <a href="http://rvm.io/">RVM</a>. Ruby version is 2.1.2.</p>
<div class="highlight"><pre><span></span>$ <span class="nv">rvm</span> <span class="nv">use</span> <span class="mi">2</span>.<span class="mi">1</span>.<span class="mi">2</span> <span class="o">--</span><span class="nv">default</span>
$ <span class="nv">cat</span> <span class="nv">closure</span>.<span class="nv">rb</span>
<span class="nv">def</span> <span class="nv">extent</span>
    <span class="nv">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nv">lambda</span> {
        <span class="nv">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nv">printf</span> <span class="s2">&quot;</span><span class="s">n=%d</span><span class="se">\n</span><span class="s2">&quot;</span>, <span class="nv">n</span>
    }
<span class="k">end</span>

<span class="nv">extent</span><span class="ss">()</span>.<span class="nv">call</span><span class="ss">()</span>
<span class="nv">extent</span><span class="ss">()</span>.<span class="nv">call</span><span class="ss">()</span>
<span class="nv">f</span> <span class="o">=</span> <span class="nv">extent</span><span class="ss">()</span>
<span class="nv">puts</span> <span class="s1">&#39;</span><span class="s">------</span><span class="s1">&#39;</span>
<span class="nv">f</span>.<span class="nv">call</span><span class="ss">()</span>
<span class="nv">f</span>.<span class="nv">call</span><span class="ss">()</span>
<span class="nv">puts</span> <span class="s2">&quot;</span><span class="s">class of f is #{f.class.name}, its id is #{f.object_id}</span><span class="s2">&quot;</span>

$ <span class="nv">ruby</span> <span class="nv">closure</span>.<span class="nv">rb</span>
<span class="nv">n</span><span class="o">=</span><span class="mi">1</span>
<span class="nv">n</span><span class="o">=</span><span class="mi">1</span>
<span class="o">------</span>
<span class="nv">n</span><span class="o">=</span><span class="mi">1</span>
<span class="nv">n</span><span class="o">=</span><span class="mi">2</span>
<span class="nv">class</span> <span class="nv">of</span> <span class="nv">f</span> <span class="nv">is</span> <span class="nv">Proc</span>, <span class="nv">its</span> <span class="nv">id</span> <span class="nv">is</span> <span class="mi">6724520</span>
</pre></div>


<p>Two versions of Scala,
define functions via "def" and "val" give different results:</p>
<div class="highlight"><pre><span></span>$ diff *.scala
1c1
&lt; def <span class="nv">extent</span> <span class="o">=</span> <span class="o">{</span>
---
&gt; val <span class="nv">extent</span> <span class="o">=</span> <span class="o">{</span>

$ cat closure-def.scala
def <span class="nv">extent</span> <span class="o">=</span> <span class="o">{</span>
    var <span class="nv">n</span> <span class="o">=</span> <span class="m">0</span>
    <span class="o">()</span> <span class="o">=</span>&gt; <span class="o">{</span>
        <span class="nv">n</span> <span class="o">+=</span> <span class="m">1</span>
        println<span class="o">(</span><span class="s2">&quot;n=&quot;</span> + n<span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>

extent<span class="o">()</span>
extent<span class="o">()</span>
val <span class="nv">f</span> <span class="o">=</span> extent
println<span class="o">(</span><span class="s2">&quot;------&quot;</span><span class="o">)</span>
f<span class="o">()</span>
f<span class="o">()</span>
println<span class="o">(</span>s<span class="s2">&quot;Class of f is </span><span class="si">${</span><span class="nv">f</span><span class="p">.getClass</span><span class="si">}</span><span class="s2">, its id is </span><span class="si">${</span><span class="nv">f</span><span class="p">.hashCode</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">)</span>

$ scala closure-def.scala
<span class="nv">n</span><span class="o">=</span><span class="m">1</span>
<span class="nv">n</span><span class="o">=</span><span class="m">1</span>
------
<span class="nv">n</span><span class="o">=</span><span class="m">1</span>
<span class="nv">n</span><span class="o">=</span><span class="m">2</span>
Class of f is class Main<span class="nv">$$</span>anon<span class="nv">$1$$</span>anonfun<span class="nv">$extent$1</span>, its id is <span class="m">8970973</span>

$ cat closure-val.scala 
val <span class="nv">extent</span> <span class="o">=</span> <span class="o">{</span>
    var <span class="nv">n</span> <span class="o">=</span> <span class="m">0</span>
    <span class="o">()</span> <span class="o">=</span>&gt; <span class="o">{</span>
        <span class="nv">n</span> <span class="o">+=</span> <span class="m">1</span>
        println<span class="o">(</span><span class="s2">&quot;n=&quot;</span> + n<span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>

extent<span class="o">()</span>
extent<span class="o">()</span>
val <span class="nv">f</span> <span class="o">=</span> extent
println<span class="o">(</span><span class="s2">&quot;------&quot;</span><span class="o">)</span>
f<span class="o">()</span>
f<span class="o">()</span>
println<span class="o">(</span>s<span class="s2">&quot;Class of f is </span><span class="si">${</span><span class="nv">f</span><span class="p">.getClass</span><span class="si">}</span><span class="s2">, its id is </span><span class="si">${</span><span class="nv">f</span><span class="p">.hashCode</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">)</span>
$ scala closure-val.scala 
<span class="nv">n</span><span class="o">=</span><span class="m">1</span>
<span class="nv">n</span><span class="o">=</span><span class="m">2</span>
------
$ scala closure-val.scala 
<span class="nv">n</span><span class="o">=</span><span class="m">1</span>
<span class="nv">n</span><span class="o">=</span><span class="m">2</span>
------
<span class="nv">n</span><span class="o">=</span><span class="m">3</span>
<span class="nv">n</span><span class="o">=</span><span class="m">4</span>
Class of f is class Main<span class="nv">$$</span>anon<span class="nv">$1$$</span>anonfun<span class="nv">$1</span>, its id is <span class="m">8970973</span>
</pre></div>
            
            
            <hr/>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2014-08-20T10:39:48+08:00">Aug 20, 2014</time>

<h4>Last Updated</h4>
<time datetime="2014-08-20T10:39:48+08:00">Aug 20, 2014</time>

            <h4>Category</h4>
            <a class="category-link" href="http://leetschau.github.io/categories.html#tech-ref">Tech</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="http://leetschau.github.io/tags.html#closure-ref">closure
                    <span>3</span>
</a></li>
                <li><a href="http://leetschau.github.io/tags.html#javascript-ref">javascript
                    <span>11</span>
</a></li>
                <li><a href="http://leetschau.github.io/tags.html#python-ref">python
                    <span>125</span>
</a></li>
                <li><a href="http://leetschau.github.io/tags.html#ruby-ref">ruby
                    <span>7</span>
</a></li>
                <li><a href="http://leetschau.github.io/tags.html#scala-ref">scala
                    <span>20</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="#" title="My You can add links in your config file Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-you can add links in your config file sidebar-social-links"></i></a>
    <a href="#" title="My Another social link Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-another social link sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>