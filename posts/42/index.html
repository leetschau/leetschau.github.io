
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dark Matter in Cyberspace</title>
  <meta name="author" content="Li Chao">

  
  <meta name="description" content="Sonarqube中的issue，也就是一个不符合代码规范的“问题”，有一个“状态(status)”属性，如果在某一版本的源代码上出现了一个issue（比如类过长），后来修改源代码导致这个issue消失（将此类改短），它的状态就会变为"Close"，但这个issue本身不会消失，Web &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://leetschau.github.io/posts/42/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Dark Matter in Cyberspace" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Dark Matter in Cyberspace</a></h1>
  
    <h2>A notes repository for Meteor.js, data mining, Linux, etc.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="leetschau.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/21/145134/">Sonarqube中的Issue</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-21T14:51:34+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>2:51 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Sonarqube中的issue，也就是一个不符合代码规范的“问题”，有一个“状态(status)”属性，如果在某一版本的源代码上出现了一个issue（比如类过长），后来修改源代码导致这个issue消失（将此类改短），它的状态就会变为"Close"，但这个issue本身不会消失，Web API查询时如不指定issue的statuses，默认是所有状态，因此就把一些已经Close的issue也查了出来，解决方法是在api后面加上"statuses=OPEN,REOPENED":</p>

<p><a href="http://">http://</a><host_ip>:<port>/api/issues/search?componentRoots=<project_key>:<package_name>&amp;pageSize=5000&amp;rules=<issue_key>&amp;statuses=OPEN,REOPENED</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/21/141802/">修改CentOS系统的最大连接数</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-21T14:18:02+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>2:18 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>一秒内最大连接数</h1>

<p>/etc/xinetd.conf中cps, instances, per_source由50改为1000,</p>

<p>重启服务： sudo /etc/init.d/xinetd restart</p>

<p>Ref: <a href="http://linux.vbird.org/linux_basic/0560daemons.php">鸟哥的Linux私房菜 第18章、认识系统服务</a></p>

<h1>用户可发起的最大进程数</h1>

<p>/etc/security/limits.d/90-nproc.conf，将1024改为了10240;</p>

<p>查询godu用户当前发起的进程数：ps -L -u godu|wc -l</p>

<p>Ref: <a href="http://timsvirtualworld.com/2013/03/increasing-number-of-processes-allowed-to-be-run-by-a-user-on-rhel-centos-6/">http://timsvirtualworld.com/2013/03/increasing-number-of-processes-allowed-to-be-run-by-a-user-on-rhel-centos-6/</a></p>

<h1>用户级连接限制数</h1>

<p>/etc/security/limits.conf增加：</p>

<p>godu    soft nofile   10000
godu    hard nofile   10000</p>

<p>验证方法：ulimit -Hn, ulimit -Sn</p>

<p>修改后需要重登录才能生效；</p>

<p>Ref: <a href="http://www.cyberciti.biz/faq/linux-increase-the-maximum-number-of-open-files/">Linux Increase The Maximum Number Of Open Files / File Descriptors (FD)</a></p>

<p>另：主机名定义</p>

<p>修改/etc/hosts</p>

<p>增加：10.0.2.49  bocoty49</p>

<p>验证：ping bocoty49</p>

<p>修改后即时生效，不需要重登录；</p>

<p>Ref: <a href="http://os.51cto.com/art/200803/68170.htm">Linux操作系统下/etc/hosts文件配置方法</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/21/095631/">Functional Programming in Python</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-21T09:56:31+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>9:56 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This program calculate file issues on specified packages, retrieved from Sonarqube Server.</p>

<h1>Origin imperative program</h1>

<p> from <strong>future</strong> import division
 import urllib2, json
 SERV_ADDR = &lsquo;10.0.2.74:9000&rsquo;
 FILE_LENGTH_ISSUE_KEY = &lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.sizes.FileLengthCheck&rsquo;
 METHOD_RELATED_ISSUE_KEYS = [&lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.sizes.MethodLengthCheck&rsquo;,
    &lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.sizes.ParameterNumberCheck&rsquo;,
    &lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.metrics.CyclomaticComplexityCheck&rsquo;,
    &lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.coding.NestedIfDepthCheck&rsquo;,
    &lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.duplicates.StrictDuplicateCodeCheck&rsquo;]
 def get_data(url):
  conn = urllib2.urlopen(url)
  return json.load(conn)
 def get_issue_num(proj_name, pkg_key, issue_key):
  issue_url = &lsquo;<a href="http://%s/api/issues/search?componentRoots=%s:%s&amp;pageSize=5000&amp;rules=%s">http://%s/api/issues/search?componentRoots=%s:%s&amp;pageSize=5000&amp;rules=%s</a>&rsquo;
  data = get_data(issue_url % (SERV_ADDR, proj_name, pkg_key, issue_key))
  issues = data[&lsquo;issues&rsquo;]
  return len(issues)
 def get_class_num(proj_name, pkg_key):
  class_num_url = &lsquo;<a href="http://%s/api/resources?resource=%s:%s&amp;metrics=classes">http://%s/api/resources?resource=%s:%s&amp;metrics=classes</a>&rsquo;
  data = get_data(class_num_url % (SERV_ADDR, proj_name, pkg_key))
  return data[0][&lsquo;msr&rsquo;][0][&lsquo;val&rsquo;]
 def get_method_num(proj_name, pkg_key):
  method_num_url = &lsquo;<a href="http://%s/api/resources?resource=%s:%s&amp;metrics=functions">http://%s/api/resources?resource=%s:%s&amp;metrics=functions</a>&rsquo;
  data = get_data(method_num_url % (SERV_ADDR, proj_name, pkg_key))
  return data[0][&lsquo;msr&rsquo;][0][&lsquo;val&rsquo;]
 def get_average_issue_ratio(proj_name, pkgs, issue_key, base_type_name):
  total_issue_num = 0
  total_base_num = 0
  for pkg in pkgs:
   total_issue_num += get_issue_num(proj_name, pkg, issue_key)
   total_base_num += base_type_name(proj_name, pkg)
  return total_issue_num / total_base_num</p>

<p> def file_length_check(proj_name, pkgs):
  res = get_average_issue_ratio(proj_name, pkgs, FILE_LENGTH_ISSUE_KEY, get_class_num)
  return &lsquo;{:.2%}&rsquo;.format(res)
 def method_related_checks(proj_name, pkgs):
  check_result = {}
  for issue_key in METHOD_RELATED_ISSUE_KEYS:
   res = get_average_issue_ratio(proj_name, pkgs, issue_key, get_method_num)
   issue_name = issue_key.split(&lsquo;.&rsquo;)[-1]
   check_result[issue_name] = &lsquo;{:.2%}&rsquo;.format(res)
  return check_result
 def get_test_lines(proj_name, pkg_key):
  &hellip;
  return covered_lines, valid_lines</p>

<p> def get_test_branches(proj_name, pkg_key):
  &hellip;
  return covered_branches, valid_branches</p>

<p> def get_average_coverage(proj_name, pkgs):
  lines = []
  for pkg in pkgs:
   res = get_test_lines(proj_name, pkg)
   lines.append(res)
  total_covered_lines = 0
  total_valid_lines = 0
  for item in lines:
   covered_lines, valid_lines = item
   total_covered_lines += covered_lines
   total_valid_lines += valid_lines
  average_line_coverage = total_covered_lines / total_valid_lines</p>

<p>  &hellip;</p>

<p>  average_branch_coverage = total_covered_branches / total_valid_branches</p>

<p>  return average_line_coverage, average_branch_coverage</p>

<h1>List Comprehension</h1>

<p> def get_average_issue_ratio(proj_name, pkgs, issue_key, base_type_name):
  total_issue_num = sum(get_issue_num(proj_name, pkg, issue_key) for pkg in pkgs)
  total_base_num = sum(base_type_name(proj_name, pkg) for pkg in pkgs)
  return total_issue_num / total_base_num</p>

<p> def get_average_coverage_v1(proj_name, pkgs):</p>

<p>  lines_info = [get_test_lines(proj_name, pkg) for pkg in pkgs]</p>

<p>  line_cov = sum(cov_line for (cov_line,<em>) in lines_info) / sum(valid_line for (</em>,valid_line) in lines_info)</p>

<p>  branches_info = [get_test_branches(proj_name, pkg) for pkg in pkgs]
  branch_cov = sum(cov_branch for (cov_branch,<em>) in branches_info) / sum(valid_branch for (</em>,valid_branch) in branches_info)</p>

<p>  return line_cov, branch_cov</p>

<p>You can see this declarative version is much readable than its imperative counterpart.</p>

<p>Note 1: Notice the usage of &ldquo;base_type_name&rdquo;. As a function (first-class citizen), it&rsquo;s passed as a ordinary parameter into the method.</p>

<p>Note 2: manipulate a complex list in the following way (result = (1+2+3)/(10+20+30)):</p>

<p> col = [(1,10), (2,20), (3,30)]</p>

<p> result = sum([x for (x,<em>) in col]) / sum([y for (</em>,y) in col])</p>

<p>in &ldquo;get_average_coverage_v1&rdquo; is still too complicated. So in the following sections you can see some more concise (and FP style) versions.</p>

<h1>Dictionary Comprehension</h1>

<p>def method_related_check_func(proj_name, pkgs):
 return {issue_key.split(&lsquo;.&rsquo;)[-1]:
   &lsquo;{:.2%}&rsquo;.format(get_average_issue_ratio(proj_name, pkgs,
             issue_key,
             get_method_num))
   for issue_key in METHOD_RELATED_ISSUE_KEYS}</p>

<p>Its imperative counterpart has better code shape, but this functional version is more expressive.</p>

<p>Ref: <a href="http://stackoverflow.com/questions/14507591/python-dictionary-comprehension">http://stackoverflow.com/questions/14507591/python-dictionary-comprehension</a></p>

<h1>Use zip, map and apply</h1>

<p> def get_average_coverage_v2(proj_name, pkgs):</p>

<p>  total_covered_lines, total_valid_lines = \      <br/>
    apply(lambda <em>x: map(lambda </em>y: sum(y), *x),    <br/>
      [get_test_lines(proj_name, pkg) for pkg in pkgs])<br/>
  return total_covered_lines / total_valid_lines</p>

<p> def get_cov_ratio(col):</p>

<p>  covered, valid = map(sum, apply(zip, col))</p>

<p>  return covered / valid</p>

<p> def get_coverage_data_v3(proj_name, pkgs):        <br/>
  return get_cov_ratio([get_test_lines(proj_name, pkg) for pkg in pkgs])</p>

<p> def get_coverage_data_v4(proj_name, pkgs):        <br/>
  cov_ratio = lambda col: reduce(operator.truediv, map(sum, apply(zip, col)))
  return cov_ratio([get_test_lines(proj_name, pkg) for pkg in pkgs])</p>

<p>v2 works, but it&rsquo;s too complicated and hard to understand. But there are some useful things in it: variable arguments in lambda expression.</p>

<p>v3 and v4 are almost the same:</p>

<ol>
<li><p>convert [(1,2), (11,22),(111,222)] to [(1,11,111),(2,22,222)] with &ldquo;apply(zip, &hellip;)&rdquo;;</p></li>
<li><p>add every element up (convert to [1+11+111, 2+22+222]) with &ldquo;map(sum, &hellip;)&rdquo;;</p></li>
<li><p>first element divided by the second: using external function in v3, or &ldquo;reduce&rdquo; in v4;</p></li>
</ol>


<p>Clearly this FP version is much readable than its imperative counterpart. You have to add &ldquo;import operator&rdquo; for v4.</p>

<p>The corresponding clojure function is:</p>

<p> (defn trans-metrics [col]
  (/ (apply + (map first col)) (apply + (map second col))))</p>

<p>or as function literal:</p>

<p> #(/ (apply + (map first %)) (apply + (map second %)))</p>

<p>It looks more readable than its Python counterpart.</p>

<h1>Final Script</h1>

<p>Note: Run Python script at command line with user defined functions:</p>

<p>For example you write a module named &ldquo;ex.py&rdquo;, and define a function &ldquo;getdata&rdquo; in it. Now run the following command in its directory: (the current working directory will be added in PYTHONPATH automatically)</p>

<p> python -c &lsquo;import ex;print ex.getdata(&ldquo;bb&rdquo;)&rsquo;</p>

<p>The ex.py and all functions in it are &ldquo;stable&rdquo; business logic. While the command (&ldquo;print ex.getdata()&rdquo; in this case) is &ldquo;how to use this tool&rdquo;, which will change frequently. Thus we divide frequent changed part from stable logic, which is a best practice of programming.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/20/151654/">Evernote Development in Python</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-20T15:16:54+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>3:16 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Follow <a href="http://dev.evernote.com/doc/start/python.php">The Evernote SDK for Python Quick-start Guide</a>:</p>

<ol>
<li><p>Get an account on sandbox.evernote.com and an API key;</p></li>
<li><p>Download Evernote SDK for python:</p></li>
</ol>


<p> $ sudo pip install evernote;</p>

<ol>
<li>A simple demo:</li>
</ol>


<p> from evernote.api.client import EvernoteClient</p>

<p> dev_token = &hellip; # get it from evernote dev server</p>

<p> client = EvernoteClient(token=dev_token)</p>

<p> userStore = client.get_user_store()</p>

<p> user = userStore.getUser()</p>

<p> type(user) # evernote.edam.type.ttypes.User</p>

<p> user.username # your user name of sandbox account</p>

<p> noteStore = client.get_note_store()</p>

<p> type(noteStore) # evernote.api.client.Store</p>

<p> notebooks = noteStore.listNotebooks()</p>

<p> for n in notebooks:</p>

<p>  print n.name</p>

<p>Now add a notebook in your account via web page, then run:</p>

<p> notebooks = noteStore.listNotebooks()</p>

<p> for n in notebooks:</p>

<p>  print n.name</p>

<p>You can get the list with newly added notebook.</p>

<ol>
<li>Create a new note:</li>
</ol>


<p> import evernote.edam.type.ttypes as Types</p>

<p> note = Types.Note()</p>

<p> note.title = &ldquo;Test note from EDAMTest.py&rdquo;</p>

<p> # set note content &hellip;</p>

<p> created_note = note_store.createNote(note)</p>

<p>Ref: <a href="https://github.com/evernote/evernote-sdk-python/blob/master/sample/client/EDAMTest.py">EDAMTest.py on github</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/20/092952/">Python Interactive Development Workflow</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-20T09:29:52+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>9:29 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The key of interactive programming is &ldquo;declarative programming&rdquo;, which can be expressed as following principles:</p>

<ol>
<li><p>Try to write all business logic in functions or classes, instead of procedures;</p></li>
<li><p>Express the result as return values of functions, instead of printing them to console;</p></li>
</ol>


<p>Then you store these functions or classes in your files. Then you start the REPL shell, load your function file, declare your inputs, run your functions with the inputs, evaluate the output; modify the function in file, reload your file in shell, run your functions again, reevaluate the output, continue this loop, until you get the expected output.</p>

<p>Between these loops, you have 2 window: an editor and a shell, the former for write &ldquo;real&rdquo; production code, the latter for loading file and doing some experiments, while switching between them with Alt-Tab. You only declare inputs once. Using shortcuts (Ctrl-p) to reload function file and re-test your function. So the loop will be very fast, and you can concentrate on the business logic itself.</p>

<p>emacs-for-python and IPython are the preferred editor and shell, both have powerful code completion functionality.</p>

<h1>Linux Shell</h1>

<p>Save some fundamental functions in a python file, say &ldquo;myfunc.py&rdquo;, Then use &ldquo;python -i myfunc.py&rdquo; to load all functions in myfunc.py and enter interactive shell.</p>

<h1>Python Console</h1>

<p>&ldquo;execfile(&lsquo;filename.py&rsquo;)&rdquo; to load (or reload) file;</p>

<p>&ldquo;dir()&rdquo; to list all variables;</p>

<p>&ldquo;del(variable)&rdquo; to clear a variable;</p>

<p>C-p, C-n to traverse in command history;</p>

<h1>IPython</h1>

<h2>Installation</h2>

<pre><code>sudo apt-get install ipython-notebook
</code></pre>

<h2>Command history traverse and back reference</h2>

<p>History inputs: all in dictionary &ldquo;In&rdquo;, use &ldquo;%hist -n&rdquo; list all previous command;</p>

<p>Output: all in dictionary &ldquo;Out&rdquo;, <em>1, </em>2, &hellip;</p>

<p>C-p, C-n, %rep <command_num></p>

<p>While all shortcuts supported by bash are available in IPython (See Command Line Shortcuts in Linux Shell for details).</p>

<h2>Command</h2>

<p>To line magic command, &ldquo;%&rdquo; can be omitted.</p>

<p>%pwd: pwd</p>

<p>!<cmd>: run shell command;</p>

<p>%run <file_name>: equals to &ldquo;execfile()&rdquo; in standard python shell;</p>

<p>%reset: clear all user defined variables;</p>

<p>%pycat <file_name>: show file content with syntax coloring;</p>

<p>%edit <file_name>: edit file;</p>

<p>%pdb or %run -d <file_name>: debug file;</p>

<h2>log utility</h2>

<p>%logstate: get the current state of log: on/off</p>

<p>%logstart -o <file_name></p>

<p>%logstop</p>

<h1>Emacs</h1>

<p><a href="https://github.com/gabrielelanaro/emacs-for-python">emacs-for-python</a></p>

<h1>Difference between &ldquo;import&rdquo; and &ldquo;run&rdquo;</h1>

<p>You can put some code after</p>

<pre><code>if __name__ == '__main__':
</code></pre>

<p>in a python file &ldquo;test.py&rdquo;. Then if you want run these codes, use &ldquo;run test.py&rdquo; in ipython or &ldquo;execfile(&lsquo;test.py&rsquo;)&rdquo; in python shell. If you don&rsquo;t want to run these code, use &ldquo;import test&rdquo;. But this is not a best practice. Try to put all things in functions and classes.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/19/173101/">Manage Historical Snapshots in Sonarqube</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-19T17:31:01+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>5:31 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Login as admin, go to a dashboard of a project, then click &ldquo;Configuration -> History&rdquo; at the upper-right corner of the panel.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/19/101234/">Work on Remote Git Repository</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-19T10:12:34+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>10:12 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Create New Branch</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/hackrole/pyevernote.git
</span><span class='line'>$ cd pyevernote
</span><span class='line'>$ git branch    // list all existing branches
</span><span class='line'>$ git checkout -b leetschau     // create new branch "leetschau" and checkout it</span></code></pre></td></tr></table></div></figure>


<h1>Push to remote repository</h1>

<p><code>$ git push origin leetschau</code>, where &ldquo;origin&rdquo; is repository name, &ldquo;leetschau&rdquo; is branch name.</p>

<p>When you push your branch the first time, add &ldquo;-u&rdquo; to specify that the current branch is associated with the remote branch.</p>

<p>Ref: <a href="http://stackoverflow.com/questions/6089294/why-do-i-need-to-do-set-upstream-all-the-time.">http://stackoverflow.com/questions/6089294/why-do-i-need-to-do-set-upstream-all-the-time.</a></p>

<h1>Push all branches to remote repository</h1>

<p><code>$ git push origin --all</code>.</p>

<h1>Sync with remote repository</h1>

<p>If there&rsquo;s no local changes, the first command is unnecessary.</p>

<pre><code>git checkout -- .
git pull --all
</code></pre>

<h1>Discard local changes</h1>

<p>Discard all local changes and keep the same with last commit in repo.</p>

<pre><code>git reset --hard HEAD
</code></pre>

<p>We need discard all local changes and keep the same with remote repository. Provided that you want sync with &ldquo;master&rdquo; branch in remote repository &ldquo;origin&rdquo;:</p>

<pre><code>$ git fetch orgin
$ git reset --hard origin/master
</code></pre>

<p>Note that files not in stage area (not been &ldquo;add&rdquo;) will remains, while files in stage area or committed will be removed.
If your remote repo is developed with git flow, your synchronized repo also need install git flow.
On CentOS, install it with <code>yum install gitflow</code>. See installation doc on <a href="https://github.com/nvie/gitflow">gitflow</a> for details.</p>

<h1>Remove Existing Branch</h1>

<pre><code>$ git push origin :leetchao
</code></pre>

<h1>Create, query and remove remote repository alias</h1>

<pre><code>$ git remote add pyevernote-repo https://github.com/hackrole/pyevernote.git
$ git remote -v
$ git remote rm pyevernote-repo
</code></pre>

<h1>Checkout from a existing repository and branch</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/hackrole/pyevernote.git
</span><span class='line'>$ cd pyevernote
</span><span class='line'>$ git branch -r               // list all local and remote branches
</span><span class='line'>  origin/leetschau
</span><span class='line'>  ...
</span><span class='line'>$ git checkout leetschau      // or "git checkout -b leetschau origin/leetschau" for old version git</span></code></pre></td></tr></table></div></figure>


<p>For verification, you can find &lsquo;remote=origin &hellip; under [branch &ldquo;leetschau&rdquo;]&rsquo; in file .git/config.</p>

<h1>Update from remote repository</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git fetch origin
</span><span class='line'>$ git status
</span><span class='line'>  Your branch is **behind** 'origin/develop' by 3 commits... (which means your local branch need to be updated with remote one)
</span><span class='line'>$ git merge origin/develop</span></code></pre></td></tr></table></div></figure>


<p>Or simply <code>git pull origin develop</code>, where develop is the branch name we want to sync.</p>

<p>Note: Be careful to use &ldquo;git pull&rdquo; for &ldquo;pull&rdquo; is too &ldquo;smart&rdquo;.
<a href="http://longair.net/blog/2009/04/16/git-fetch-and-merge/">git: fetch and merge, donât pull</a> gives the reason and provides an excellent explanation of what is &ldquo;branch&rdquo;.</p>

<h1>Move a git repository from Bitbucket to Github</h1>

<p>Based on <a href="http://www.blackdogfoundry.com/blog/moving-repository-from-bitbucket-to-github/">Moving Repository from Bitbucket to GitHub</a>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd $DSNOTE_HOME
</span><span class='line'>git remote rename origin bitbucket
</span><span class='line'>// create a new repository "dsnote" on Github
</span><span class='line'>git remote add origin https://github.com/leetschau/dsnote.git
</span><span class='line'>git push -u origin master
</span><span class='line'>git remote -v
</span><span class='line'>git branch -r</span></code></pre></td></tr></table></div></figure>


<h1>Other</h1>

<p>Always use <code>git status</code> to get current status, such as the difference between CWD and stage area, difference between stage area and local repository, and difference between local repository and remote repository.
Use <code>git log</code> to show commit history.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/14/160706/">Add Multiple Classpath Items in One Tag</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-14T16:07:06+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>4:07 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have to add many jar files to a &ldquo;javac&rdquo; and a &ldquo;junit&rdquo; task from command line arguments. The <pathemelent path/> inside <classpath/> tag is suited for this situation.</p>

<p>Ant script:</p>

<p> &lt;javac srcdir=&ldquo;${test.dir}&rdquo;</p>

<p>  destdir=&ldquo;${test.class.dir}&rdquo;
  encoding=&ldquo;UTF-8&rdquo;
  debug=&ldquo;true&rdquo;
  failonerror=&ldquo;true&rdquo;>
  <classpath>
   <pathelement location="${instrumented.class.dir}"/>
   <pathelement location="${src.class.dir}"/>
   <pathelement path="${pdegen.classpath}"/>
  </classpath>
 </javac></p>

<p> <junit printsummary="yes" fork="yes">
  <sysproperty key="net.sourceforge.cobertura.datafile"
   file="${cobertura.data.file}" />
  <classpath>
   <pathelement location="${instrumented.class.dir}"/>
   <pathelement location="${src.class.dir}"/>
   <pathelement location="${test.class.dir}"/>
   <pathelement location="${src.dir}"/>
   <pathelement location="${cobertura.path}"/>
   <pathelement path="${pdegen.classpath}"/>
  </classpath>
  <formatter type="xml"/>
  <batchtest todir="${unittest.report.dir}" haltonerror="yes">
   <fileset dir="${test.dir}">
    <include name="**/*.java" />
   </fileset>
  </batchtest>
 </junit></p>

<p>The corresponding command line is:</p>

<p> ant -Dpdegen.classpath=/path/to/jar1:/path/to/jar2 target_name</p>

<p>Here is the working Python script:</p>

<p>  from subprocess import call</p>

<p>  test_cmd = &lsquo;ant -buildfile unittest.xml -Drootdir=&rsquo;+ base_dir + \</p>

<pre><code>pkg_name +' -Dcobertura.path=/usr/share/ant/lib/cobertura.jar -Dpdegen.classpath='+classpath[pkg_name] 
</code></pre>

<p>  ret = call(test_cmd.split())</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/11/163132/">Use Remote Desktop Between Two Ubuntu Host</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-11T16:31:32+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>4:31 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Verified between Mint 14 Xfce, 2014-2-26.</p>

<h1>Server (IP: 10.21.3.31)</h1>

<ol>
<li><p><code>sudo aptitude install xrdp</code></p></li>
<li><p><code>sudo service xrdp start</code></p></li>
</ol>


<h1>Client</h1>

<ol>
<li><p>Install &ldquo;Remmina&rdquo; with Software Manager;</p></li>
<li><p>Launch Remmina, create a new connectiion with the following parameters:</p>

<p> Name: My PC
 Protocol: RDP - Remote Desktop Protocol
 Server: 10.21.3.31
 User name: chad (The desktop user)
 Password: xxx
 Resolution: Use client resolution
 Color depth: True color(32 bpp)</p></li>
<li><p>Connect to host;</p></li>
<li><p>If you want keyboard shortcuts of host, check the &ldquo;Grab all keyboard events&rdquo;;</p></li>
</ol>


<p>Now you can open a gedit window, and use left Ctrl key to active Chinese Input Method.</p>

<hr />

<p>Old version: 2013-11-11</p>

<h1>Server (IP: 10.21.3.31)</h1>

<ol>
<li><p>Install: sudo apt-get install tightvncserver</p></li>
<li><p>Config: vi ~/.vnc/xstartup</p></li>
</ol>


<p>Add: &ldquo;xfwm4 &amp; xfdesktop &amp; xfce4-panel &amp; xfce4-session&rdquo; after &ldquo; /etc/X11/Xsession&rdquo;</p>

<ol>
<li><p>Set login passwd: vncpasswd</p></li>
<li><p>Start service: vncserver :1 -geometry 800x600</p></li>
<li><p>Stop service: vncserver -kill :1</p></li>
</ol>


<h1>Client</h1>

<ol>
<li><p>Install: sudo apt-get install vncviewer</p></li>
<li><p>Connect: vncviewer 10.21.3.31:1</p></li>
</ol>


<p>Problem: This is a new desttop, how to connect to the &ldquo;old&rdquo; desktop?</p>

<p>Note:</p>

<p>There are some other vnc server, I tried vino and x11vnc both not work. Generally, GUI server function of Linux is much weak than that of Windows. You can use &ldquo;Remmina&rdquo; and rdp protocol to connect to a Windows server conveniently. So try to avoid use GUI between remote hosts, using ssh terminal instead.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/06/143348/">Change Default Application on Linux Mint Xfce</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-06T14:33:48+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>2:33 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Alt-F3 -> Preferred Application</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/43">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/41">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/11/20/104508/">Clear Chrome DNS Cache</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/11/19/103131/">Linux的图形化Git客户端</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/11/02/093547/">Move Window Between Multiple Screens via Tmux</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/31/011200/">Synchronize Data From MongoDB to Elasticsearch</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/30/131706/">Elasticsearch River for MongoDB</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/leetschau">@leetschau</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'leetschau',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Li Chao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
