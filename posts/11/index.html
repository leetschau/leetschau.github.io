
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dark Matter in Cyberspace</title>
  <meta name="author" content="Li Chao">

  
  <meta name="description" content="今天从Kickass上下载了黄秋生1996年主演的电影“伊波拉病毒”(Ebola Syndrome)，粤语版听不懂，于是想下载中文字幕，Windows上的射手播放器可以自动下载字幕，Linux上貌似没有这么好用的播放器，于是从射手网上下载了字幕文件，用iconv -f gbk -t utf8 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://leetschau.github.io/posts/11">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Dark Matter in Cyberspace" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Dark Matter in Cyberspace</a></h1>
  
    <h2>A note repository aims at Data Mining, Spark, Linux, Python.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:leetschau.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/17/094859/">在Linux上播放带中文字幕的电影</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-17T09:48:59+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:48 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天从<a href="https://kickass.to/">Kickass</a>上下载了黄秋生1996年主演的电影“伊波拉病毒”(Ebola Syndrome)，粤语版听不懂，于是想下载中文字幕，Windows上的射手播放器可以自动下载字幕，Linux上貌似没有这么好用的播放器，于是从<a href="http://shooter.cn/">射手网</a>上下载了字幕文件，用<code>iconv -f gbk -t utf8 ebola_chs.srt</code>将编码转为utf8，然后<code>sudo aptitude install mplayer</code>安装了MPlayer，发现无法正常播放中文字幕，按照网络上的介绍将默认编码设为UTF-8仍然是乱码，于是<code>sudo aptitude install smplayer</code>，然后<code>smplayer</code>启动，在[Preferences -> Subtitles -> Subtitles -> Encodings]中，将&#8221;Default subtitle encoding&#8221;设为为&#8221;UTF-8 (UTF-8)&ldquo;，将&#8221;Autoload -> Autoload subtitle files&#8221;设置为&#8221;All subs containing movie names&#8221;，并勾选&#8221;Select first available subtitle&#8221;，现在视频文件名是Ebola_LKRG.avi，字幕是Ebola_LKRG_chs.srt，播放视频文件时能够自动加载中文字幕，无乱码，另外[Preferences -> Subtitles -> Subtitles -> Font and colors -> Font]默认值为Arial，在MPlayer中同样设为Arial，中文字幕仍为乱码，可见造成乱码的原因很可能是程序本身不支持UTF8编码的多字节字符。</p>

<p>调整字幕延时：
如果某句对白在字幕文件中的时间标记是13s，但在影片中应该在第32s出现，则在[SMPlayer -> Subtitles -> Set delay&hellip;]中的值应设为-19000，即字幕向后推迟19秒。</p>

<p>搜索字幕：
[SMPlayer -> Subtitles -> Find subtitles on Opensubtitles.org].
或者安装subdownloader: <code>sudo aptitude install subdownloader</code>，但这样软件连接服务器速度很慢，不是很好用。</p>

<p>使用amule(<code>sudo aptitude install amule</code>)也可以搜索到这部影片，但下载速度很慢。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/15/110702/">Run Spark Tasks on ArchLinux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-15T11:07:02+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:07 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Install</h1>

<ol>
<li><p>Install JDK: <code>sudo pacman -S jdk7-openjdk</code>;</p></li>
<li><p>Download pre-build package (spark-1.1.0-bin-hadoop2.4.tgz) from <a href="http://spark.apache.org/">Apache Spark website</a>;</p></li>
<li><p>Extract and add path: <code>tar xf spark-1.1.0-bin-hadoop2.4.tgz</code>;</p></li>
</ol>


<h1>Run Spark script</h1>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/12/103608/">Two Java Building Tools</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-12T10:36:08+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:36 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I need build a java project to compare performance of <a href="http://logging.apache.org/log4j/2.x/">apache log4j</a> and <a href="http://logback.qos.ch/">Logback</a>. The following codes are the building procedures based on [Gradle]<a href="http://www.gradle.org/">http://www.gradle.org/</a>) and <a href="http://www.scala-sbt.org/">sbt</a>.</p>

<h1>sbt</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir myproject
</span><span class='line'>cd myproject
</span><span class='line'>cat &lt;&lt;EOF &gt; build.sbt
</span><span class='line'>name := "MyProject"
</span><span class='line'>
</span><span class='line'>version := "0.1"
</span><span class='line'>EOF
</span><span class='line'>mkdir project
</span><span class='line'>echo 'addSbtPlugin("com.typesafe.sbteclipse" % "sbteclipse-plugin" % "2.5.0")' &gt; project/plugins.sbt
</span><span class='line'>sbt eclipse</span></code></pre></td></tr></table></div></figure>


<p>Note that the blank line between &ldquo;name&rdquo; &amp; &ldquo;version&rdquo; in build.sbt is mandatory for Scala syntax.
Now start eclipse, import this proect, create new packages (com.boco.logb) and Java files (LoggerOneThread.java) in &ldquo;src/main/java&rdquo; folder, and config files (log4j.properties and logback.xml) in src/resources folder.
slf4j looks for log implementations based on jars in classpath instead of conifg files, so we add both 2 config files into resource folder.</p>

<p>The LoggerOneThread.java file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package com.boco.logb;
</span><span class='line'>
</span><span class='line'>import java.util.concurrent.TimeUnit;
</span><span class='line'>
</span><span class='line'>import org.slf4j.Logger;
</span><span class='line'>import org.slf4j.LoggerFactory;
</span><span class='line'>
</span><span class='line'>public class LoggerOneThread {
</span><span class='line'>    public static final long TOTAL_TIMES = 4000 * 1000;
</span><span class='line'>    private static final Logger logger = LoggerFactory
</span><span class='line'>            .getLogger(LoggerOneThread.class);
</span><span class='line'>
</span><span class='line'>    public static void main(String[] args) {
</span><span class='line'>        long start = System.nanoTime();
</span><span class='line'>        for (int i = 1; i &lt; TOTAL_TIMES; i++) {
</span><span class='line'>            logger.debug("This is a test message. This is another test message.");
</span><span class='line'>        }
</span><span class='line'>        long estimatedTime = TimeUnit.NANOSECONDS.toSeconds(System.nanoTime()
</span><span class='line'>                - start);
</span><span class='line'>        System.out.println("Write " + TOTAL_TIMES + " logs takes time "
</span><span class='line'>                + estimatedTime + " s.");
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Log4j config file log4j.properties:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>log4j.rootLogger = DEBUG, FILE
</span><span class='line'>
</span><span class='line'>log4j.appender.FILE=org.apache.log4j.RollingFileAppender
</span><span class='line'>log4j.appender.FILE.File=log4j.log
</span><span class='line'>log4j.appender.FILE.Append=true
</span><span class='line'>log4j.appender.FILE.MaxFileSize=50MB
</span><span class='line'>log4j.appender.FILE.MaxBackupIndex=10
</span><span class='line'>log4j.appender.FILE.layout=org.apache.log4j.PatternLayout
</span><span class='line'>log4j.appender.FILE.layout.ConversionPattern=%d{MM-dd HH:mm:ss.SSS} [%t] %p %c - %m%n</span></code></pre></td></tr></table></div></figure>


<p>Logback config file logback.xml:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
</span><span class='line'>&lt;configuration&gt;
</span><span class='line'>
</span><span class='line'>    &lt;appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;
</span><span class='line'>        &lt;file&gt;logback.log&lt;/file&gt;
</span><span class='line'>
</span><span class='line'>        &lt;rollingPolicy class="ch.qos.logback.core.rolling.FixedWindowRollingPolicy"&gt;
</span><span class='line'>            &lt;fileNamePattern&gt;logback.log.%i&lt;/fileNamePattern&gt;
</span><span class='line'>            &lt;minIndex&gt;1&lt;/minIndex&gt;
</span><span class='line'>            &lt;maxIndex&gt;11&lt;/maxIndex&gt;
</span><span class='line'>        &lt;/rollingPolicy&gt;
</span><span class='line'>
</span><span class='line'>        &lt;triggeringPolicy class="ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"&gt;
</span><span class='line'>            &lt;maxFileSize&gt;50MB&lt;/maxFileSize&gt;
</span><span class='line'>        &lt;/triggeringPolicy&gt;
</span><span class='line'>
</span><span class='line'>        &lt;encoder&gt;
</span><span class='line'>            &lt;pattern&gt;%date{MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger - %msg%n&lt;/pattern&gt;
</span><span class='line'>        &lt;/encoder&gt;
</span><span class='line'>    &lt;/appender&gt;
</span><span class='line'>
</span><span class='line'>    &lt;root level="DEBUG"&gt;
</span><span class='line'>        &lt;appender-ref ref="FILE" /&gt;
</span><span class='line'>    &lt;/root&gt;
</span><span class='line'>
</span><span class='line'>&lt;/configuration&gt;</span></code></pre></td></tr></table></div></figure>


<p>Add following dependencies into build.sbt.log4j:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>libraryDependencies ++= Seq(
</span><span class='line'>  "org.slf4j" % "slf4j-api" % "1.7.7",
</span><span class='line'>  "org.slf4j" % "slf4j-log4j12" % "1.7.7",
</span><span class='line'>  "log4j" % "log4j" % "1.2.17"
</span><span class='line'>)</span></code></pre></td></tr></table></div></figure>


<p>And the following into build.sbt.logback:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>libraryDependencies ++= Seq(
</span><span class='line'>  "org.slf4j" % "slf4j-api" % "1.7.7",
</span><span class='line'>  "ch.qos.logback" % "logback-classic" % "1.1.2",
</span><span class='line'>  "ch.qos.logback" % "logback-core" % "1.1.2"
</span><span class='line'>)</span></code></pre></td></tr></table></div></figure>


<p>Now delete .classpath file under project home folder, run <code>sbt eclipse</code> again to refresh classpath.</p>

<p>When coding completed, copy build.sbt.log4j (or build.sbt.logback) as build.sbt, run <code>sbt run</code> to run this project. Run <code>sbt package</code> to create jar file under target folder.</p>

<p>Some other settings in build.sbt:</p>

<pre><code>organization := "org.leechau"
</code></pre>

<h1>Gradle</h1>

<ol>
<li><p>Install gradle plugin for Eclipse, and create a Gradle Project &ldquo;MyProject&rdquo; in Eclipse, choose &ldquo;Java Quickstart&rdquo; as Sample project;</p></li>
<li><p>Add following lines into auto-created build.gradle file for log4j test:</p>

<pre><code> apply plugin: 'application'
 dependencies {
     compile 'org.slf4j:slf4j-api:1.7.7', 'log4j:log4j:1.2.17', 'org.slf4j:slf4j-log4j12:1.7.7'
 }
 mainClassName = "com.boco.logb.LoggerOneThread"
</code></pre></li>
<li><p>Refresh dependencies: [Gradle -> Refresh Dependencies] in context menu;</p></li>
<li><p>Run log4j test:</p>

<pre><code> cp build.gradle build.gradle.log4j
 gradle clean run
</code></pre></li>
<li><p>For logback test, create a new file build.gradle.logback based on build.gradle.log4j, but use the following dependencies:</p></li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>compile 'org.slf4j:slf4j-api:1.7.7', 'ch.qos.logback:logback-classic:1.1.2', 'ch.qos.logback:logback-core:1.1.2'</span></code></pre></td></tr></table></div></figure>


<p>The config files log4j.properties and logback.xml, and Java file LoggerOneThread.java are identical to that in sbt section.</p>

<ol>
<li><p>Run logback test:</p>

<pre><code> cp build.gradle.logback build.gradle
 gradle clean run
</code></pre></li>
</ol>


<h1>Eclipse Interface</h1>

<p>How to creat Eclipse setting files (.classpath and .project) so that we can import this project into Eclipse, editing and debuging in it.</p>

<p>For gradle, add <code>apply plugin: 'eclipse'</code> into build.gradle and run <code>gradle cleanEclipse eclipse</code>;</p>

<p>For sbt, add <code>addSbtPlugin("com.typesafe.sbteclipse" % "sbteclipse-plugin" % "2.5.0")</code> (for sbt 0.13) into $PROJECT_HOME/project/plugins.sbt, and run <code>sbt eclipse</code>;</p>

<h1>Run Program</h1>

<h2>gradle</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// run log4j test
</span><span class='line'>cp build.gradle.log4j build.gradle
</span><span class='line'>gradle clean run
</span><span class='line'>// run logback test
</span><span class='line'>cp build.gradle.logback build.gradle
</span><span class='line'>gradle clean run</span></code></pre></td></tr></table></div></figure>


<h2>sbt</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// run log4j test
</span><span class='line'>cp build.sbt.log4j build.sbt
</span><span class='line'>sbt clean run
</span><span class='line'>// run logback test
</span><span class='line'>cp build.sbt.logback build.sbt
</span><span class='line'>sbt clean run</span></code></pre></td></tr></table></div></figure>


<p>If you have multiple main entry in source files, you can use &lsquo;runMain com.boco.logb.LoggerOneThread&rsquo; instead of &ldquo;run&rdquo; to run a specific program.</p>

<h1>Conclusion</h1>

<p>Gradle is mainly for building of Groovy and Java project, while sbt is mainly for building of Scala and Java project. So far Gradle has better support for building Java project.
For example, it&rsquo;s very convenient to build production zip or tar files with Gradle&rsquo;s application plugin (via the &ldquo;distZip&rdquo; task), while there&rsquo;s no corresponding plugin in sbt.
It&rsquo;s convenient to add or remove dependencies within Eclipse with the Gradle plugin of Eclipse (not the eclipse plugin of Gradle), while there&rsquo;s no sbt plugin of Eclipse (sbteclipse of typesafehub is a eclipse plugin of sbt). So we have to refresh build path of dependencies manually when developing a project in Eclipse created by sbt.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/09/163500/">Package Repository Management on Ubuntu and Mint</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-09T16:35:00+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:35 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li><p>Add repository: &lsquo;sudo apt-add-repository ppa:kernel-ppa/ppa`</p></li>
<li><p>List all repositories: <code>ls /etc/apt/sources.list.d</code></p></li>
<li><p>Remove repository: <code>sudo apt-add-repository --remove ppa:kernel-ppa/ppa</code>.
If you can&rsquo;t get the ppa name, do it manually with <code>sudo rm /etc/apt/sources.list.d/theppa.list</code>.</p></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/03/150610/">Build BVT System Based on Docker</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-03T15:06:10+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>3:06 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>System: ArchLinux 64bit, IP address: 10.32.1.18.</p>

<h1>Build</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo docker -p 8080:8080 --name myjenkins jenkins</span></code></pre></td></tr></table></div></figure>


<p>Now you can access <a href="http://10.32.1.18:8080">jenkins server</a> in browser.</p>

<p>List running containers: <code>sudo docker ps</code> (so you can get the container&rsquo;s name for stoping and restarting later);</p>

<p>Stop jenkins server: <code>sudo docker stop myjenkins</code>;</p>

<p>Restart this server: <code>sudo docker start myjenkins</code>;</p>

<h1>Backup and Restore</h1>

<p>Backup image: <code>sudo docker save -o jenkins-docker.tar jenkins</code>;</p>

<p>Restore image: <code>sudo docker load -i jenkins-docker.tar</code>;</p>

<p>Backup container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(optional) sudo docker stop jenkins
</span><span class='line'>sudo docker export myjenkins &gt; mybvt-system.tar
</span><span class='line'>scp mybvt-system.tar chad@laptop:~/
</span><span class='line'>ssh chad@laptop
</span><span class='line'>cat mybvt-system.tar | sudo docker import - exampleimagelocal:new</span></code></pre></td></tr></table></div></figure>


<p>But where is the imported container?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/03/111703/">Automount USB Disk on Linux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-03T11:17:03+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>11:17 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>ArchLinux</h1>

<p>Install: <code>sudo pacman -S udiskie</code>;</p>

<p>Start service: run <code>udiskie &amp;</code> manually when system startup, or add &ldquo;udiskie &amp;&rdquo; into ~/.xinitrc;</p>

<p>Now when you plug USB key into computer, it will be automount to /media folder.</p>

<h2>Unmount USB disk</h2>

<p>Create an executable script in /usr/local/bin:</p>

<pre><code>$ cat /usr/local/bin/unmount
#!/bin/sh

# Global variables
TITLE="Unmount Utility"
COLUMNS=3 # TARGET,SOURCE,FSTYPE
#IFS=$'\n'

# Populate list of unmountable devices
deviceList=($(findmnt -Do TARGET,SOURCE,FSTYPE | grep -e "sd[b-z]"))
deviceCount=$((${#deviceList[@]} / $COLUMNS))

# Start of program output
echo $TITLE

# Display list of devices that can be unmounted
for ((device=0; device&lt;${#deviceList[@]}; device+=COLUMNS))
do
  printf "%4s)   %-25s%-13s%-10s\n"\
    "$(($device / $COLUMNS))"\
    "${deviceList[$device]}"\
    "${deviceList[$(($device + 1))]}"\
    "${deviceList[$(($device + 2))]}"
done

printf "%4s)   Exit\n" "x"

# Get input from user
read -p "Choose a menu option: " input

# Input validation
if [ "$input" = "X" ] || [ "$input" = "x" ]
then
  echo "Exiting"
  exit 0
fi

if (( $input&gt;=0 )) &amp;&amp; (( $input&lt;$deviceCount ))
then
  echo "Unmounting: ${deviceList[$(($input * $deviceCount))]}"
  sudo umount "${deviceList[$(($input * $deviceCount))]}"
  exit 0
else
  echo "Invalid menu choice"
  exit 1
fi
$ chmod 755 /usr/local/bin/unmount
</code></pre>

<p>Now when eject USB disk, run <code>unmount</code>, and choose a menu item to eject.
See <a href="https://wiki.archlinux.org/index.php/USB_storage_devices">USB storage devices</a> for details.
Or use <code>udiskie-umount -a</code> to unmount it manually.</p>

<p>See <code>man udiskie</code> for more information.</p>

<h1>Mint</h1>

<p>Install: <code>sudo aptitude install udevil</code>;</p>

<p>Start service: run <code>devmon</code> in dmenu when system startup, or add &ldquo;devmon &amp;&rdquo; into ~/.xsession;</p>

<p>After plug USB key into computer, it will be automount to /media folder.
If you do not startup devmon in background, you can run <code>devmon -a</code> to mount the USB key.</p>

<p>Run <code>devmon -c</code> to unmount the USB key.</p>

<p>See <code>man devmon</code> for more information.</p>

<h1>Difference between .xinitrc and .xsession:</h1>

<p>If you startup your system with <a href="https://wiki.archlinux.org/index.php/display_manager">display manager</a>, where you get a graphical login screen, it will read ~/.xsession.
In case of you startup your system without display manager and login to shell, startup i3 (or other wm) with <code>startx</code>, then the <a href="http://en.wikipedia.org/wiki/Xinit">xinit</a> program will read ~/.xinitrc;</p>

<p>See <a href="https://unix.stackexchange.com/questions/47359/what-is-xsession-for">What is “.xsession” for?</a> for details.</p>

<p>See <a href="https://wiki.archlinux.org/index.php/Arch_boot_process">Arch boot process</a> for how Getty manage login process in system boot process.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/30/104928/">Docker Notes</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-30T10:49:28+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:49 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Mint</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># sudo aptitude update
</span><span class='line'># sudo aptitude install docker.io aufs-tools cgroup-lite apparmor-utils
</span><span class='line'># sudo ln -sf /usr/bin/docker.io /usr/local/bin/docker
</span><span class='line'># sudo sed -i '$acomplete -F _docker docker' /etc/bash_completion.d/docker.io
</span><span class='line'># docker run ubuntu:14.04 echo 'hello ubuntu'
</span><span class='line'># docker version
</span><span class='line'>Client version: 0.9.1
</span><span class='line'>Go version (client): go1.2.1
</span><span class='line'>Git commit (client): 3600720
</span><span class='line'>Server version: 0.9.1
</span><span class='line'>Git commit (server): 3600720
</span><span class='line'>Go version (server): go1.2.1
</span><span class='line'>Last stable version: 1.2.0, please update docker</span></code></pre></td></tr></table></div></figure>


<h1>ArchLinux</h1>

<p>Docker is only available on X86_64 repository so far.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pacman -S docker
</span><span class='line'># systemctl enable docker
</span><span class='line'># systemctl start docker
</span><span class='line'># docker run ubuntu:14.04 echo 'hello world'
</span><span class='line'># docker run -i -t ubuntu:14.04 /bin/bash
</span><span class='line'># lsb_release -a
</span><span class='line'>Distributor ID: Ubuntu
</span><span class='line'>Description: Ubuntu 14.04.1 LTS
</span><span class='line'>Release: 14.04
</span><span class='line'>Codename: trusty
</span><span class='line'># exit
</span><span class='line'># docker version
</span><span class='line'>Client version: 1.2.0
</span><span class='line'>Go version (client): go1.3.1
</span><span class='line'>OS/Arch (client): linux/amd64
</span><span class='line'>Server version: 1.2.0
</span><span class='line'>Server API version: 1.14
</span><span class='line'>Go version (server): go1.3.1</span></code></pre></td></tr></table></div></figure>


<p>So you can see at least for now Docker is much newer and easy to use on Arch than on Mint (Ubuntu).
If you install &ldquo;tree&rdquo; with apt-get in the container, logout and relogin, you will find the &ldquo;tree&rdquo; command disappeared.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/27/180124/">Spark Notes</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-27T18:01:24+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>6:01 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Spark Shell</h1>

<h2>Shutdown info log in spark-shell:</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd $SPARK_HOME/conf    // here it's ~/apps/spark-1.0.2-bin-hadoop2/conf
</span><span class='line'>cp log4j.properties.template log4j.properties
</span><span class='line'>sed -i '2s/INFO/WARN/g' log4j.properties</span></code></pre></td></tr></table></div></figure>


<p>The sed command here replace &ldquo;INFO&rdquo; with &ldquo;WARN&rdquo; in the second line of log4j.properties.</p>

<h2>on cloud61</h2>

<p>Modify /opt/cloudera/parcels/CDH-5.2.0-1.cdh5.2.0.p0.36/lib/spark/conf/log4j.properties, add:</p>

<pre><code>log4j.appender.filelog=org.apache.log4j.RollingFileAppender
log4j.appender.filelog.layout=org.apache.log4j.PatternLayout
log4j.appender.filelog.File=sparkShell.log
log4j.appender.filelog.layout.ConversionPattern=%d{yy/MM/dd HH:mm:ss} %p %c{1}: %m%n
</code></pre>

<h2>Customize shell parameters</h2>

<h3>master and memory</h3>

<p>spark-shell &ndash;master spark://cloud60:7077 &ndash;driver-memory 2g &ndash;executor-memory 2g -i wfp-spark.script</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/26/100107/">Build Redis on CentOS 6</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-26T10:01:07+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:01 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This server can&rsquo;t access Internet. So we can only download source tarball (redis-2.8.2.tar.gz) and build from source.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tar xf redis-2.8.2.tar.gz
</span><span class='line'>cd redis-2.8.2
</span><span class='line'>// if you run "sudo make install" directly, it gives a "zmalloc.h:50:31: error: jemalloc/jemalloc.h: No such file or directory" error.
</span><span class='line'>cd deps
</span><span class='line'>sudo make hiredis jemalloc linenoise lua
</span><span class='line'>cd ..
</span><span class='line'>sudo make install</span></code></pre></td></tr></table></div></figure>


<p>Ref:
<a href="http://unix.stackexchange.com/questions/94479/jemalloc-and-other-errors-making-redis-on-centos-6-4">jemalloc and other errors making redis on centos 6.4</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/24/110909/">Build Working Environment With I3 and Mint</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-24T11:09:09+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:09 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Base System</h1>

<p>Install Linux Mint 17 Xfce with Live DVD (USB key created by YUMI 2.0.5) on Asus X84H laptop. The &ldquo;/&rdquo; partition is 30GB, while the &ldquo;/home&rdquo; partition is 50GB.</p>

<p>No need to install any hardware drivers. It simply works!</p>

<h1>Window Manager</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo aptitude install i3-wm dmenu i3status i3lock</span></code></pre></td></tr></table></div></figure>


<h2>Startup Configurations</h2>

<h3>MDM</h3>

<p>Mint&rsquo;s default graphical login manager is MDM,
see <a href="http://linuxmint.com/rel_qiana_xfce_whatsnew.php">New features in Linux Mint 17 Xfce</a>.
Logout of Xfce desktop. In login manager, you can find &ldquo;i3&rdquo;, choose it, and login i3 environment.
Its user level auto startup script is ~/.xsessionrc. It should be the same with .xinitrc.
So make a link from it with <code>ln -s ~/.xinitrc ~/.xsessionrc</code>.
See /etc/mdm/Xsession for variable definitions, such as USERXSESSION, USERXSESSIONRC, etc.
See <a href="https://wiki.ubuntu.com/CustomXSession">CustomXSession</a> for more.</p>

<h3>xinit</h3>

<p>See note &ldquo;Run Linux Without Desktop Environment&rdquo;.
Its user level auto startup script is ~/.xinitrc.</p>

<h2>Input Method</h2>

<p>Add the following lines into ~/.xinitrc before &ldquo;exec i3&rdquo;:</p>

<pre><code>export GTK_IM_MODULE=xim
export QT_IM_MODULE=xim
export XMODIFIERS="@im=fcitx"
fcitx &amp;
</code></pre>

<h2>Power Management in i3</h2>

<p>Check if &ldquo;pm-utils&rdquo; has been installed via <code>dpkg -l|grep pm-utils</code>. If not, install it with <code>sudo aptitude install pm-utils</code>;</p>

<p>Add the following line into /etc/sudoers:</p>

<pre><code>%sudo   ALL=(ALL) NOPASSWD: /sbin/poweroff, /sbin/reboot, /sbin/shutdown, /usr/sbin/pm-suspend, /usr/sbin/pm-suspend-hybrid
</code></pre>

<p>Add file /usr/local/bin/pm and <code>chmod 755 /usr/local/bin/pm</code>:</p>

<pre><code>#!/bin/sh
lock() {
    i3lock -c 000000
}

case "$1" in
    lk)
        lock
        ;;
    logout)
        i3-msg exit
        ;;
    ssd)
        lock &amp;&amp; sudo pm-suspend-hybrid
        ;;
    hibernate)
        lock &amp;&amp; sudo pm-hibernate
        ;;
    rbt)
        sudo reboot
        ;;
    shd)
        sudo poweroff
        ;;
    *)
        echo "Usage: $0 {lk|logout|ssd|hibernate|rbt|shd}"
        exit 2
esac
exit 0
</code></pre>

<p>The &ldquo;-c&rdquo; option of i3lock command specifies the screen color, where &ldquo;000000&rdquo; is black.</p>

<p>Now any user belonging to sudo group can run <code>pm lk|ssd|rbt|shd</code> to lock, suspend, reboot or shutdown computer without input password.
If the user is not a sudoer, run <code>usermod -aG sudo username</code> with root.
Verify user&rsquo;s group with <code>id</code>, <code>groups</code> or <code>groups username</code>.</p>

<p>Ref:</p>

<p><a href="http://askubuntu.com/questions/168879/shutdown-from-terminal-without-entering-password">http://askubuntu.com/questions/168879/shutdown-from-terminal-without-entering-password</a></p>

<p><a href="http://askubuntu.com/questions/159007/how-do-i-run-specific-sudo-commands-without-a-password">http://askubuntu.com/questions/159007/how-do-i-run-specific-sudo-commands-without-a-password</a></p>

<p><a href="http://askubuntu.com/questions/2214/how-do-i-add-a-user-to-the-sudo-group">http://askubuntu.com/questions/2214/how-do-i-add-a-user-to-the-sudo-group</a></p>

<p><a href="http://www.cyberciti.biz/faq/howto-linux-add-user-to-group/">http://www.cyberciti.biz/faq/howto-linux-add-user-to-group/</a></p>

<p><a href="http://linuxers.org/article/difference-between-primary-and-secondary-groups-linux">http://linuxers.org/article/difference-between-primary-and-secondary-groups-linux</a></p>

<h2>Config System Font</h2>

<ol>
<li><p>List all available fonts installed: <code>fc-list</code>. For example, when run <code>fc-list|grep wqy</code>, we got the name of this pre-installed Chinese font: &ldquo;WenQuanYi Micro Hei&rdquo;.</p></li>
<li><p>Edit config file ~/.i3/config: replace &ldquo;font -misc-fixed-medium-r-normal&ndash;13-120-75-75-C-70-iso10646-1&rdquo; with &ldquo;font pango:WenQuanYi Micro Hei 11&rdquo;.</p></li>
</ol>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/12">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/10">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/03/30/181242/">Convert MS Word File to PDF Files</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/30/175224/">Scrapy Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/27/173224/">优化网站加载速度的方法</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/26/203002/">Deploy Meteor Application Manually</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/25/195307/">Deploy Meteor App With MUP</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/leetschau">@leetschau</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'leetschau',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Li Chao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
