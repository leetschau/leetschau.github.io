
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dark Matter in Cyberspace</title>
  <meta name="author" content="Li Chao">

  
  <meta name="description" content="The simple web server is based on example 16-1 in &ldquo;Clojure Programming&rdquo; by Chas Emerick. I add it into a clojure project created by &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://leetschau.github.io/posts/11">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Dark Matter in Cyberspace" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Dark Matter in Cyberspace</a></h1>
  
    <h2>A note repository aims at Data Mining, Spark, Linux, Python.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:leetschau.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/27/113819/">A Simple Ring Server</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-27T11:38:19+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:38 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The simple web server is based on example 16-1 in &ldquo;Clojure Programming&rdquo; by Chas Emerick. I add it into a clojure project created by leiningen.</p>

<pre><code>$ lein new app ring-server
$ cd ring-server
// Add "[ring "1.0.0"]" into ":dependencies" of project.clj
$ vi src/ring-server/core.clj
$ cat src/ring-server/core.clj
(ns ring-server.core
  (:gen-class))

(use '[ring.adapter.jetty :only (run-jetty)])
(defn app
  [{:keys [uri query-string]}]
  {:body (format "You requested %s with query %s" uri query-string)})
(defn -main
  "this is a ring server"
  [port]
  (run-jetty #'app {:port (bigdec port) :join? false}))

$ lein run -m ring-server.core 8082
</code></pre>

<p>Now open <a href="http://localhost:8082/hello?at=china">http://localhost:8082/hello?at=china</a> in your browser, you can see &ldquo;You requested /hello with query at=china&rdquo;.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/24/073009/">Xen on CentOS 6</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-24T07:30:09+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>7:30 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Ref: <a href="http://wiki.centos.org/HowTos/Xen/Xen4QuickStart">Xen4 CentOS6 QuickStart</a> &amp; <a href="http://wiki.centos.org/HowTos/Xen/Xen4QuickStart/Xen4Libvirt">Xen4 Libvirt for CentOS 6</a>.</p>

<h1>Build Xen Server</h1>

<p>The IP address of the Xen server (a Dell PC) is 10.32.1.112.
First install CentOS 6.4 via Minimal CD (or LiveDVD) and install Xen on the new OS;</p>

<pre><code>yum update
yum groupinstall Virtualization
yum install centos-release-xen   // unnecessary if install OS with LiveDVD
yum install xen bridge-utils
/usr/bin/grub-bootxen.sh
reboot
yum install libvirt python-virtinst libvirt-daemon-xen
yum install rsync wget vim-enhanced openssh-clients   // unnecessary if install OS with LiveDVD
reboot
uname -r  // the kernel should be 3.x
xm info
useradd -m chad
groupadd remote-libvirt
usermod -G remote-libvirt chad
cat &gt; /etc/polkit-1/localauthority/50-local.d/50-libvirt-remote-access.pkla &lt;&lt;EOF
[Remote libvirt SSH access]
Identity=unix-group:remote-libvirt
Action=org.libvirt.unix.manage
ResultAny=yes
ResultInactive=yes
ResultActive=yes
EOF
</code></pre>

<h2>Config network</h2>

<p>Modify dom0 host file /etc/xen/xend-config.sxp:</p>

<p>Comment out &ldquo;(network-script /bin/true)&rdquo; to &ldquo;(network-script &lsquo;network-bridge bridge=virbr0 netdev=eth0&rsquo;)&rdquo;.</p>

<h1>Build Xen Client</h1>

<p>We usually do not work on a Xen dom0 server. So here we install xen client on a Mint OS, and control Xen server with it:</p>

<h2>GUI Client</h2>

<p>First install with <code>sudo aptitude install virt-manager</code>, then run it with <code>virt-manager</code>. The &ldquo;Virtual Machine Manager&rdquo; window appears.</p>

<p>[Edit -> Connect Details -> Storage], Location: /var/lib/libvirt/images. So copy an OS image file (here it&rsquo;s CentOS-6.5-x86_64-minimal.iso) to this folder, and press the refresh button after &ldquo;Volumns&rdquo;, the ISO file appears.</p>

<p>Click &ldquo;New&rdquo; on toolbar, Name: Cloud21, check &ldquo;Local install media&rdquo; -> Use ISO image: /var/lib/libvirt/images/CentOS-6.5-x86_64-minimal.iso, OS type: Linux, Version: Red Hat Enterprise Linux 6 -> Memory: 1024 MB, CPUs: 1 -> Create a disk image &hellip;: 8.0 GB.</p>

<p>Now install CentOS with Minimal ISO file.</p>

<h2>Console Client</h2>

<pre><code>sudo aptitude install libvirt-bin
virsh -c xen+ssh://chad@10.32.1.112
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/20/105816/">Lightweight Web Browser Dwb</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-20T10:58:16+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:58 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>List all shortcuts: ga, then click &ldquo;Keys&rdquo;
Open homepage: ga
Open links of current page in current tab: f
Open links of current page in new tab: F
Open a url by input manually in current tab: o
Open a url by input manually in a new tab: O
Close tab: d
Save current page to bookmark: M
Show all Bookmarks: ga
Save current page to quickmark: m
Open quick mark: b
Zoom in: +
Zoom out: -
Yank web page title: yt
Yank web page url: yy
Go to next tab: J
Go to previous tab: K
Go to previous page (history): H
Go to next page: L
Insert text: i</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/20/103138/">Set Time Synchronization on ArchLinux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-20T10:31:38+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:31 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Find out if current system time and time zone services status: <code>timedatectl status</code>.
If your &ldquo;Time zone&rdquo; is correct (Hongkong, in my case), and the &ldquo;NTP enabled&rdquo; is &ldquo;no&rdquo;, then you should open time synchronization service.</p>

<p>Run the following commands as root to set correct timezne and sync time with Internet.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ln -s /usr/share/zoneinfo/Hongkong /etc/localtime
</span><span class='line'># hwclock --systohc --utc
</span><span class='line'># systemctl enable systemd-timesyncd.service
</span><span class='line'># systemctl start systemd-timesyncd.service </span></code></pre></td></tr></table></div></figure>


<p>Ref: <a href="https://wiki.archlinux.org/index.php/Time">Time - ArchWiki</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/19/153017/">Linux From Scratch Notes</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-19T15:30:17+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>3:30 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Linux from Scratch (LFS) version: 7.5.</p>

<p>Host: Dell PC, ArchLinux.</p>

<h1>Partition Scheme</h1>

<p>The host is GPT, so use <code>cgdisk</code> to create 2 new partitions (after 2 existing partitions): root 10GB, and swap 4GB.
When asked for partition type, input &ldquo;L&rdquo;, it will list all type code, where code of linux swap is 8200.
Reboot and build as root:</p>

<pre><code>mkfs.ext4 /dev/sda3
mkswap /dev/sda4
export LFS=/mnt/lfs
mkdir -pv $LFS
mount -v -t ext4 /dev/sda3 $LFS
swapon -v /dev/sda4
mkdir $LFS/sources
chmod -v a+wt $LFS/sources
mkdir -v $LFS/tools
groupadd lfs
useradd -s /bin/bash -g lfs -m -k /dev/null lfs
passwd lfs
chown -R lfs:lfs $LFS
chown -v lfs $LFS/tools
ln -sv $LFS/tools /
chown -v lfs $LFS/sources
su - lfs

cat &gt; ~/.bash_profile &lt;&lt; "EOF"
exec env -i HOME=$HOME TERM=$TERM PS1='\u:\w\$ ' /bin/bash
EOF
cat &gt; ~/.bashrc &lt;&lt; "EOF"
set +h
umask 022
LFS=/mnt/lfs
LC_ALL=POSIX
LFS_TGT=$(uname -m)-lfs-linux-gnu
PATH=/tools/bin:/bin:/usr/bin
export LFS LC_ALL LFS_TGT PATH
EOF

wget -O wget-list http://www.linuxfromscratch.org/lfs/downloads/stable/wget-list
wget -i wget-list -P $LFS/sources

cd $LFS
tar xf sources/binutils-2.24.tar.bz2
cd binutils-2.24
./configure --prefix=/tools --with-sysroot=$LFS --with-lib-path=/tools/lib --target=$LFS_TGT --disable-nls --disable-werror 
make
mkdir -v /tools/lib
ln -sv lib /tools/lib64
make install
cd $LFS
tar xf sources/gcc-4.8.2.tar.bz2
tar xf sources/mpfr-3.1.2.tar.xz
tar xf sources/gmp-5.1.3.tar.xz
tar xf sources/mpc-1.0.2.tar.xz
mv mpfr* mpfr
mv gmp* gmp
mv mpc* mpc
mv mpfr gmp mpc gcc-4.8.2
cd gcc-4.8.2
cat &gt; runme.sh &lt;&lt;EOF
for file in $(find gcc/config -name linux64.h -o -name linux.h -o -name sysv4.h)
do
    cp -uv $file{,.orig}
    sed -e 's@/lib\(64\)\?\(32\)\?/ld@/tools&amp;@g' \
        -e 's@/usr@/tools@g' $file.orig &gt; $file
    echo '
#undef STANDARD_STARTFILE_PREFIX_1
#undef STANDARD_STARTFILE_PREFIX_2
#define STANDARD_STARTFILE_PREFIX_1 "/tools/lib/"
#define STANDARD_STARTFILE_PREFIX_2 ""' &gt;&gt; $file
    touch $file.orig
done
EOF
chmod 755 runme.sh
./runme.sh
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/17/215227/">Xen on ArchLinux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-17T21:52:27+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:52 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today I bought a new hard disk, and tried to install xen on it.</p>

<h1>Install Base ArchLinux</h1>

<ol>
<li><p>Start computer with USB key, choose x86_64, NBD;</p></li>
<li><p>This is not UEFI boot: an error raised when <code>efivar -l</code>;</p></li>
<li><p>Install system:</p>

<p> # rmmod tg3
 # modprobe broadcom
 # modprobe tg3
 # systemctl stop dhcpcd.service
 # dhcpcd enp2s0
 # sgdisk &ndash;zap-all /dev/sda
 # cgdisk /dev/sda
 // choose GPT partitions type, /dev/sda1: 50G, /dev/sda2: 300G, 581G free
 # mkfs.ext4 /dev/sda1
 # mkfs.ext4 /dev/sda2
 # mount /dev/sda1 /mnt
 # mkdir /mnt/home
 # mount /dev/sda2 /mnt/home
 # vi /etc/pacman.d/mirrorlist
 # export http_proxy=<a href="http://10.32.1.154:8888">http://10.32.1.154:8888</a>
 # export https_proxy=<a href="http://10.32.1.154:8888">http://10.32.1.154:8888</a>   // add the ip into &ldquo;allow&rdquo; list tinyproxy.conf
 # pacstrap -i /mnt base base-devel
 # genfstab -U -p /mnt >> /mnt/etc/fstab
 # vi /etc/locale.gen
 # locale-gen
 # echo LANG=en_US.UTF-8 > /etc/locale.conf
 # export LANG=en_US.UTF-8
 # ln -s /usr/share/zoneinfo/Hongkong /etc/localtime
 # hwclock &ndash;systohc &ndash;utc
 # echo xenserver > /etc/hostname
 # vi /etc/hosts
 # systemctl enable <a href="&#109;&#x61;&#105;&#x6c;&#116;&#111;&#58;&#x64;&#104;&#x63;&#112;&#99;&#x64;&#x40;&#x65;&#x6e;&#x70;&#x32;&#x73;&#48;&#x2e;&#x73;&#x65;&#x72;&#x76;&#x69;&#x63;&#x65;">&#100;&#x68;&#99;&#x70;&#x63;&#100;&#64;&#x65;&#x6e;&#112;&#50;&#x73;&#x30;&#x2e;&#x73;&#x65;&#114;&#118;&#105;&#x63;&#x65;</a>
 # passwd
 # export http_proxy=<a href="http://10.32.1.154:8888">http://10.32.1.154:8888</a>
 # export https_proxy=<a href="http://10.32.1.154:8888">http://10.32.1.154:8888</a>
 # pacman -S openssh
 # systemctl enable sshd.service
 # pacman -S gptfdisk            // use syslinux boot loader for GPT installed previously
 # pacman -S syslinux
 # syslinux-install_update -iam
 # vi /boot/syslinux/syslinux.cfg    // modify sda3 to sda1 in &ldquo;APPEND root=/dev/sda3&rdquo;
 # exit
 # reboot</p></li>
</ol>


<h1>Customize System</h1>

<p>After reboot, login as root and run:</p>

<pre><code># useradd -m chad
# passwd chad
# passwd -l root     // disable root login, use can remove this by `sudo passwd -u root`
# export http_proxy=http://10.32.1.154:8888
# export https_proxy=http://10.32.1.154:8888
# pacman -Syu
# pacman -S xorg-server xorg-server-utils xorg-xinit i3 dmenu xf86-video-intel terminator ttf-dejavu firefox
# su - chad
$ echo exec i3 &gt; ~/.xinitrc
$ startx
</code></pre>

<h1>Install Xen</h1>

<p>First make sure the host can access internet, then enable multilib repository, uncomment following lines in /etc/pacman.conf:</p>

<pre><code>[multilib]
Include = /etc/pacman.d/mirrorlist
</code></pre>

<p>Install yaourt, see note &ldquo;Yaourt Notes&rdquo; for details. Then run <code>yaourt -S xen</code>. If failed, install it manually:</p>

<p>Download xen.tar.gz, and run:</p>

<pre><code>tar xf xen.tar.gz
cd xen
makepkg
sudo pacman -U xen-4.4.1-1-x86_64.pkg.tar.xz
</code></pre>

<p>Config network:</p>

<pre><code># cd /etc/netctl
# cp examples/bridge xenbridge-dhcp
# vi xenbridge-dhcp
# netctl start xenbridge-dhcp
# brctl show
# netctl enable xenbridge-dhcp
</code></pre>

<p>Config services:</p>

<pre><code>sudo systemctl enable xenstored.service
sudo systemctl enable xenconsoled.service
sudo systemctl enable xendomains.service
</code></pre>

<p>Config boot loader. Add following stanza to /boot/syslinux/syslinux.cfg:</p>

<pre><code>LABEL xen
    MENU LABEL Xen
    KERNEL mboot.c32
    APPEND ../xen-4.4.1.gz --- ../vmlinuz-linux console=tty0 root=/dev/sda1 ro --- ../initramfs-linux.img
</code></pre>

<p>And make sure there is a &ldquo;mboot.c32&rdquo; file in folder /boot/syslinux, or you have to copy it:
<code>cp /usr/lib/syslinux/bios/mboot.c32 /boot/syslinux/</code>.</p>

<p>Note: If there is file conflicting errors, use <code>sudo pacman -U --force xen-4.4.1-1-x86_64.pkg.tar.xz</code> to install it.</p>

<p>Reboot, choose &ldquo;Xen&rdquo; at boot screen, then run <code>sudo xl list</code> (list all xen domains), you can see a &ldquo;Domain-0&rdquo; item.
If you boot with ArchLinux, run <code>sudo xl list</code> will report an error.</p>

<h1>Install Guest OS on Xen</h1>

<p>See <a href="http://wiki.xen.org/wiki/Xen_Configuration_File_Options#Disk_Devices">Xen Configuration File Options</a> for full syntax of xen domU config files.</p>

<h2>CentOS 6.5 minimal</h2>

<h3>PV</h3>

<p>Not succeed yet. Maybe we should use CentOS as dom0 system.</p>

<pre><code>$ mkdir ~/docs/cloud60
$ cd ~/docs/cloud60
$ dd if=/dev/zero of=cloud60.img bs=1M count=10240
$ mkfs.ext4 cloud60.img
$ sudo mount -o loop CentOS-6.5-x86_64-minimal.iso /mnt
$ cat cloud60.conf      // ???
$ sudo xl create -c cloud60.conf
</code></pre>

<h3>HVM</h3>

<pre><code>$ sudo pacman -S mesa-libgl bluez-libs tigervnc
$ mkdir ~/docs/cloud60
$ cd ~/docs/cloud60
$ dd if=/dev/zero of=cloud60.img bs=1M count=10240
$ mkfs.ext4 cloud60.img
$ sudo mount -o loop CentOS-6.5-x86_64-minimal.iso /mnt
$ cat cloud60.conf
name = "hvmcentos"
builder = "hvm"
memory = 1024
disk = [ "file:/home/chad/docs/cloud60/cloud60.img,xvda,w", "file:/home/chad/warez/CentOS-6.5-x86_64-minimal.iso,xvdb:cdrom,r" ]
vif = ["bridge=xenbr0"]
vnc = 1
vnclisten = "0.0.0.0"
vncdisplay = 1

$ sudo xl create cloud60.conf
$ sudo xl vncviewer hvmcentos
</code></pre>

<p>Or you can use <code>vncviewer localhost:5901</code> to connect to the guest OS, here the &ldquo;1&rdquo; in &ldquo;5901&rdquo; is determined by the value of &ldquo;vncdisplay&rdquo; in guest OS config file.
After connecting to the guest OS, install system, then reboot and connect it with vncviewer again.
You can use xl&rsquo;s subcommands &ldquo;list&rdquo;, &ldquo;top&rdquo; and &ldquo;info&rdquo; to probe domU systems.</p>

<h1>Using Xen</h1>

<p>Based on <a href="https://wiki.archlinux.org/index.php/Xen">Xen on Arch Wiki</a>.</p>

<p>Use Debian as dom0: <a href="http://wiki.xenproject.org/wiki/Xen_Project_Beginners_Guide#Installing_the_Xen_Project_Software">Xen Project Beginners Guide</a>;</p>

<p>Use CentOS as dom0: <a href="http://wiki.centos.org/HowTos/Xen/Xen4QuickStart">Xen4 CentOS6 QuickStart</a>;</p>

<p>Use Ubuntu as dom0: <a href="https://help.ubuntu.com/community/Xen">Xen in Ubuntu Community</a>;</p>

<p>Other patterns see <a href="http://wiki.xenproject.org/wiki/Category:Guest_Install">Guest Install</a>;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/17/094859/">在Linux上播放带中文字幕的电影</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-17T09:48:59+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:48 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天从<a href="https://kickass.to/">Kickass</a>上下载了黄秋生1996年主演的电影“伊波拉病毒”(Ebola Syndrome)，粤语版听不懂，于是想下载中文字幕，Windows上的射手播放器可以自动下载字幕，Linux上貌似没有这么好用的播放器，于是从<a href="http://shooter.cn/">射手网</a>上下载了字幕文件，用<code>iconv -f gbk -t utf8 ebola_chs.srt</code>将编码转为utf8，然后<code>sudo aptitude install mplayer</code>安装了MPlayer，发现无法正常播放中文字幕，按照网络上的介绍将默认编码设为UTF-8仍然是乱码，于是<code>sudo aptitude install smplayer</code>，然后<code>smplayer</code>启动，在[Preferences -> Subtitles -> Subtitles -> Encodings]中，将&#8221;Default subtitle encoding&#8221;设为为&#8221;UTF-8 (UTF-8)&ldquo;，将&#8221;Autoload -> Autoload subtitle files&#8221;设置为&#8221;All subs containing movie names&#8221;，并勾选&#8221;Select first available subtitle&#8221;，现在视频文件名是Ebola_LKRG.avi，字幕是Ebola_LKRG_chs.srt，播放视频文件时能够自动加载中文字幕，无乱码，另外[Preferences -> Subtitles -> Subtitles -> Font and colors -> Font]默认值为Arial，在MPlayer中同样设为Arial，中文字幕仍为乱码，可见造成乱码的原因很可能是程序本身不支持UTF8编码的多字节字符。</p>

<p>调整字幕延时：
如果某句对白在字幕文件中的时间标记是13s，但在影片中应该在第32s出现，则在[SMPlayer -> Subtitles -> Set delay&hellip;]中的值应设为-19000，即字幕向后推迟19秒。</p>

<p>搜索字幕：
[SMPlayer -> Subtitles -> Find subtitles on Opensubtitles.org].
或者安装subdownloader: <code>sudo aptitude install subdownloader</code>，但这样软件连接服务器速度很慢，不是很好用。</p>

<p>使用amule(<code>sudo aptitude install amule</code>)也可以搜索到这部影片，但下载速度很慢。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/15/110702/">Run Spark Tasks on ArchLinux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-15T11:07:02+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:07 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Install</h1>

<ol>
<li><p>Install JDK: <code>sudo pacman -S jdk7-openjdk</code>;</p></li>
<li><p>Download pre-build package (spark-1.1.0-bin-hadoop2.4.tgz) from <a href="http://spark.apache.org/">Apache Spark website</a>;</p></li>
<li><p>Extract and add path: <code>tar xf spark-1.1.0-bin-hadoop2.4.tgz</code>;</p></li>
</ol>


<h1>Run Spark script</h1>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/12/103608/">Two Java Building Tools</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-12T10:36:08+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:36 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I need build a java project to compare performance of <a href="http://logging.apache.org/log4j/2.x/">apache log4j</a> and <a href="http://logback.qos.ch/">Logback</a>. The following codes are the building procedures based on [Gradle]<a href="http://www.gradle.org/">http://www.gradle.org/</a>) and <a href="http://www.scala-sbt.org/">sbt</a>.</p>

<h1>sbt</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir myproject
</span><span class='line'>cd myproject
</span><span class='line'>cat &lt;&lt;EOF &gt; build.sbt
</span><span class='line'>name := "MyProject"
</span><span class='line'>
</span><span class='line'>version := "0.1"
</span><span class='line'>EOF
</span><span class='line'>mkdir project
</span><span class='line'>echo 'addSbtPlugin("com.typesafe.sbteclipse" % "sbteclipse-plugin" % "2.5.0")' &gt; project/plugins.sbt
</span><span class='line'>sbt eclipse</span></code></pre></td></tr></table></div></figure>


<p>Note that the blank line between &ldquo;name&rdquo; &amp; &ldquo;version&rdquo; in build.sbt is mandatory for Scala syntax.
Now start eclipse, import this proect, create new packages (com.boco.logb) and Java files (LoggerOneThread.java) in &ldquo;src/main/java&rdquo; folder, and config files (log4j.properties and logback.xml) in src/resources folder.
slf4j looks for log implementations based on jars in classpath instead of conifg files, so we add both 2 config files into resource folder.</p>

<p>The LoggerOneThread.java file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package com.boco.logb;
</span><span class='line'>
</span><span class='line'>import java.util.concurrent.TimeUnit;
</span><span class='line'>
</span><span class='line'>import org.slf4j.Logger;
</span><span class='line'>import org.slf4j.LoggerFactory;
</span><span class='line'>
</span><span class='line'>public class LoggerOneThread {
</span><span class='line'>    public static final long TOTAL_TIMES = 4000 * 1000;
</span><span class='line'>    private static final Logger logger = LoggerFactory
</span><span class='line'>            .getLogger(LoggerOneThread.class);
</span><span class='line'>
</span><span class='line'>    public static void main(String[] args) {
</span><span class='line'>        long start = System.nanoTime();
</span><span class='line'>        for (int i = 1; i &lt; TOTAL_TIMES; i++) {
</span><span class='line'>            logger.debug("This is a test message. This is another test message.");
</span><span class='line'>        }
</span><span class='line'>        long estimatedTime = TimeUnit.NANOSECONDS.toSeconds(System.nanoTime()
</span><span class='line'>                - start);
</span><span class='line'>        System.out.println("Write " + TOTAL_TIMES + " logs takes time "
</span><span class='line'>                + estimatedTime + " s.");
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Log4j config file log4j.properties:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>log4j.rootLogger = DEBUG, FILE
</span><span class='line'>
</span><span class='line'>log4j.appender.FILE=org.apache.log4j.RollingFileAppender
</span><span class='line'>log4j.appender.FILE.File=log4j.log
</span><span class='line'>log4j.appender.FILE.Append=true
</span><span class='line'>log4j.appender.FILE.MaxFileSize=50MB
</span><span class='line'>log4j.appender.FILE.MaxBackupIndex=10
</span><span class='line'>log4j.appender.FILE.layout=org.apache.log4j.PatternLayout
</span><span class='line'>log4j.appender.FILE.layout.ConversionPattern=%d{MM-dd HH:mm:ss.SSS} [%t] %p %c - %m%n</span></code></pre></td></tr></table></div></figure>


<p>Logback config file logback.xml:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
</span><span class='line'>&lt;configuration&gt;
</span><span class='line'>
</span><span class='line'>    &lt;appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;
</span><span class='line'>        &lt;file&gt;logback.log&lt;/file&gt;
</span><span class='line'>
</span><span class='line'>        &lt;rollingPolicy class="ch.qos.logback.core.rolling.FixedWindowRollingPolicy"&gt;
</span><span class='line'>            &lt;fileNamePattern&gt;logback.log.%i&lt;/fileNamePattern&gt;
</span><span class='line'>            &lt;minIndex&gt;1&lt;/minIndex&gt;
</span><span class='line'>            &lt;maxIndex&gt;11&lt;/maxIndex&gt;
</span><span class='line'>        &lt;/rollingPolicy&gt;
</span><span class='line'>
</span><span class='line'>        &lt;triggeringPolicy class="ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"&gt;
</span><span class='line'>            &lt;maxFileSize&gt;50MB&lt;/maxFileSize&gt;
</span><span class='line'>        &lt;/triggeringPolicy&gt;
</span><span class='line'>
</span><span class='line'>        &lt;encoder&gt;
</span><span class='line'>            &lt;pattern&gt;%date{MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger - %msg%n&lt;/pattern&gt;
</span><span class='line'>        &lt;/encoder&gt;
</span><span class='line'>    &lt;/appender&gt;
</span><span class='line'>
</span><span class='line'>    &lt;root level="DEBUG"&gt;
</span><span class='line'>        &lt;appender-ref ref="FILE" /&gt;
</span><span class='line'>    &lt;/root&gt;
</span><span class='line'>
</span><span class='line'>&lt;/configuration&gt;</span></code></pre></td></tr></table></div></figure>


<p>Add following dependencies into build.sbt.log4j:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>libraryDependencies ++= Seq(
</span><span class='line'>  "org.slf4j" % "slf4j-api" % "1.7.7",
</span><span class='line'>  "org.slf4j" % "slf4j-log4j12" % "1.7.7",
</span><span class='line'>  "log4j" % "log4j" % "1.2.17"
</span><span class='line'>)</span></code></pre></td></tr></table></div></figure>


<p>And the following into build.sbt.logback:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>libraryDependencies ++= Seq(
</span><span class='line'>  "org.slf4j" % "slf4j-api" % "1.7.7",
</span><span class='line'>  "ch.qos.logback" % "logback-classic" % "1.1.2",
</span><span class='line'>  "ch.qos.logback" % "logback-core" % "1.1.2"
</span><span class='line'>)</span></code></pre></td></tr></table></div></figure>


<p>Now delete .classpath file under project home folder, run <code>sbt eclipse</code> again to refresh classpath.</p>

<p>When coding completed, copy build.sbt.log4j (or build.sbt.logback) as build.sbt, run <code>sbt run</code> to run this project. Run <code>sbt package</code> to create jar file under target folder.</p>

<p>Some other settings in build.sbt:</p>

<pre><code>organization := "org.leechau"
</code></pre>

<h1>Gradle</h1>

<ol>
<li><p>Install gradle plugin for Eclipse, and create a Gradle Project &ldquo;MyProject&rdquo; in Eclipse, choose &ldquo;Java Quickstart&rdquo; as Sample project;</p></li>
<li><p>Add following lines into auto-created build.gradle file for log4j test:</p>

<pre><code> apply plugin: 'application'
 dependencies {
     compile 'org.slf4j:slf4j-api:1.7.7', 'log4j:log4j:1.2.17', 'org.slf4j:slf4j-log4j12:1.7.7'
 }
 mainClassName = "com.boco.logb.LoggerOneThread"
</code></pre></li>
<li><p>Refresh dependencies: [Gradle -> Refresh Dependencies] in context menu;</p></li>
<li><p>Run log4j test:</p>

<pre><code> cp build.gradle build.gradle.log4j
 gradle clean run
</code></pre></li>
<li><p>For logback test, create a new file build.gradle.logback based on build.gradle.log4j, but use the following dependencies:</p></li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>compile 'org.slf4j:slf4j-api:1.7.7', 'ch.qos.logback:logback-classic:1.1.2', 'ch.qos.logback:logback-core:1.1.2'</span></code></pre></td></tr></table></div></figure>


<p>The config files log4j.properties and logback.xml, and Java file LoggerOneThread.java are identical to that in sbt section.</p>

<ol>
<li><p>Run logback test:</p>

<pre><code> cp build.gradle.logback build.gradle
 gradle clean run
</code></pre></li>
</ol>


<h1>Eclipse Interface</h1>

<p>How to creat Eclipse setting files (.classpath and .project) so that we can import this project into Eclipse, editing and debuging in it.</p>

<p>For gradle, add <code>apply plugin: 'eclipse'</code> into build.gradle and run <code>gradle cleanEclipse eclipse</code>;</p>

<p>For sbt, add <code>addSbtPlugin("com.typesafe.sbteclipse" % "sbteclipse-plugin" % "2.5.0")</code> (for sbt 0.13) into $PROJECT_HOME/project/plugins.sbt, and run <code>sbt eclipse</code>;</p>

<h1>Run Program</h1>

<h2>gradle</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// run log4j test
</span><span class='line'>cp build.gradle.log4j build.gradle
</span><span class='line'>gradle clean run
</span><span class='line'>// run logback test
</span><span class='line'>cp build.gradle.logback build.gradle
</span><span class='line'>gradle clean run</span></code></pre></td></tr></table></div></figure>


<h2>sbt</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// run log4j test
</span><span class='line'>cp build.sbt.log4j build.sbt
</span><span class='line'>sbt clean run
</span><span class='line'>// run logback test
</span><span class='line'>cp build.sbt.logback build.sbt
</span><span class='line'>sbt clean run</span></code></pre></td></tr></table></div></figure>


<p>If you have multiple main entry in source files, you can use &lsquo;runMain com.boco.logb.LoggerOneThread&rsquo; instead of &ldquo;run&rdquo; to run a specific program.</p>

<h1>Conclusion</h1>

<p>Gradle is mainly for building of Groovy and Java project, while sbt is mainly for building of Scala and Java project. So far Gradle has better support for building Java project.
For example, it&rsquo;s very convenient to build production zip or tar files with Gradle&rsquo;s application plugin (via the &ldquo;distZip&rdquo; task), while there&rsquo;s no corresponding plugin in sbt.
It&rsquo;s convenient to add or remove dependencies within Eclipse with the Gradle plugin of Eclipse (not the eclipse plugin of Gradle), while there&rsquo;s no sbt plugin of Eclipse (sbteclipse of typesafehub is a eclipse plugin of sbt). So we have to refresh build path of dependencies manually when developing a project in Eclipse created by sbt.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/09/163500/">Package Repository Management on Ubuntu and Mint</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-09T16:35:00+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:35 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li><p>Add repository: &lsquo;sudo apt-add-repository ppa:kernel-ppa/ppa`</p></li>
<li><p>List all repositories: <code>ls /etc/apt/sources.list.d</code></p></li>
<li><p>Remove repository: <code>sudo apt-add-repository --remove ppa:kernel-ppa/ppa</code>.
If you can&rsquo;t get the ppa name, do it manually with <code>sudo rm /etc/apt/sources.list.d/theppa.list</code>.</p></li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/12">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/10">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/04/18/140631/">4月17日讲座文字稿</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/17/151844/">Linux Mint System Provision</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/16/172913/">Fzf让命令行更方便</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/15/105035/">How to Sync a Fork on Github</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/08/161006/">Python的Generator和yield</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/leetschau">@leetschau</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'leetschau',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Li Chao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
