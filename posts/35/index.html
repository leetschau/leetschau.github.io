
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dark Matter in Cyberspace</title>
  <meta name="author" content="Li Chao">

  
  <meta name="description" content="Installation: Install Ruboto Core and IRB from Google Play;
Run irb: double click &ldquo;Ruboto IRB&rdquo; icon;
Verify: input &ldquo;Dir.pwd&rdquo &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://leetschau.github.io/posts/35">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Dark Matter in Cyberspace" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Dark Matter in Cyberspace</a></h1>
  
    <h2>A note repository aims at Data Mining, Spark, Linux, Python.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:leetschau.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/26/155129/">Run Ruby Shell on Android</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-26T15:51:29+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>3:51 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><ol>
<li><p>Installation: Install Ruboto Core and IRB from Google Play;</p></li>
<li><p>Run irb: double click &ldquo;Ruboto IRB&rdquo; icon;</p></li>
<li><p>Verify: input &ldquo;Dir.pwd&rdquo;, my got the output: &ldquo;/storage/sdcard0/jruby&rdquo;;</p></li>
</ol>


<p>Verify device: HUAWEI C8813D (mobile phone), Android 4.1.1.</p>

<p>bingo.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/25/144450/">Git Commands and Configurations</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-25T14:44:50+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>2:44 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Some helpful resources:</p>

<p><a href="http://marklodato.github.io/visual-git-guide/index-en.html">A Visual Git Reference</a>;</p>

<p><a href="http://rogerdudler.github.io/git-guide/">git - the simple guide</a>;</p>

<p>Git has 3 places to store files: working dir, stage and history.
The last commit in history is called &ldquo;HEAD&rdquo;, all the older commits have their IDs.
In the following texts, &ldquo;a47c3&rdquo; and &ldquo;b325c&rdquo; are both sample revision IDs, which can be get with <code>git log --oneline</code>.</p>

<h1>Move Files</h1>

<ul>
<li><p>Working dir -> Stage: <code>git add -A</code> for all files, <code>git add -u</code> for update, <code>git add filename</code>;</p></li>
<li><p>Stage -> HEAD: <code>git commit filename</code>, <code>git commit</code> for all;</p></li>
<li><p>HEAD -> Stage: <code>git reset -- files</code>, <code>git reset</code> or <code>git reset -- .</code> for all;</p></li>
<li><p>Stage -> Working dir: <code>git checkout -- files</code>, <code>git checkout -- .</code> for all;</p></li>
<li><p>HEAD -> ( Stage &amp; Working dir ): <code>git checkout HEAD -- files</code>, <code>git checkout HEAD</code> do nothing;</p></li>
<li><p>Working dir -> ( Stage &amp; HEAD ): <code>git commit filename</code>, <code>git commit -a</code> for all;</p></li>
</ul>


<h1>Compare Files</h1>

<ul>
<li><p>Working dir <-> Stage: <code>git diff filename</code>, <code>git diff</code> for all;</p></li>
<li><p>Stage <-> HEAD: <code>git diff --cached filename</code>, <code>git diff --cached</code> for all;;</p></li>
<li><p>HEAD <-> Working dir: <code>git diff HEAD filename</code>, <code>git diff HEAD</code> for all;</p></li>
<li><p>Revision a47c3 <-> Working dir: <code>git diff a47c3 filename</code>, <code>git diff a47c3</code> for all;</p></li>
<li><p>Revision a47c3 <-> b325c: <code>git diff a47c3 b325c filename</code>, <code>git diff a47c3 b325c</code> for all;</p></li>
</ul>


<h1>Logs and Tags</h1>

<ul>
<li><p>Create a tag based on a commit: <code>git tag 1.0 a47c3</code>;</p></li>
<li><p>Print logs with tags and color highlights: <code>git log --decorate</code>;</p></li>
<li><p>Print logs with files changed: <code>git log --name-status</code>;</p></li>
<li><p>Print logs in one line for each: <code>git log --oneline</code>;</p></li>
<li><p>Print logs with all information: <code>git log --graph --decorate --name-status --all</code>;</p></li>
</ul>


<h1>Useful Commands</h1>

<p><code>git add &lt;files&gt;</code>: add files to stage area, use git rm &ndash;cached <file> to remove it from stage area (physical file remains);</p>

<p><code>git add -A</code>: If you use &ldquo;mv&rdquo; instead of &ldquo;git mv&rdquo; to rename a file, you can use this command to apply this rename operation to stage area;</p>

<p><code>git checkout &lt;commit&gt;</code>: make your working directory back to state <commit>;</p>

<pre><code>$ git checkout &lt;branch-name&gt;  // switch between branches
</code></pre>

<p><code>git checkout -- &lt;file-name&gt;</code>: use <file-name> in stage area replace its counterpart in working directory;</p>

<p><code>git checkout -- .</code>: abandon all modifications in working directory. Don&rsquo;t forget the last dot. It means &ldquo;all&rdquo;.</p>

<p><code>git clean -n</code>: &ldquo;dry run&rdquo; mode, preview the removed files;
<code>git clean -f</code>: remove all untracked files;
<code>git clean -f -d</code>: remove all untracked files and directories;</p>

<p><code>git commit</code>: commit all files in stage area;</p>

<p><code>git config</code>: see section &ldquo;git config&rdquo; below. list all configs: <code>git config --list</code>;</p>

<p><code>git diff</code>: compare file contents;</p>

<p><code>git init</code>: initialize local repository;</p>

<p><code>git log --stat</code>: list log with file changes;</p>

<p><code>git mv &lt;old-file-name&gt; &lt;new-file-name&gt;</code></p>

<p><code>git remote show origin</code>: git equivalent of &ldquo;svn info&rdquo;;</p>

<p><code>git reset --hard &lt;commit&gt;</code>: go back to <commit> completely, both working directory and repository, the history is lost;</p>

<p><code>git reset</code>: undo all &ldquo;git add&rdquo; commands, same with &ldquo;git reset HEAD&rdquo;;</p>

<p><code>git reset -- &lt;file-name&gt;</code>: only remove <file-name> from stage area;</p>

<p><code>git rm</code>:</p>

<p><code>git show &lt;object&gt;</code>: show information of <object>, like a commit, the following command show the information of commit 389be, like &ldquo;git log &hellip;&rdquo;:</p>

<pre><code>git show 389be --stat
</code></pre>

<p>or <strong>print file contents of a specified version</strong>, the following command show the file contents of the parent of HEAD:</p>

<pre><code>git show HEAD~1:donno/cloudsync.py
</code></pre>

<p>Note that the colon after version is necessary, or it will print the difference between HEAD~1 &amp; HEAD~2 when it&rsquo;s <code>git show HEAD~1 filename</code>;</p>

<p><code>git stash</code>: save current working directory and index and change them to the state of last commit;</p>

<p><code>git stash apply</code>: restore last &ldquo;stash save&rdquo;;</p>

<p><code>git stash drop</code>: delete last &ldquo;stash save</p>

<p><code>git stash pop</code>: git stash apply + git stash drop</p>

<p><code>git stash clear</code>: clear all stash saves;</p>

<p><code>git status</code></p>

<h2>Undo the last commit</h2>

<p>After a commit with <code>git commit -m "..."</code>, I found I forget to update version number which is defined in file build.gradle.
Now I need undo the last commit, modify version number in build.gradle, then commit again with the same commit comments.</p>

<pre><code>$ git reset --soft HEAD~1
// edit build.gradle
$ git add -u
$ git commit -c ORIG_HEAD
</code></pre>

<p>Ref: <a href="http://stackoverflow.com/questions/927358/undo-the-last-git-commit">Undo the last Git commit?</a></p>

<p>GUI tool: <code>gitk</code>, see all branches with <code>gitk --all</code>.</p>

<h1>Git config</h1>

<p>Add the following lines into user level config file ~/.gitconfig, or system level config file /etc/gitconfig:</p>

<pre><code>[user]
    name = leetschau
    email = leetschau@gmail.com
[alias]
    ci = commit -s
    co = checkout
    br = branch
    lg = log --stat --graph --decorate --all
</code></pre>

<p>Here in <code>git log</code>, &ndash;stat prints file changed info, &ndash;all print all branches instead of current branch,
&ndash;decorate print branch/tag info, &ndash;graph print hierarchical relation lines between commits.</p>

<p>Or change configs in command line:</p>

<pre><code>git config --global alias.ci "commit -s"
git config --global user.name "leetschau"
git config --global user.email "leetschau@gmail.com"
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/22/172634/">Run Clojure Script Portable</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-22T17:26:34+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2013</span></span> <span class='time'>5:26 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>leiningen is great, but it&rsquo;s for project-level application. How to run clojure script on a bare host, like python script?</p>

<p>Yes, python is build-in for almost all Linux host. But you can build your clojure environment on a host only depends JVM:</p>

<ol>
<li><p>Download clojure distribution from <a href="http://clojure.org/">clojure official website</a>, and extract it somewhere, say, ~/apps/clojure-1.5.1;</p></li>
<li><p>Add a alias in your ~/.bashrc:</p></li>
</ol>


<p> alias clj=&lsquo;java -cp ~/apps/clojure-1.5.1/clojure-1.5.1.jar clojure.main&rsquo;</p>

<ol>
<li>Validate your .bashrc: &ldquo;. ~/.bashrc&rdquo;;</li>
</ol>


<p>That&rsquo;s it!</p>

<p>Now run clojure repl with command &ldquo;clj&rdquo;. Then write a clojure hello world file &ldquo;hw.clj&rdquo;: (println &ldquo;hello world&rdquo;), then run &ldquo;clj hw.clj&rdquo;, you can see the output is the same as you run it in clojure repl console.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/21/145134/">Sonarqube中的Issue</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-21T14:51:34+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>2:51 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Sonarqube中的issue，也就是一个不符合代码规范的“问题”，有一个“状态(status)”属性，如果在某一版本的源代码上出现了一个issue（比如类过长），后来修改源代码导致这个issue消失（将此类改短），它的状态就会变为&#8221;Close&#8221;，但这个issue本身不会消失，Web API查询时如不指定issue的statuses，默认是所有状态，因此就把一些已经Close的issue也查了出来，解决方法是在api后面加上&#8221;statuses=OPEN,REOPENED&#8221;:</p>

<p><a href="http://">http://</a><host_ip>:<port>/api/issues/search?componentRoots=<project_key>:<package_name>&amp;pageSize=5000&amp;rules=<issue_key>&amp;statuses=OPEN,REOPENED</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/21/141802/">修改CentOS系统的最大连接数</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-21T14:18:02+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>2:18 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>一秒内最大连接数</h1>

<p>/etc/xinetd.conf中cps, instances, per_source由50改为1000,</p>

<p>重启服务： sudo /etc/init.d/xinetd restart</p>

<p>Ref: <a href="http://linux.vbird.org/linux_basic/0560daemons.php">鸟哥的Linux私房菜 第18章、认识系统服务</a></p>

<h1>用户可发起的最大进程数</h1>

<p>/etc/security/limits.d/90-nproc.conf，将1024改为了10240;</p>

<p>查询godu用户当前发起的进程数：ps -L -u godu|wc -l</p>

<p>Ref: <a href="http://timsvirtualworld.com/2013/03/increasing-number-of-processes-allowed-to-be-run-by-a-user-on-rhel-centos-6/">http://timsvirtualworld.com/2013/03/increasing-number-of-processes-allowed-to-be-run-by-a-user-on-rhel-centos-6/</a></p>

<h1>用户级连接限制数</h1>

<p>/etc/security/limits.conf增加：</p>

<p>godu    soft nofile   10000
godu    hard nofile   10000</p>

<p>验证方法：ulimit -Hn, ulimit -Sn</p>

<p>修改后需要重登录才能生效；</p>

<p>Ref: <a href="http://www.cyberciti.biz/faq/linux-increase-the-maximum-number-of-open-files/">Linux Increase The Maximum Number Of Open Files / File Descriptors (FD)</a></p>

<p>另：主机名定义</p>

<p>修改/etc/hosts</p>

<p>增加：10.0.2.49  bocoty49</p>

<p>验证：ping bocoty49</p>

<p>修改后即时生效，不需要重登录；</p>

<p>Ref: <a href="http://os.51cto.com/art/200803/68170.htm">Linux操作系统下/etc/hosts文件配置方法</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/21/095631/">Functional Programming in Python</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-21T09:56:31+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>9:56 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This program calculate file issues on specified packages, retrieved from Sonarqube Server.</p>

<h1>Origin imperative program</h1>

<p> from <strong>future</strong> import division
 import urllib2, json
 SERV_ADDR = &lsquo;10.0.2.74:9000&rsquo;
 FILE_LENGTH_ISSUE_KEY = &lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.sizes.FileLengthCheck&rsquo;
 METHOD_RELATED_ISSUE_KEYS = [&lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.sizes.MethodLengthCheck&rsquo;,
    &lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.sizes.ParameterNumberCheck&rsquo;,
    &lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.metrics.CyclomaticComplexityCheck&rsquo;,
    &lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.coding.NestedIfDepthCheck&rsquo;,
    &lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.duplicates.StrictDuplicateCodeCheck&rsquo;]
 def get_data(url):
  conn = urllib2.urlopen(url)
  return json.load(conn)
 def get_issue_num(proj_name, pkg_key, issue_key):
  issue_url = &lsquo;<a href="http://%s/api/issues/search?componentRoots=%s:%s&amp;pageSize=5000&amp;rules=%s">http://%s/api/issues/search?componentRoots=%s:%s&amp;pageSize=5000&amp;rules=%s</a>&rsquo;
  data = get_data(issue_url % (SERV_ADDR, proj_name, pkg_key, issue_key))
  issues = data[&lsquo;issues&rsquo;]
  return len(issues)
 def get_class_num(proj_name, pkg_key):
  class_num_url = &lsquo;<a href="http://%s/api/resources?resource=%s:%s&amp;metrics=classes">http://%s/api/resources?resource=%s:%s&amp;metrics=classes</a>&rsquo;
  data = get_data(class_num_url % (SERV_ADDR, proj_name, pkg_key))
  return data[0][&lsquo;msr&rsquo;][0][&lsquo;val&rsquo;]
 def get_method_num(proj_name, pkg_key):
  method_num_url = &lsquo;<a href="http://%s/api/resources?resource=%s:%s&amp;metrics=functions">http://%s/api/resources?resource=%s:%s&amp;metrics=functions</a>&rsquo;
  data = get_data(method_num_url % (SERV_ADDR, proj_name, pkg_key))
  return data[0][&lsquo;msr&rsquo;][0][&lsquo;val&rsquo;]
 def get_average_issue_ratio(proj_name, pkgs, issue_key, base_type_name):
  total_issue_num = 0
  total_base_num = 0
  for pkg in pkgs:
   total_issue_num += get_issue_num(proj_name, pkg, issue_key)
   total_base_num += base_type_name(proj_name, pkg)
  return total_issue_num / total_base_num</p>

<p> def file_length_check(proj_name, pkgs):
  res = get_average_issue_ratio(proj_name, pkgs, FILE_LENGTH_ISSUE_KEY, get_class_num)
  return &lsquo;{:.2%}&rsquo;.format(res)
 def method_related_checks(proj_name, pkgs):
  check_result = {}
  for issue_key in METHOD_RELATED_ISSUE_KEYS:
   res = get_average_issue_ratio(proj_name, pkgs, issue_key, get_method_num)
   issue_name = issue_key.split(&lsquo;.&rsquo;)[-1]
   check_result[issue_name] = &lsquo;{:.2%}&rsquo;.format(res)
  return check_result
 def get_test_lines(proj_name, pkg_key):
  &hellip;
  return covered_lines, valid_lines</p>

<p> def get_test_branches(proj_name, pkg_key):
  &hellip;
  return covered_branches, valid_branches</p>

<p> def get_average_coverage(proj_name, pkgs):
  lines = []
  for pkg in pkgs:
   res = get_test_lines(proj_name, pkg)
   lines.append(res)
  total_covered_lines = 0
  total_valid_lines = 0
  for item in lines:
   covered_lines, valid_lines = item
   total_covered_lines += covered_lines
   total_valid_lines += valid_lines
  average_line_coverage = total_covered_lines / total_valid_lines</p>

<p>  &hellip;</p>

<p>  average_branch_coverage = total_covered_branches / total_valid_branches</p>

<p>  return average_line_coverage, average_branch_coverage</p>

<h1>List Comprehension</h1>

<p> def get_average_issue_ratio(proj_name, pkgs, issue_key, base_type_name):
  total_issue_num = sum(get_issue_num(proj_name, pkg, issue_key) for pkg in pkgs)
  total_base_num = sum(base_type_name(proj_name, pkg) for pkg in pkgs)
  return total_issue_num / total_base_num</p>

<p> def get_average_coverage_v1(proj_name, pkgs):</p>

<p>  lines_info = [get_test_lines(proj_name, pkg) for pkg in pkgs]</p>

<p>  line_cov = sum(cov_line for (cov_line,<em>) in lines_info) / sum(valid_line for (</em>,valid_line) in lines_info)</p>

<p>  branches_info = [get_test_branches(proj_name, pkg) for pkg in pkgs]
  branch_cov = sum(cov_branch for (cov_branch,<em>) in branches_info) / sum(valid_branch for (</em>,valid_branch) in branches_info)</p>

<p>  return line_cov, branch_cov</p>

<p>You can see this declarative version is much readable than its imperative counterpart.</p>

<p>Note 1: Notice the usage of &ldquo;base_type_name&rdquo;. As a function (first-class citizen), it&rsquo;s passed as a ordinary parameter into the method.</p>

<p>Note 2: manipulate a complex list in the following way (result = (1+2+3)/(10+20+30)):</p>

<p> col = [(1,10), (2,20), (3,30)]</p>

<p> result = sum([x for (x,<em>) in col]) / sum([y for (</em>,y) in col])</p>

<p>in &ldquo;get_average_coverage_v1&rdquo; is still too complicated. So in the following sections you can see some more concise (and FP style) versions.</p>

<h1>Dictionary Comprehension</h1>

<p>def method_related_check_func(proj_name, pkgs):
 return {issue_key.split(&lsquo;.&rsquo;)[-1]:
   &lsquo;{:.2%}&rsquo;.format(get_average_issue_ratio(proj_name, pkgs,
             issue_key,
             get_method_num))
   for issue_key in METHOD_RELATED_ISSUE_KEYS}</p>

<p>Its imperative counterpart has better code shape, but this functional version is more expressive.</p>

<p>Ref: <a href="http://stackoverflow.com/questions/14507591/python-dictionary-comprehension">http://stackoverflow.com/questions/14507591/python-dictionary-comprehension</a></p>

<h1>Use zip, map and apply</h1>

<p> def get_average_coverage_v2(proj_name, pkgs):</p>

<p>  total_covered_lines, total_valid_lines = \      <br/>
    apply(lambda <em>x: map(lambda </em>y: sum(y), *x),    <br/>
      [get_test_lines(proj_name, pkg) for pkg in pkgs])<br/>
  return total_covered_lines / total_valid_lines</p>

<p> def get_cov_ratio(col):</p>

<p>  covered, valid = map(sum, apply(zip, col))</p>

<p>  return covered / valid</p>

<p> def get_coverage_data_v3(proj_name, pkgs):        <br/>
  return get_cov_ratio([get_test_lines(proj_name, pkg) for pkg in pkgs])</p>

<p> def get_coverage_data_v4(proj_name, pkgs):        <br/>
  cov_ratio = lambda col: reduce(operator.truediv, map(sum, apply(zip, col)))
  return cov_ratio([get_test_lines(proj_name, pkg) for pkg in pkgs])</p>

<p>v2 works, but it&rsquo;s too complicated and hard to understand. But there are some useful things in it: variable arguments in lambda expression.</p>

<p>v3 and v4 are almost the same:</p>

<ol>
<li><p>convert [(1,2), (11,22),(111,222)] to [(1,11,111),(2,22,222)] with &ldquo;apply(zip, &hellip;)&rdquo;;</p></li>
<li><p>add every element up (convert to [1+11+111, 2+22+222]) with &ldquo;map(sum, &hellip;)&rdquo;;</p></li>
<li><p>first element divided by the second: using external function in v3, or &ldquo;reduce&rdquo; in v4;</p></li>
</ol>


<p>Clearly this FP version is much readable than its imperative counterpart. You have to add &ldquo;import operator&rdquo; for v4.</p>

<p>The corresponding clojure function is:</p>

<p> (defn trans-metrics [col]
  (/ (apply + (map first col)) (apply + (map second col))))</p>

<p>or as function literal:</p>

<p> #(/ (apply + (map first %)) (apply + (map second %)))</p>

<p>It looks more readable than its Python counterpart.</p>

<h1>Final Script</h1>

<p>Note: Run Python script at command line with user defined functions:</p>

<p>For example you write a module named &ldquo;ex.py&rdquo;, and define a function &ldquo;getdata&rdquo; in it. Now run the following command in its directory: (the current working directory will be added in PYTHONPATH automatically)</p>

<p> python -c &lsquo;import ex;print ex.getdata(&ldquo;bb&rdquo;)&rsquo;</p>

<p>The ex.py and all functions in it are &ldquo;stable&rdquo; business logic. While the command (&ldquo;print ex.getdata()&rdquo; in this case) is &ldquo;how to use this tool&rdquo;, which will change frequently. Thus we divide frequent changed part from stable logic, which is a best practice of programming.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/20/151654/">Evernote Development in Python</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-20T15:16:54+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>3:16 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Follow <a href="http://dev.evernote.com/doc/start/python.php">The Evernote SDK for Python Quick-start Guide</a>:</p>

<ol>
<li><p>Get an account on sandbox.evernote.com and an API key;</p></li>
<li><p>Download Evernote SDK for python:</p></li>
</ol>


<p> $ sudo pip install evernote;</p>

<ol>
<li>A simple demo:</li>
</ol>


<p> from evernote.api.client import EvernoteClient</p>

<p> dev_token = &hellip; # get it from evernote dev server</p>

<p> client = EvernoteClient(token=dev_token)</p>

<p> userStore = client.get_user_store()</p>

<p> user = userStore.getUser()</p>

<p> type(user) # evernote.edam.type.ttypes.User</p>

<p> user.username # your user name of sandbox account</p>

<p> noteStore = client.get_note_store()</p>

<p> type(noteStore) # evernote.api.client.Store</p>

<p> notebooks = noteStore.listNotebooks()</p>

<p> for n in notebooks:</p>

<p>  print n.name</p>

<p>Now add a notebook in your account via web page, then run:</p>

<p> notebooks = noteStore.listNotebooks()</p>

<p> for n in notebooks:</p>

<p>  print n.name</p>

<p>You can get the list with newly added notebook.</p>

<ol>
<li>Create a new note:</li>
</ol>


<p> import evernote.edam.type.ttypes as Types</p>

<p> note = Types.Note()</p>

<p> note.title = &ldquo;Test note from EDAMTest.py&rdquo;</p>

<p> # set note content &hellip;</p>

<p> created_note = note_store.createNote(note)</p>

<p>Ref: <a href="https://github.com/evernote/evernote-sdk-python/blob/master/sample/client/EDAMTest.py">EDAMTest.py on github</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/20/092952/">Python Interactive Development Workflow</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-20T09:29:52+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>9:29 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The key of interactive programming is &ldquo;declarative programming&rdquo;, which can be expressed as following principles:</p>

<ol>
<li><p>Try to write all business logic in functions or classes, instead of procedures;</p></li>
<li><p>Express the result as return values of functions, instead of printing them to console;</p></li>
</ol>


<p>Then you store these functions or classes in your files. Then you start the REPL shell, load your function file, declare your inputs, run your functions with the inputs, evaluate the output; modify the function in file, reload your file in shell, run your functions again, reevaluate the output, continue this loop, until you get the expected output.</p>

<p>Between these loops, you have 2 window: an editor and a shell, the former for write &ldquo;real&rdquo; production code, the latter for loading file and doing some experiments, while switching between them with Alt-Tab. You only declare inputs once. Using shortcuts (Ctrl-p) to reload function file and re-test your function. So the loop will be very fast, and you can concentrate on the business logic itself.</p>

<p>emacs-for-python and IPython are the preferred editor and shell, both have powerful code completion functionality.</p>

<h1>Linux Shell</h1>

<p>Save some fundamental functions in a python file, say &ldquo;myfunc.py&rdquo;, Then use &ldquo;python -i myfunc.py&rdquo; to load all functions in myfunc.py and enter interactive shell.</p>

<h1>Python Console</h1>

<p>&ldquo;execfile(&lsquo;filename.py&rsquo;)&rdquo; to load (or reload) file;</p>

<p>&ldquo;dir()&rdquo; to list all variables;</p>

<p>&ldquo;del(variable)&rdquo; to clear a variable;</p>

<p>C-p, C-n to traverse in command history;</p>

<h1>IPython</h1>

<h2>Installation</h2>

<pre><code>sudo apt-get install ipython-notebook
</code></pre>

<h2>Command history traverse and back reference</h2>

<p>History inputs: all in dictionary &ldquo;In&rdquo;, use &ldquo;%hist -n&rdquo; list all previous command;</p>

<p>Output: all in dictionary &ldquo;Out&rdquo;, <em>1, </em>2, &hellip;</p>

<p>C-p, C-n, %rep <command_num></p>

<p>While all shortcuts supported by bash are available in IPython (See Command Line Shortcuts in Linux Shell for details).</p>

<h2>Command</h2>

<p>To line magic command, &ldquo;%&rdquo; can be omitted.</p>

<p>%pwd: pwd</p>

<p>!<cmd>: run shell command;</p>

<p>%run <file_name>: equals to &ldquo;execfile()&rdquo; in standard python shell;</p>

<p>%reset: clear all user defined variables;</p>

<p>%pycat <file_name>: show file content with syntax coloring;</p>

<p>%edit <file_name>: edit file;</p>

<p>%pdb or %run -d <file_name>: debug file;</p>

<h2>log utility</h2>

<p>%logstate: get the current state of log: on/off</p>

<p>%logstart -o <file_name></p>

<p>%logstop</p>

<h1>Emacs</h1>

<p><a href="https://github.com/gabrielelanaro/emacs-for-python">emacs-for-python</a></p>

<h1>Difference between &ldquo;import&rdquo; and &ldquo;run&rdquo;</h1>

<p>You can put some code after</p>

<pre><code>if __name__ == '__main__':
</code></pre>

<p>in a python file &ldquo;test.py&rdquo;. Then if you want run these codes, use &ldquo;run test.py&rdquo; in ipython or &ldquo;execfile(&lsquo;test.py&rsquo;)&rdquo; in python shell. If you don&rsquo;t want to run these code, use &ldquo;import test&rdquo;. But this is not a best practice. Try to put all things in functions and classes.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/19/173101/">Manage Historical Snapshots in Sonarqube</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-19T17:31:01+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>5:31 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Login as admin, go to a dashboard of a project, then click &ldquo;Configuration -> History&rdquo; at the upper-right corner of the panel.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/19/101234/">Work on Remote Git Repository</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-19T10:12:34+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>10:12 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Create New Branch</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/hackrole/pyevernote.git
</span><span class='line'>$ cd pyevernote
</span><span class='line'>$ git branch    // list all existing branches
</span><span class='line'>$ git checkout -b leetschau     // create new branch "leetschau" and checkout it</span></code></pre></td></tr></table></div></figure>


<h1>Push to remote repository</h1>

<p><code>$ git push origin leetschau</code>, where &ldquo;origin&rdquo; is repository name, &ldquo;leetschau&rdquo; is branch name.</p>

<p>When you push your branch the first time, add &ldquo;-u&rdquo; to specify that the current branch is associated with the remote branch.</p>

<p>Ref: <a href="http://stackoverflow.com/questions/6089294/why-do-i-need-to-do-set-upstream-all-the-time.">http://stackoverflow.com/questions/6089294/why-do-i-need-to-do-set-upstream-all-the-time.</a></p>

<h1>Push all branches to remote repository</h1>

<p><code>$ git push origin --all</code>.</p>

<h1>Sync with remote repository</h1>

<p>If there&rsquo;s no local changes, the first command is unnecessary.</p>

<pre><code>git checkout -- .
git pull --all
</code></pre>

<h1>Discard local changes</h1>

<p>Discard all local changes and keep the same with last commit in repo.</p>

<pre><code>git reset --hard HEAD
</code></pre>

<p>We need discard all local changes and keep the same with remote repository. Provided that you want sync with &ldquo;master&rdquo; branch in remote repository &ldquo;origin&rdquo;:</p>

<pre><code>$ git fetch orgin
$ git reset --hard origin/master
</code></pre>

<p>Note that files not in stage area (not been &ldquo;add&rdquo;) will remains, while files in stage area or committed will be removed.
If your remote repo is developed with git flow, your synchronized repo also need install git flow.
On CentOS, install it with <code>yum install gitflow</code>. See installation doc on <a href="https://github.com/nvie/gitflow">gitflow</a> for details.</p>

<h1>Remove Existing Branch</h1>

<pre><code>$ git push origin :leetchao
</code></pre>

<h1>Create, query and remove remote repository alias</h1>

<pre><code>$ git remote add pyevernote-repo https://github.com/hackrole/pyevernote.git
$ git remote -v
$ git remote rm pyevernote-repo
</code></pre>

<h1>Checkout from a existing repository and branch</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/hackrole/pyevernote.git
</span><span class='line'>$ cd pyevernote
</span><span class='line'>$ git branch -r               // list all local and remote branches
</span><span class='line'>  origin/leetschau
</span><span class='line'>  ...
</span><span class='line'>$ git checkout leetschau      // or "git checkout -b leetschau origin/leetschau" for old version git</span></code></pre></td></tr></table></div></figure>


<p>For verification, you can find &lsquo;remote=origin &hellip; under [branch &ldquo;leetschau&rdquo;]&rsquo; in file .git/config.</p>

<h1>Update from remote repository</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git fetch origin
</span><span class='line'>$ git status
</span><span class='line'>  Your branch is **behind** 'origin/develop' by 3 commits... (which means your local branch need to be updated with remote one)
</span><span class='line'>$ git merge origin/develop</span></code></pre></td></tr></table></div></figure>


<p>Or simply <code>git pull origin develop</code>, where develop is the branch name we want to sync.</p>

<p>Note: Be careful to use &ldquo;git pull&rdquo; for &ldquo;pull&rdquo; is too &ldquo;smart&rdquo;.
<a href="http://longair.net/blog/2009/04/16/git-fetch-and-merge/">git: fetch and merge, donât pull</a> gives the reason and provides an excellent explanation of what is &ldquo;branch&rdquo;.</p>

<h1>Move a git repository from Bitbucket to Github</h1>

<p>Based on <a href="http://www.blackdogfoundry.com/blog/moving-repository-from-bitbucket-to-github/">Moving Repository from Bitbucket to GitHub</a>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd $DSNOTE_HOME
</span><span class='line'>git remote rename origin bitbucket
</span><span class='line'>// create a new repository "dsnote" on Github
</span><span class='line'>git remote add origin https://github.com/leetschau/dsnote.git
</span><span class='line'>git push -u origin master
</span><span class='line'>git remote -v
</span><span class='line'>git branch -r</span></code></pre></td></tr></table></div></figure>


<h1>Other</h1>

<p>Always use <code>git status</code> to get current status, such as the difference between CWD and stage area, difference between stage area and local repository, and difference between local repository and remote repository.
Use <code>git log</code> to show commit history.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/36">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/34">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/04/30/095841/">Git GUI Clients on Linux</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/30/095418/">Git GUI Tools</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/29/181733/">Build a Simple Meteor Package</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/29/114138/">QGIS的坐标系和缓冲区</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/26/101038/">Penetrate GFW With ShadowSocks</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/leetschau">@leetschau</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'leetschau',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Li Chao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
