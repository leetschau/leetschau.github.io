
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dark Matter in Cyberspace</title>
  <meta name="author" content="Li Chao">

  
  <meta name="description" content="The normal way of deploy clojure files is using leiningen. But if we have no leiningen, or the script is small and unnecessary to pack as a leiningen &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://leetschau.github.io/posts/30">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Dark Matter in Cyberspace" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Dark Matter in Cyberspace</a></h1>
  
    <h2>A note repository aims at Data Mining, Spark, Linux, Python.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:leetschau.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/04/163536/">Run Clojure Script With External Dependencies Without Leiningen</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-04T16:35:36+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>4:35 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The normal way of deploy clojure files is using leiningen. But if we have no leiningen, or the script is small and unnecessary to pack as a leiningen project, we can build a &ldquo;bare&rdquo; clojure script in the following way.</p>

<ol>
<li><p>Get the dependency jar files, 2 options:</p>

<ol type="a">
<li><p>download the jar file directly;</p></li>
<li><p>if the dependency project provide the dependency as leiningen dependency items in porject.clj (for example, &ldquo;[org.clojure/data.json &#8220;0.2.3&rdquo;]&ldquo; in <a href="https://github.com/clojure/data.json">data.json</a>), you can build the leiningen project following Parse Sonarqube Data via Web API in Clojure , then copy the denpendency jar files from the ~/.m2/repository folder;</p></li>
</ol>
</li>
<li><p>Build srcipt: get-sonar-data.clj</p>

<p> (require &lsquo;[clojure.data.json :as json])
 (def url &ldquo;<a href="http://10.0.2.74:9000/api/resources?resource=ESB:com.boco.esb.analysismgr.service.impl&amp;metrics=classes">http://10.0.2.74:9000/api/resources?resource=ESB:com.boco.esb.analysismgr.service.impl&amp;metrics=classes</a>&rdquo;)
 (def data (json/read-str (slurp url)))
 (println ((first data) &ldquo;name&rdquo;))
 (println ((first ((first data) &ldquo;msr&rdquo;)) &ldquo;val&rdquo;))</p></li>
<li><p>Run script: java -cp &lsquo;./*:.&rsquo; clojure.main get-sonar-data.clj</p></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/04/114616/">Parse Sonarqube Data via Web API in Clojure</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-04T11:46:16+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>11:46 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><ol>
<li><p>build project: lein new sonar-parser</p></li>
<li><p>add dependencies: add &ldquo;[org.clojure/data.json &#8220;0.2.3&rdquo;]&ldquo; in :dependencies in project.clj;</p></li>
<li><p>update (download) dependency jars (into ~/.m2/repository folder): lein deps</p></li>
<li><p>start repl: lein repl</p></li>
<li><p>test in repl:</p></li>
</ol>


<p> (require &lsquo;[clojure.data.json :as json])</p>

<p> (def data (json/read-str (slurp &ldquo;<a href="http://...">http://&#8230;</a>&rdquo;)))</p>

<p> ((first ((first data) &ldquo;msr&rdquo;)) &ldquo;val&rdquo;) ; => 5.0</p>

<ol>
<li><p>add script into src/sonar-parser/core.clj;</p></li>
<li><p>pack project: lein uberjar</p></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/04/100446/">Parse Sonarqube Data via Web API in Groovy</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-04T10:04:46+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>10:04 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Shell</h1>

<h2>getdata.groovy</h2>

<pre><code>url = "http://10.0.2.74:9000/api/resources?resource=ESB:com.boco.esb.analysismgr.service.impl&amp;metrics=classes"

addr = url.toURL() 
conn= addr.openConnection() 
status = conn.getResponseCode() 
reader = new BufferedReader(new InputStreamReader(conn.getInputStream())) 
datastr = reader.readLine()

import groovy.json.JsonSlurper

slurper = new JsonSlurper()

data = slurper.parseText(datastr)

msr = data[0].msr.frmt_val[0]
</code></pre>

<h2>Run Shell Script</h2>

<ol>
<li><p>start shell: &ldquo;groovysh&rdquo;</p></li>
<li><p>load script file: &ldquo;. getdata.groovy&rdquo;;</p></li>
<li><p>all variables in script file can be used in shell; evaluate variable value by its name directly;</p></li>
<li><p>reload file: &ldquo;purge all&rdquo; then &ldquo;. getdata.groovy&rdquo;;</p></li>
</ol>


<h1>Script</h1>

<h2>getdata_scpt.groovy</h2>

<pre><code>def url = "http://10.0.2.74:9000/api/resources?resource=ESB:com.boco.esb.analysismgr.service.impl&amp;metrics=classes"
def addr = url.toURL()
def conn= addr.openConnection()
def status = conn.getResponseCode()
def reader = new BufferedReader(new InputStreamReader(conn.getInputStream()))
println reader.readLine()
</code></pre>

<h2>run script</h2>

<p>groovy getdata_scpt.groovy</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/02/193731/">Run Shell Script Inside Ruby Script</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-02T19:37:31+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2013</span></span> <span class='time'>7:37 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Backtick grammar</h1>

<p>Thanks to the backtick grammar and string substitution, shell script can be embedded more easily into Ruby script than Python.</p>

<p>Execute shell command in irb, the return value is the output in stdout:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>2.1.2 :036 &gt; `ls -l|grep play`
</span><span class='line'> =&gt; "drwxr-xr-x 3 chad chad 4096 Aug 12 17:17 playproj\n" 
</span><span class='line'> 2.1.2 :037 &gt; `aaa`
</span><span class='line'> Errno::ENOENT: No such file or directory - aaa
</span><span class='line'> ...</span></code></pre></td></tr></table></div></figure>


<p>Execute shell commands in Ruby scripts:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Usage: Save the following scripts in file "cmd.rb" 
</span><span class='line'># $ ruby cmd.rb ls -a 
</span><span class='line'>cmd = ARGV[0] 
</span><span class='line'>op = ARGV[1] 
</span><span class='line'>result = `#{cmd} #{op}` 
</span><span class='line'>puts result</span></code></pre></td></tr></table></div></figure>


<h1>system function</h1>

<p>Kernel#system executes the given command in a subshell. Return true if the command was found and ran successfully, false otherwise.
The output of the command will be written to stdout. So it can&rsquo;t store the command output.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>2.1.2 :036 &gt; `ls -l|grep play`
</span><span class='line'>drwxr-xr-x 3 chad chad 4096 Aug 12 17:17 playproj
</span><span class='line'> =&gt; truee</span></code></pre></td></tr></table></div></figure>


<p>Ref:</p>

<p><a href="http://stackoverflow.com/questions/2232/calling-bash-commands-from-ruby">Calling Bash Commands From Ruby</a></p>

<p><a href="http://stackoverflow.com/questions/2741260/can-ruby-access-output-from-shell-commands-as-it-appears">Can Ruby access output from shell commands as it appears?</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/02/164918/">Line Wrap in Python</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-02T16:49:18+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2013</span></span> <span class='time'>4:49 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Omitting Backslash</h1>

<p>You can only omitting backslash in list bracket or using parenthesis with long string.</p>

<p> ke = [&lsquo;com.boco.esb.analysismgr.service.impl&rsquo;,
   &lsquo;com.boco.esb.dataencapsulation.service.impl&rsquo;,
   &lsquo;com.boco.esb.dataquality.service.impl&rsquo;]</p>

<p> issue_url = (&lsquo;<a href="http://%s/api/issues/search?componentRoots=%s:%s">http://%s/api/issues/search?componentRoots=%s:%s</a>&rsquo;</p>

<pre><code> '&amp;pageSize=5000&amp;rules=%s&amp;statuses=OPEN,REOPENED') 
</code></pre>

<h1>Mandatory Backslash</h1>

<h2>Long Variable Name</h2>

<p>Use backslash following &ldquo;=&rdquo; to save space.</p>

<p> METHOD_RELATED_ISSUE_KEYS = \
 [&lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.sizes.MethodLengthCheck&rsquo;,
  &lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.sizes.ParameterNumberCheck&rsquo;,
  &lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.metrics.CyclomaticComplexityCheck&rsquo;,
  &lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.coding.NestedIfDepthCheck&rsquo;,
  &lsquo;checkstyle:com.puppycrawl.tools.checkstyle.checks.duplicates.StrictDuplicateCodeCheck&rsquo;]</p>

<h2>List Comprehension</h2>

<p>Backslash before &ldquo;for&rdquo; in list(dict) comprehension cannot be omitted.</p>

<p> total_issue_num = sum(get_issue_num(proj_name, pkg, issue_key) \
   for pkg in pkgs)</p>

<h2>After Operator</h2>

<p>Backslash after operator cannot be omitted.</p>

<p> line_cov = sum(cov_line for (cov_line,<em>) in lines_info) / \
     sum(valid_line for (</em>,valid_line) in lines_info)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/02/152923/">Retrieve Sonarqube Data With Java</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-02T15:29:23+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2013</span></span> <span class='time'>3:29 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The following class &ldquo;GetData&rdquo; can retrieve data from Sonarqube. But you have to</p>

<p> import java.net.URL;
 import java.net.HttpURLConnection;
 import java.net.MalformedURLException;
 import java.io.IOException;
 import java.io.BufferedReader;
 import java.io.InputStreamReader;
 public class GetData {
  private static String url = &ldquo;<a href="http://10.0.2.74:9000/api/resources?resource=ESB:com.boco.esb.analysismgr.service.impl&amp;metrics=classes">http://10.0.2.74:9000/api/resources?resource=ESB:com.boco.esb.analysismgr.service.impl&amp;metrics=classes</a>&rdquo;;
  public static void main(String[] args) {
   HttpURLConnection myURLConnection = null;
   int status = -1;
   String cont = null;
   try {
    URL myURL = new URL(url);
    myURLConnection = (HttpURLConnection)myURL.openConnection();
    myURLConnection.connect();
    status = myURLConnection.getResponseCode();
    switch (status) {
     case 200:
     case 201:
      BufferedReader br = new BufferedReader(new InputStreamReader(myURLConnection.getInputStream()));
      StringBuilder sb = new StringBuilder();
      String line;
      while ((line = br.readLine()) != null) {
       sb.append(line+&ldquo;\n&rdquo;);
      }
      br.close();
      cont = sb.toString();
    }
   }
   catch (MalformedURLException e) {
    System.out.println(&ldquo;url error&rdquo;);
   }
   catch (IOException e) {
    System.out.println(&ldquo;other io error&rdquo;);
   }
   System.out.println(&ldquo;my conn ret code: &rdquo; + status);
   System.out.println(&ldquo;my conn: &rdquo; + cont);
  }
 }</p>

<p>$ java GetData</p>

<p>my conn ret code: 200
my conn: [{&ldquo;id&rdquo;:8251,&ldquo;key&rdquo;:&ldquo;ESB:com.boco.esb.analysismgr.service.impl&rdquo;,&ldquo;name&rdquo;:&ldquo;com.boco.esb.analysismgr.service.impl&rdquo;,&ldquo;scope&rdquo;:&ldquo;DIR&rdquo;,&ldquo;qualifier&rdquo;:&ldquo;PAC&rdquo;,&ldquo;date&rdquo;:&ldquo;2013-11-29T17:02:10+0800&rdquo;,&ldquo;lname&rdquo;:&ldquo;com.boco.esb.analysismgr.service.impl&rdquo;,&ldquo;lang&rdquo;:&ldquo;java&rdquo;,&ldquo;msr&rdquo;:[{&ldquo;key&rdquo;:&ldquo;classes&rdquo;,&ldquo;val&rdquo;:5.0,&ldquo;frmt_val&rdquo;:&ldquo;5&rdquo;}]}]</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/02/111254/">FP vs OOP</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-02T11:12:54+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2013</span></span> <span class='time'>11:12 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Four Paradigms of Decomposing Problems</h1>

<ul>
<li><p>Procedural: C, Pascal, Unix shells;</p></li>
<li><p>Declarative: SQL;</p></li>
<li><p>Object-oriented: Smalltalk, Java;</p></li>
<li><p>Functional: Haskell;</p></li>
</ul>


<h1>Relations of FP and OOP</h1>

<p>&ldquo;Functional programming can be considered the opposite of object-oriented programming. Objects are little capsules containing some internal state along with a collection of method calls that let you modify this state, and programs consist of making the right set of state changes. Functional programming wants to avoid state changes as much as possible and works with data flowing between functions.&rdquo; &ndash;From <a href="http://docs.python.org/2/howto/functional.html">Functional Programming HOWTO</a></p>

<p>&ldquo;I think the lack of reusability comes in object-oriented languages, not in functional languages. Because the problem with object-oriented languages is they’ve got all this implicit environment that they carry around with them. You wanted a banana but what you got was a gorilla holding the banana and the entire jungle.&rdquo; &ndash;Joe Armstrong (the creator of Erlang) discussed in &ldquo;Coders At work&rdquo; about the reusability of Object-Oriented Programming.
To be fair, in my opinion it&rsquo;s not an intrinsic problems of OOP. You can write OOP code which is also functional, but certainly:
* Typical OOP tends to emphasize change of state in objects.
* Typical OOP tends to impose tight coupling between layers (which hinders modularization).
* Typical OOP mixes the concepts of identity and state.
* Mixture of data and code raises both conceptual and practical problems.
&ndash; <a href="http://code.google.com/p/tokland/wiki/RubyFunctionalProgramming">Ruby Functional Programming</a>
Rich Hickey, the creator of Clojure (a functional Lisp-dialect for the JVM), discusses state, values and identity in this <a href="http://www.infoq.com/presentations/Value-Identity-State-Rich-Hickey">excellent talk</a>.</p>

<h1>If we can do functional programming with Python, do we need a specific functional programming language?</h1>

<p><a href="http://programmers.stackexchange.com/questions/42986/if-we-can-do-functional-programming-with-python-do-we-need-a-specific-functiona">http://programmers.stackexchange.com/questions/42986/if-we-can-do-functional-programming-with-python-do-we-need-a-specific-functiona</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/29/172706/">Manipulate Sonarqube Database in PostgreSQL With JDBC</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-29T17:27:06+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>5:27 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Use the following Java class to manipulate Sonarqube database in postgresql.</p>

<h1>ManipulateSonarPost.java</h1>

<p> import java.sql.Connection;
 import java.sql.DatabaseMetaData;
 import java.sql.DriverManager;
 import java.sql.ResultSet;
 import java.sql.SQLException;
 import java.sql.Statement;
 public class TestPost {
  private static Connection connection = null;
  public static void main(String[] args) throws SQLException, java.lang.ClassNotFoundException {
   String url = &ldquo;jdbc:postgresql://localhost/sonar&rdquo;;
   String user = &ldquo;sonar&rdquo;;
   String password = &ldquo;sonar&rdquo;;
   String driver = &ldquo;org.postgresql.Driver&rdquo;;</p>

<p>   Class.forName(driver);
   connection = DriverManager.getConnection(url+&ldquo;?user=&rdquo;+user+&ldquo;&amp;password=&rdquo;+password);
   if ((connection == null) || (connection.isClosed())) return;
   System.out.println(&ldquo;Connection is: &rdquo;+connection);</p>

<p>   listTables();
   String table = &ldquo;projects&rdquo;;
   printTable(table);
   connection.close();</p>

<p>  }</p>

<p>  private static void listTables() throws SQLException {
   DatabaseMetaData md = connection.getMetaData();
   ResultSet rs = md.getTables(null, null, &ldquo;%&rdquo;, null);
   while (rs.next()) {
    System.out.println(rs.getString(3));
   }
   rs.close();</p>

<p>  }</p>

<p>  private static void printTable(String tableName) throws SQLException {
   Statement st = connection.createStatement();
   ResultSet rs = st.executeQuery(&ldquo;SELECT * FROM &rdquo; + tableName);
   while (rs.next()) {
     System.out.println(&ldquo;Column 1: &rdquo; + rs.getString(1));
     System.out.println(&ldquo;Column 2: &rdquo; + rs.getString(2));
     System.out.println(&ldquo;Column 3: &rdquo; + rs.getString(3));
   }
   rs.close();
   st.close();
  }
 }</p>

<h1>Compile and Run</h1>

<p>$ javac -cp ~/apps/sonar-3.6.1/extensions/jdbc-driver/postgresql/postgresql-9.1-901-1.jdbc4.jar ManipulateSonarPost.java</p>

<p>$ java -cp ~/apps/sonar-3.6.1/extensions/jdbc-driver/postgresql/postgresql-9.1-901-1.jdbc4.jar:. ManipulateSonarPost</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/29/100558/">Backup and Restore Postgresql Database</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-29T10:05:58+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>10:05 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Backup</h1>

<p>(On CentOS 6.4)</p>

<p>Enable backup as user &ldquo;sonar&rdquo;: modify authentication file pg_hba.conf following SonarQube and Postgresql on Linux ;</p>

<p>Then you can backup a database: $ pg_dump -U sonar -F c -v -f sonar.bak sonar</p>

<p>Synopsis: pg_dump [options] <db_name>. &ldquo;-F c&rdquo; means using &ldquo;custom&rdquo; file format. -f specifies the output file name.</p>

<p>Or backup all: $ pg_dumpall -U postgres -f totalbackup.sql -v -c</p>

<p>The &ldquo;-c&rdquo; will print drop commands to remove existing databases or roles. So you can restore them without cleaning existing databases in your backup server first.</p>

<h1>Restore</h1>

<p>Install and start postgresql server. Then you can restore a full backup:</p>

<p> $ psql -U postgres -f totalbackup.sql</p>

<p>Or restore a specific database:</p>

<ol>
<li><p>$ psql -U postgres (modify pg_hba.conf for authenticaiton);</p></li>
<li><p>create role &ldquo;sonar&rdquo; and database &ldquo;sonar&rdquo;:</p></li>
</ol>


<p> create role sonar login password &lsquo;sonar&rsquo;;</p>

<p> create database sonar owner sonar;</p>

<ol>
<li>$ pg_restore -U sonar -d sonar -j 4 -v sonar.bak</li>
</ol>


<h1>Verify</h1>

<ul>
<li>Print database size of &ldquo;sonar&rdquo;:</li>
</ul>


<p> $ psql -U sonar -c &ldquo;\l+&rdquo; sonar|grep sonar</p>

<ul>
<li>Print all tables and sizes in database &ldquo;sonar&rdquo;:</li>
</ul>


<p> $ psql -U sonar -c &ldquo;\d+&rdquo; sonar</p>

<p>Or run a psql console ($ psql -U sonar), and use the following commands to verify:</p>

<ul>
<li><p>\d // list all tables</p></li>
<li><p>select * from projects; // print contents of table &ldquo;projects&rdquo;</p></li>
<li><p>select pg_size_pretty(pg_database_size(&lsquo;sonar&rsquo;)); // print the human_readable size of database &ldquo;sonar&rdquo;</p></li>
<li><p>select pg_database_size(&lsquo;sonar&rsquo;); // give the exact size of database &ldquo;sonar&rdquo;</p></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/28/143902/">Rsync Omit `core` Folder</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-28T14:39:02+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>2:39 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Problem Description</h1>

<p>Test script:</p>

<pre><code>mkdir {gsp,dst,dst2,dst3} 
svn co http://10.0.2.59:8118/svn/gsp/Development-Area/3-SCL/Trunk/TaskServer_Gsp gsp
rsync -auC gsp/* dst/
rsync -au gsp/* dst2/
rsync -auC --include=core gsp/ dst3/
rsync -au gsp/ dst4/
diff -rq gsp dst
</code></pre>

<p>Output:</p>

<p>Only in gsp/com.boco.gdpp.taskserver.core/src/com/boco/gdpp/taskserver: core</p>

<h1>Cause and Solution</h1>

<p>The -C option looks &ldquo;core&rdquo; as a <em>source version control</em> folder, and exclude it. See man page for details.</p>

<p>The size of the &ldquo;.svn&rdquo; folder is similar to the host folder. So &ldquo;-C&rdquo; option is necessary. Becase &ldquo;.svn&rdquo; is not &ldquo;<em>&rdquo;, so there is no &ldquo;.svn&rdquo; in dst2. But it will also exclude other &ldquo;.</em>&rdquo; folder in gsp. So the right answer is:</p>

<pre><code>rsync -auC --include=core gsp/ dst3/
</code></pre>

<p>The dst4 is a completely copy.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/31">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/29">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/02/01/134829/">Full Text Search for Meteor App</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/30/183509/">基于Search Source的简单查询实现方法</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/29/141348/">Git-flow Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/26/174649/">Meteor Development Styles</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/26/173952/">离线保存网页</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/leetschau">@leetschau</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'leetschau',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Li Chao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
