
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dark Matter in Cyberspace</title>
  <meta name="author" content="Li Chao">

  
  <meta name="description" content="According to Why is 1366x768 considered by some to be the standard widescreen for modern laptops?,
screen resolution 1366x768 is most frequently used &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://leetschau.github.io/posts/2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Dark Matter in Cyberspace" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Dark Matter in Cyberspace</a></h1>
  
    <h2>A note repository aims at Data Mining, Spark, Linux, Python.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:leetschau.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/14/112821/">Preferred Web Browser Resolution When Developing a Website</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-14T11:28:21+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:28 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>According to <a href="https://ux.stackexchange.com/questions/41466/why-is-1366x768-considered-by-some-to-be-the-standard-widescreen-for-modern-lapt">Why is 1366x768 considered by some to be the standard widescreen for modern laptops?</a>,
screen resolution 1366x768 is most frequently used from desktop , the 2nd frequently used resolution is 1024x768.</p>

<p>So for a web UI designer, 1024x768 is the safe solution,
because a 1024-pixels-width web page on a wider screen (1366 pixels) looks ok,
while people have to scroll horizontally to view a 1366-pixels-wide web page on a 1024 screen.</p>

<p>For Axure RP, 960 pixels width is preferred:
right click on the wireframe window of a page,
select &ldquo;Grid and Guides -> Create Guides -> Presets: 960 Grid 12 Column&rdquo;.</p>

<p>The following is a Meteor app that detect screen and browser size on the fly.</p>

<pre><code>$ cat getDimension.js
if (Meteor.isClient) {
  Session.setDefault("bro_wid", $(window).width());
  Session.setDefault("bro_hei", $(window).height());
  Session.setDefault("scr_wid", screen.width);
  Session.setDefault("scr_hei", screen.height);

  Meteor.startup(function () {
    $(window).resize(function(e) {
      Session.set("bro_wid", $(window).width());
      Session.set("bro_hei", $(window).height());
      Session.set("scr_wid", screen.width);
      Session.set("scr_hei", screen.height);
    });
  });

  Template.getDim.helpers({
    bro_wid: function () {
      return Session.get("bro_wid");
    },
    bro_hei: function () {
      return Session.get("bro_hei");
    },
    scr_wid: function () {
      return Session.get("scr_wid");
    },
    scr_hei: function () {
      return Session.get("scr_hei");
    }
  });
}

$ cat getDimension.html
&lt;head&gt;
  &lt;title&gt;Window Size Detector&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;Window Size Detector&lt;/h1&gt;
  &lt;div&gt; &lt;b&gt;Resize your browser window ...&lt;/b&gt; &lt;hr&gt; &lt;/div&gt;

&lt;/body&gt;
&lt;template name="getDim"&gt;
  &lt;div&gt; Browser window width:  &lt;/div&gt;
  &lt;div&gt; Browser window height:  &lt;/div&gt;
  &lt;div&gt; Screen width:  &lt;/div&gt;
  &lt;div&gt; Screen height:  &lt;/div&gt;
&lt;/template&gt;
</code></pre>

<p>Ref:</p>

<p><a href="http://stackoverflow.com/questions/3437786/get-the-size-of-the-screen-current-web-page-and-browser-window">Get the size of the screen, current web page and browser window</a></p>

<p><a href="http://alistapart.com/article/holygrail">In Search of the Holy Grail</a></p>

<p><a href="http://www.ehow.com/how_6165639_make-website-fit-resolution.html">How to Make My Website Fit Any Resolution</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/13/142025/">Using Windows VM in Linux Mint I3wm</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-13T14:20:25+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:20 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Build a Windows vm in VirtualBox.</p>

<p>Then get the UUID of the guest OS with:</p>

<pre><code>$ VBoxManage list vms
"Win7Office" {35cd049b-7242-4db4-8329-2eb05149f5cf}
...
</code></pre>

<p>The UUID will be used to start the vm with script.
Save the following line in /usr/local/bin/win7:</p>

<pre><code>VBoxManage startvm 35cd049b-7242-4db4-8329-2eb05149f5cf --type gui
</code></pre>

<p>Add executing permission: <code>sudo chmod 755 /usr/local/bin/win7</code>;</p>

<p>Now start Windows vm with dmenu: Alt-d -> win7.</p>

<p>Make the vm full screen: press &ldquo;Home&rdquo; key, (here is right ctrl key), followed by Alt-f.</p>

<p>To leave the guest system to the #2 workspace: right Ctrl, Alt-2.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/13/114850/">Manipulate 7zip Files on Linux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-13T11:48:50+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:48 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Install: <code>sudo aptitude install p7zip-full</code>;</p>

<p>Extract: <code>7zr x myfile.7z</code>;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/13/110500/">Download Blocked Resource With RTorrent</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-13T11:05:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:05 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today I need download a file via bt seed on <a href="http://kickass.so/">kickass</a>.
However here BitTorrent protocol is blocked.
So I install <a href="https://github.com/rakshasa/rtorrent">rtorrent</a> on the Linode virtual host via <code>sudo yum install rtorrent</code>.
Start it with <code>rtorrent</code>, press Backspace, and paste torrent file url in the text box.
The file is downloaded to current folder.</p>

<p>Finally download this file to my computer with <code>scp myVirtualHost:~/theFile.zip .</code>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/13/104859/">Linux命令行中删除特殊名字的文件</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-13T10:48:59+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:48 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天下载了一个zip文件，解压后出现一个文件名为&#8221;-==(czRGsl)==-.mp4&#8221;的文件，删除时出现下面的错误：</p>

<pre><code>[chad@chadleebj ~]$ rm *.mp4
rm: invalid option -- '='
Try `rm ./'-==(czRGsl)==-.mp4'' to remove the file `-==(czRGsl)==-.mp4'.
Try `rm --help' for more information
</code></pre>

<p>加单引号和转义符都无效：</p>

<pre><code>[chad@chadleebj ~]$ rm '-==(czRGsl)==-.mp4'
rm: invalid option -- '='
Try `rm ./'-==(czRGsl)==-.mp4'' to remove the file `-==(czRGsl)==-.mp4'.
Try `rm --help' for more information.

[chad@chadleebj ~]$ rm \-\=\=\(czRGsl\)\=\=-.mp4
rm: invalid option -- '='
Try `rm ./'-==(czRGsl)==-.mp4'' to remove the file `-==(czRGsl)==-.mp4'.
Try `rm --help' for more information
</code></pre>

<p>错误原因是将文件名的第一个字符&#8221;-&ldquo;当成了选项符号，又没有&rdquo;=&ldquo;这个选项造成的，所以首先要在rm后加&rdquo;&ndash;&ldquo;告诉命令后面的&rdquo;-&ldquo;不是选项符号：</p>

<pre><code>[chad@chadleebj ~]$ rm -- -==(czRGsl)==-.mp4
-bash: syntax error near unexpected token `('
</code></pre>

<p>其中的括号需要转义：</p>

<pre><code>[chad@chadleebj ~]$ rm -- -==\(czRGsl)==-.mp4
-bash: syntax error near unexpected token `)'

[chad@chadleebj ~]$ rm -- -==\(czRGsl\)==-.mp4
</code></pre>

<p>搞定。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/12/143532/">PDF Margin Trimming Tools</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-12T14:35:32+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:35 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I am looking for a tool to trim the margin of pdf files,
to be more convenient to reading on my 10.0 inch tablet.</p>

<p><a href="http://briss.sourceforge.net/">Briss</a> do the work well.
It&rsquo;s a java program, so jvm need to be installed beforehand.</p>

<p>Download it (briss-0.9.tar.gz) and extract, run it with <code>java -jar briss-0.9.jar</code>,
or <code>java -jar briss-0.9.jar &lt;target.pdf&gt;</code>, see README.txt for details.</p>

<p>After several tries, I found the right process is NOT open pdf directly with briss.
The following is the recommended way:</p>

<p>First open the target pdf with <code>evince &lt;target.pdf&gt;</code>, see if the margin area is the same.
If not, remember the special page numbers.</p>

<p>For example, the first 6 pages, including cover, copy right page, etc, are different with the remaining pages.
When starting briss, input &ldquo;1-6&rdquo; when asked for &ldquo;Enter pages to be excluded from merging&rdquo;.
Briss open page 1 to 6 respectively, and put all odd and even pages into 2 other &ldquo;clusters&rdquo;.</p>

<p>A cluster is group of pages share the same margin settings.
So all odd pages use the same margin settings,
and all even pages use same margin settings, (which may be different with the odd cluster).</p>

<p>Use mouse to set the rectange in each cluster, then [Action -> Preview],
if it&rsquo;s ok, [Action -> Crop PDF].</p>

<p>For convenience, add the following codes into ~/.bash_aliases:</p>

<pre><code>function briss(){
  java -jar $HOME/apps/briss-0.9/briss-0.9.jar $1
}
</code></pre>

<p>So now crop pdf with <code>briss &lt;target.pdf&gt;</code>.</p>

<p>If define alias with <code>alias briss='java -jar $HOME/apps/briss-0.9/briss-0.9.jar'</code>, tab-completion doesn&rsquo;t work.
So here we use function.</p>

<p>I also tried pdfcrop, which is installed with <code>sudo apt-get install texlive-extra-utils</code>.
After cropped, the page index information is lost.
And page size vary with the text area.
So it&rsquo;s not recommended.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/11/022211/">网站线框图绘制工具</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-11T02:22:11+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:22 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>纸和笔</h1>

<p>修改比较麻烦，复制成本高，表达能力强。</p>

<h1>软件工具</h1>

<h2>Pencil</h2>

<p><a href="http://pencil.evolus.vn/">Pencil</a>可以通过下载Firefox插件或者deb包的方式在Linux上安装，接近于手画，目前找到的唯一一个开源软件。</p>

<p>开发过程中，需要安装它的Dojo Widgets，其中包含按钮，文本框等一些必需的控件，</p>

<p>Pencil只能导出为单页html文件，试验发现其TabNav和jQuery两个模板导出的html网页可以比较好地模拟多页html效果。</p>

<p>Dojo widgets和TabNav, jQuery两个模板都可以在官网的<a href="http://pencil.evolus.vn/Stencils-Templates.html">Stencils</a>页面上找到下载信息。</p>

<p>这里下载到的是Dojo.GUI_v6.zip, TabNav.zip和JQUERY.zip这3个文件。</p>

<h2>Cacoo</h2>

<p><a href="https://cacoo.com/">Cacoo</a>是一个在线工具，基于flash开发，优点是有比较好的模板，可以直接在上面改，缺点是必须有网络，运行速度略慢，不能导出源代码，免费版有数量限制。</p>

<h2>Axure RP Pro</h2>

<p><a href="http://www.axure.com/">Axure RP</a>大概是国内知名度最高的原型开发工具了，功能强大，学习资料多，绿色版运行需要先安装Microsoft .NET framework 4.0.</p>

<p>其他还有很多在线线框图制作网站，一般都是收费的，或者限制功能版免费，功能类似于Cacoo，搜索&#8221;wireframing tool quora&#8221;可以找到一些比较好的推荐文章。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/05/183154/">Manipulating CSV Files in Command Line</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-05T18:31:54+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>6:31 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>csvkit</h1>

<p>Here we manipulate csv files with <a href="https://github.com/onyxfish/csvkit">csvkit</a>.
It&rsquo;s developed with Python. So install it with <code>sudo pip install csvkit</code>;</p>

<p>Convert xls, xlsx file into csv file: <code>in2csv input.xlsx &gt; data.csv</code>;</p>

<p>List column titles of a csv file: <code>csvcut -n data.csv</code>;</p>

<p>Print statistic information for each columns in a csv file: <code>csvstat data.csv</code>;</p>

<p>Print the first, second, 11th, 16th column of first 9 records (another one for headline): <code>csvcut -c 1,2,11,16 data.csv|head</code>;</p>

<p>If there are newline characters in records, add &ldquo;-l&rdquo; option to make it clear: <code>csvcut -l -c 1,2,11,16 data.csv|head</code>;</p>

<p>Convert to json file with csvjson: <code>csvcut -c 1,2,11,16 fairData150104.csv|head|csvjson -i 4</code>, &ldquo;-i&rdquo; specify how many indent spaces, default is no indent.</p>

<h1>csvtool</h1>

<p>Install: <code>sudo aptitude install csvtool</code>;</p>

<ul>
<li><p>csvtool sub <n1> <n2> <n3> <n4> data.csv:</p>

<p>  Take a square subset of the CSV, top left at row <n1>, column <n2>,
  which is <n3> deep and <n4> wide.
  <n1> and <n2> count from 1, or from 0 if -z option is given.</p>

<p>  Example: <code>csvtool sub 1 16 1 1 data.csv</code></p></li>
<li><p>csvtool take <n> data.csv: take first <n> rows of the csv, like &ldquo;head&rdquo; in shell;</p></li>
<li><p>csvtool drop <n> data.csv: drop the first <n> rows and return the rest (if any).</p></li>
</ul>


<p>See <code>csvtool -h</code> for details.</p>

<p>To print the <em>n</em>th record easily, add the following function into ~/.bash_alias file:</p>

<pre><code>function ctls(){
  if test $# -eq 3; then
    csvtool drop $2 $1 | csvtool take $3 -
  else
    echo ctls: csvtool list specified record
    echo Synopsis: ctls '&lt;filename&gt; &lt;startNo&gt; &lt;count&gt;'
  fi
}
</code></pre>

<p>Now print the 3rd record of data.csv with <code>ctls data.csv 3 1</code>.</p>

<p>The &ldquo;-&rdquo; in &ldquo;csvtool take&rdquo; means &ldquo;get input from stdin instead of a file&rdquo;.</p>

<h1>Put them together</h1>

<ul>
<li><p>Count the number of records which the 7th field is empty: <code>csvgrep -c 7 -r "^$" data.csv | csvtool height -</code>;</p></li>
<li><p>Count the number of records which the 7th field is NOT empty: <code>csvgrep -c 7 -r "^.+$" data.csv | csvtool height -</code>;</p></li>
<li><p>Print data on screen without line wrap: <code>less -S &lt;filename&gt;</code>;</p></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/04/173843/">Compare Users in 2 Days With Spark</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-04T17:38:43+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>5:38 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>We have 2 log files. One contains logs created in 2014.11.22, the other all in 2014.11.23.
Each have about 240 million logs in it, with file size 30GB.</p>

<p>The log in these files are like this:</p>

<blockquote><p>&ldquo;460015482006002&rdquo;,&ldquo;深圳市&rdquo;,&ldquo;广东省&rdquo;,&ldquo;2014-12-22  16:46:04&rdquo;,&ldquo;2014-12-22  16:46:04&rdquo;,&ldquo;42705&rdquo;,&ldquo;16111&rdquo;,&ldquo;460014270516111&rdquo;,&ldquo;MAP&rdquo;</p></blockquote>

<p>The number in the first column &ldquo;460015482006002&rdquo; represents a unique user, which is called &ldquo;IMSI&rdquo;.
We need to find all IMSI number <strong>only</strong> exists in 2014.11.22.</p>

<p>Given the huge size of log files, we compute with Apache Spark.</p>

<p>Create only22.scala:</p>

<pre><code>import java.util.Date
import java.util.Calendar
import java.util.concurrent.TimeUnit

val SIG_DATA1 = "datamine/drawdata_20141122_cs.utf8.csv"
val SIG_DATA2 = "datamine/drawdata_20141123_cs.utf8.csv"
val USER_ID_POS = 1

def get_users(data: String): Set[String] = {
  val raw_data = sc.textFile(data).map(_.split("\"").toList)
  val raw_sig_map = raw_data.filter(x =&gt; x.size &gt; 17)
  val users = raw_sig_map.map(_(USER_ID_POS)).distinct
  return users.toArray.toSet
}

val u1 = get_users(SIG_DATA1)
val u2 = get_users(SIG_DATA2)
val only22 = u1 -- u2
scala.tools.nsc.io.File("only22.txt").writeAll(only22.toString)
</code></pre>

<p>Run it: <code>spark-shell --master spark://cloud142:7077 --driver-memory 6g --driver-cores 5 --total-executor-cores 28 --executor-memory 20g -i only22.scala</code></p>

<p>In file only22.txt, all elements in the set are written in one line.
So we have to replace all &ldquo;,&rdquo; with newline character: <code>sed -i 's/,/\n/g' only22.txt</code>;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/31/101055/">将中文字符串转换为拼音首字母串</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-31T10:10:55+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2014</span></span> <span class='time'>10:10 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>下面的Python脚本将任意汉字和英文、数字混合字符串转换为拼音首字母组成的字符串，
注意：有些汉字不能查找到首字母，例如&#8221;深圳东莞&#8221;的&#8221;圳&#8221;和&#8221;莞&#8221;两个字，原因不明。
需要在vi中用&#8221;/\&lt;[A-Z]>搜索这种情况。</p>

<p>实现过程是：首先尝试用unicode, utf8和gbk解码字符串，然后用GBK编码字符串，利用GBK汉字是按拼音顺序编码的原理查出其首字母。</p>

<pre><code>#!/usr/bin/env python
# -*- coding: utf-8 -*-

def get_word_initial(inp):
    if isinstance(inp, unicode):
        unicode_str = inp
    else:
        try:
            unicode_str = inp.decode('utf8')
        except:
            try:
                unicode_str = inp.decode('gbk')
            except:
                print 'unknown coding'
                return

    init_list = [get_char_initial(i) for i in unicode_str]
    return "".join(init_list)

def get_char_initial(unicode1):
    gbkStr = unicode1.encode('gbk')
    try:
        ord(gbkStr)
        return gbkStr
    except:
        asc = ord(gbkStr[0]) * 256 + ord(gbkStr[1]) - 65536
        if asc &gt;= -20319 and asc &lt;= -20284:
            return 'A'
        if asc &gt;= -20283 and asc &lt;= -19776:
            return 'B'
        if asc &gt;= -19775 and asc &lt;= -19219:
            return 'C'
        if asc &gt;= -19218 and asc &lt;= -18711:
            return 'D'
        if asc &gt;= -18710 and asc &lt;= -18527:
            return 'E'
        if asc &gt;= -18526 and asc &lt;= -18240:
            return 'F'
        if asc &gt;= -18239 and asc &lt;= -17923:
            return 'G'
        if asc &gt;= -17922 and asc &lt;= -17418:
            return 'H'
        if asc &gt;= -17417 and asc &lt;= -16475:
            return 'J'
        if asc &gt;= -16474 and asc &lt;= -16213:
            return 'K'
        if asc &gt;= -16212 and asc &lt;= -15641:
            return 'L'
        if asc &gt;= -15640 and asc &lt;= -15166:
            return 'M'
        if asc &gt;= -15165 and asc &lt;= -14923:
            return 'N'
        if asc &gt;= -14922 and asc &lt;= -14915:
            return 'O'
        if asc &gt;= -14914 and asc &lt;= -14631:
            return 'P'
        if asc &gt;= -14630 and asc &lt;= -14150:
            return 'Q'
        if asc &gt;= -14149 and asc &lt;= -14091:
            return 'R'
        if asc &gt;= -14090 and asc &lt;= -13119:
            return 'S'
        if asc &gt;= -13118 and asc &lt;= -12839:
            return 'T'
        if asc &gt;= -12838 and asc &lt;= -12557:
            return 'W'
        if asc &gt;= -12556 and asc &lt;= -11848:
            return 'X'
        if asc &gt;= -11847 and asc &lt;= -11056:
            return 'Y'
        if asc &gt;= -11055 and asc &lt;= -10247:
            return 'Z'
        return ''

if __name__ == "__main__":
    str_input='广州火车站A2c'
    print(get_word_initial(str_input))
</code></pre>

<p>下面是一个完整的使用场景，利用上面的代码为小区的地理位置表添加ID字段。
首先将上面的代码保存在chnInit.py中，然后相同目录下创建一个addID.py文件：</p>

<pre><code>import chnInit
import sys

target = sys.argv[1]
inclID = sys.argv[2]
with open(target, 'r') as src:
    with open(inclID, 'w') as dst:
        for content in src:
            line = content.strip()
            cgi = line.split(' ,')[0]
            node = line.split(' ,')[1].split(' ')[0]
            city = line.split(' ,')[1].split(' ')[1]
            nodeID = chnInit.get_word_initial(node)
            cityID = chnInit.get_word_initial(city)
            dst.write(cgi + ' ,' + city + ' ' + cityID + ' ' + node + ' ' + nodeID + '\n')
</code></pre>

<p>相同目录下保存输入文件input.csv，然后运行脚本：</p>

<pre><code>$ head input.csv
460010973309433 ,白云国际机场 广州
...

$ python addID.py input.csv loc_map.csv
$ head loc_map.csv
460010973309433 ,广州 GZ 白云国际机场 BYGJJC
...
</code></pre>

<p>根据Python文档7.2.1节：&#8221;Methods of File Objects&#8221;中的描述：</p>

<blockquote><p>For reading lines from a file, you can loop over the file object.
This is memory efficient, fast, and leads to simple code:</p></blockquote>

<pre><code>with open(target, 'r') as f:
    for line in f:
        ...
</code></pre>

<p>这种方式比较节省内存，适于处理大文件。
当处理小文件时，可以用下面的方法将完整内容保存在一个变量中：</p>

<pre><code>with open('workfile', 'r') as f:
    read_data = f.read()
</code></pre>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/3">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/index.html">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/02/01/134829/">Full Text Search for Meteor App</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/30/183509/">基于Search Source的简单查询实现方法</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/29/141348/">Git-flow Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/26/174649/">Meteor Development Styles</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/26/173952/">离线保存网页</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/leetschau">@leetschau</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'leetschau',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Li Chao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
