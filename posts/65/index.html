
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dark Matter in Cyberspace</title>
  <meta name="author" content="Li Chao">

  
  <meta name="description" content="jdk1.6.0_35/src.zip, only java package is reviewd(full package review caused a OutofMemory on java heap size). Checkstyle Review tyRules.xml: &lt;? &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://leetschau.github.io/posts/65/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Dark Matter in Cyberspace" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Dark Matter in Cyberspace</a></h1>
  
    <h2>A notes repository for Meteor.js, data mining, Linux, etc.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="leetschau.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/21/202314/">CodeReview of JDK Source Code</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-05-21T20:23:14+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>8:23 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>jdk1.6.0_35/src.zip, only java package is reviewd(full package review caused a OutofMemory on java heap size).</p>

<h1>Checkstyle Review</h1>

<h2>tyRules.xml:</h2>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt; 
&lt;!DOCTYPE module PUBLIC "-//Puppy Crawl//DTD Check Configuration 1.3//EN" "http://www.puppycrawl.com/dtds/configuration_1_3.dtd"&gt; 
&lt;module name="Checker"&gt; 
    &lt;property name="severity" value="warning"/&gt; 
    &lt;module name="TreeWalker"&gt; 
        &lt;metadata name="net.sf.eclipsecs.core.lastEnabledSeverity" value="inherit"/&gt; 
        &lt;property name="fileExtensions" value="java"/&gt; 
        &lt;module name="MethodLength"&gt; 
            &lt;property name="max" value="200"/&gt; 
        &lt;/module&gt; 
        &lt;module name="NestedIfDepth"&gt; 
            &lt;property name="max" value="5"/&gt; 
        &lt;/module&gt; 
        &lt;module name="CyclomaticComplexity"/&gt; 
            &lt;module name="ParameterNumber"&gt; 
            &lt;property name="max" value="6"/&gt; 
        &lt;/module&gt; 
    &lt;/module&gt; 
    &lt;module name="StrictDuplicateCode"&gt; 
        &lt;property name="fileExtensions" value="java"/&gt; 
        &lt;property name="min" value="75"/&gt; 
    &lt;/module&gt; 
    &lt;module name="FileLength"&gt; 
        &lt;property name="fileExtensions" value="java"/&gt; 
        &lt;property name="max" value="1000"/&gt; 
    &lt;/module&gt; 
&lt;/module&gt; 
</code></pre>

<h2>Run code review</h2>

<pre><code>java -jar checkstyle-5.6-all.jar -c tyRules.xml -r /home/chad/tmp/jdksrc -o result.txt
</code></pre>

<h2>Get Review Result</h2>

<pre><code>grep "Method length is" result.txt|wc -l
grep "Nested if-else depth is" result.txt|wc -l
grep "More than 6 parameters" result.txt|wc -l
grep "max allowed is 1,000" result.txt|wc -l
grep "Found duplicate of" result.txt|wc -l
grep "Cyclomatic Complexity is" result.txt|wc -l
</code></pre>

<h1>Sonar Review</h1>

<h2>sonar-project.properties:</h2>

<pre><code>sonar.projectKey=jdk.sonar.analysis 
sonar.projectName=JDK 
sonar.projectVersion=1.6 
sonar.sources=jdksrc 
sonar.login=liuyan 
sonar.password=liuyan 
sonar.language=java 
sonar.profile=TongYong 
sonar.skipDesign=true 
sonar.dynamicAnalysis=false 
</code></pre>

<h2>Run code review</h2>

<pre><code>/opt/sonar-server/runner/sonar-runner-2.2/bin/sonar-runner
</code></pre>

<p>The profile TongYong is imported from above tyRules.xml.</p>

<h1>Result</h1>

<h2>From Sonar</h2>

<p>Lines of code: 202,505 (NBNC, not blank not comment code lines);</p>

<p>559,577 lines (total lines = NBNC + blank + comment);</p>

<p>Above can be verified by cloc.</p>

<p>2172 Classes, 21,275 methods, 675 method cyclomatic complexity are greater than 10,</p>

<h2>Cyclomatic Complxity</h2>

<p>GCP: 298/6276 = 4.75%</p>

<p>JDK: 674/21275 = 3.17%</p>

<h2>Duplicate Lines</h2>

<p>GCP:</p>

<p>JDK: 825/</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/21/115033/">Jenkins User Management Using Role-based Strategy</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-05-21T11:50:33+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>11:50 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Build-in authorization method of Jenkins(described in note &ldquo; Jenkins user account configurations &rdquo;) have to deal with user rights one by one. The following role-based method can create some roles and assgin some users to a role.</p>

<ol>
<li><p>Install Role Strategy Plugin;</p></li>
<li><p>Start Jenkins Server;</p></li>
<li><p>Jenkins -> Manage Jenkins -> Global Security -> enable security;</p></li>
<li><p>Select &ldquo;Jenkins&rsquo;s own user database&rdquo; as the security realm;</p></li>
<li><p>Check &ldquo;Allow user to sign up&rdquo;;</p></li>
<li><p>Select &ldquo;Authorizaiton -> Role-based Strategy&rdquo;;</p></li>
<li><p>Manage Jenkins -> Manage and Assign Roles -> Manage Roles: create a role &ldquo;admin&rdquo; with all rights, &ldquo;proj_leader&rdquo;, check Overall->Read and all of Jobs, Run, View and SCM;</p></li>
<li><p>Manage Jenkins -> Manage and Assign Roles -> Assign Roles: create user &ldquo;admin&rdquo; and assign role &ldquo;admin&rdquo; to it, create user &ldquo;chad&rdquo; and assign role &ldquo;proj_leader&rdquo; to it;</p></li>
</ol>


<p>Note:</p>

<ol>
<li><p>Ensure Overall->Read &amp; Job->Discover is checked for user &ldquo;Anonymous&rdquo;, or a 404 error will raised;</p></li>
<li><p>When user rights definition is changed, no need to restart Jenkins service to take effect;</p></li>
<li><p>Chinese charactor in user name is allowed and verified;</p></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/21/083322/">Quality Profile in Sonar</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-05-21T08:33:22+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>8:33 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Quality profile of sonar is a set of check rules, like the rulesets of Checkstyle. You can create/modify/backup/rename/delete a profile at [Settings -> Quality Profiles] as Administrator. Creating a profile means importing check rules from a xml file. On the contrary, &ldquo;backup&rdquo; a existing profile means save it(as a xml file) to disk. You can edit the profile under the &ldquo;Coding rules&rdquo; tab, and link it to a specific project under the &ldquo;Projects&rdquo; tab.</p>

<p>Once defined some profiles, you can use it in a sonar runner by specify it in sonar-project.properties file:</p>

<pre><code>sonar.profile=profile_name
</code></pre>

<p>You also can specify a profile to a project at &ldquo;Configuration&rdquo;(at the upper-right corner of the dashboard of the project). See <a href="http://docs.codehaus.org/display/SONAR/Analysis+Parameters">Analysis Parameters</a> for all 4 ways to specify profile for a project, and a full list of parameters you can specify in sonar-project.properties.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/20/180356/">Jenkins User Account Configurations</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-05-20T18:03:56+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>6:03 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Lightweight Security Management</h1>

<ol>
<li><p>Start Jenkins;</p></li>
<li><p>Jenkins -> Manage Jenkins -> Global Security -> enable security;</p></li>
<li><p>Select &ldquo;Security Realm ->Jenkins&rsquo;s own user database&rdquo;;</p></li>
<li><p>Check &ldquo;Allow user to sign up&rdquo;;</p></li>
<li><p>Check Authorization -> Logged-in users can do anything;</p></li>
<li><p>Click &ldquo;Save&rdquo;;</p></li>
<li><p>Sign in as &ldquo;admin&rdquo;;</p></li>
<li><p>Manage Jenkins -> Global Security -> uncheck &ldquo;Allow user to sign up&rdquo;;</p></li>
</ol>


<p>Now anonymous users are read-only for Jenkins. This security strategy are suitable for one user scenario.</p>

<p>===Deprecated===</p>

<ol>
<li><p>Start Jenkins Service: nohup java -jar jenkins.war 1>jenkins.log 2>jenkins.log &amp;</p></li>
<li><p>Jenkins -> Manage Jenkins -> Global Security -> enable security;</p></li>
<li><p>Select &ldquo;Security Realm ->Jenkins&rsquo;s own user database&rdquo;;</p></li>
<li><p>Check &ldquo;Allow user to sign up&rdquo;;</p></li>
<li><p>Select &ldquo;Matrix-based security&rdquo; as the authorization;</p></li>
<li><p>Give anonymous user the read access;</p></li>
<li><p>In Textbox follow &ldquo;User/group to add&rdquo;, write &ldquo;admin&rdquo; and click &ldquo;add&rdquo; button;</p></li>
<li><p>Give admin full access right by checking all items in the row;</p></li>
<li><p>Click &ldquo;save&rdquo; button at the bottom;</p></li>
<li><p>Now you should be locked out of Jenkins. But you can find a &ldquo;sign up&rdquo; link at the upper-right corner on the main page;</p></li>
<li><p>Sign up a user named &ldquo;admin&rdquo;(the same you config at preceding steps), set password, then you can login as administrator.</p></li>
</ol>


<p><a href="https://wiki.jenkins-ci.org/display/JENKINS/Quick+and+Simple+Security">Quick and Simple Security</a> does not work on my Ubuntu Desktop PC.</p>

<p>Reference:</p>

<p><a href="https://wiki.jenkins-ci.org/display/JENKINS/Standard+Security+Setup">Standard Security Setup</a>;</p>

<p><a href="https://wiki.jenkins-ci.org/display/JENKINS/Disable+security">Help! I locked myself out!</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/20/161756/">Code Quality Check Based on Jenkins and Sonar</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-05-20T16:17:56+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>4:17 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Based on Jenkins 1.5 with Sonar plugins, Ubuntu 12.04.</p>

<h1>Installation and System Configuration</h1>

<ul>
<li><p>Install and config Jenkins: see note &ldquo; Install Jenkins and plugins by hand &rdquo;;</p></li>
<li><p>Install and config Sonar and Sonar Runner: see note &ldquo; Analyze Java Code with Sonar on Ubuntu &rdquo;;</p></li>
</ul>


<h2>Jenkins System Configuration</h2>

<p>Manage Jenkins -> Configure System:</p>

<pre><code>Sonar Runner: Name: MySonarRunner; SONAR_RUNNER_HOME: parent folder of "bin/sonar-runner" script;
Sonar -&gt; Sonar Installations -&gt; Advanced:
Name: MySonar;
Sonar account login/password: admin/admin;
Server URL: leave blank(http://localhost:9000, if sonar server is not at the same server with jenkins, notice no "/" at the end of this url);
Database URL: jdbc:mysql://localhost:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true(equals to "sonar.jdbc.url" in $SONAR_SERVER/conf/sonar.properties, notice "localhost" can not be writen as ip address);
Database login/password: sonar/sonar;
Database Driver: com.mysql.jdbc.Driver;
</code></pre>

<h1>Project-specific Sonar Runner Configuration</h1>

<p>Creating file /opt/sonar-server/gcp.properties as followings: see note &ldquo; Analyze Java Code with Sonar on Ubuntu &rdquo; and notice:</p>

<pre><code>sonar.sources=src (a relative path name whose root directory is $PROJECT_WORKSPACE);
sonar.sourceEncoding=GBK (determined by source file encoding, default is UTF-8);
</code></pre>

<h1>Jenkins Project Configuration</h1>

<p>Source Code Management: Subversion -> enter subversion url;</p>

<p>Build:</p>

<pre><code>Execute Shell: cp /opt/sonar-server/gcp.properties ./sonar-project.properties
Invoke Standalone Sonar Analysis
</code></pre>

<p>Do not add post-build actions &ldquo;Sonar&rdquo; because it&rsquo;s bounded with Maven. If there is no pom.xml at the root of the project, an error raises.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/19/153646/">Erlang IDE Setup</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-05-19T15:36:46+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>3:36 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Windows Console</h1>

<ol>
<li><p>add erl.exe and vim.exe to %PATH%;</p></li>
<li><p>start ConEmu, split window vertically (see note &ldquo; Multiple terminals operation on Windows and Ubuntu &rdquo; for spliting window detail);</p></li>
<li><p>start erlang shell with <code>erl.exe</code> at left and <code>vim erlSrc.erl</code> at the right window;</p></li>
</ol>


<h1>Ubuntu Console</h1>

<ol>
<li><p>start Terminator and split window;</p></li>
<li><p><code>erl</code> at left and <code>vi erlSrc.erl</code> at right;</p></li>
</ol>


<h1>IDE based on Sublime Text 2</h1>

<p>Use package control install two package: SublimErl and SublimeREPL.</p>

<p>Run erlang REPL: Sublime Text Menu / Tools / SublimeREPL / Erlang. If you got a error message, it&rsquo;s most probably caused by not adding werl.exe in $PATH. So Sublime Text Menu / Preferences / Package Settings / SublimeREPL / Settings-User, add <code>{ "default_extend_env": {"PATH": "{PATH};C:/Program Files/erl5.10/bin"} }</code>.</p>

<p>alt+shift+2(shortcut in View / Layout): split window with 2 column;</p>

<p>key shortcuts defs in sublime text 2:</p>

<p><a href="http://docs.sublimetext.info/en/latest/reference/keyboard_shortcuts_win.html#">http://docs.sublimetext.info/en/latest/reference/keyboard_shortcuts_win.html#</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/17/094431/">去掉文件中的^M</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-05-17T09:44:31+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>9:44 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>一般情况下用:set ff=unix就可以解决问题，如果无效，用下面的方法手工完成：</p>

<pre><code>:%s/[ctrl+v] [ctrl+m]//g
</code></pre>

<p>ctrl+v表示按住Ctrl键再按下v键。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/17/084555/">Analyze Java Code With Sonar on Ubuntu</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-05-17T08:45:55+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>8:45 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Install Sonar Service</h1>

<ol>
<li><p><code>set JAVA_HOME=/usr/lib/jvm/default-java</code>(optional);</p></li>
<li><p>install database: <code>apt-get install mysql-server</code>;</p></li>
<li><p>download sonar-3.5.1.zip and extract to /opt/sonar-server;</p></li>
<li><p>test startup: <code>$SONAR_HOME/bin/linux-x86-32/sonar.sh console</code>, web browser: <a href="http://localhost:9000;">http://localhost:9000;</a></p></li>
<li><p>build database: root@chadpc56:/opt/sonar-server/sonar-3.5.1/extras/database/mysql# <code>mysql -u root -p &lt; create_database.sql</code>;</p></li>
<li><p>modify db config: comment out &ldquo;sonar.jdbc.url: jdbc:h2&hellip;&rdquo;, uncomment &ldquo;sonar.jdbc.url: jdbc:mysql&hellip;&rdquo; in $SONAR_SERVER/conf/sonar.properties;</p></li>
<li><p>verify db operations: <code>$SONAR_HOME/bin/linux-x86-32/sonar.sh console</code>, you can see many tables are created in mysql db, then <code>mysqlshow sonar -u sonar -p</code>, with password &ldquo;sonar&rdquo;, you can see a list of tables created;</p></li>
<li><p>start sonar service: <code>nohup $SONAR_HOME/bin/linux-x86-32/sonar.sh start 1&gt;/dev/null &amp;</code>, you can monitor its startup via <code>tail -f $SONAR_HOME/logs/sonar.log</code>;</p></li>
</ol>


<p>Note: If using zsh, you have to add <code>disown %1</code> to detach background job from current shell, or your background jobs will be killed when you logged out, even it was nohupped. (or you can add &ldquo;setopt nohup&rdquo; in .zshrc to the same effect).</p>

<h1>First Login Configuration</h1>

<ol>
<li>login <a href="http://localhost:9000">http://localhost:9000</a> with admin/admin;</li>
</ol>


<h1>Analyse Java Project with Sonar Runner</h1>

<ol>
<li><p><a href="http://docs.codehaus.org/display/SONAR/Installing+and+Configuring+Sonar+Runner">Installing and Configuring Sonar Runner</a>: download, extract, set environment variables, add to path, modify config file, verify (sonar-runner -h);</p></li>
<li><p><a href="http://docs.codehaus.org/display/SONAR/Analyzing+with+Sonar+Runner">Analyzing with Sonar Runner</a>: create sonar-project.properties under project root folder, run sonar runner at project root folder (sonar-runner), see result in sonar dashboard;</p></li>
</ol>


<p>Note: add sonar.login &amp; sonar.password in sonar-project.properties;</p>

<h1>Analyse Java Project with Ant Task</h1>

<h2>Build a Demo Java Project</h2>

<ol>
<li><p>apt-get install ant;</p></li>
<li><p>copy junit-4.11.jar and hamcrest-core-1.3.jar to lib folder of ant(/usr/share/ant/lib);</p></li>
<li><p>create build.xml:</p></li>
</ol>


<h2>Run Sonar</h2>

<ol>
<li><p>Download sonar-ant-task-2.1.jar;</p></li>
<li><p>Add sonar tasks into above build.xml;</p></li>
<li><p>Run sonar with <code>ant sonar</code>;</p></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/16/091955/">Customize Window Buttons Position on Ubuntu</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-05-16T09:19:55+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>9:19 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Verified on Ubuntu Desktop 12.04.</p>

<p>Move window buttons to upper-right corner:</p>

<p>gconftool -s /apps/metacity/general/button_layout -t string menu:minimize,maximize,close</p>

<p>Move window buttons to upper-left corner:</p>

<p>gconftool -s /apps/metacity/general/button_layout -t string close,minimize,maximize</p>

<p>Only show close and minimize buttons at upper-left corner:</p>

<p>gconftool -s /apps/metacity/general/button_layout -t string close,minimize</p>

<p>(You can maximize window by double-clicking title-bar)</p>

<p>You have to use current user to run this command, or you will get &ldquo;No D-BUS daemon running&rdquo; error. For example, if you login desktop as user &ldquo;john&rdquo;, you will find a .dbus folder owned by john in $HOME of user john.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/15/164215/">Auto Code Review Based on Jenkins and Checkstyle</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-05-15T16:42:15+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>4:42 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Based on Jenkins 1.509 and Checkstyle 5.6.</p>

<p>Now we need practising code review, as a step of BVT of course. The ideal solution is based on Sonar and its checkstyle plugin. But I am not very familiar with sonar&rsquo;s java runner and other features. So I decided to use some &ldquo;plain&rdquo; method to embed code review into the process of BVT.</p>

<h1>Preparations</h1>

<ol>
<li><p>Install checkstyle plugin of jenkins;</p></li>
<li><p>copy checkstyle-5.6-all.jar to /opt/checkstyle;</p></li>
<li><p>create a code review rule file tyRules.xml at /opt/checkstyle:</p></li>
</ol>


<p> &lt;?xml version=&ldquo;1.0&rdquo; encoding=&ldquo;UTF-8&rdquo;?></p>

<p> &lt;!DOCTYPE module PUBLIC &ldquo;-//Puppy Crawl//DTD Check Configuration 1.3//EN&rdquo; &ldquo;<a href="http://www.puppycrawl.com/dtds/configuration_1_3.dtd">http://www.puppycrawl.com/dtds/configuration_1_3.dtd</a>&rdquo;>
 <module name="Checker">
  <property name="severity" value="warning"/>
  <module name="TreeWalker">
  <metadata name="net.sf.eclipsecs.core.lastEnabledSeverity" value="inherit"/>
  <module name="MethodLength">
   <property name="max" value="200"/>
  </module>
  <module name="NestedIfDepth">
   <property name="max" value="5"/>
  </module>
  <module name="CyclomaticComplexity"/>
  <module name="ParameterNumber">
   <property name="max" value="6"/>
  </module>
  </module>
  <module name="StrictDuplicateCode">
  <property name="min" value="75"/>
  </module>
  <module name="FileLength">
  <property name="max" value="1000"/>
  </module>
 </module></p>

<ol>
<li><p>Project -> Configuration -> Source Code Management -> Subversion -> Repo URL: svn://localhost/ServerMeter</p></li>
<li><p>Project -> Configuration -> Post-build Actions -> Publish Checkstyle analysis results: <em>*/codeReview</em>.xml;</p></li>
<li><p>Project -> Configuration -> Post-build Actions -> E-mail Notification: &hellip;</p></li>
</ol>


<h1>As part of ant build</h1>

<ol>
<li>add a target &ldquo;checkcode&rdquo; in build.xml:</li>
</ol>


<p> &lt;?xml version=&ldquo;1.0&rdquo; encoding=&ldquo;UTF-8&rdquo;?>
 <project name="checkstyleTest" basedir="./" default="checkcode">
   <taskdef resource="checkstyletask.properties" classpath="/opt/checkstyle/checkstyle-5.6-all.jar"/>
   <property name="build.dir" value="${basedir}/build" />
   <target name="init">
     <delete dir="${build.dir}"/>
     <mkdir dir="${build.dir}"/>
   </target>
   <target name="checkcode" depends="init">
     <checkstyle config="/opt/checkstyle/tyRules.xml">
       <fileset dir="src" includes="**/*.java"/>
       <formatter type="xml" toFile="build/codeReviewResult.xml"/>
     </checkstyle>
   </target>
 </project></p>

<ol>
<li>Jenkins setup: Project -> Configuration -> Build -> Invoke Ant -> Targets: checkcode;</li>
</ol>


<p>PROS: simple config, with the power of ant;</p>

<p>CONS: build scripts of every project have to be modified, which violates the DRY principle;</p>

<h1>As an independent step in build process</h1>

<p>Jenkins setup: Project -> Configuration -> Build -> Execute shell:</p>

<p> rm -rf build
 mkdir build
 find . -depth -name .svn -exec rm -fr {} \;
 java -jar /opt/checkstyle/checkstyle-5.6-all.jar -c /opt/checkstyle/tyRules.xml -r src -f xml -o build/codeReviewResult.xml</p>

<p>PROS: no need to modify any thing in project, do one thing in only ONE place;</p>

<p>CONS: there are some dirty work in shell script, for example you have to delete and create build folder manually (otherwise checkstyle report can not be created correctly), and remove all .svn folder recursively (otherwise checkstyle will find some duplicate codes in normal code file and backup file in .svn folder).</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/66">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/64">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/04/09/204200/">Note About Rest Client</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/29/183444/">MongoDB Schema Analysis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/21/075937/">Toggle Syntastic Mode to Speedup Vim</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/21/004603/">Persist Tmux</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/17/140426/">Git Submodule的同步问题</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/leetschau">@leetschau</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'leetschau',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Li Chao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
