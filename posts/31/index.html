
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dark Matter in Cyberspace</title>
  <meta name="author" content="Li Chao">

  
  <meta name="description" content="客户端&copy;连接服务端(S)时，会在自己的~/.ssh/known_hosts中记录S名称的Hash（如果希望在known_hosts文件中使用原服务端名称，在/etc/ssh/ssh_config中去掉"HashKnownHosts yes"，或者在~/.ssh/config中增加" &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://leetschau.github.io/posts/31/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Dark Matter in Cyberspace" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Dark Matter in Cyberspace</a></h1>
  
    <h2>A notes repository for Meteor.js, data mining, Linux, etc.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="leetschau.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/25/200006/">Secure Shell基于密钥的连接过程</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-25T20:00:06+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:00 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>客户端&copy;连接服务端(S)时，会在自己的~/.ssh/known_hosts中记录S名称的Hash（如果希望在known_hosts文件中使用原服务端名称，在/etc/ssh/ssh_config中去掉"HashKnownHosts yes"，或者在~/.ssh/config中增加"HashKnownHosts no"）以及一个很长的特征串，当有人伪装成S骗取密码，或者S操作系统重装之后，由于后面这个特征串发生了变化，所以ssh会发出警告，只有从~/.ssh/known_hosts中删掉要连接的S那一行才能重新连接。</p>

<p>使用密钥而不是密码登录S的好处是不需要每次输入密码，且能够避免“中间人攻击”，基于密钥的配置过程是：</p>

<ol>
<li><p>C创建自己的公钥和私钥(ssh-keygen命令）；</p></li>
<li><p>C将自己的公钥保存到S（ssh-copy-id命令，实际上是加自己的公钥加入了S的~/.ssh/authorized_keys文件中）；</p></li>
</ol>


<p>这样就配置好了，以后当客户端需要登录服务端时，连接过程是：</p>

<ol>
<li><p>C与S首先进行Diffie–Hellman key exchange（参考<a href="http://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange">http://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange</a> 其中的插图对这种算法为什么是安全的解释的很清楚：密钥的混合类似于颜色的混合，反向操作几乎是不可能的，因此将混合后的密钥在网络上传输是安全的），最终生成本次会话的密钥；</p></li>
<li><p>后续的报文基于上面生成的密钥进行对称加密传输（也就是加密和解密使用同一个密钥）。</p></li>
</ol>


<p>网上有写SSH登录过程使用非对称加密传输（及公钥加密、私钥解密，见<a href="http://en.wikipedia.org/wiki/Public-key_cryptography%EF%BC%89%EF%BC%8C%E8%BF%99%E6%98%AFSSH">http://en.wikipedia.org/wiki/Public-key_cryptography%EF%BC%89%EF%BC%8C%E8%BF%99%E6%98%AFSSH</a> v1的加密方式。</p>

<p>详细的连接过程参考man sshd.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/25/114442/">Join Two Files Line to Line in Each Row</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-25T11:44:42+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:44 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>TY-HD-01-001
TY-HD-01-002
TY-HD-01-003
TY-HD-01-004
TY-HD-01-005
TY-HD-01-006
TY-HD-01-007
TY-HD-01-008
TY-HD-01-009
TY-HD-01-010</p>

<p>$ head tail.txt
fa_cg_nb_c_000157
fa_cg_nb_d_001571
fa_cg_nb_d_000432
fa_cg_nb_d_001796
fa_cg_nb_d_001675
fa_cg_nb_d_001198
fa_cg_nb_d_001768
fa_cg_nb_d_001445
fa_cg_nb_d_000703
fa_cg_nb_d_001563</p>

<p>$ paste -d &lsquo;-&rsquo; head.txt tail.txt > all.txt
$ head all.txt
TY-HD-01-001-fa_cg_nb_c_000157
TY-HD-01-002-fa_cg_nb_d_001571
TY-HD-01-003-fa_cg_nb_d_000432
TY-HD-01-004-fa_cg_nb_d_001796
TY-HD-01-005-fa_cg_nb_d_001675
TY-HD-01-006-fa_cg_nb_d_001198
TY-HD-01-007-fa_cg_nb_d_001768
TY-HD-01-008-fa_cg_nb_d_001445
TY-HD-01-009-fa_cg_nb_d_000703
TY-HD-01-010-fa_cg_nb_d_001563</p>

<p>Note: The EOL(end of line) must be Unix style. If it&rsquo;s Windows style, the &ldquo;paste&rdquo; command will produce wrong results.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/19/171117/">Text Expansion in Vim</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-19T17:11:17+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:11 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>You have 2 options: imap and abbr. Use &ldquo;pt&rdquo; for abbreviation of &ldquo;Puppet&rdquo; for example, first open your vim or gVim:</p>

<ul>
<li><p>imap: &ldquo;:imap pt Puppet&rdquo;;</p></li>
<li><p>abbr: &ldquo;:ab pt Puppet&rdquo;;</p></li>
</ul>


<p>The difference is, imap will expand text right after you press &ldquo;t&rdquo;,
while for abbr, you have to type a space or tab or enter after the &ldquo;t&rdquo; to perform text expansion.
So when writing English, use &ldquo;abbr&rdquo; for it&rsquo;s the &ldquo;normal&rdquo; way.
If you write Chinese with English, imap is the better way,
because there is probably no space after the expanded words.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/18/162706/">Build Puppet Clusters With Vagrant</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-18T16:27:06+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:27 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>$ cd ~/docs/propuppetex/chapter3
$ cat Vagrantfile
Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|</p>

<p>  config.vm.box = &ldquo;centos64&rdquo;</p>

<p>  config.vm.define &ldquo;ppt&rdquo; do |ppt|
    ppt.vm.hostname = &ldquo;puppet.boco.com.cn&rdquo;
    ppt.vm.network &ldquo;private_network&rdquo;, ip: &ldquo;192.168.50.3&rdquo;,
        virtualbox__intnet: &ldquo;gcptest-network&rdquo;
    ppt.vm.provider :virtualbox do |vbox|
      vbox.customize [&ldquo;modifyvm&rdquo;, :id, &ldquo;&ndash;natnet1&rdquo;, &ldquo;10.3/16&rdquo;]
    end
    ppt.vm.provision :shell, path: &ldquo;master.sh&rdquo;
  end</p>

<p>  config.vm.define &ldquo;web&rdquo; do |web|
    web.vm.hostname = &ldquo;web.boco.com.cn&rdquo;
    web.vm.network &ldquo;private_network&rdquo;, ip: &ldquo;192.168.50.4&rdquo;,
        virtualbox__intnet: &ldquo;gcptest-network&rdquo;
    web.vm.provider :virtualbox do |vbox|
      vbox.customize [&ldquo;modifyvm&rdquo;, :id, &ldquo;&ndash;natnet1&rdquo;, &ldquo;10.3/16&rdquo;]
    end
    web.vm.provision :shell, path: &ldquo;web.sh&rdquo;
  end
end</p>

<p>$ cat master.sh
echo &lsquo;<em>&rsquo; > /etc/puppet/autosign.conf
sed -i &lsquo;/[.</em>]/ a \    autosign = true&rsquo; /etc/puppet/puppet.conf # add &ldquo;autosign = true&rdquo; in [main] and [agent]
echo &ldquo;192.168.50.3  puppet.boco.com.cn puppet&rdquo; >> /etc/hosts
echo &ldquo;192.168.50.4  web.boco.com.cn web&rdquo; >> /etc/hosts
mkdir /etc/puppet/manifests
cat > /etc/puppet/manifests/site.pp &lt;<-EOF
node 'web' {
  file { '/home/vagrant/aaa.conf':
    content => &lsquo;this is made by puppet master!&rsquo;,
  }
}
EOF
service iptables stop</p>

<p>$ cat web.sh
sed -i &lsquo;1 a \    master = puppet&rsquo; /etc/puppet/puppet.conf # add &ldquo;master = puppet&rdquo; after the line [main]
echo &ldquo;192.168.50.3  puppet.boco.com.cn puppet&rdquo; >> /etc/hosts
echo &ldquo;192.168.50.4  web.boco.com.cn web&rdquo; >> /etc/hosts
echo &ldquo;proxy=<a href="http://10.21.3.31:8888">http://10.21.3.31:8888</a>&rdquo; >> /etc/yum.conf
service iptables stop</p>

<p>Now run &ldquo;puppet master &ndash;no-daemonize &ndash;verbose&rdquo; on ppt, run &ldquo;puppet agent &ndash;test&rdquo; on web, you can file the file &ldquo;aaa.conf&rdquo; at /home/vagrant.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/18/085501/">Publish Blogs on Cnblogs.com</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-18T08:55:01+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:55 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Some frequently used action about post on cnblogs:</p>

<pre><code>import xmlrpclib

serviceUrl, appKey = 'http://www.cnblogs.com/yourusername/services/metaweblog.aspx', 'yourusername'
username, password = 'yourusername', 'yourpassword'
server = xmlrpclib.ServerProxy(serviceUrl)

res = server.metaWeblog.getRecentPosts('', username, password, 10)
print('no of posts: %d' % len(res))
print('list posts: %s' %res)

cat = server.metaWeblog.getCategories('', username, password)
print('no of categories: %d' %len(cat))
print('list categories: %s' %cat)

post = {'title':'My 4th Post', 'description':'some test text here\na new line', 'mt_keywords': 'test, demo'}
postid = server.metaWeblog.newPost('', username, password, post, True)
print('postid is: %s' % postid)

post = server.metaWeblog.getPost('3604635', username, password)
print('Get Post: %s' % post)
</code></pre>

<p>When publish new post, we often meet this error:</p>

<pre><code>Traceback (most recent call last):
  File "config.py", line 18, in &lt;module&gt;
    postid = server.metaWeblog.newPost('', usr, passwd, post, True)
  File "/usr/lib/python2.7/xmlrpclib.py", line 1224, in __call__
    return self.__send(self.__name, args)
  File "/usr/lib/python2.7/xmlrpclib.py", line 1578, in __request
    verbose=self.__verbose
  File "/usr/lib/python2.7/xmlrpclib.py", line 1264, in request
    return self.single_request(host, handler, request_body, verbose)
  File "/usr/lib/python2.7/xmlrpclib.py", line 1297, in single_request
    return self.parse_response(response)
  File "/usr/lib/python2.7/xmlrpclib.py", line 1473, in parse_response
    return u.close()
  File "/usr/lib/python2.7/xmlrpclib.py", line 793, in close
    raise Fault(**self._stack[0])
xmlrpclib.Fault: &lt;Fault 500: u'\u62b1\u6b49\uff01\u5df2\u8d85\u8fc7\u5f53\u65e5\u535a\u6587\u53d1\u5e03\u6570\u91cf100\u7bc7\u9650\u5236\uff01\u4eca\u5929\u65e0\u6cd5\u7ee7\u7eed\u53d1\u5e03\uff01'&gt;
</code></pre>

<p>To see the error information, open a python shell, run following code</p>

<pre><code>print(u'\u62b1\u6b49\uff01\u5df2\u8d85\u8fc7\u5f53\u65e5\u535a\u6587\u53d1\u5e03\u6570\u91cf100\u7bc7\u9650\u5236\uff01\u4eca\u5929\u65e0\u6cd5\u7ee7\u7eed\u53d1\u5e03\uff01')
</code></pre>

<p>Output:</p>

<pre><code>抱歉！已超过当日博文发布数量100篇限制！今天无法继续发布！
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/17/163640/">基于gVim的暗色调Puppet书籍翻译写作环境</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-17T16:36:40+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:36 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>翻译环境包括两个部分，写作部分和电子书，前者用gVim，后者Windows上用SumatraPDF，Linux Mint就用自带的evince。</p>

<h1>Linux</h1>

<p>配置gVim字体和颜色：</p>

<p>$ cat ~/.gvimrc
set go=
set guifont=Monospace\ 12
colo koehler
set et
set ts=2
set sw=2
set cc=0
set wrap</p>

<p>开始写作：gvim <filename></p>

<p>gVim比vim好的地方是按<ESC>切换到标准状态下时，输入法会自动关闭。</p>

<p>evince用Ctrl-i即可切换到黑底白字，用F11切换全屏。</p>

<p>注：不写"set keymap=pinyin"，也能在<ESC>时自动退出中文输入法。</p>

<h1>Windows</h1>

<h2>gVim</h2>

<p>全屏需要使用一个叫做<a href="http://www.vim.org/scripts/script.php?script_id=2596">gvimfullscreen_win32</a>的工具，下载安装包，把gvimfullscreen.dll解压到gvim.exe所在目录下（d:\Apps\Vim\vim72\），然后在_vimrc中加一行：</p>

<p>map <F11> <Esc>:call libcallnr(&ldquo;gvimfullscreen.dll&rdquo;, &ldquo;ToggleFullScreen&rdquo;, 0)<CR></p>

<p>试用后发现全屏状态下输入法和其他提示窗口都不能显示，基本不可用。</p>

<p>最终$MYVIMRC（d:\Apps\Vim_vimrc）的设置是：</p>

<pre><code>set encoding=utf-8
language messages zh_CN.utf-8
map &lt;Right&gt; :bn&lt;CR&gt;
map &lt;F2&gt; :set wrap!&lt;CR&gt;
set go=
colo evening
set noswapfile
set nobackup
set ts=2
set sw=2
set et
set ai
set nu
set clipboard+=unnamed
set guifont=Consolas:h13
cd e:/docs/translate/propuppet
</code></pre>

<p>其中"set encoding"解决打开UTF-8 without BOM格式编码文件时中文字符乱码问题；</p>

<p>language解决提示信息中的中文乱码问题；</p>

<p>set ts=2是专门为Puppet代码格式设置的。</p>

<p>Windows上的gVim不论插入模式和标志模式默认都支持C-s保存文件。</p>

<h2>SumatraPDF</h2>

<p>主菜单 -> 设置 -> 高级选项，在打开的配置文件里将FixedPageUI中TextColor值和BackgroundColor值互换，就实现了黑底白字的效果。</p>

<p>全屏用 [查看 -> 全屏]，快捷键C-S-l。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/12/175101/">Convert a Private Project on bitbucket.com to a Github Public Project</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-12T17:51:01+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:51 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><ol>
<li><p>Create a public repo on github, you can add README or License files on the master branch, suppose the url is:</p>

<p> <a href="https://github.com/leetschau/don4.git">https://github.com/leetschau/don4.git</a></p></li>
<li><p>Get the private repo:</p>

<p> $ git clone <a href="https://leechau@bitbucket.org/leechau/donno.git">https://leechau@bitbucket.org/leechau/donno.git</a>
 $ cd donno
 $ git branch -v -a   (list all remote branches for checkout)
 $ git checkout -b develop origin/develop   (copy remote branch to local repo and update working directory)</p></li>
<li><p>Publish to github, you have 2 choices:</p>

<ol type="a">
<li><p>Publish selected branches:</p>

<p> $ git remote add don4 <a href="https://github.com/leetschau/don4.git">https://github.com/leetschau/don4.git</a>
 $ git push -u don4 master
 $ git push -u don4 develop</p></li>
</ol>


<p>   or you can push your &ldquo;master&rdquo; branch to remote as &ldquo;init&rdquo; branch for avoid confliction with master branch created on github:</p>

<pre><code> $ git push don4 master:init
</code></pre>

<ol type="a">
<li><p>Publish all branches:</p>

<p> $ git push &ndash;mirror <a href="https://github.com/leetschau/don4.git">https://github.com/leetschau/don4.git</a></p>

<p>In this case you can&rsquo;t create README or License files when creating github project, to avoid conflict on master branch.</p></li>
</ol>
</li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/11/095843/">Fix Jenkins Startup and Access Failure on CentOS</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-11T09:58:43+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:58 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today I install Jenkins on CentOS 6. When start the service with &ldquo;java -jar jenkins.war &ndash;httpPort=8088&rdquo;, it raised a &ldquo;java.net.unknownhostexception: Temporary failure in name resolution&rdquo; error.</p>

<p>Resolution: add hostname (&ldquo;tybvt&rdquo; here) into &ldquo;127.0.0.1&rdquo; name of /etc/hosts, from:</p>

<pre><code>127.0.0.1  localhost.localdomain localhost
</code></pre>

<p>to:</p>

<pre><code>127.0.0.1  tybvt localhost.localdomain localhost
</code></pre>

<p>When Jenkins start successfully, only can access from &ldquo;localhost:8088&rdquo;, &ldquo;10.0.2.47:8088&rdquo; is rejected. It&rsquo;s because the firewall &ldquo;iptables&rdquo; service. So we need to add a rule into iptables configuration. Add:</p>

<pre><code>-A INPUT -i eth0 -p tcp --dport 8088 -j ACCEPT
</code></pre>

<p><strong>right after</strong> the line &ldquo;-A INPUT -i lo -j ACCEPT&rdquo; in file /etc/sysconfig/iptables.
Or simply stop the service with &ldquo;service iptables stop&rdquo; if security is not a concern.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/10/182629/">Configure Hosts With Puppet</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-10T18:26:29+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>6:26 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>According to &ldquo;Pro Puppet&rdquo; 2nd edition, Chapter 2, &ldquo;Creating a Module to Manage SSH&rdquo;.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/07/172525/">Compile Java Codes in Linux Shell Instead of Ant Script</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-07T17:25:25+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:25 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The following is frequently used ant script, compile some java source codes with a libary path, then copy all non-java files to compiled folder:</p>

<pre><code>&lt;property name="src.dir" value="${basedir}/src" /&gt;
&lt;property name="src.class.dir" value="${webroot.dir}/web-inf/classes" /&gt;
&lt;path id="lib.path"&gt;
    &lt;fileset dir="${webroot.dir}/web-inf/lib"&gt;
        &lt;include name="**/*.jar" /&gt;
    &lt;/fileset&gt;
&lt;/path&gt;
&lt;target name="compile-src" depends="init" description="compile java sources"&gt;
    &lt;javac srcdir="${src.dir}" destdir="${src.class.dir}" encoding="utf-8"
            debug="true" classpathref="lib.path" failonerror="false"/&gt;
    &lt;copy todir="${src.class.dir}"&gt;
        &lt;fileset dir="${src.dir}"&gt;
            &lt;exclude name="**/*.java" /&gt;
        &lt;/fileset&gt;
    &lt;/copy&gt;
&lt;/target&gt;
</code></pre>

<p>The corresponding shell script is:</p>

<pre><code>src_dir=/vagrant/codes/GCP6.1/src
web_build=/vagrant/codes/web_build
class_dir=$web_build/web_server/webapps/GCP6.1/WEB-INF/classes
lib_dir=/vagrant/codes/GCP6.1/WebRoot/WEB-INF/lib
find $src_dir -type f -name "*.java" -exec javac -cp "$lib_dir/*:$src_dir" -d $class_dir {} \;
rsync -auC --exclude='*.java' $src_dir/ $class_dir/
</code></pre>

<p>Take care there&rsquo;s no folder named &ldquo;core&rdquo; in $src_dir, or it will be excluded by the &ldquo;-C&rdquo; option of rsync command.</p>

<h1>A Test Case</h1>

<pre><code>$ tree
.
├── classes
├── lib
│   ├── libadd.jar
│   └── libmul.jar
├── libadd
│   └── com
│       └── boco
│           └── gcp
│               └── add
│                   ├── MyAdd.class
│                   └── MyAdd.java
├── libmul
│   └── com
│       └── boco
│           └── gcp
│               └── mul
│                   ├── MyMul.class
│                   └── MyMul.java
└── main
    └── com
        └── boco
            └── gcp
                ├── Test.java
                └── util
                    └── MyUtil.java

17 directories, 8 files

$ find . -name '*.java' -exec cat {} \; -exec echo "--------" \;
package com.boco.gcp.util;

import com.boco.gcp.add.MyAdd;
import com.boco.gcp.mul.MyMul;

public class MyUtil {
    public int newadd(int x, int y) {
        MyAdd add = new MyAdd();
        MyMul mul = new MyMul();
        return add.myadd(3,5) + mul.mymul(3,5);
    }
}
--------
package com.boco.gcp;

import com.boco.gcp.mul.MyMul;
import com.boco.gcp.add.MyAdd;
import com.boco.gcp.util.MyUtil;

public class Test {
    public static void main(String[] args) {
        MyMul mul = new MyMul();
        MyAdd add = new MyAdd();
        System.out.println(mul.mymul(3,5));
        System.out.println(add.myadd(3,5));
        MyUtil util = new MyUtil();
        System.out.println(util.newadd(3,5));
    }
}
--------
package com.boco.gcp.mul;

public class MyMul {
    public int mymul(int x, int y) {
        return 10*x*y;
    }

    public static void main(String[] args) {
        MyMul mul = new MyMul();
        System.out.println(mul.mymul(3,5));
    }
}
--------
package com.boco.gcp.add;

public class MyAdd {
    public int myadd(int x, int y){
        return 10*x+y;
    }

    public static void main(String[] args) {
        MyAdd add = new MyAdd();
        System.out.println(add.myadd(3,5));
    }
}
--------
$ find main -name '*.java' -exec javac -cp 'lib/*:main' {} -d classes \;
$ tree classes/
classes/
└── com
    └── boco
        └── gcp
            ├── Test.class
            └── util
                └── MyUtil.class
</code></pre>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/32">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/30">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/10/05/131004/">Meteor Development Environment on Windows</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/05/110947/">Use Git in Vim With Fugitive</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/03/095227/">A Meteor Package Test Demo</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/01/202107/">Notes of Learn You a Haskell for Great Good</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/29/121847/">Meteor Test With Velocity and Jasmine</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/leetschau">@leetschau</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'leetschau',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Li Chao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
