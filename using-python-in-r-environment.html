<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Li Chao" />
        <meta name="copyright" content="Li Chao" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="rlang, python, rstudio, Tech, " />

<meta property="og:title" content="Using Python in R Environment "/>
<meta property="og:url" content="/using-python-in-r-environment.html" />
<meta property="og:description" content="Add Python Script in Rmd File First you need build a conda environment with all packages needed in your script. To use Python in this environment (instaed of the default one chosen by R), specify the env path in R&#39;s PATH environment variable. For example, I built a conda env …" />
<meta property="og:site_name" content="DarkMatter in Cyberspace" />
<meta property="og:article:author" content="Li Chao" />
<meta property="og:article:published_time" content="2018-06-21T16:53:41+08:00" />
<meta property="" content="2018-09-19T18:24:36+08:00" />
<meta name="twitter:title" content="Using Python in R Environment ">
<meta name="twitter:description" content="Add Python Script in Rmd File First you need build a conda environment with all packages needed in your script. To use Python in this environment (instaed of the default one chosen by R), specify the env path in R&#39;s PATH environment variable. For example, I built a conda env …">

        <title>Using Python in R Environment  · DarkMatter in Cyberspace
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/custom.css" media="screen">
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="/"><span class=site-name>DarkMatter in Cyberspace</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="">Home</a></li>
                            <li ><a href="/categories.html">Categories</a></li>
                            <li ><a href="/tags.html">Tags</a></li>
                            <li ><a href="/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="/using-python-in-r-environment.html"> Using Python in R Environment  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            <hr>
<h1>Add Python Script in Rmd File</h1>
<p>First you need build a conda environment with all packages needed in your script.
To use Python in this environment (instaed of the default one chosen
by R), specify the env path in R's <code>PATH</code> environment variable.</p>
<p>For example, I built a conda env named <code>anaconda</code> with full Anaconda packages,
in the folder <code>/home/leo/apps/miniconda3/envs/anaconda</code>.
And in RStudio console window, run:</p>
<div class="highlight"><pre><span></span>Sys.setenv(PATH=paste(&#39;/home/leo/apps/miniconda3/envs/anaconda/bin:/home/leo/apps/miniconda3/bin&#39;, Sys.getenv(&#39;PATH&#39;), sep = &#39;:&#39;))
</pre></div>


<p>Now in the R markdown (*.Rmd) file, add Python script between triple backslash
with the <code>{python}</code> tag.
See an example with <a href="https://github.com/znbt/mlOperatorIntro/blob/master/tutorial/outlier-fit.Rmd">source code</a>
and rendered <a href="https://github.com/znbt/mlOperatorIntro/blob/master/tutorial/outlier-fit.md">markdown file</a>
with calculation results.</p>
<h1>Run Python REPL in R console</h1>
<p>To use Python in specified conda environment of R,
specify it with <code>Sys.setenv()</code> <strong>before</strong> loading the <em>reticulate</em> package:</p>
<div class="highlight"><pre><span></span>Sys.setenv(RETICULATE_PYTHON=&#39;/home/leo/apps/miniconda3/envs/anaconda/bin/python&#39;)
library(reticulate)
packageVersion(&#39;reticulate&#39;)  # version 1.8
use_condaenv(&#39;anaconda&#39;, required = TRUE)
py_config()
py_discover_config()
repl_python()
</pre></div>


<p>To avoid <code>Sys.setenv</code> every time using reticulate,
add <code>RETICULATE_PYTHON=/home/leo/apps/miniconda3/envs/anaconda/bin/python</code> into
~/.Renviron.</p>
<p>You can use almost all packages (such as pandas, scikit-learn, etc) in the Python
.  However, when using <em>matplotlib</em> in the repl,
a <em>ZLIB not found</em> error raised.</p>
<p><a href="https://rstudio.github.io/reticulate/articles/r_markdown.html">By design</a>,
Python and R code chunks can both be written in R markdown documents,
and interoperate all the objects created in Python and R.
However in my test this didn't work.
Looks there are some bugs when the reticulate package manipulating
the conda environment.</p>
<p>Ref:</p>
<ul>
<li>
<p><a href="https://blog.rstudio.com/2018/03/26/reticulate-r-interface-to-python/">reticulate: R interface to Python</a></p>
</li>
<li>
<p><a href="https://rstudio.github.io/reticulate/articles/r_markdown.html">R Markdown Python Engine</a></p>
</li>
<li>
<p><a href="https://www.danielphadley.com/jupyter-to-rmarkdown/">From Jupyter Notebooks to R Markdown</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/49764125/importing-matplotlib-with-reticulate-in-r">Importing matplotlib with reticulate in R</a></p>
</li>
</ul>
            
            
            <hr/>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2018-06-21T16:53:41+08:00">Jun 21, 2018</time>

<h4>Last Updated</h4>
<time datetime="2018-09-19T18:24:36+08:00">Sep 19, 2018</time>

            <h4>Category</h4>
            <a class="category-link" href="/categories.html#tech-ref">Tech</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="/tags.html#python-ref">python
                    <span>116</span>
</a></li>
                <li><a href="/tags.html#rlang-ref">rlang
                    <span>12</span>
</a></li>
                <li><a href="/tags.html#rstudio-ref">rstudio
                    <span>4</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="#" title="My You can add links in your config file Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-you can add links in your config file sidebar-social-links"></i></a>
    <a href="#" title="My Another social link Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-another social link sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>