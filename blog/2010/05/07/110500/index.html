
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Java网络通信程序（一对一） - Dark Matter in Cyberspace</title>
  <meta name="author" content="Li Chao">

  
  <meta name="description" content="本文是基于[1]之10.3.8节的阅读笔记，文末的两个java程序改自该节例10-2和10-3。 Client/Server结构的Java程序由两个独立的程序组成，每个程序的核心功能都由4个对象相互协作实现： 1 Socket，这是网络通信的核心； 2 信息发送者：是一个PrintWriter对象 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://leetschau.github.io/blog/2010/05/07/110500">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Dark Matter in Cyberspace" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Dark Matter in Cyberspace</a></h1>
  
    <h2>A note repository aims at Data Mining, Spark, Linux, Python.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:leetschau.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Java网络通信程序（一对一）</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2010-05-07T11:05:00+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2010</span></span> <span class='time'>11:05 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>本文是基于[1]之10.3.8节的阅读笔记，文末的两个java程序改自该节例10-2和10-3。</p>

<p> Client/Server结构的Java程序由两个独立的程序组成，每个程序的核心功能都由4个对象相互协作实现：
 1 Socket，这是网络通信的核心；
 2 信息发送者：是一个PrintWriter对象，与Socket的输出流绑定，负责发送信息，见Server程序第26行，Client程序第12行；
 3 信息接收者：是一个BufferedReader对象，首先与Socket的输入流绑定，然后将输入的字节流转换为字符流，见Server程序第25行，Client程序第13行；
 4 用户输入处理器：这个对象处理本地用户的输入，将输入字符串以合适的形式保存或者展现，不涉及网络，服务端程序代码见27行，客户端见11行；
之所以接收者需要加一层字节流到字符流的转换（用InputStreamReader实现），是因为网络传输的字节而非字符。</p>

<p> 这类程序的基本结构由4个步骤组成：
 1 创建Socket，Server端可分为两个子步骤（见程序第8-23行），第一步是创建一个ServerSocket对象，第二步是用它的accept方法在某一端口监听，等待客户端连接（程序运行到这里进入等待状态，也就是书中所谓的“阻塞”，在未收到客户端连接之前，不运行后面的代码）；Client端比较简单（见程序第8行），创建一个Socket对象就OK了；
 2 为Socket配置信息发送和接收者，服务端程序代码见25、26行，客户端见12、13行；
 3 开始进行信息传递，代码见第29-36行（服务端）和15-22行（客户端），服务端运行到第30行is.readLine()等待socket的输入流，进入等待状态，与此同时客户端运行到第17行sin.readLine()等待用户输入，例如用户输入'aa'并回车，则程序执行到第20行is.readLine()（第20行）进入等待socket输入流状态，同时服务端收到了客户端os.flush()发送的信息并打印出来（第30行），得到用户输入（第32行）后向客户端发送（第35行），本次通信完成，客户端得到了socket的输出流后打印出来（第20行），本次通信完成。以上就此一次完整的do while循环内容。
 4 通信结束，关闭Socket，见第37-46行（服务端）和24-31行（客户端）。</p>

<p>[1] 陈明：Java语言程序设计，清华大学出版社，2009.6</p>

<p> TalkServer.java（服务端程序）
01 import java.io.<em>;
02 import java.net.</em>;
03
04 public class TalkServer {
05
06 public static void main(String[] args) {
07 try{
08  ServerSocket server = null;
09  try{
10  server = new ServerSocket(4700);
11  System.out.println(&ldquo;Server Started.&rdquo;);
12  }
13  catch(Exception e){
14  System.out.println(&ldquo;Can not listen to:&rdquo;+e);
15  }
16  Socket socket = null;
17  try{
18  socket = server.accept();
19  System.out.println(&ldquo;Connected to Client.&rdquo;);
20  }
21  catch(Exception e){
22  System.out.println(&ldquo;Error:&rdquo;+e);
23  }
24  String line;
25  BufferedReader is = new BufferedReader(new InputStreamReader(socket.getInputStream()));
26  PrintWriter os = new PrintWriter(socket.getOutputStream());
27  BufferedReader sin = new BufferedReader(new InputStreamReader(System.in));
28  System.out.println();
29  do{
30  System.out.println(&ldquo;Client &rdquo;+is.readLine());
31  System.out.println(&ldquo;To Client:&rdquo;);
32  line = sin.readLine();
33  System.out.println();
34  os.println(line);
35  os.flush();
36  } while(! line.equals(&ldquo;bye&rdquo;));
37  os.close();
38  is.close();
39  socket.close();
40  server.close();
41 }
42 catch (Exception e){
43  System.out.println(&ldquo;Error:&rdquo;+e);
44 }
45 }
46 }
 TalkClient.java（客户端程序）
01 import java.io.<em>;
02 import java.net.</em>;
03
04 public class TalkClient {
05
06 public static void main(String[] args) {
07 try {
08 Socket socket = new Socket(&ldquo;127.0.0.1&rdquo;,4700);
09 System.out.println(&ldquo;Connected to Server.&rdquo;);
10 System.out.println();
11 BufferedReader sin = new BufferedReader(new InputStreamReader(System.in));
12 PrintWriter os = new PrintWriter(socket.getOutputStream());
13 BufferedReader is = new BufferedReader(new InputStreamReader(socket.getInputStream()));
14 String readline;
15 do{
16  System.out.print(&ldquo;To Server:&rdquo;);
17  readline = sin.readLine();
18  os.println(readline);
19  os.flush();
20  System.out.println(&ldquo;Server says:&rdquo;+is.readLine());
21  System.out.println();
22 }
23 while (! readline.equals(&ldquo;bye&rdquo;));
24 os.close();
25 is.close();
26 }
27 catch(Exception e){
28 System.out.println(&ldquo;Error&rdquo;+e);
29 }
30 }
31 }</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Li Chao</span></span>

      




<time class='entry-date' datetime='2010-05-07T11:05:00+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2010</span></span> <span class='time'>11:05 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/java/'>java</a>, <a class='category' href='/blog/categories/wang-luo/'>网络</a>, <a class='category' href='/blog/categories/tong-xin/'>通信</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://leetschau.github.io/blog/2010/05/07/110500/" data-via="" data-counturl="http://leetschau.github.io/blog/2010/05/07/110500/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2010/05/06/113556/" title="Previous Post: TotalCMD 7.5常用快捷键">&laquo; TotalCMD 7.5常用快捷键</a>
      
      
        <a class="basic-alignment right" href="/blog/2010/05/07/111652/" title="Next Post: Java网络通信程序（一对多）">Java网络通信程序（一对多） &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/02/01/134829/">Full Text Search for Meteor App</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/30/183509/">基于Search Source的简单查询实现方法</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/29/141348/">Git-flow Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/26/174649/">Meteor Development Styles</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/26/173952/">离线保存网页</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/leetschau">@leetschau</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'leetschau',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Li Chao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
