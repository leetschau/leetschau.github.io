
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Linux上中文乱码问题的解决办法 - Dark Matter in Cyberspace</title>
  <meta name="author" content="Li Chao">

  
  <meta name="description" content="中文出现乱码，首先需要查看字符串编码和解码的方法是否一致，其次检查Linux的LANG环境变量中的编码是否匹配程序的编解码方法。 建议统一编码为UTF-8，对应的bash脚本：export LANG=zh_CN.UTF-8 编码是字符串转换为字节数组（二进制串），解码是逆过程， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://leetschau.github.io/blog/2012/06/19/163003">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Dark Matter in Cyberspace" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Dark Matter in Cyberspace</a></h1>
  
    <h2>A note repository aims at Data Mining, Spark, Linux, Python.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:leetschau.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Linux上中文乱码问题的解决办法</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-06-19T16:30:03+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>4:30 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>中文出现乱码，首先需要查看字符串编码和解码的方法是否一致，其次检查Linux的LANG环境变量中的编码是否匹配程序的编解码方法。</p>

<p>建议统一编码为UTF-8，对应的bash脚本：export LANG=zh_CN.UTF-8</p>

<p>编码是字符串转换为字节数组（二进制串），解码是逆过程，charset指定了其中转换/逆转换的方式（见 字符编解码的故事 ）。就Java而言，用指定的charset（例如UTF-8）对字符串编码用"byte[] dst = input_string.getBytes(&ldquo;UTF-8&rdquo;);&ldquo;实现，解码用“String dst = new String(input_byte_array, "UTF-8&rdquo;);”实现；</p>

<p>如果编码使用“byte[] dst = input_string.getBytes()”，则具体的编码方式依赖于操作系统，存在编码错误的风险，解码用“String dst = new String(input_byte_array);”也存在解码错误的风险，所以在编/解码过程中最好明确指定使用的charset。</p>

<p>下面的代码将字节数组转换为16进制字节码字符串，以便观察不同的charset如何影响生成的字节码。</p>

<p> public class MQReceiver {
 public static void main(String[] args) {
  byte[] buf = mq.recvTextMessage(); // receive msg from mq
  if (buf != null) {
   String hexRes = bytes2HexString(buf);
   System.out.println(hexRes);
   System.out.println(getChnBytes(hexRes));
   String bufstr = new String(buf,&ldquo;UTF-8&rdquo;);
   System.out.println(&ldquo;Recv alarm: &rdquo; + bufstr);
  } else {
   System.out.println(&ldquo;buf: &rdquo; + buf);
  }
 }</p>

<p> public static String bytes2HexString(byte[] b) {
  String ret = &ldquo;&rdquo;;
  for (int i = 0; i &lt; b.length; i++) {
   String hex = Integer.toHexString(b[i] &amp; 0xFF);
   if (hex.length() == 1) {
    hex = &lsquo;0&rsquo; + hex;
   }
   ret += hex.toUpperCase();
  }
  return ret;
 }
 public static String getChnBytes(String input) {
  String sflag = &ldquo; &lt;FM_ALARM_MSG.AlarmText> &rdquo;;
  String eflag = &ldquo;&lt;/FM_ALARM_MSG.AlarmText>&rdquo;;
  byte[] start = sflag.getBytes();
  byte[] end = eflag.getBytes();
  String ss = bytes2HexString(start);
  String se = bytes2HexString(end);
  int beginIndex = input.indexOf(ss) + ss.length();
  int endIndex = input.indexOf(se);
  return input.substring(beginIndex, endIndex);
 }
}</p>

<p>其中getChnBytes方法从下面的字符数组中找到汉字，提取出来，以便于观察汉字部分编码的变化，</p>

<p> &lt;FM_ALARM_MSG.EventTime>2012-06-20 14:39:51&lt;/FM_ALARM_MSG.EventTime> &lt;FM_ALARM_MSG.AlarmText> 检查数据库连接产生异常&lt;/FM_ALARM_MSG.AlarmText><C_FP0></C_FP0></p>

<p>例如UTF-8的“ 检查数据库连接产生异常”编码输出如下：</p>

<p> E6A380
E69FA5
E695B0
E68DAE
E5BA93
E8BF9E
E68EA5
E4BAA7
E7949F
E5BC82
E5B8B8</p>

<p>注： 快典网 可以在线查看汉字的各种编码。</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Li Chao</span></span>

      




<time class='entry-date' datetime='2012-06-19T16:30:03+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>4:30 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/utf-8/'>utf-8</a>, <a class='category' href='/blog/categories/bian-ma/'>编码</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://leetschau.github.io/blog/2012/06/19/163003/" data-via="" data-counturl="http://leetschau.github.io/blog/2012/06/19/163003/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/06/15/111332/" title="Previous Post: Java整数手工编码实例">&laquo; Java整数手工编码实例</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/06/20/093123/" title="Next Post: 包名不要与已有模块名一致">包名不要与已有模块名一致 &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/05/26/174257/">Meteor基础知识之系统篇</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/15/142023/">Run MongoDB Server on Docker in VPS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/10/091733/">Git初体验</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/08/155132/">Run Mongo Scripts in Shell</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/07/151147/">Find Verified User in MongoDB</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/leetschau">@leetschau</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'leetschau',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Li Chao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
