<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: {"not_eaten"=>["wordpress Post"]} | Dark Matter in Cyberspace]]></title>
  <link href="http://leetschau.github.io/blog/categories/{-not-eaten-equals->-wordpress-post-}/atom.xml" rel="self"/>
  <link href="http://leetschau.github.io/"/>
  <updated>2014-08-30T17:38:24+08:00</updated>
  <id>http://leetschau.github.io/</id>
  <author>
    <name><![CDATA[Li Chao]]></name>
    <email><![CDATA[leetschau@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Code Metrics Management With Sonar]]></title>
    <link href="http://leetschau.github.io/blog/2013/05/29/183259/"/>
    <updated>2013-05-29T18:32:59+08:00</updated>
    <id>http://leetschau.github.io/blog/2013/05/29/183259</id>
    <content type="html"><![CDATA[<p>I added coverage test with cobertura and test the demo project built yesterday. Then I add Sonar Ant task in the ant script and saved test result into Sonar database.</p>

<p>The following is a standard build script(add junit-4.*.jar and cobertura.jar to $ANT_HOME/lib, in Ubuntu it is /usr/share/ant/lib):</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project name="MyJavaProj" basedir="./" default="coverage_report"&gt;
&lt;property name="build.dir" value="${basedir}/build" /&gt;
&lt;target name="init"&gt;
    &lt;delete dir="${build.dir}"/&gt;
    &lt;mkdir dir="${build.dir}"/&gt;
&lt;/target&gt;

&lt;property name="src.dir" value="${basedir}/src" /&gt;
&lt;property name="src.class.dir" value="${build.dir}/class" /&gt;
&lt;target name="compile-src" depends="init"&gt;
    &lt;mkdir dir="${src.class.dir}"/&gt;
    &lt;javac srcdir="${src.dir}" destdir="${src.class.dir}" encoding="UTF-8" debug="true"/&gt;
&lt;/target&gt;
&lt;taskdef classpath="cobertura.jar" resource="tasks.properties" /&gt;
&lt;property name="instrumented.class.dir" value="${build.dir}/instrumented-class" /&gt;
&lt;property name="cobertura.data.file" value="${instrumented.class.dir}/cobertura.ser" /&gt;

&lt;target name="instrument" depends="compile-src"&gt;
    &lt;cobertura-instrument datafile="${cobertura.data.file}" todir="${instrumented.class.dir}"&gt;
    &lt;fileset dir="${src.class.dir}"&gt;
        &lt;include name="**/*.class" /&gt;
    &lt;/fileset&gt;
    &lt;/cobertura-instrument&gt;
&lt;/target&gt;

&lt;property name="test.dir" value="${basedir}/test" /&gt;
&lt;property name="test.class.dir" value="${build.dir}/test" /&gt;
&lt;target name="compile-test" depends="instrument"&gt;
    &lt;mkdir dir="${test.class.dir}"/&gt;
    &lt;javac srcdir="${test.dir}" destdir="${test.class.dir}"&gt;
        &lt;classpath&gt;
            &lt;pathelement location="${instrumented.class.dir}"/&gt;
            &lt;pathelement location="${src.class.dir}"/&gt;
        &lt;/classpath&gt;
    &lt;/javac&gt;
&lt;/target&gt;

&lt;property name="unittest.report.dir" value="${build.dir}/unittest_report" /&gt;
&lt;property name="lib.dir" value="${basedir}/lib" /&gt;
&lt;target name="unittest" depends="compile-test"&gt;
    &lt;mkdir dir="${unittest.report.dir}"/&gt;
    &lt;junit printsummary="yes" fork="yes"&gt;
        &lt;sysproperty key="net.sourceforge.cobertura.datafile" file="${cobertura.data.file}" /&gt;
        &lt;classpath&gt;
            &lt;pathelement location="${instrumented.class.dir}"/&gt;
            &lt;pathelement location="${src.class.dir}"/&gt;
            &lt;pathelement location="${test.class.dir}"/&gt;
            &lt;pathelement location="${src.dir}"/&gt;
            &lt;path refid="lib.path"/&gt;
        &lt;/classpath&gt;
        &lt;formatter type="xml"/&gt;
        &lt;batchtest todir="${unittest.report.dir}" haltonerror="no"&gt;
            &lt;fileset dir="${test.dir}"&gt;
                &lt;include name="**/*.java" /&gt;
            &lt;/fileset&gt;
        &lt;/batchtest&gt;
    &lt;/junit&gt;
&lt;/target&gt;

&lt;property name="coverage.report.dir" value="${build.dir}/coverage_report" /&gt;
&lt;target name="coverage-report" depends="unittest"&gt;
    &lt;cobertura-report datafile="${cobertura.data.file}" srcdir="${src.dir}" destdir="${coverage.report.dir}" format="xml" /&gt;
&lt;/target&gt;

&lt;property name="sonar.jdbc.url" value="jdbc:h2:tcp://localhost:9092/sonar" /&gt;
&lt;property name="sonar.jdbc.username" value="sonar" /&gt;
&lt;property name="sonar.jdbc.password" value="sonar" /&gt;
&lt;property name="sonar.projectKey" value="com.doco.gif.MyModule" /&gt;
&lt;property name="sonar.projectName" value="My Unit Test Project Demo" /&gt;
&lt;property name="sonar.projectVersion" value="2.1" /&gt;
&lt;property name="sonar.language" value="java" /&gt;
&lt;property name="sonar.sources" value="src" /&gt;
&lt;property name="sonar.tests" value="test" /&gt;
&lt;property name="sonar.binaries" value="${src.class.dir},${test.class.dir},${build.instrument.dir}" /&gt;
&lt;property name="sonar.dynamicAnalysis" value="reuseReports" /&gt;
&lt;property name="sonar.surefire.reportsPath" value="${unittest.report.dir}" /&gt;
&lt;property name="sonar.core.codeCoveragePlugin" value="cobertura" /&gt;
&lt;property name="sonar.cobertura.reportPath" value="${coverage.report.dir}/coverage.xml" /&gt;
&lt;target name="sonar" depends="coverage-report"&gt;
    &lt;taskdef uri="antlib:org.sonar.ant" resource="org/sonar/ant/antlib.xml"&gt;
        &lt;classpath path="/usr/share/ant/lib/sonar-ant-task-2.1.jar" /&gt;
    &lt;/taskdef&gt;
    &lt;sonar:sonar xmlns:sonar="antlib:org.sonar.ant" /&gt;
&lt;/target&gt;
&lt;/project&gt;
</code></pre>

<p>To run this script successfully:</p>

<ol>
<li><p>build a demo java project and put this script at project root;</p></li>
<li><p>copy sonar-ant-task-2.1.jar and junit-4.11.jar to $ANT_HOME/lib;</p></li>
<li><p>start Sonar server: $SONAR_HOME/bin/sonar.sh console;</p></li>
<li><p>run this script: ant sonar;</p></li>
</ol>


<p>Note1: you have to add &ldquo;sonar.core.codeCoveragePlugin&rdquo; or coverage result can&rsquo;t be collected by Sonar. This is not mentioned in official documents<a href="http://docs.codehaus.org/display/SONAR/Code+Coverage+by+Unit+Tests+for+Java+Project">Code Coverage by Unit Tests for Java Project</a>;</p>

<p>Note2: take care of the spelling: &ldquo;sonar.surefire.report<strong>s</strong>Path&rdquo; while &ldquo;sonar.cobertura.reportPath&rdquo;;</p>

<p>Note3: the &ldquo;xmlns:sonar="antlib:org.sonar.ant&rdquo; in &ldquo;sonar:sonar&rdquo; is necessary or the prefix &ldquo;sonar&rdquo; would be unbound;</p>

<p>Note4: if unit test results can&rsquo;t be collected by Sonar, try to specify &ldquo;sonar.binaries&rdquo; carefully as above shows;</p>

<p>Note5: the value of junit report path &ldquo;sonar.surefire.reportsPath&rdquo; is a <strong>directory</strong>(because there are lots of reports under this folder), while the value of cobertura report is a <strong>file</strong>, if sonar can not get junit or cobertura report, verify these settings;</p>

<p>Note6: if there are &ldquo;class &hellip; is not accessible through the ClassLoader.&rdquo; in output of sonar task, there are two solutions:</p>

<ol>
<li><p>remove property &ldquo;sonar.binaries&rdquo;, where Sonar will not check bytecode;</p></li>
<li><p>in case you want Sonar check bytecodes, add property &ldquo;sonar.libraries&rdquo; like follows:</p>

<p> <property name="sonar.libraries" value="src/lib/*.jar,src/lib/dom4j/*.jar"/></p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Customize Window Buttons Position on Ubuntu]]></title>
    <link href="http://leetschau.github.io/blog/2013/05/16/091955/"/>
    <updated>2013-05-16T09:19:55+08:00</updated>
    <id>http://leetschau.github.io/blog/2013/05/16/091955</id>
    <content type="html"><![CDATA[<p>Verified on Ubuntu Desktop 12.04.</p>

<p>Move window buttons to upper-right corner:</p>

<p>gconftool -s /apps/metacity/general/button_layout -t string menu:minimize,maximize,close</p>

<p>Move window buttons to upper-left corner:</p>

<p>gconftool -s /apps/metacity/general/button_layout -t string close,minimize,maximize</p>

<p>Only show close and minimize buttons at upper-left corner:</p>

<p>gconftool -s /apps/metacity/general/button_layout -t string close,minimize</p>

<p>(You can maximize window by double-clicking title-bar)</p>

<p>You have to use current user to run this command, or you will get &ldquo;No D-BUS daemon running&rdquo; error. For example, if you login desktop as user &ldquo;john&rdquo;, you will find a .dbus folder owned by john in $HOME of user john.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Auto Code Review Based on Jenkins and Checkstyle]]></title>
    <link href="http://leetschau.github.io/blog/2013/05/15/164215/"/>
    <updated>2013-05-15T16:42:15+08:00</updated>
    <id>http://leetschau.github.io/blog/2013/05/15/164215</id>
    <content type="html"><![CDATA[<p>Based on Jenkins 1.509 and Checkstyle 5.6.</p>

<p>Now we need practising code review, as a step of BVT of course. The ideal solution is based on Sonar and its checkstyle plugin. But I am not very familiar with sonar&rsquo;s java runner and other features. So I decided to use some &ldquo;plain&rdquo; method to embed code review into the process of BVT.</p>

<h1>Preparations</h1>

<ol>
<li><p>Install checkstyle plugin of jenkins;</p></li>
<li><p>copy checkstyle-5.6-all.jar to /opt/checkstyle;</p></li>
<li><p>create a code review rule file tyRules.xml at /opt/checkstyle:</p></li>
</ol>


<p> &lt;?xml version=&ldquo;1.0&rdquo; encoding=&ldquo;UTF-8&rdquo;?></p>

<p> &lt;!DOCTYPE module PUBLIC &ldquo;-//Puppy Crawl//DTD Check Configuration 1.3//EN&rdquo; &ldquo;<a href="http://www.puppycrawl.com/dtds/configuration_1_3.dtd">http://www.puppycrawl.com/dtds/configuration_1_3.dtd</a>&rdquo;>
 <module name="Checker">
  <property name="severity" value="warning"/>
  <module name="TreeWalker">
  <metadata name="net.sf.eclipsecs.core.lastEnabledSeverity" value="inherit"/>
  <module name="MethodLength">
   <property name="max" value="200"/>
  </module>
  <module name="NestedIfDepth">
   <property name="max" value="5"/>
  </module>
  <module name="CyclomaticComplexity"/>
  <module name="ParameterNumber">
   <property name="max" value="6"/>
  </module>
  </module>
  <module name="StrictDuplicateCode">
  <property name="min" value="75"/>
  </module>
  <module name="FileLength">
  <property name="max" value="1000"/>
  </module>
 </module></p>

<ol>
<li><p>Project -> Configuration -> Source Code Management -> Subversion -> Repo URL: svn://localhost/ServerMeter</p></li>
<li><p>Project -> Configuration -> Post-build Actions -> Publish Checkstyle analysis results: <em>*/codeReview</em>.xml;</p></li>
<li><p>Project -> Configuration -> Post-build Actions -> E-mail Notification: &hellip;</p></li>
</ol>


<h1>As part of ant build</h1>

<ol>
<li>add a target &ldquo;checkcode&rdquo; in build.xml:</li>
</ol>


<p> &lt;?xml version=&ldquo;1.0&rdquo; encoding=&ldquo;UTF-8&rdquo;?>
 <project name="checkstyleTest" basedir="./" default="checkcode">
   <taskdef resource="checkstyletask.properties" classpath="/opt/checkstyle/checkstyle-5.6-all.jar"/>
   <property name="build.dir" value="${basedir}/build" />
   <target name="init">
     <delete dir="${build.dir}"/>
     <mkdir dir="${build.dir}"/>
   </target>
   <target name="checkcode" depends="init">
     <checkstyle config="/opt/checkstyle/tyRules.xml">
       <fileset dir="src" includes="**/*.java"/>
       <formatter type="xml" toFile="build/codeReviewResult.xml"/>
     </checkstyle>
   </target>
 </project></p>

<ol>
<li>Jenkins setup: Project -> Configuration -> Build -> Invoke Ant -> Targets: checkcode;</li>
</ol>


<p>PROS: simple config, with the power of ant;</p>

<p>CONS: build scripts of every project have to be modified, which violates the DRY principle;</p>

<h1>As an independent step in build process</h1>

<p>Jenkins setup: Project -> Configuration -> Build -> Execute shell:</p>

<p> rm -rf build
 mkdir build
 find . -depth -name .svn -exec rm -fr {} \;
 java -jar /opt/checkstyle/checkstyle-5.6-all.jar -c /opt/checkstyle/tyRules.xml -r src -f xml -o build/codeReviewResult.xml</p>

<p>PROS: no need to modify any thing in project, do one thing in only ONE place;</p>

<p>CONS: there are some dirty work in shell script, for example you have to delete and create build folder manually (otherwise checkstyle report can not be created correctly), and remove all .svn folder recursively (otherwise checkstyle will find some duplicate codes in normal code file and backup file in .svn folder).</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Multiple Terminals Operation on Windows and Ubuntu]]></title>
    <link href="http://leetschau.github.io/blog/2013/05/14/081549/"/>
    <updated>2013-05-14T08:15:49+08:00</updated>
    <id>http://leetschau.github.io/blog/2013/05/14/081549</id>
    <content type="html"><![CDATA[<p>Termianl, a.k.a. console or command line, is a great tool to tell computers what to do. It&rsquo;s efficient and cool to type some words in a terminal(of course in full screen mode) and get all things done. But if you have only one terminal on the screen, switching between directories are always disturbing and time-consuming jobs. So to keyboard fans, a terminal enhancement tool is necessary. With the help of workspace(a.k.a. virtual desktop) switching tool and window arrangements shortcuts, a geek&rsquo;s screen is like this:</p>

<ol>
<li><p>Put all GUI windows in workspace 1;</p></li>
<li><p>Put terminal windows in workspace 2;</p></li>
<li><p>In workspace 2, switch multiple terminal tool in full screen mode;</p></li>
<li><p>Use workspace switching shortcuts to switching between GUI workspace and terminal workspace;</p></li>
</ol>


<h1>Windows: Conemu + VirtuaWin</h1>

<p>Terminal full screen: alt + enter;</p>

<p>Split window: alt + h/v (split horizontal/vertical, defined in [Settings-> Keys &amp; Macros -> duplicate active &lt;<shell>> split to bottom/right]);</p>

<p>Switch between terminal: [ctrl + tab] or [Win + q];</p>

<p>Hide tab bar: Settings -> Features -> Tabs -> Don&rsquo;t show;</p>

<p>Switch workspace: alt + win + Left/Right/Up/Down (defined in Setup -> Hotkeys of VirtuaWin);</p>

<h1>Ubuntu: Teminator</h1>

<p>Auto run command when startup (ssh to a remote server in this case): terminator -x ssh bvt@10.0.2.74;</p>

<p>(use terminator -h for details. xterm and konsole also surppot -e <command> syntax).</p>

<p>Terminal full screen: F11 (defined in [System Settings -> Keyboard -> Shortcuts -> Windows -> Toggle fullscreen mode]);</p>

<p>Split window: alt + h/v (split horizontal/vertical, defined in [Preference -> Keybindings -> split_horiz/split_vert]);</p>

<p>Switch between terminal: alt + Left/Right/Up/Down;</p>

<p>Toggle Window max/normal of one of all terminals: ctrl + shift + z (defined in [Preferences -> Keybindings -> scaled_zoom]);</p>

<p>Make background transparent: [Preferences -> Profiles -> defaults -> Background -> Transparent background: 0.8];</p>

<p>copy on selection: [Preferences -> Profiles -> Copy on selection];</p>

<p>Switch workspace: alt + ctrl + Left/Right/Up/Down (defined in [System Settings -> Keyboard -> Shortcuts -> Navigation -> Move to workspace left/right/above/below]);</p>
]]></content>
  </entry>
  
</feed>
