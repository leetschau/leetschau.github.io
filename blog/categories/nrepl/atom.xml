<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Nrepl | Dark Matter in Cyberspace]]></title>
  <link href="http://leetschau.github.io/blog/categories/nrepl/atom.xml" rel="self"/>
  <link href="http://leetschau.github.io/"/>
  <updated>2015-06-04T20:48:19+08:00</updated>
  <id>http://leetschau.github.io/</id>
  <author>
    <name><![CDATA[Li Chao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Using Emacs as Clojure IDE]]></title>
    <link href="http://leetschau.github.io/blog/2013/09/23/163218/"/>
    <updated>2013-09-23T16:32:18+08:00</updated>
    <id>http://leetschau.github.io/blog/2013/09/23/163218</id>
    <content type="html"><![CDATA[<ol>
<li><p>Open emacs24;</p></li>
<li><p>Change CWD to parent folder of project home: M-x cd<CR> ~/docs/tmp<CR>;</p></li>
<li><p>Build a leiningen project: M-! lein new calc-cov (see Run Shell Command in Emacs for other method to run shell command in emacs);</p></li>
<li><p>Change CWD to project home: M-x cd<CR> calc-cov<CR>;</p></li>
<li><p>Start nrepl server: M-x nrepl-jack-in;</p></li>
<li><p>Open source file in another window: C-x 2 C-x C-f src/&hellip;/core.clj;</p></li>
<li><p>Change the namespace of the REPL to the namespace of the file you are in: C-c M-n;</p></li>
<li><p>Evaluate the whole source file: C-c C-k, evaluate a s-exp before the cursor: C-x C-e;</p></li>
<li><p>Open clojure doc of the function under the cursor: C-c C-d</p></li>
<li><p>Run test: C-c C-,</p></li>
</ol>


<h1>Frequently used keyboard shortcuts and commands</h1>

<ul>
<li><p>Toggle focus between nrepl window and clojure source file window: C-c C-z (you should add &ldquo;(add-to-list &lsquo;same-window-buffer-names &rdquo;<em>nrepl</em>&ldquo;)&rdquo; to ~/.emacs;</p></li>
<li><p>Always pretty printing in the REPL: M-x nrepl-toggle-pretty-printing</p></li>
<li><p>Move over sexp: C-M-b/C-M-f;</p></li>
<li><p>Interrupt any pending evaluations: C-c C-b;</p></li>
</ul>


<h1>Evaluate a sexp without evaluate all file</h1>

<ol>
<li><p>Add this sexp into source file (unnecessary to save source file);</p></li>
<li><p>Use following methods to evaluate the sexp:</p></li>
<li><p>Move cursor to the sexp for test, C-M-x (or C-c C-c) to evaluate the top-level form (such as a defn expression) under the cursor; If you want insert the evaluation result to current buffer, use C-u C-M-x;</p></li>
<li><p>If the the target form is not a &ldquo;top-level&rdquo; form, move the cursor to the <strong>end</strong> of this sexp, C-x C-e to evaluate it, See more shortcuts at <a href="https://github.com/clojure-emacs/nrepl.el">nrepl official site</a>;</p></li>
</ol>


<p>Then this sexp has been added to the repl, you can use it in repl;</p>

<p>This is very helpful in some circumstances. For example, I want debug function &ldquo;cell-block&rdquo; (see p141 in &ldquo;Clojure Programming&rdquo;), add</p>

<pre><code>(println "[left mid right] is:") 
(println [left mid right]) 
</code></pre>

<p>before &ldquo;(window (map &hellip;)&rdquo;. But You can&rsquo;t evaluate the whole file because there are some lazy sequences and evaluate whole file will cause JVM heap out of memory; So I only evaluate this modified version with C-x C-e, test it in repl. After I figure out how this function works, undo my modification and move on.</p>

<p>Note:</p>

<ul>
<li><p>In clojure mode with Evil, you have to switch to insert state and put the cursor <strong>after</strong> the last parenthsis, then evaluate the expression with C-x C-e. If you put the cursor <strong>on</strong> the last parenthesis in normal state, The result will be wrong.</p></li>
<li><p>It unnecessary to put your clojure file in a leiningen-created project, which is more flexible than vim-fireplace;</p></li>
<li><p>The value of expression will be output to the <em>message</em> area (bottom of the emacs window), while the output by &ldquo;println&rdquo; will be output to nrepl buffer;</p></li>
<li><p>Switch cursor between windows: C-x o;</p></li>
<li><p>Clear repl output: C-c M-o;</p></li>
<li><p>Indent code blocks intelligently: C-M-q</p></li>
<li><p>All the keyboard shortcuts will be more convenient if you swap CapsLock key and Escape key, together with Ctrl key and Alt key, see Define Keymap on Ubuntu for detail;</p></li>
</ul>


<p>Ref: <a href="http://stackoverflow.com/questions/3636364/can-i-clean-the-repl">http://stackoverflow.com/questions/3636364/can-i-clean-the-repl</a></p>

<p>Ref: <a href="http://cojure-doc.org/articles/tutorials/emacs.html">Clojure with Emacs</a></p>
]]></content>
  </entry>
  
</feed>
