<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Generator | Dark Matter in Cyberspace]]></title>
  <link href="http://leetschau.github.io/blog/categories/generator/atom.xml" rel="self"/>
  <link href="http://leetschau.github.io/"/>
  <updated>2015-06-01T12:52:39+08:00</updated>
  <id>http://leetschau.github.io/</id>
  <author>
    <name><![CDATA[Li Chao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Python的Generator和yield]]></title>
    <link href="http://leetschau.github.io/blog/2015/04/08/161006/"/>
    <updated>2015-04-08T16:10:06+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/04/08/161006</id>
    <content type="html"><![CDATA[<p>下面的代码演示了yield的一个使用场景：</p>

<pre><code>def fab(max): 
    n, a, b = 0, 0, 1 
    while n &lt; max: 
        yield b 
        # print b 
        a, b = b, a + b 
        n = n + 1 

for n in fab(5):
    print(n)
</code></pre>

<p>简单地讲，yield的作用就是把一个函数变成一个Generator，
带有yield的函数不再是一个普通函数，Python解释器会将其视为一个Generator，
调用<code>fab(5)</code>不会执行fab函数，而是返回一个iterable对象。
在for循环执行时，每次循环都会执行fab函数内部的代码，执行到<code>yield b</code>时，
fab 函数就返回一个迭代值，下次迭代时，代码从<code>yield b</code>的下一条语句继续执行，
而函数的本地变量看起来和上次中断执行前是完全一样的，于是函数继续执行，直到再次遇到<code>yield</code>。</p>

<p>上面的<code>fab</code>函数也可以返回一个List，与Generator相比，缺点是内存使用量会很大，
比如要读取一个10GB的文件，如果直接使用f.read()会把整个文件加载到内存中，
用Generator代替List，可以保证内存使用量是固定的，例如下面的1024字节：</p>

<pre><code>def read_file(fpath): 
    BLOCK_SIZE = 1024 
    with open(fpath, 'rb') as f: 
        while True: 
            block = f.read(BLOCK_SIZE) 
            if block: 
                yield block 
            else: 
                return
</code></pre>

<p>上面的文件读取是为了演示yield的用法，在实际读取文件时，
如果是大文件，不能一次性载入所有内容，使用for循环，一次载入一行到内存：</p>

<pre><code>with open('workfile', 'r') as f:
    for line in f:
        print(line)
</code></pre>

<p>反之，如果文件比较小，需要一次性载入内存，使用<code>readlines()</code>方法：</p>

<pre><code>with open('workfile', 'r') as f:
    lines = f.readlines()
</code></pre>

<p>参考：</p>

<p><a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-python-yield/">Python yield 使用浅析</a></p>

<p><a href="https://docs.python.org/2/tutorial/inputoutput.html">7. Input and Output</a> in <a href="https://docs.python.org/2/tutorial/index.html">The Python Tutorial</a></p>
]]></content>
  </entry>
  
</feed>
