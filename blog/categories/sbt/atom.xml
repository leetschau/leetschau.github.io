<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Sbt | Dark Matter in Cyberspace]]></title>
  <link href="http://leetschau.github.io/blog/categories/sbt/atom.xml" rel="self"/>
  <link href="http://leetschau.github.io/"/>
  <updated>2015-11-04T11:47:14+08:00</updated>
  <id>http://leetschau.github.io/</id>
  <author>
    <name><![CDATA[Li Chao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Two Java Building Tools]]></title>
    <link href="http://leetschau.github.io/blog/2014/09/12/103608/"/>
    <updated>2014-09-12T10:36:08+08:00</updated>
    <id>http://leetschau.github.io/blog/2014/09/12/103608</id>
    <content type="html"><![CDATA[<p>I need build a java project to compare performance of <a href="http://logging.apache.org/log4j/2.x/">apache log4j</a> and <a href="http://logback.qos.ch/">Logback</a>. The following codes are the building procedures based on [Gradle]<a href="http://www.gradle.org/">http://www.gradle.org/</a>) and <a href="http://www.scala-sbt.org/">sbt</a>.</p>

<h1>sbt</h1>

<pre><code>mkdir myproject
cd myproject
cat &lt;&lt;EOF &gt; build.sbt
name := "MyProject"

version := "0.1"
EOF
mkdir project
echo 'addSbtPlugin("com.typesafe.sbteclipse" % "sbteclipse-plugin" % "2.5.0")' &gt; project/plugins.sbt
sbt eclipse
</code></pre>

<p>Note that the blank line between &ldquo;name&rdquo; &amp; &ldquo;version&rdquo; in build.sbt is mandatory for Scala syntax.
Now start eclipse, import this proect, create new packages (com.boco.logb) and Java files (LoggerOneThread.java) in &ldquo;src/main/java&rdquo; folder, and config files (log4j.properties and logback.xml) in src/resources folder.
slf4j looks for log implementations based on jars in classpath instead of conifg files, so we add both 2 config files into resource folder.</p>

<p>The LoggerOneThread.java file:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package com.boco.logb;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;import java.util.concurrent.TimeUnit;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;import org.slf4j.Logger;
</span><span class='line'>import org.slf4j.LoggerFactory;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;public class LoggerOneThread {
</span><span class='line'>    public static final long TOTAL_TIMES = 4000 * 1000;
</span><span class='line'>    private static final Logger logger = LoggerFactory
</span><span class='line'>            .getLogger(LoggerOneThread.class);&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;public static void main(String[] args) {
</span><span class='line'>    long start = System.nanoTime();
</span><span class='line'>    for (int i = 1; i &lt; TOTAL_TIMES; i++) {
</span><span class='line'>        logger.debug("This is a test message. This is another test message.");
</span><span class='line'>    }
</span><span class='line'>    long estimatedTime = TimeUnit.NANOSECONDS.toSeconds(System.nanoTime()
</span><span class='line'>            - start);
</span><span class='line'>    System.out.println("Write " + TOTAL_TIMES + " logs takes time "
</span><span class='line'>            + estimatedTime + " s.");
</span><span class='line'>}
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;}
</span><span class='line'>&lt;code&gt;
</span><span class='line'>Log4j config file log4j.properties:
</span><span class='line'>&lt;/code&gt;
</span><span class='line'>log4j.rootLogger = DEBUG, FILE&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;log4j.appender.FILE=org.apache.log4j.RollingFileAppender
</span><span class='line'>log4j.appender.FILE.File=log4j.log
</span><span class='line'>log4j.appender.FILE.Append=true
</span><span class='line'>log4j.appender.FILE.MaxFileSize=50MB
</span><span class='line'>log4j.appender.FILE.MaxBackupIndex=10
</span><span class='line'>log4j.appender.FILE.layout=org.apache.log4j.PatternLayout
</span><span class='line'>log4j.appender.FILE.layout.ConversionPattern=%d{MM-dd HH:mm:ss.SSS} [%t] %p %c - %m%n
</span><span class='line'>&lt;code&gt;
</span><span class='line'>Logback config file logback.xml:
</span><span class='line'>&lt;/code&gt;
</span><span class='line'>&lt;?xml version=&ldquo;1.0&rdquo; encoding=&ldquo;UTF-8&rdquo;?&gt;
</span><span class='line'>&lt;configuration&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;&lt;appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;
</span><span class='line'>    &lt;file&gt;logback.log&lt;/file&gt;
</span><span class='line'>
</span><span class='line'>    &lt;rollingPolicy class="ch.qos.logback.core.rolling.FixedWindowRollingPolicy"&gt;
</span><span class='line'>        &lt;fileNamePattern&gt;logback.log.%i&lt;/fileNamePattern&gt;
</span><span class='line'>        &lt;minIndex&gt;1&lt;/minIndex&gt;
</span><span class='line'>        &lt;maxIndex&gt;11&lt;/maxIndex&gt;
</span><span class='line'>    &lt;/rollingPolicy&gt;
</span><span class='line'>
</span><span class='line'>    &lt;triggeringPolicy class="ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"&gt;
</span><span class='line'>        &lt;maxFileSize&gt;50MB&lt;/maxFileSize&gt;
</span><span class='line'>    &lt;/triggeringPolicy&gt;
</span><span class='line'>
</span><span class='line'>    &lt;encoder&gt;
</span><span class='line'>        &lt;pattern&gt;%date{MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger - %msg%n&lt;/pattern&gt;
</span><span class='line'>    &lt;/encoder&gt;
</span><span class='line'>&lt;/appender&gt;
</span><span class='line'>
</span><span class='line'>&lt;root level="DEBUG"&gt;
</span><span class='line'>    &lt;appender-ref ref="FILE" /&gt;
</span><span class='line'>&lt;/root&gt;
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;/configuration&gt;</span></code></pre></td></tr></table></div></figure></p>

<p>Add following dependencies into build.sbt.log4j:
<code>
libraryDependencies ++= Seq(
  "org.slf4j" % "slf4j-api" % "1.7.7",
  "org.slf4j" % "slf4j-log4j12" % "1.7.7",
  "log4j" % "log4j" % "1.2.17"
)
</code></p>

<p>And the following into build.sbt.logback:
<code>
libraryDependencies ++= Seq(
  "org.slf4j" % "slf4j-api" % "1.7.7",
  "ch.qos.logback" % "logback-classic" % "1.1.2",
  "ch.qos.logback" % "logback-core" % "1.1.2"
)
</code></p>

<p>Now delete .classpath file under project home folder, run <code>sbt eclipse</code> again to refresh classpath.</p>

<p>When coding completed, copy build.sbt.log4j (or build.sbt.logback) as build.sbt, run <code>sbt run</code> to run this project. Run <code>sbt package</code> to create jar file under target folder.</p>

<p>Some other settings in build.sbt:</p>

<pre><code>organization := "org.leechau"
</code></pre>

<h1>Gradle</h1>

<ol>
<li><p>Install gradle plugin for Eclipse, and create a Gradle Project &ldquo;MyProject&rdquo; in Eclipse, choose &ldquo;Java Quickstart&rdquo; as Sample project;</p></li>
<li><p>Add following lines into auto-created build.gradle file for log4j test:</p>

<pre><code> apply plugin: 'application'
 dependencies {
     compile 'org.slf4j:slf4j-api:1.7.7', 'log4j:log4j:1.2.17', 'org.slf4j:slf4j-log4j12:1.7.7'
 }
 mainClassName = "com.boco.logb.LoggerOneThread"
</code></pre></li>
<li><p>Refresh dependencies: [Gradle -> Refresh Dependencies] in context menu;</p></li>
<li><p>Run log4j test:</p>

<pre><code> cp build.gradle build.gradle.log4j
 gradle clean run
</code></pre></li>
<li><p>For logback test, create a new file build.gradle.logback based on build.gradle.log4j, but use the following dependencies:</p></li>
</ol>


<pre><code>compile 'org.slf4j:slf4j-api:1.7.7', 'ch.qos.logback:logback-classic:1.1.2', 'ch.qos.logback:logback-core:1.1.2'
</code></pre>

<p>The config files log4j.properties and logback.xml, and Java file LoggerOneThread.java are identical to that in sbt section.</p>

<ol>
<li><p>Run logback test:</p>

<pre><code> cp build.gradle.logback build.gradle
 gradle clean run
</code></pre></li>
</ol>


<h1>Eclipse Interface</h1>

<p>How to creat Eclipse setting files (.classpath and .project) so that we can import this project into Eclipse, editing and debuging in it.</p>

<p>For gradle, add <code>apply plugin: 'eclipse'</code> into build.gradle and run <code>gradle cleanEclipse eclipse</code>;</p>

<p>For sbt, add <code>addSbtPlugin("com.typesafe.sbteclipse" % "sbteclipse-plugin" % "2.5.0")</code> (for sbt 0.13) into $PROJECT_HOME/project/plugins.sbt, and run <code>sbt eclipse</code>;</p>

<h1>Run Program</h1>

<h2>gradle</h2>

<pre><code>// run log4j test
cp build.gradle.log4j build.gradle
gradle clean run
// run logback test
cp build.gradle.logback build.gradle
gradle clean run
</code></pre>

<h2>sbt</h2>

<pre><code>// run log4j test
cp build.sbt.log4j build.sbt
sbt clean run
// run logback test
cp build.sbt.logback build.sbt
sbt clean run
</code></pre>

<p>If you have multiple main entry in source files, you can use &lsquo;runMain com.boco.logb.LoggerOneThread&rsquo; instead of &ldquo;run&rdquo; to run a specific program.</p>

<h1>Conclusion</h1>

<p>Gradle is mainly for building of Groovy and Java project, while sbt is mainly for building of Scala and Java project. So far Gradle has better support for building Java project.
For example, it&rsquo;s very convenient to build production zip or tar files with Gradle&rsquo;s application plugin (via the &ldquo;distZip&rdquo; task), while there&rsquo;s no corresponding plugin in sbt.
It&rsquo;s convenient to add or remove dependencies within Eclipse with the Gradle plugin of Eclipse (not the eclipse plugin of Gradle), while there&rsquo;s no sbt plugin of Eclipse (sbteclipse of typesafehub is a eclipse plugin of sbt). So we have to refresh build path of dependencies manually when developing a project in Eclipse created by sbt.</p>
]]></content>
  </entry>
  
</feed>
