<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Deployment | Dark Matter in Cyberspace]]></title>
  <link href="http://leetschau.github.io/blog/categories/deployment/atom.xml" rel="self"/>
  <link href="http://leetschau.github.io/"/>
  <updated>2014-11-03T17:15:36+08:00</updated>
  <id>http://leetschau.github.io/</id>
  <author>
    <name><![CDATA[Li Chao]]></name>
    <email><![CDATA[leetschau@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[A Deployment Pipeline Based on Puppet]]></title>
    <link href="http://leetschau.github.io/blog/2013/10/10/180521/"/>
    <updated>2013-10-10T18:05:21+08:00</updated>
    <id>http://leetschau.github.io/blog/2013/10/10/180521</id>
    <content type="html"><![CDATA[<p><a href="https://puppetlabs.com/blog/a-deployment-pipeline-for-infrastructure">https://puppetlabs.com/blog/a-deployment-pipeline-for-infrastructure</a></p>

<h1>Installation</h1>

<p>On Linux Mint 14 Xfce.</p>

<h2>OS verification</h2>

<pre><code>$ lsb_release -a
</code></pre>

<p>The codename of Linux Mint 14 is &ldquo;Nadia&rdquo;. Google &ldquo;linux mint release&rdquo; shows Nadia based on Ubuntu Quantal(12.10), which is in the supported version of puppet 3.</p>

<h2>Install it in standalone mode</h2>

<pre><code>$ wget https://apt.puppetlabs.com/puppetlabs-release-quantal.deb
$ sudo dpkg -i puppetlabs-release-quantal.deb
$ sudo apt-get update
$ sudo apt-get install puppet-common
</code></pre>

<p>You have to run puppet command as root: <code>puppet apply -e 'notice ("Hello World")'</code>.</p>

<h2>On Master Node</h2>

<p>After update apt repo:</p>

<pre><code># apt-get install puppetmaster
# puppet master --version
# apt-get install puppetmaster-passenger (failed on my laptop)
</code></pre>

<p>Verify as root:</p>

<pre><code># service puppetmaster status
</code></pre>

<p>Start it in foreground:</p>

<pre><code># service puppetmaster stop
# puppet master --no-daemonize --verbose
</code></pre>

<h2>On Agent Node</h2>

<pre><code># apt-get install puppet
</code></pre>

<p>Verify as root:</p>

<pre><code># service puppet status
# puppet agent --test --server=10.21.2.7
</code></pre>

<p>You will meet a &ldquo;no certificate found and waitforcert is disabled&rdquo; error. So we let master sign the certificate for the agent.</p>

<h2>Signing the Certificate</h2>

<p>On master:</p>

<pre><code># puppet cert list
</code></pre>

<p>You get the agent&rsquo;s name. It&rsquo;s OK.</p>

<pre><code># puppet cert sign chadpc527.boco.com
</code></pre>

<p>On agent:</p>

<pre><code># puppet apply -e '...'
</code></pre>

<h1>Trouble Shooting</h1>

<p>Log file: /var/log/puppet/masterhttp.log</p>

<p>Default puppet master port: 8140</p>

<p>Port detection: lsof -wni tcp:8140</p>

<p>Regenerate certificate request of agent: rm -rf /var/lib/puppet/ssl</p>
]]></content>
  </entry>
  
</feed>
