<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Automount | Dark Matter in Cyberspace]]></title>
  <link href="http://leetschau.github.io/blog/categories/automount/atom.xml" rel="self"/>
  <link href="http://leetschau.github.io/"/>
  <updated>2015-11-04T11:47:14+08:00</updated>
  <id>http://leetschau.github.io/</id>
  <author>
    <name><![CDATA[Li Chao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Automount USB Disk on Linux]]></title>
    <link href="http://leetschau.github.io/blog/2014/09/03/111703/"/>
    <updated>2014-09-03T11:17:03+08:00</updated>
    <id>http://leetschau.github.io/blog/2014/09/03/111703</id>
    <content type="html"><![CDATA[<h1>ArchLinux</h1>

<p>Install: <code>sudo pacman -S udiskie</code>;</p>

<p>Start service: run <code>udiskie &amp;</code> manually when system startup, or add &ldquo;udiskie &amp;&rdquo; into ~/.xinitrc;</p>

<p>Now when you plug USB key into computer, it will be automount to /media folder.</p>

<h2>Unmount USB disk</h2>

<p>Create an executable script in /usr/local/bin:</p>

<pre><code>$ cat /usr/local/bin/unmount
#!/bin/sh

# Global variables
TITLE="Unmount Utility"
COLUMNS=3 # TARGET,SOURCE,FSTYPE
#IFS=$'\n'

# Populate list of unmountable devices
deviceList=($(findmnt -Do TARGET,SOURCE,FSTYPE | grep -e "sd[b-z]"))
deviceCount=$((${#deviceList[@]} / $COLUMNS))

# Start of program output
echo $TITLE

# Display list of devices that can be unmounted
for ((device=0; device&lt;${#deviceList[@]}; device+=COLUMNS))
do
  printf "%4s)   %-25s%-13s%-10s\n"\
    "$(($device / $COLUMNS))"\
    "${deviceList[$device]}"\
    "${deviceList[$(($device + 1))]}"\
    "${deviceList[$(($device + 2))]}"
done

printf "%4s)   Exit\n" "x"

# Get input from user
read -p "Choose a menu option: " input

# Input validation
if [ "$input" = "X" ] || [ "$input" = "x" ]
then
  echo "Exiting"
  exit 0
fi

if (( $input&gt;=0 )) &amp;&amp; (( $input&lt;$deviceCount ))
then
  echo "Unmounting: ${deviceList[$(($input * $deviceCount))]}"
  sudo umount "${deviceList[$(($input * $deviceCount))]}"
  exit 0
else
  echo "Invalid menu choice"
  exit 1
fi
$ chmod 755 /usr/local/bin/unmount
</code></pre>

<p>Now when eject USB disk, run <code>unmount</code>, and choose a menu item to eject.
See <a href="https://wiki.archlinux.org/index.php/USB_storage_devices">USB storage devices</a> for details.
Or use <code>udiskie-umount -a</code> to unmount it manually.</p>

<p>See <code>man udiskie</code> for more information.</p>

<h1>Mint</h1>

<p>Install: <code>sudo aptitude install udevil</code>;</p>

<p>Start service: run <code>devmon</code> in dmenu when system startup, or add &ldquo;devmon &amp;&rdquo; into ~/.xsession;</p>

<p>After plug USB key into computer, it will be automount to /media folder.
If you do not startup devmon in background, you can run <code>devmon -a</code> to mount the USB key.</p>

<p>Run <code>devmon -c</code> to unmount the USB key.</p>

<p>See <code>man devmon</code> for more information.</p>

<h1>Difference between .xinitrc and .xsession:</h1>

<p>If you startup your system with <a href="https://wiki.archlinux.org/index.php/display_manager">display manager</a>, where you get a graphical login screen, it will read ~/.xsession.
In case of you startup your system without display manager and login to shell, startup i3 (or other wm) with <code>startx</code>, then the <a href="http://en.wikipedia.org/wiki/Xinit">xinit</a> program will read ~/.xinitrc;</p>

<p>See <a href="https://unix.stackexchange.com/questions/47359/what-is-xsession-for">What is “.xsession” for?</a> for details.</p>

<p>See <a href="https://wiki.archlinux.org/index.php/Arch_boot_process">Arch boot process</a> for how Getty manage login process in system boot process.</p>
]]></content>
  </entry>
  
</feed>
