<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Centos | Dark Matter in Cyberspace]]></title>
  <link href="http://leetschau.github.io/blog/categories/centos/atom.xml" rel="self"/>
  <link href="http://leetschau.github.io/"/>
  <updated>2016-11-11T15:03:30+08:00</updated>
  <id>http://leetschau.github.io/</id>
  <author>
    <name><![CDATA[Li Chao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[System Monitor Tools for Linux Server]]></title>
    <link href="http://leetschau.github.io/blog/2015/02/28/114611/"/>
    <updated>2015-02-28T11:46:11+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/02/28/114611</id>
    <content type="html"><![CDATA[<h1>sar</h1>

<p>On CentOS 6.5, install sysstat with <code>yum install sysstat</code>.
And the cron jobs will be created in /etc/cron.d/sysstat.
The default routines defined in this file is running system activity accounting every 10 minutes,
and generating a daily summary of process accounting at 23:53 each day.</p>

<p>Now you can see system memory usage hisory with <code>sar -r 2 5</code>,
which means display memory usage every 2 seconds, 5 times totally.</p>

<p>To see the memory history: <code>sar -r -f /var/log/sa/sa28</code>,
the total free memory is the sum of 3 items: kbmemfree, kbbuffers, kbcached.</p>

<p>Refs:</p>

<ul>
<li><p><a href="https://www.thomas-krenn.com/en/wiki/Collect_and_report_Linux_System_Activity_Information_with_sar">https://www.thomas-krenn.com/en/wiki/Collect_and_report_Linux_System_Activity_Information_with_sar</a></p></li>
<li><p><a href="http://serverfault.com/questions/85470/meaning-of-the-buffers-cache-line-in-the-output-of-free.">http://serverfault.com/questions/85470/meaning-of-the-buffers-cache-line-in-the-output-of-free.</a></p></li>
</ul>


<h1>dstat</h1>

<p>On CentOS 6.5, install dstat with <code>yum install dstat</code>.</p>

<p>Log the memory usage with <code>dstat --output memlog.csv -t -m 600 500</code>,
which will log totally 500 times, with a 10-minute interval.</p>

<h1>Glances</h1>

<p>Install it with <code>curl -L http://bit.ly/glances | /bin/bash</code>.
This only works on Linode node.
It failed on my loptop with message &ldquo;connection reset by peer&rdquo;.
On the Linode node, the installation failed with &ldquo;yum&rdquo; and &ldquo;pip&rdquo;.
It seems the reason is the dependencies are not met.</p>

<p>Use it with <code>glances</code> with root, or <code>glances -w</code> as a web server.
Then you can see the status of your server with url &ldquo;<a href="http://104.237.135.143:61208">http://104.237.135.143:61208</a>&rdquo;.</p>

<p>For keep a system log, use <code>glances -t 600 --export-csv /tmp/glances.csv</code>,
which means write a csv-format log every 10 minutes (3 seconds by default) to /tmp/glances.csv.</p>

<p>P.S.: There&rsquo;s also a <a href="http://munin-monitoring.org/">Munin</a>.
It seems the installation is complex, so I gave up.</p>

<h1>collectl</h1>

<p>Install with <code>yum install collectl</code>.</p>

<p>Print memeory usage with <code>collectl -i 2 -c 5 -sm</code>.</p>

<p>Print all subsystems with <code>collectl --showsubsys</code>.</p>

<p>Log output information with &ldquo;-f&rdquo; options: <code>collectl -sm -i 2 -c 5 -f mylog</code>.
It creates a gz file, which you have to extract with <code>gzip -d mylog...</code>.</p>

<p>Ref: <a href="http://lintut.com/best-command-line-tools-for-linux-performance-monitring/">http://lintut.com/best-command-line-tools-for-linux-performance-monitring/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CentOS服务器根目录空间被占满的解决方法]]></title>
    <link href="http://leetschau.github.io/blog/2014/12/24/174727/"/>
    <updated>2014-12-24T17:47:27+08:00</updated>
    <id>http://leetschau.github.io/blog/2014/12/24/174727</id>
    <content type="html"><![CDATA[<p>60和61服务器根目录(/)50G空间全被占满，用<code>du -shx /*</code>查看，非挂载目录的空间加起来远达不到50GB，
查了一下，怀疑原因是原来挂在/mnt下的data1和data2目录下的两块大容量磁盘由于某种原因没有挂载上，
但cloudera manager管理的hadoop和hdfs系统仍然在向这两个目录下存放大文件，导致空间被耗光，
验证方法是用<code>mount</code>命令检查/mnt下是否有挂载，如果有，将它们卸载掉，看/mnt下是否还有文件，
有的话删除掉就好了。</p>

<p>如果不是这个原因，还可能是被删除的大文件没有释放，用<code>lsof|grep "deleted"</code>检查；</p>

<p>参考：</p>

<p><a href="http://serverfault.com/questions/275206/disk-full-du-tells-different-how-to-further-investigate">Disk full, du tells different. How to further investigate?</a></p>

<p><a href="http://serverfault.com/questions/57098/du-vs-df-difference">du vs. df difference</a></p>

<p><a href="http://serverfault.com/questions/62119/how-do-i-find-out-what-is-using-up-all-the-space-on-my-partition">How do I find out what is using up all the space on my / partition?</a></p>

<p><a href="http://askubuntu.com/questions/266825/what-do-i-do-when-my-root-filesystem-is-full">What do I do when my root filesystem is full?</a></p>

<p><a href="http://serverfault.com/questions/513136/centos-dev-root-is-getting-full-cannot-find-disk-space-usage">Centos , /dev/root is getting full. Cannot find disk space usage</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Xen on CentOS 6]]></title>
    <link href="http://leetschau.github.io/blog/2014/09/24/073009/"/>
    <updated>2014-09-24T07:30:09+08:00</updated>
    <id>http://leetschau.github.io/blog/2014/09/24/073009</id>
    <content type="html"><![CDATA[<p>Ref: <a href="http://wiki.centos.org/HowTos/Xen/Xen4QuickStart">Xen4 CentOS6 QuickStart</a> &amp; <a href="http://wiki.centos.org/HowTos/Xen/Xen4QuickStart/Xen4Libvirt">Xen4 Libvirt for CentOS 6</a>.</p>

<h1>Build Xen Server</h1>

<p>The IP address of the Xen server (a Dell PC) is 10.32.1.112.
First install CentOS 6.4 via Minimal CD (or LiveDVD) and install Xen on the new OS;</p>

<pre><code>yum update
yum groupinstall Virtualization
yum install centos-release-xen   // unnecessary if install OS with LiveDVD
yum install xen bridge-utils
/usr/bin/grub-bootxen.sh
reboot
yum install libvirt python-virtinst libvirt-daemon-xen
yum install rsync wget vim-enhanced openssh-clients   // unnecessary if install OS with LiveDVD
reboot
uname -r  // the kernel should be 3.x
xm info
useradd -m chad
groupadd remote-libvirt
usermod -G remote-libvirt chad
cat &gt; /etc/polkit-1/localauthority/50-local.d/50-libvirt-remote-access.pkla &lt;&lt;EOF
[Remote libvirt SSH access]
Identity=unix-group:remote-libvirt
Action=org.libvirt.unix.manage
ResultAny=yes
ResultInactive=yes
ResultActive=yes
EOF
</code></pre>

<h2>Config network</h2>

<p>Modify dom0 host file /etc/xen/xend-config.sxp:</p>

<p>Comment out &ldquo;(network-script /bin/true)&rdquo; to &ldquo;(network-script &lsquo;network-bridge bridge=virbr0 netdev=eth0&rsquo;)&rdquo;.</p>

<h1>Build Xen Client</h1>

<p>We usually do not work on a Xen dom0 server. So here we install xen client on a Mint OS, and control Xen server with it:</p>

<h2>GUI Client</h2>

<p>First install with <code>sudo aptitude install virt-manager</code>, then run it with <code>virt-manager</code>. The &ldquo;Virtual Machine Manager&rdquo; window appears.</p>

<p>[Edit -> Connect Details -> Storage], Location: /var/lib/libvirt/images. So copy an OS image file (here it&rsquo;s CentOS-6.5-x86_64-minimal.iso) to this folder, and press the refresh button after &ldquo;Volumns&rdquo;, the ISO file appears.</p>

<p>Click &ldquo;New&rdquo; on toolbar, Name: Cloud21, check &ldquo;Local install media&rdquo; -> Use ISO image: /var/lib/libvirt/images/CentOS-6.5-x86_64-minimal.iso, OS type: Linux, Version: Red Hat Enterprise Linux 6 -> Memory: 1024 MB, CPUs: 1 -> Create a disk image &hellip;: 8.0 GB.</p>

<p>Now install CentOS with Minimal ISO file.</p>

<h2>Console Client</h2>

<pre><code>sudo aptitude install libvirt-bin
virsh -c xen+ssh://chad@10.32.1.112
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Build Redis on CentOS 6]]></title>
    <link href="http://leetschau.github.io/blog/2014/08/26/100107/"/>
    <updated>2014-08-26T10:01:07+08:00</updated>
    <id>http://leetschau.github.io/blog/2014/08/26/100107</id>
    <content type="html"><![CDATA[<p>This server can&rsquo;t access Internet.
We have to download source tarball (redis-2.8.2.tar.gz) and build from source.</p>

<pre><code>tar xf redis-2.8.2.tar.gz
cd redis-2.8.2
// if you run "sudo make install" directly,
// it gives a "zmalloc.h:50:31: error: jemalloc/jemalloc.h: No such file or directory" error.
cd deps
sudo make hiredis jemalloc linenoise lua
cd ..
sudo make install
</code></pre>

<p>Ref:
<a href="http://unix.stackexchange.com/questions/94479/jemalloc-and-other-errors-making-redis-on-centos-6-4">jemalloc and other errors making redis on centos 6.4</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Install Hadoop With CDH on CentOS]]></title>
    <link href="http://leetschau.github.io/blog/2014/07/24/153852/"/>
    <updated>2014-07-24T15:38:52+08:00</updated>
    <id>http://leetschau.github.io/blog/2014/07/24/153852</id>
    <content type="html"><![CDATA[<h1>Define hostname on every node</h1>

<p>Add &ldquo;HOSTNAME=cloud60&rdquo; into file /etc/sysconfig/network on host 10.12.2.60. Then reboot system.
Do this with it&rsquo;s own hostname on every node.</p>

<h1>Add host name to every node</h1>

<p>Add /etc/hosts to every node:</p>

<pre><code>10.12.2.60 cloud60
10.12.2.61 cloud61
10.12.2.62 cloud62
10.12.2.63 cloud63
10.12.2.90 cloud90
10.12.2.91 cloud91
10.12.2.92 cloud92
10.12.2.93 cloud93
</code></pre>

<p>where 10.12.2.60 is the manager node (where the cloudera manager is installed).</p>

<h1>Local Repository</h1>

<p>Copy DVD iso file to manager node, mount it. Create a link of /mnt/cdrom to /var/www/html with httpd:</p>

<pre><code># mkdir /mnt/cdrom
# mount -o loop /path/to/CentOS6.3-DVD.iso /mnt/cdrom
# cd /var/www/html
# ln -s /mnt/cdrom cdrom
</code></pre>

<p>Then add file cdrom.repo under /etc/yum.repos.d/:</p>

<pre><code>[cdrom]
name = CDROM
baseurl = http://10.12.2.60/cdrom/
gpgcheck = 0
</code></pre>

<h1>Other notes</h1>

<ul>
<li><p>Add user &ldquo;boco&rdquo; to &ldquo;sudoers&rdquo; on all nodes: add &ldquo;boco ALL=(ALL) NOPASSWD: ALL&rdquo; to /etc/sudoers;</p></li>
<li><p>The manager node can ssh to any other node with no password (ssh-copy-id &hellip;);</p></li>
<li><p>SSH from normal node to manager node to remove &ldquo;are you sure you want to continue connecting (yes/no)?&rdquo; prompt;</p></li>
<li><p>Shutdown iptables on all nodes: <code>service iptables stop</code> and <code>chkconfig iptables off</code>;</p></li>
</ul>

]]></content>
  </entry>
  
</feed>
