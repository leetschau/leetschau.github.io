<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Centos | Dark Matter in Cyberspace]]></title>
  <link href="http://leetschau.github.io/blog/categories/centos/atom.xml" rel="self"/>
  <link href="http://leetschau.github.io/"/>
  <updated>2014-10-01T21:14:19+08:00</updated>
  <id>http://leetschau.github.io/</id>
  <author>
    <name><![CDATA[Li Chao]]></name>
    <email><![CDATA[leetschau@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Xen on CentOS 6]]></title>
    <link href="http://leetschau.github.io/blog/2014/09/24/073009/"/>
    <updated>2014-09-24T07:30:09+08:00</updated>
    <id>http://leetschau.github.io/blog/2014/09/24/073009</id>
    <content type="html"><![CDATA[<p>Ref: <a href="http://wiki.centos.org/HowTos/Xen/Xen4QuickStart">Xen4 CentOS6 QuickStart</a> &amp; <a href="http://wiki.centos.org/HowTos/Xen/Xen4QuickStart/Xen4Libvirt">Xen4 Libvirt for CentOS 6</a>.</p>

<h1>Build Xen Server</h1>

<p>The IP address of the Xen server (a Dell PC) is 10.32.1.112.
First install CentOS 6.4 via Minimal CD (or LiveDVD) and install Xen on the new OS;</p>

<pre><code>yum update
yum groupinstall Virtualization
yum install centos-release-xen   // unnecessary if install OS with LiveDVD
yum install xen bridge-utils
/usr/bin/grub-bootxen.sh
reboot
yum install libvirt python-virtinst libvirt-daemon-xen
yum install rsync wget vim-enhanced openssh-clients   // unnecessary if install OS with LiveDVD
reboot
uname -r  // the kernel should be 3.x
xm info
useradd -m chad
groupadd remote-libvirt
usermod -G remote-libvirt chad
cat &gt; /etc/polkit-1/localauthority/50-local.d/50-libvirt-remote-access.pkla &lt;&lt;EOF
[Remote libvirt SSH access]
Identity=unix-group:remote-libvirt
Action=org.libvirt.unix.manage
ResultAny=yes
ResultInactive=yes
ResultActive=yes
EOF
</code></pre>

<h2>Config network</h2>

<p>Modify dom0 host file /etc/xen/xend-config.sxp:</p>

<p>Comment out &ldquo;(network-script /bin/true)&rdquo; to &ldquo;(network-script &lsquo;network-bridge bridge=virbr0 netdev=eth0&rsquo;)&rdquo;.</p>

<h1>Build Xen Client</h1>

<p>We usually do not work on a Xen dom0 server. So here we install xen client on a Mint OS, and control Xen server with it:</p>

<h2>GUI Client</h2>

<p>First install with <code>sudo aptitude install virt-manager</code>, then run it with <code>virt-manager</code>. The &ldquo;Virtual Machine Manager&rdquo; window appears.</p>

<p>[Edit -> Connect Details -> Storage], Location: /var/lib/libvirt/images. So copy an OS image file (here it&rsquo;s CentOS-6.5-x86_64-minimal.iso) to this folder, and press the refresh button after &ldquo;Volumns&rdquo;, the ISO file appears.</p>

<p>Click &ldquo;New&rdquo; on toolbar, Name: Cloud21, check &ldquo;Local install media&rdquo; -> Use ISO image: /var/lib/libvirt/images/CentOS-6.5-x86_64-minimal.iso, OS type: Linux, Version: Red Hat Enterprise Linux 6 -> Memory: 1024 MB, CPUs: 1 -> Create a disk image &hellip;: 8.0 GB.</p>

<p>Now install CentOS with Minimal ISO file.</p>

<h2>Console Client</h2>

<pre><code>sudo aptitude install libvirt-bin
virsh -c xen+ssh://chad@10.32.1.112
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Build Redis on CentOS 6]]></title>
    <link href="http://leetschau.github.io/blog/2014/08/26/100107/"/>
    <updated>2014-08-26T10:01:07+08:00</updated>
    <id>http://leetschau.github.io/blog/2014/08/26/100107</id>
    <content type="html"><![CDATA[<p>This server can&rsquo;t access Internet. So we can only download source tarball (redis-2.8.2.tar.gz) and build from source.</p>

<pre><code>tar xf redis-2.8.2.tar.gz
cd redis-2.8.2
// if you run "sudo make install" directly, it gives a "zmalloc.h:50:31: error: jemalloc/jemalloc.h: No such file or directory" error.
cd deps
sudo make hiredis jemalloc linenoise lua
cd ..
sudo make install
</code></pre>

<p>Ref:
<a href="http://unix.stackexchange.com/questions/94479/jemalloc-and-other-errors-making-redis-on-centos-6-4">jemalloc and other errors making redis on centos 6.4</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Install Hadoop With CDH on CentOS]]></title>
    <link href="http://leetschau.github.io/blog/2014/07/24/153852/"/>
    <updated>2014-07-24T15:38:52+08:00</updated>
    <id>http://leetschau.github.io/blog/2014/07/24/153852</id>
    <content type="html"><![CDATA[<h1>Define hostname on every node</h1>

<p>Add &ldquo;HOSTNAME=cloud60&rdquo; into file /etc/sysconfig/network on host 10.12.2.60. Then reboot system.
Do this with it&rsquo;s own hostname on every node.</p>

<h1>Add host name to every node</h1>

<p>Add /etc/hosts to every node:</p>

<pre><code>10.12.2.60 cloud60
10.12.2.61 cloud61
10.12.2.62 cloud62
10.12.2.63 cloud63
10.12.2.90 cloud90
10.12.2.91 cloud91
10.12.2.92 cloud92
10.12.2.93 cloud93
</code></pre>

<p>where 10.12.2.60 is the manager node (where the cloudera manager is installed).</p>

<h1>Local Repository</h1>

<p>Copy DVD iso file to manager node, mount it. Create a link of /mnt/cdrom to /var/www/html with httpd:</p>

<pre><code># mkdir /mnt/cdrom
# mount -o loop /path/to/CentOS6.3-DVD.iso /mnt/cdrom
# cd /var/www/html
# ln -s /mnt/cdrom cdrom
</code></pre>

<p>Then add file cdrom.repo under /etc/yum.repos.d/:</p>

<pre><code>[cdrom]
name = CDROM
baseurl = http://10.12.2.60/cdrom/
gpgcheck = 0
</code></pre>

<h1>Other notes</h1>

<ul>
<li><p>Add user &ldquo;boco&rdquo; to &ldquo;sudoers&rdquo; on all nodes: add &ldquo;boco ALL=(ALL) NOPASSWD: ALL&rdquo; to /etc/sudoers;</p></li>
<li><p>The manager node can ssh to any other node with no password (ssh-copy-id &hellip;);</p></li>
<li><p>SSH from normal node to manager node to remove &ldquo;are you sure you want to continue connecting (yes/no)?&rdquo; prompt;</p></li>
<li><p>Shutdown iptables on all nodes: <code>service iptables stop</code> and <code>chkconfig iptables off</code>;</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reset Forgotten Password in CentOS]]></title>
    <link href="http://leetschau.github.io/blog/2014/07/23/154955/"/>
    <updated>2014-07-23T15:49:55+08:00</updated>
    <id>http://leetschau.github.io/blog/2014/07/23/154955</id>
    <content type="html"><![CDATA[<ol>
<li><p>When system booting, press Space bar to interrupt the GRUB process;</p></li>
<li><p>Press &ldquo;a&rdquo; and <Enter>;</p></li>
<li><p>When see &ldquo;rhgb quiet&rdquo;, add &ldquo; 1&rdquo; after &ldquo;quiet&rdquo; and press <Enter>;</p></li>
</ol>


<p>Now CentOS boot in single user mode, you login as root, use <code>passwd</code> to reset password.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fix NIC Name of Cloned CentOS VMs]]></title>
    <link href="http://leetschau.github.io/blog/2014/07/23/151635/"/>
    <updated>2014-07-23T15:16:35+08:00</updated>
    <id>http://leetschau.github.io/blog/2014/07/23/151635</id>
    <content type="html"><![CDATA[<p>Sometimes the NIC name in output of <code>ip addr</code> or <code>ifconfig</code> is not the same with that defined in /etc/sysconfig/network-scripts/ifcfg-eth0, for example, in ifcfg-eth0, the first line is:</p>

<pre><code>DEVICE="eth0"
</code></pre>

<p>but the output of <code>ip addr</code> is:</p>

<pre><code>2: eth1: &lt;BROADCAST...
</code></pre>

<p>This is because the source of <code>ip addr</code> is /etc/udev/rules.d/70-persistent-net.rules. Edit this file to correct the NIC name.</p>

<p>The total step to fix network of a centos VM is:</p>

<ol>
<li><p>vi /etc/sysconfig/network   // fix hostname and gateway IP</p></li>
<li><p>vi /etc/sysconfig/network-scripts/ifcfg-eth0 // fix NIC name, host IP and netmask</p></li>
<li><p>vi /etc/udev/rules.d/70-persistent-net.rules  // NIC name and hardware address should be the same with that in file ifcfg-eth0</p></li>
<li><p>reboot</p></li>
</ol>


<h1>Update 2014-9-19</h1>

<p>The MAC address is determined by <code>ifconfig -a</code>, so copy IP address after &ldquo;HWaddr&rdquo; in command output, and modify &ldquo;HWADDR&rdquo; in /etc/&hellip;/ifcfg-eth0, then <code>sudo service network restart</code>.</p>
]]></content>
  </entry>
  
</feed>
