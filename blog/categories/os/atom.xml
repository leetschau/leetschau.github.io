<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Os | Dark Matter in Cyberspace]]></title>
  <link href="http://leetschau.github.io/blog/categories/os/atom.xml" rel="self"/>
  <link href="http://leetschau.github.io/"/>
  <updated>2016-11-11T14:51:43+08:00</updated>
  <id>http://leetschau.github.io/</id>
  <author>
    <name><![CDATA[Li Chao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Build Multiple OS on a Host]]></title>
    <link href="http://leetschau.github.io/blog/2014/07/18/201809/"/>
    <updated>2014-07-18T20:18:09+08:00</updated>
    <id>http://leetschau.github.io/blog/2014/07/18/201809</id>
    <content type="html"><![CDATA[<h1>Rearrange Disk Partitions</h1>

<p>Start computer with gparted LiveCD and start GParted. The data partition is &ldquo;/dev/sda1&rdquo;.</p>

<ol>
<li><p>Use &ldquo;Resize/Move&rdquo; to move /dev/sda1 partition to the end of the disk, before the swap partition. Shrink 928GB to 295GB, where 87GB are used. It took about 5 hours. You can only shrink the partition without moving them to the end, which will be faster than the previous &ldquo;shrink + move&rdquo; method.</p></li>
<li><p>Right click /dev/sda1 -> Manage Flags, uncheck the &ldquo;boot&rdquo; flag.</p></li>
<li><p>Create a new 50GB partition /dev/sda3 with EXT4 format, label it as &ldquo;system1&rdquo; and quit GParted;</p></li>
<li><p>Start computer with new system (Mint 17 64bit here) LiveCD;</p></li>
<li><p>Install Mint, select &ldquo;Something else&rdquo; when asked for &ldquo;Installation type&rdquo;;</p></li>
<li><p>Select /dev/sda3, click &ldquo;change&rdquo;, then choose &ldquo;Ext4 journaling file system&rdquo; in &ldquo;Use as&rdquo;, then choose &ldquo;/&rdquo; as the &ldquo;Mount point&rdquo;, set /dev/sda1 mounted at /home and the old swap partition as swap;</p></li>
<li><p>Install the system, then reboot;</p></li>
</ol>


<h2>Transfer old data</h2>

<p>The old partition is mounted on /home, so the old home folder is now /home/home/chad. So we need:</p>

<ol>
<li><p>Move sub-folders of /home/home/chad to /home/chad;</p></li>
<li><p>After some days when it&rsquo;s sure all data have been transfered, delete all folders and files under /home except &ldquo;chad&rdquo; (new $HOME folder);</p></li>
</ol>


<p>Now on /dev/sda3, there is only one folder &ldquo;chad&rdquo;. When install the second system, just mount /dev/sda3 to /home, everything will be ok.</p>

<h2>Supported methods for disk partition management</h2>

<p>Start &ldquo;Terminal&rdquo; on LiveCD.</p>

<ol>
<li><p>Detect disk: <code>gdisk /dev/sda</code>, notice  your detection target is the whole disk instead of a partition, so &ldquo;sda&rdquo; can&rsquo;t be written as &ldquo;sda1&rdquo;, or there will no MBR be found.</p></li>
<li><p>Backup MBR: <code>sfdisk -d /dev/sda &gt; parts.txt</code>, you can recover MBR with <code>sfdisk /dev/sda &lt; backup-sda.sfdisk</code> , or with &ldquo;dd&rdquo; command:</p>

<p> Backup: # dd if=/dev/sda of=/backup/mbr_sda.bak bs=512 count=1
 Restore: # dd if=/backup/mbr_sda.bak of=/dev/hda bs=512 count=1</p></li>
</ol>


<h1>Install the Second OS</h1>

<ol>
<li><p>Backup MBR and grub.cfg:</p></li>
<li><p>Install centOS 6.5 Minimal with USB stick;</p></li>
<li><p>Choose &ldquo;Create Custom Layout&rdquo;, create a new partititon, mounted at /, and mount sdb1 as /home;</p></li>
<li><p>Uncheck &ldquo;Install boot loader on /dev/sdb&rdquo;;</p></li>
<li><p>Reboot system. There is no change in boot menu, startup origin system (Mint 17), run <code>update-grub</code> with root.</p></li>
<li><p>Reboot, you can see the CentOS is in boot menu.</p></li>
</ol>


<p>Note: If you don&rsquo;t want an OS in your boot menu, rename its &ldquo;boot&rdquo; folder as &ldquo;boot.old&rdquo; (or anything else).</p>

<p>Ref:</p>

<p><a href="http://www.maketecheasier.com/move-home-folder-ubuntu/">How to Move Your Home Folder to Another Partition</a></p>

<p>Google: Linux系统启动过程</p>

<p><a href="http://keping.me/linux-boot-process/">Linux系统启动过程</a></p>

<p><a href="http://www.thegeekstuff.com/2011/02/linux-boot-process/">6 Stages of Linux Boot Process (Startup Sequence)</a></p>

<p><a href="http://www.lifelinux.com/how-to-backup-restore-master-boot-record-mbr-in-linux/">How To Backup &amp; Restore Master Boot Record (MBR) In Linux</a></p>

<p><a href="http://www.techpository.com/?page_id=123">Linux: Copy Master Boot Record (MBR)</a></p>

<p>Manpage of sfdisk.</p>

<p><a href="https://sites.google.com/site/easylinuxtipsproject/grub">Boot loader Grub: how to repair, adapt or remove it</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用Windows7的系统备份和还原功能备份操作系统]]></title>
    <link href="http://leetschau.github.io/blog/2012/12/21/091837/"/>
    <updated>2012-12-21T09:18:37+08:00</updated>
    <id>http://leetschau.github.io/blog/2012/12/21/091837</id>
    <content type="html"><![CDATA[<p>刚入手的联想V480装好了系统和驱动需要做系统备份，之前使用的小马PE找不到硬盘，无法用它的ghost功能，所以尝试了一下Win7自己的备份和还原功能。</p>

<p>Win7的备份和还原在【控制面板->系统和安全->备份和还原】中进行，备份操作分为两部分：创建系统镜像和引导光盘，前者是系统盘的备份，类似于ghost镜像，但没有压缩功能（用了13GB空间），备份之后在F盘（选择的备份目标盘）上生成了一个文件（MediaID.bin）和两个文件夹（WindowsImageBackup和一个与计算机名相同的文件夹），将它们设为隐藏即可。创建引导光盘需要刻录光盘，需要的空间很小，只用了187MB，CD盘即可，DVD浪费了。</p>

<p>还原的时候将从光盘启动系统，它会自动寻找最新的备份，如果找不到也可以手工指定。</p>

<p>今天做的备份用户名是chad，密码是godu。</p>

<p>如果需要还原的时候系统还能启动，可以在系统中进行还原操作，如果系统已经不能启动，恢复光盘也找不到了，可以从微软官网下载"Windows 7 USB/DVD download tool"，安装后可以把U盘做成一个启动盘（需要一个Win7系统iso文件），然后用这个U盘启动计算机，选择“系统映像恢复”即可。也可以用它安装全新的系统。</p>

<hr />

<p>2013-01-05更新：</p>

<p>Easeus Todo Backup是更好的选择，生成的镜像压缩比大，时间短，可以增量备份，可以只恢复系统，可以恢复到不同大小的分区上，参考<a href="http://www.freewaregenius.com/the-best-free-disk-imaging-program-a-comparative-analysis">http://www.freewaregenius.com/the-best-free-disk-imaging-program-a-comparative-analysis</a></p>
]]></content>
  </entry>
  
</feed>
