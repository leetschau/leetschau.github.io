<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Stack | Dark Matter in Cyberspace]]></title>
  <link href="http://leetschau.github.io/blog/categories/stack/atom.xml" rel="self"/>
  <link href="http://leetschau.github.io/"/>
  <updated>2015-11-20T11:01:10+08:00</updated>
  <id>http://leetschau.github.io/</id>
  <author>
    <name><![CDATA[Li Chao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Stack Notes]]></title>
    <link href="http://leetschau.github.io/blog/2015/09/23/123748/"/>
    <updated>2015-09-23T12:37:48+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/09/23/123748</id>
    <content type="html"><![CDATA[<h1>Install</h1>

<p>Install <a href="https://github.com/commercialhaskell/stack">stack</a> and start a demo yesod web server:</p>

<pre><code>wget -q -O- https://s3.amazonaws.com/download.fpcomplete.com/ubuntu/fpco.key | sudo apt-key add -
echo 'deb http://download.fpcomplete.com/ubuntu/trusty stable main'|sudo tee /etc/apt/sources.list.d/fpco.list
sudo apt-get update &amp;&amp; sudo apt-get install stack -y
cd ~/docs/playground
stack new myHaskellProj yesod-sqlite  // very slow, 30 minutes or so
stack install yesod-bin cabal-install --install-ghc
stack build  // if it's interupteed by "FailedConnectionException s3.amazonaws.com 443" error, run this command again
stack exec -- yesod devel
</code></pre>

<p>Now open &ldquo;<a href="http://localhost:3000/">http://localhost:3000/</a>&rdquo;.</p>

<p>On Windows:</p>

<p>下载stack Windows包stack-0.1.4.0-i386-windows.zip，解压，
在解压目录中运行Git Bash（通过msysGit安装），</p>

<pre><code>cd /f/ghost/tempFiles
stack steup
/d/Apps/stack/stack.exe new myHaskellProj yesod-sqlite
/d/Apps/stack/stack.exe templates
/d/Apps/stack/stack.exe install yesod-bin cabal-install --install-ghc
/d/Apps/stack/stack.exe build
/d/Apps/stack/stack.exe exec -- yesod devel
</code></pre>

<p>stack setup比较慢，大约需要10分钟，安装后运行不正常，放弃。</p>

<h1>Run Haskell Code</h1>

<p>To start a ghci, in any folder, run:</p>

<pre><code>stack ghci
Prelude&gt; putStrLn "hello world"
</code></pre>

<p>To run haskell script: in any folder, run</p>

<pre><code>$ cat hello.hs
main = putStrLn "hello world"
$ stack runghc hello.hs
</code></pre>

<h1>Install New Library</h1>

<p>For example install library &ldquo;random&rdquo;:</p>

<pre><code>cabal update
cabal install random
</code></pre>

<h1>Editor Setup</h1>

<p>Ref: <a href="http://seanhess.github.io/2015/08/05/practical-haskell-editors.html">PRACTICAL HASKELL - EDITOR SETUP WITH STACK</a>.</p>

<pre><code>cd ~
stack setup
stack install hdevtools
stack path|grep ghc      # to get the ghc binary path used below
</code></pre>

<p>Add <code>PATH=$PATH:$HOME/.stack/programs/x86_64-linux/ghc-7.10.2/bin:$HOME/.local/bin</code> into ~/.zshenv.</p>

<p>Install syntastic and &lsquo;bitc/vim-hdevtools&rsquo; plugin for vim:</p>

<p>add the following 2 lines into ~/.vimrc:</p>

<pre><code>Plugin 'scrooloose/syntastic'
Plugin 'bitc/vim-hdevtools'
</code></pre>

<p>then run <code>vim +PluginInstall</code>.</p>

<p>Now your .hs files will be checked when saving.</p>

<p>To verify, create hello.hs as follows:</p>

<pre><code>main = do
  print "What is your name?"
  name &lt;- getLine
  print ("Hello " ++ name ++ "!")
</code></pre>

<p>When cursor on &ldquo;print&rdquo; in the 2nd line, run <code>:HdevtoolsType</code>
(which equivalent to run <code>hdevtools type hello.hs 2 3</code> in shell),
you should get &ldquo;[Char] -> IO ()&rdquo;.</p>

<p>For convenient, add the following shortcuts into ~/.vimrc:</p>

<pre><code>" hdevtools setup (haskell)
au FileType haskell nnoremap &lt;buffer&gt; &lt;F3&gt; :HdevtoolsType&lt;CR&gt;
au FileType haskell nnoremap &lt;buffer&gt; &lt;silent&gt; &lt;F4&gt; :HdevtoolsClear&lt;CR&gt;
</code></pre>

<p>Add &ldquo;this&rdquo; at the end of file from column 3 and save
(which is equivalent to run <code>hdevtools check hello.hs</code> in shell),
a &ldquo;Not in scope: ‘this’&rdquo; error will raises.</p>

<p>See <a href="https://github.com/schell/hdevtools">hdevtools</a> and
<a href="https://github.com/bitc/vim-hdevtools">bitc/vim-hdevtools</a> for more information.</p>
]]></content>
  </entry>
  
</feed>
