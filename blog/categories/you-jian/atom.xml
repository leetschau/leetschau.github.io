<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: 邮件 | Dark Matter in Cyberspace]]></title>
  <link href="http://leetschau.github.io/blog/categories/you-jian/atom.xml" rel="self"/>
  <link href="http://leetschau.github.io/"/>
  <updated>2014-09-10T17:28:18+08:00</updated>
  <id>http://leetschau.github.io/</id>
  <author>
    <name><![CDATA[Li Chao]]></name>
    <email><![CDATA[leetschau@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Python发送邮件时的抄送问题]]></title>
    <link href="http://leetschau.github.io/blog/2011/01/19/111508/"/>
    <updated>2011-01-19T11:15:08+08:00</updated>
    <id>http://leetschau.github.io/blog/2011/01/19/111508</id>
    <content type="html"><![CDATA[<p>python使用smtp模块的sendmail()方法发送邮件时，并不区分是“发送给”、“抄送给”还是“密送给”，都一视同仁的放在该方法的第二个参数中，但邮件头（也就是收到的邮件中头部“收件人”、“抄送”等信息）却是由第三个参数决定，也就是说邮件的表现形式是在邮件头里定义的，所以如果想“密送”给某人，只要把他的地址加在第二个参数里，而不要在邮件头里出现就行了。下面是代码实例。</p>

<pre><code>import smtplib, ConfigParser, datetime 
from email.mime.text import MIMEText 
from email.mime.multipart import MIMEMultipart 
config = ConfigParser.ConfigParser() 
config.read('build.cfg') 
try: 
    mail_server = smtplib.SMTP(config.get('mail','server_addr')) 
    mail_server.set_debuglevel(1) 
    mail_server.login(config.get('mail','username'), config.get('mail','password')) 
except Exception,e: 
    exit() 
from_addr = config.get('mail','from_addr') 
to_addr = config.get('mail','to_addr') 
copyto_addr = config.get('mail','copyto_addr') 
sending_date = datetime.datetime.now().strftime("%d/%m/%Y %H:%M") 
message_body = '&lt;html&gt;&lt;body&gt;aa&lt;/body&gt;&lt;/html&gt;' 
msg = MIMEMultipart() 
msg.add_header('From',from_addr) 
msg.add_header('To',to_addr) 
msg.add_header('Cc',copyto_addr) 
msg.add_header('Subject',config.get('mail','subject')) 
msg.add_header('Date',sending_date) 
msg.attach(MIMEText(message_body, 'html')) 
mail_server.sendmail(from_addr, to_addr.split()+copyto_addr.split(), msg.as_string()) 
mail_server.quit() 
</code></pre>

<p>在代码所在文件夹下写一个build.cfg文件，内容如下：</p>

<pre><code>[mail] 
server_addr: 124.127.106.5 
username: lichao1 
password: aba... 
from_addr: LiChao&lt;lichao1@boco.com.cn&gt; 
to_addr: lichao1@boco.com.cn zhaohuaqiao_kkk@boco.com.cn 
copyto_addr: leechau@126.com liu_xin_kkk@boco.com.cn 
subject: BVT Reports
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[用python发送各种形式的邮件]]></title>
    <link href="http://leetschau.github.io/blog/2011/01/12/153209/"/>
    <updated>2011-01-12T15:32:09+08:00</updated>
    <id>http://leetschau.github.io/blog/2011/01/12/153209</id>
    <content type="html"><![CDATA[<p>分别是发送纯文本邮件、html格式邮件，以及带附件的html格式邮件。纯文本邮件消息体是普通字符串，html格式邮件中消息体是MIMEText型对象，这种对象的特点是不能加附件；带附件的html格式邮件中消息体是MIMEMultipart型对象，正文和附件都用attach()方法添加。</p>

<p>代码如下（红色字体部分是一个html格式文本的示例，可跳过不看）：</p>

<p> import smtplib</p>

<p> from email.mime.text import MIMEText</p>

<p> from email.mime.multipart import MIMEMultipart</p>

<p> if <strong>name</strong>==&lsquo;<strong>main</strong>&rsquo;:</p>

<p>  msg_body=&lsquo;&rsquo;&lsquo; &lt;!DOCTYPE HTML PUBLIC &ldquo;-//W3C//DTD HTML 4.01 Transitional//EN&rdquo;> <html xmlns:lxslt="http://xml.apache.org/xslt" xmlns:stringutils="xalan://org.apache.tools.ant.util.StringUtils"></p>

<p> <head></p>

<p> <META http-equiv="Content-Type" content="text/html; charset=US-ASCII"> <title>BVT Report</title> <style type="text/css"></p>

<p>  body {</p>

<p>   font:normal 68% verdana,arial,helvetica;</p>

<p>   color:#000000;</p>

<p>  }</p>

<p>  table tr td, table tr th {</p>

<p>   font-size: 68%;</p>

<p>  }</p>

<p>  table.details tr th{</p>

<p>   font-weight: bold;</p>

<p>   text-align:left;</p>

<p>   background:#a6caf0;</p>

<p>  }</p>

<p>  table.details tr td{</p>

<p>   background:#eeeee0;</p>

<p>  }</p>

<p>  p {</p>

<p>   line-height:1.5em;</p>

<p>   margin-top:0.5em; margin-bottom:1.0em;</p>

<p>  }</p>

<p>  h1 {</p>

<p>   margin: 0px 0px 5px; font: 165% verdana,arial,helvetica</p>

<p>  }</p>

<p>  h2 {</p>

<p>   margin-top: 1em; margin-bottom: 0.5em; font: bold 125% verdana,arial,helvetica</p>

<p>  }</p>

<p>  h3 {</p>

<p>   margin-bottom: 0.5em; font: bold 115% verdana,arial,helvetica</p>

<p>  }</p>

<p>  h4 {</p>

<p>   margin-bottom: 0.5em; font: bold 100% verdana,arial,helvetica</p>

<p>  }</p>

<p>  h5 {</p>

<p>   margin-bottom: 0.5em; font: bold 100% verdana,arial,helvetica</p>

<p>  }</p>

<p>  h6 {</p>

<p>   margin-bottom: 0.5em; font: bold 100% verdana,arial,helvetica</p>

<p>  }</p>

<p>  .Error {</p>

<p>   font-weight:bold; color:red;</p>

<p>  }</p>

<p>  .Failure {</p>

<p>   font-weight:bold; color:purple;</p>

<p>  }</p>

<p>  .Properties {</p>

<p>   text-align:right;</p>

<p>  }</p>

<p>  </style></p>

<p> </head></p>

<p> <body></p>

<p> <h1>Unit Test Results Summary</h1></p>

<p> <table class="details" border="0" cellpadding="5" cellspacing="2" width="95%"> <tr valign="top"> <th>Tests</th><th>Failures</th><th>Errors</th><th>Success rate</th><th>Time</th> </tr> <tr valign="top" class="Error"> <td>382</td><td>3</td><td>382</td><td>36.0466666667%</td><td>1.65</td></p>

<p> </tr></p>

<p> </table></p>

<p> <hr/></p>

<p> <h1>Diffcount Report</h1></p>

<p> <h2>GODU SERVER</h2></p>

<p> <table class="details" border="0" cellpadding="5" cellspacing="2" width="95%"> <tr valign="top"> <th>LANG</th><th>ADD</th><th>MOD</th><th>DEL</th><th>A&amp;M</th><th>BLK</th><th>CMT</th><th>NBNC</th><th>RATE</th></p>

<p> </tr></p>

<p> <tr valign="top" class="Error"><td>Java</td><td>52774</td><td>0</td><td>0</td><td>52774</td><td>5501</td><td>8036</td><td>39344</td><td>0.41</td></tr><tr valign="top" class="Error"><td>XML</td><td>399</td><td>0</td><td>0</td><td>399</td><td>0</td><td>0</td><td>399</td><td>0.12</td></tr></p>

<p> </table></p>

<p> <h2>GAPI</h2></p>

<p> <table class="details" border="0" cellpadding="5" cellspacing="2" width="95%"> <tr valign="top"> <th>LANG</th><th>ADD</th><th>MOD</th><th>DEL</th><th>A&amp;M</th><th>BLK</th><th>CMT</th><th>NBNC</th><th>RATE</th></p>

<p> </tr></p>

<p> <tr valign="top" class="Error"><td>Java</td><td>52774</td><td>0</td><td>0</td><td>52774</td><td>5501</td><td>8036</td><td>39344</td><td>0.41</td></tr><tr valign="top" class="Error"><td>XML</td><td>399</td><td>0</td><td>0</td><td>399</td><td>0</td><td>0</td><td>399</td><td>0.12</td></tr></p>

<p> </table></p>

<p> <h2>GODU WEB</h2></p>

<p> <table class="details" border="0" cellpadding="5" cellspacing="2" width="95%"> <tr valign="top"> <th>LANG</th><th>ADD</th><th>MOD</th><th>DEL</th><th>A&amp;M</th><th>BLK</th><th>CMT</th><th>NBNC</th><th>RATE</th></p>

<p> </tr></p>

<p> <tr valign="top" class="Error"><td>Java</td><td>52774</td><td>0</td><td>0</td><td>52774</td><td>5501</td><td>8036</td><td>39344</td><td>0.41</td></tr><tr valign="top" class="Error"><td>XML</td><td>399</td><td>0</td><td>0</td><td>399</td><td>0</td><td>0</td><td>399</td><td>0.12</td></tr></p>

<p> </table></p>

<p> </body></p>

<p> </html></p>

<p> &lsquo;&rsquo;&#8217;</p>

<p>  mail_server = smtplib.SMTP(&lsquo;124.127.106.5&rsquo;) # use &lsquo;smtp.163.com&rsquo; to send email with 163</p>

<p>  mail_server.set_debuglevel(1)</p>

<p>  mail_server.login(&lsquo;lichao1&rsquo;, &lsquo;abaqus67&rsquo;)</p>

<p>  #发送纯文本邮件</p>

<p>  #from_addr = &lsquo;LiChao<a href="&#x6d;&#x61;&#x69;&#x6c;&#116;&#x6f;&#x3a;&#108;&#105;&#99;&#104;&#97;&#111;&#x31;&#x40;&#x62;&#111;&#99;&#111;&#46;&#x63;&#111;&#109;&#46;&#99;&#110;">&#x6c;&#x69;&#x63;&#104;&#x61;&#x6f;&#49;&#64;&#98;&#111;&#99;&#x6f;&#46;&#99;&#x6f;&#109;&#x2e;&#x63;&#x6e;</a>&rsquo;</p>

<p>  #to_addr = &lsquo;LiChao<a href="&#109;&#x61;&#x69;&#x6c;&#x74;&#x6f;&#58;&#x6c;&#105;&#99;&#x68;&#97;&#x6f;&#49;&#x40;&#98;&#x6f;&#99;&#111;&#46;&#x63;&#111;&#109;&#46;&#99;&#110;">&#108;&#105;&#x63;&#x68;&#x61;&#111;&#49;&#x40;&#x62;&#x6f;&#99;&#x6f;&#x2e;&#99;&#111;&#109;&#46;&#x63;&#x6e;</a>&rsquo;</p>

<p>  #subj = &lsquo;hello&rsquo;</p>

<p>  #date = datetime.datetime.now().strftime(&ldquo;%d/%m/%Y %H:%M&rdquo;)</p>

<p>  #msg = &ldquo;From: %s\nTo: %s\nSubject: %s\nDate: %s\n\n%s&rdquo; % (from_addr, to_addr, subj, date, message_body)</p>

<p>  #mail_server.sendmail(from_addr, to_addr, msg)</p>

<p>  #发送html格式邮件</p>

<p>  #msg = MIMEText (msg_body, &lsquo;html&rsquo;)</p>

<p>  #msg[&lsquo;From&rsquo;] = &lsquo;LiChao<a href="&#109;&#x61;&#105;&#108;&#x74;&#111;&#x3a;&#x6c;&#105;&#99;&#x68;&#x61;&#111;&#x31;&#64;&#x62;&#x6f;&#99;&#111;&#46;&#x63;&#x6f;&#109;&#x2e;&#99;&#x6e;">&#x6c;&#x69;&#x63;&#104;&#97;&#x6f;&#49;&#64;&#98;&#x6f;&#x63;&#x6f;&#x2e;&#x63;&#x6f;&#109;&#46;&#x63;&#110;</a>&rsquo;</p>

<p>  #msg[&lsquo;To&rsquo;] = &lsquo;LiChao<a href="&#x6d;&#x61;&#x69;&#x6c;&#x74;&#x6f;&#x3a;&#108;&#x69;&#99;&#x68;&#97;&#x6f;&#49;&#64;&#x62;&#111;&#x63;&#x6f;&#46;&#x63;&#x6f;&#x6d;&#x2e;&#99;&#x6e;">&#108;&#105;&#x63;&#104;&#97;&#111;&#x31;&#x40;&#98;&#111;&#99;&#x6f;&#46;&#99;&#x6f;&#x6d;&#46;&#99;&#x6e;</a>&rsquo;</p>

<p>  #msg[&lsquo;Subject&rsquo;] = &lsquo;hello&rsquo;</p>

<p>  #mail_server.sendmail(&lsquo;LiChao<a href="&#109;&#x61;&#x69;&#108;&#x74;&#111;&#x3a;&#108;&#x69;&#99;&#104;&#97;&#x6f;&#49;&#64;&#x62;&#x6f;&#99;&#111;&#46;&#99;&#111;&#x6d;&#x2e;&#99;&#x6e;">&#108;&#105;&#x63;&#104;&#x61;&#111;&#49;&#x40;&#98;&#x6f;&#x63;&#x6f;&#x2e;&#99;&#111;&#x6d;&#x2e;&#x63;&#x6e;</a>&rsquo;, &lsquo;LiChao<a href="&#x6d;&#97;&#105;&#x6c;&#116;&#x6f;&#58;&#108;&#105;&#x63;&#104;&#x61;&#111;&#49;&#64;&#98;&#111;&#99;&#111;&#x2e;&#99;&#x6f;&#109;&#46;&#99;&#110;">&#108;&#x69;&#x63;&#x68;&#x61;&#111;&#x31;&#x40;&#98;&#x6f;&#99;&#111;&#x2e;&#99;&#x6f;&#x6d;&#x2e;&#x63;&#110;</a>&rsquo;, msg.as_string())</p>

<p>  #发送带附件的html格式邮件</p>

<p>  msg = MIMEMultipart ()</p>

<p>  part2 = MIMEText(msg_body, &lsquo;html&rsquo;)</p>

<p>  msg. attach (part2)</p>

<p>  att = MIMEText(open(&lsquo;e:\BVT\GODU-BVT\GCIF\build\2011-01-12\GAPI\build\result\junit\junit-noframes.html&rsquo;, &lsquo;rt&rsquo;).read())</p>

<p>  att[&ldquo;Content-Type&rdquo;] = &lsquo;application/octet-stream&rsquo;</p>

<p>  att[&ldquo;Content-Disposition&rdquo;] = &lsquo;attachment; filename=&ldquo;JUnitReport.html&rdquo;&rsquo;</p>

<p>  msg. attach (att)</p>

<p>  msg[&lsquo;From&rsquo;] = &lsquo;LiChao<a href="&#109;&#97;&#105;&#108;&#116;&#x6f;&#x3a;&#108;&#x69;&#x63;&#104;&#x61;&#x6f;&#49;&#x40;&#98;&#x6f;&#x63;&#x6f;&#46;&#x63;&#111;&#x6d;&#x2e;&#x63;&#x6e;">&#x6c;&#105;&#x63;&#104;&#97;&#x6f;&#49;&#64;&#x62;&#x6f;&#x63;&#111;&#x2e;&#99;&#x6f;&#x6d;&#46;&#99;&#x6e;</a>&rsquo;</p>

<p>  msg[&lsquo;To&rsquo;] = &lsquo;LiChao<a href="&#x6d;&#97;&#105;&#108;&#x74;&#x6f;&#58;&#x6c;&#105;&#x63;&#104;&#x61;&#111;&#x31;&#64;&#x62;&#x6f;&#x63;&#x6f;&#46;&#x63;&#111;&#x6d;&#x2e;&#x63;&#110;">&#x6c;&#x69;&#99;&#x68;&#97;&#x6f;&#49;&#x40;&#x62;&#x6f;&#99;&#x6f;&#x2e;&#99;&#x6f;&#x6d;&#x2e;&#x63;&#110;</a>&rsquo;</p>

<p>  msg[&lsquo;Subject&rsquo;] = &lsquo;hello&rsquo;</p>

<p>  mail_server.sendmail(&lsquo;LiChao<a href="&#109;&#97;&#105;&#x6c;&#116;&#111;&#58;&#108;&#x69;&#99;&#104;&#x61;&#x6f;&#x31;&#x40;&#98;&#x6f;&#99;&#111;&#46;&#99;&#111;&#109;&#x2e;&#x63;&#110;">&#108;&#105;&#99;&#104;&#x61;&#111;&#49;&#x40;&#x62;&#111;&#x63;&#111;&#x2e;&#99;&#111;&#x6d;&#46;&#x63;&#110;</a>&rsquo;, &lsquo;LiChao<a href="&#x6d;&#x61;&#x69;&#108;&#116;&#111;&#58;&#108;&#105;&#x63;&#x68;&#x61;&#111;&#x31;&#x40;&#98;&#111;&#x63;&#111;&#x2e;&#99;&#x6f;&#109;&#46;&#99;&#x6e;">&#108;&#x69;&#x63;&#x68;&#x61;&#111;&#x31;&#64;&#98;&#x6f;&#99;&#111;&#x2e;&#x63;&#111;&#109;&#46;&#99;&#x6e;</a>&rsquo;, msg.as_string())</p>

<p>  mail_server.quit()</p>

<p> 注意：sendmail()发送邮件时，如果收件人有多个，必须放在一个list中作为参数，如果是字符串，则只发给第一个人，似乎只有python2.6要求是list型参数。</p>
]]></content>
  </entry>
  
</feed>
