<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Mongo-connector | Dark Matter in Cyberspace]]></title>
  <link href="http://leetschau.github.io/blog/categories/mongo-connector/atom.xml" rel="self"/>
  <link href="http://leetschau.github.io/"/>
  <updated>2015-11-04T11:47:14+08:00</updated>
  <id>http://leetschau.github.io/</id>
  <author>
    <name><![CDATA[Li Chao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Synchronize Data From MongoDB to Elasticsearch]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/31/011200/"/>
    <updated>2015-10-31T01:12:00+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/31/011200</id>
    <content type="html"><![CDATA[<p>Your mongo replica set and elasticsearch are hosted on 2 servers.
The mongo server is on &ldquo;mip:mport&rdquo;.
The ES server is on &ldquo;esip:esport&rdquo;.</p>

<p>On another server, install <a href="https://github.com/mongodb-labs/mongo-connector">mongo-connector</a>
with <code>pip install mongo-connector</code>.
If there are some errors, it may be caused by absence of gcc.
On Ubuntu, install them with <code>sudo apt-get install build-essential python-dev</code>.</p>

<pre><code>mongo-connector -m mip:mport -t esip:esport -d elastic_doc_manager --admin-username root --password rootPwd
</code></pre>

<p>That&rsquo;s it!
Now when you insert documents into MongoDB,
you can see it on elasticsearch.</p>

<p>We&rsquo;ve studied Mongo River and Mongoosatic, neither is better than this.</p>

<p>Note:</p>

<p>Use root to sync is unsafe.
We create an user with &ldquo;clusterManager&rdquo; role to do this work.
Login with root, and run:</p>

<pre><code>use admin
db.createUser(
    {
      user: "clustermgr",
      pwd: "cmpwd",
      roles: [ "clusterManager" ]
    }
)
</code></pre>

<p>But run the command
<code>mongo-connector -m 119.254.211.28:15515 -t localhost:9200 -d elastic_doc_manager --admin-username clustermgr --password cmpwd</code>
will be the error <code>OperationFailure: database error: not authorized for query on local.oplog.rs</code>.</p>
]]></content>
  </entry>
  
</feed>
