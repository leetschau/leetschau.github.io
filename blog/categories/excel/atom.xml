<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Excel | Dark Matter in Cyberspace]]></title>
  <link href="http://leetschau.github.io/blog/categories/excel/atom.xml" rel="self"/>
  <link href="http://leetschau.github.io/"/>
  <updated>2014-08-30T17:38:24+08:00</updated>
  <id>http://leetschau.github.io/</id>
  <author>
    <name><![CDATA[Li Chao]]></name>
    <email><![CDATA[leetschau@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Add Security Mark for Many Excel Files]]></title>
    <link href="http://leetschau.github.io/blog/2014/07/08/144818/"/>
    <updated>2014-07-08T14:48:18+08:00</updated>
    <id>http://leetschau.github.io/blog/2014/07/08/144818</id>
    <content type="html"><![CDATA[<h1>Build macro for batch manipulate Excel Files</h1>

<p>Now I have to add a security mark for many many excel files. I use the following the following VBA codes to achieve this.</p>

<ol>
<li><p>Run Excel 2010, save the new blank file as &ldquo;Excel Macro-Enabled Workbook&rdquo;, named &ldquo;AddMark.xlsm&rdquo; (via [File -> Save as]);</p></li>
<li><p>Open &ldquo;Developer&rdquo; ribbon: [File -> Options -> Customize ribbon], check &ldquo;Developer&rdquo; in right panel, press &ldquo;OK&rdquo; to close the dialog, you can see &ldquo;Developer&rdquo; ribbon now;</p></li>
<li><p>In &ldquo;developer&rdquo; ribbon, click &ldquo;Visual Basic&rdquo; to open the VBA IDE (or use shortcut &ldquo;Alt-F11&rdquo;);</p></li>
<li><p>In visual basic IDE, add &ldquo;Microsoft Scripting Run-time&rdquo; and &ldquo;Microsoft Scriptlet Library&rdquo; in [Tools -> References] of main menu;</p></li>
<li><p>Add the following codes to [VBAProject -> Microsoft Excel Objects -> This Workbook]:</p>

<p> Option Explicit
 Sub InsertMark2Excels()
     Dim fso As New FileSystemObject
     Dim folder As Object
     Set folder = fso.GetFolder(ActiveWorkbook.Path)
     LoopFolder folder
     Call WriteLog(&ldquo;Creation Date: &rdquo; &amp; Now)
     Call WriteLog(&ldquo;Log over.&rdquo;)
 End Sub
 Sub LoopFolder(FF As Scripting.folder)
     Dim F As Scripting.File
     Dim SubF As Scripting.folder
     Dim fso As New FileSystemObject
     For Each F In FF.Files
         Dim fext As String
         fext = fso.GetExtensionName(F)
         If fext = &ldquo;xls&rdquo; Or fext = &ldquo;xlsx&rdquo; Then
             InsertMark F.Path
         End If
     Next F
     For Each SubF In FF.SubFolders
         LoopFolder SubF
     Next SubF
 End Sub
 Sub InsertMark(target As String)
     Workbooks.Open target
     ActiveWorkbook.Sheets(1).Activate
     ActiveWorkbook.Sheets(1).Rows(&ldquo;1:1&rdquo;).Select
     Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
     Range(&ldquo;A1&rdquo;).Select
     ActiveCell.FormulaR1C1 = &ldquo;保密&rdquo;
     ActiveWorkbook.Save
     ActiveWorkbook.Close
     Call WriteLog(&ldquo;Insert mark to &rdquo; &amp; target)
 End Sub
 Sub WriteLog(log As String)
     Open ActiveWorkbook.Path &amp; &ldquo;\insertmark.log&rdquo; For Append As #1
     Print #1, log
     Close #1
 End Sub</p></li>
<li><p>Add shortcut for macro &ldquo;InsertMark2Excels&rdquo;: in ribbon Developer -> Macro, then click &ldquo;Options&rdquo;, assign Ctrl-d to this macro;</p></li>
</ol>


<p>Now you can copy AddMark.xlsm to another host, open this file, press Ctrl-d to run the macro.</p>

<h1>Open Office Macro in LibreOffice</h1>

<ol>
<li><p>Open xlsm file with LibreOffice Calc, or simply <code>thunar filename.xlsm</code>;</p></li>
<li><p>Tools -> Macros -> Organize Macros -> LibreOffice Basic, select [AddMark.xlsm -> VBA Project -> Document Objects -> ThisWorkbook] in &ldquo;Macro from&rdquo;, then select a macro in &ldquo;Existing macros&rdquo;, then click &ldquo;Edit&rdquo; button.</p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Manipulate Word and Excel Files in a Folder]]></title>
    <link href="http://leetschau.github.io/blog/2014/07/03/185755/"/>
    <updated>2014-07-03T18:57:55+08:00</updated>
    <id>http://leetschau.github.io/blog/2014/07/03/185755</id>
    <content type="html"><![CDATA[<p>Ref:
<a href="http://excelexperts.com/VBA-Tips-List-Files-In-A-Folder">21. VBA Tips - List Files In A Folder</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[加班时间汇总算法]]></title>
    <link href="http://leetschau.github.io/blog/2013/01/07/164935/"/>
    <updated>2013-01-07T16:49:35+08:00</updated>
    <id>http://leetschau.github.io/blog/2013/01/07/164935</id>
    <content type="html"><![CDATA[<p>加班时间原始记录在一个excel文件里，每个月的加班时间在一个sheet里，共12个sheet，第13个sheet里存放12个月加班时间的和，如下图所示：</p>

<p>原始记录页： 汇总页：</p>

<p>这里要处理的情况是：原始记录中有些名字是汇总表里没有的，所以不是所有原始记录都被写到汇总中，另外原始记录中有空行。</p>

<p>汇总的VBA算法首先遍历前12个sheet，将结果放在一个名为total的Set中（类似于Java中的map，key-value组成的集合），如果没有此人名字，则创建，若已有，则累加，然后遍历最后一个sheet，其中的每一个名字从total里找对应的值填在表格里：</p>

<p> Sub OTSum()
  Dim Month
  Month = 12
  Set Total = CreateObject(&ldquo;Scripting.Dictionary&rdquo;)
  For shidx = 1 To Month
   rowcnt = Worksheets(shidx).UsedRange.Rows.Count
   For rowidx = 1 To rowcnt
    empname = Worksheets(shidx).Cells(rowidx, 1).Value
    jbTime = Worksheets(shidx).Cells(rowidx, 2).Value
    If Total.exists(empname) Then
     Total.Item(empname) = Total.Item(empname) + jbTime
    Else: Total.Add empname, jbTime
    End If
   Next
  Next
  rowcnt = Worksheets(Month + 1).UsedRange.Rows.Count
  For rowidx = 1 To rowcnt
   empname = Worksheets(Month + 1).Cells(rowidx, 1).Value
   If Total.exists(empname) Then
    Worksheets(Month + 1).Cells(rowidx, 2) = Total.Item(empname)
   End If
  Next
 End Sub</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[破解Excel文件打开密码]]></title>
    <link href="http://leetschau.github.io/blog/2011/09/09/102328/"/>
    <updated>2011-09-09T10:23:28+08:00</updated>
    <id>http://leetschau.github.io/blog/2011/09/09/102328</id>
    <content type="html"><![CDATA[<p>使用了Passware Password Recovery Kit Enterprise(v10.3.2585)，这个软件的优点是能够破解多种密码，CPU占有率低，上手快，易于制定密码规则。</p>
]]></content>
  </entry>
  
</feed>
