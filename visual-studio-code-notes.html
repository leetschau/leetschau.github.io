<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Li Chao" />
        <meta name="copyright" content="Li Chao" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="vsc, Tech, " />

<meta property="og:title" content="Visual Studio Code Notes "/>
<meta property="og:url" content="http://leetschau.github.io/visual-studio-code-notes.html" />
<meta property="og:description" content="VSC 是一个很好实现了 editor + terminal 模式的文本编辑器： editor 和 terminal 被整合到了同一个环境中， 通过 workbench.action.terminal.runSelectedText 命令把文本发送到 terminal 里； 通过快捷键方便地在二者间一步跳转，不需要像 nvim terminal 那样在 insert 模式下执行命令， 用 Ctrl-\ Ctrl-n 切换到 normal 模式才能转换到 editor； terminal 直接使用操作系统的 terminal emulator 应用， 可以使用所有系统命令快捷键（例如 fzf 的命令行历史，autojump 的跳转等）； 详细的 terminal 配置，提供了大量 terminal 相关的命令可以绑定快捷键， 详细列表在系统快捷键定义文件（Command …" />
<meta property="og:site_name" content="DarkMatter in Cyberspace" />
<meta property="og:article:author" content="Li Chao" />
<meta property="og:article:published_time" content="2018-10-01T10:02:52+08:00" />
<meta property="" content="2018-11-07T17:47:37+08:00" />
<meta name="twitter:title" content="Visual Studio Code Notes ">
<meta name="twitter:description" content="VSC 是一个很好实现了 editor + terminal 模式的文本编辑器： editor 和 terminal 被整合到了同一个环境中， 通过 workbench.action.terminal.runSelectedText 命令把文本发送到 terminal 里； 通过快捷键方便地在二者间一步跳转，不需要像 nvim terminal 那样在 insert 模式下执行命令， 用 Ctrl-\ Ctrl-n 切换到 normal 模式才能转换到 editor； terminal 直接使用操作系统的 terminal emulator 应用， 可以使用所有系统命令快捷键（例如 fzf 的命令行历史，autojump 的跳转等）； 详细的 terminal 配置，提供了大量 terminal 相关的命令可以绑定快捷键， 详细列表在系统快捷键定义文件（Command …">

        <title>Visual Studio Code Notes  · DarkMatter in Cyberspace
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://leetschau.github.io/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://leetschau.github.io/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://leetschau.github.io/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://leetschau.github.io/theme/css/custom.css" media="screen">
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://leetschau.github.io/"><span class=site-name>DarkMatter in Cyberspace</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://leetschau.github.io">Home</a></li>
                            <li ><a href="http://leetschau.github.io/categories.html">Categories</a></li>
                            <li ><a href="http://leetschau.github.io/tags.html">Tags</a></li>
                            <li ><a href="http://leetschau.github.io/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://leetschau.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="http://leetschau.github.io/visual-studio-code-notes.html"> Visual Studio Code Notes  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            <hr>
<p>VSC 是一个很好实现了 editor + terminal 模式的文本编辑器：</p>
<ul>
<li>
<p>editor 和 terminal 被整合到了同一个环境中，
  通过 <em>workbench.action.terminal.runSelectedText</em> 命令把文本发送到 terminal 里；</p>
</li>
<li>
<p>通过快捷键方便地在二者间一步跳转，不需要像 nvim terminal 那样在 insert 模式下执行命令，
  用 <em>Ctrl-\ Ctrl-n</em> 切换到 normal 模式才能转换到 editor；</p>
</li>
<li>
<p>terminal 直接使用操作系统的 terminal emulator 应用，
  可以使用所有系统命令快捷键（例如 fzf 的命令行历史，autojump 的跳转等）；</p>
</li>
<li>
<p>详细的 terminal 配置，提供了大量 terminal 相关的命令可以绑定快捷键，
  详细列表在系统快捷键定义文件（Command Palette 里搜索 <code>keyboard shortcuts</code>）
  里搜索 <code>workbench.action.terminal.*</code>;</p>
</li>
<li>
<p>基于文件的配置：全局配置和用户配置分离，主要的用户配置文件都在
  <em>~/.config/Code/User</em> 目录下，例如 keybindings.json 和 settings.json;</p>
</li>
<li>
<p>全局模糊匹配的 <strong>Command Palette</strong> (<code>Ctrl-Shift-p</code>)，
  很多使用频率不太高的命令不必定义快捷键也能通过键盘快速操作，
  不需要通过鼠标点击菜单完成；</p>
</li>
<li>
<p>与 neovim 深度整合（<a href="https://github.com/VSCodeVim/Vim">VSCodeVim/Vim</a> 
  插件正是 neovim <a href="https://github.com/neovim/neovim/wiki/Related-projects#gui">GUI 列表</a>
  中 VSC 的实现），vim mode 体验不错，很多 vim 插件也被移植到了 vsc-vim 上
  （例如 easy-motion）；</p>
</li>
<li>
<p>基于 electron 框架，可以方便地使用 JavaScript/TypeScript 开发插件；</p>
</li>
</ul>
<h1>Install</h1>
<p>Always install VSC with the deb file from its <a href="https://code.visualstudio.com/">official website</a>.</p>
<p>不要通过 <em>flatpak</em> 安装 VSC。flatpak 在沙箱中运行应用，应用环境与
用户环境隔离，所以适合运行微信等不依赖外界环境的应用，而 VSC 与系统终端深度整合，
通过 $SHELL 环境变量确定启动 shell 的种类和方式，而 flatpak sandbox 中 $SHELL
只能是 <em>/bin/sh</em>，无法改变。</p>
<p>P.S.: the configuration files above are in folder <em>~/.var/app/com.visualstudio.code/config/Code/User</em>
when installed with flatpak.</p>
<p>See <a href="https://marketplace.visualstudio.com/items?itemName=vscodevim.vim">vscodevim</a>
for more customization examples.</p>
<p>Install <em>Vim</em> extension in the <em>Extensions</em> bar (show with <em>ctrl-shift-x</em>,
hide with <em>ctrl-b</em>).</p>
<h1>Configuration</h1>
<p>Add the following codes in <em>~/.config/Code/User/keybindings.json</em> to
enable Capslock-ESC swap and <em>Ctrl-j</em> to jump between editor and console:</p>
<div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="err">{</span>
        <span class="ss">&quot;key&quot;</span><span class="p">:</span> <span class="ss">&quot;capslock&quot;</span><span class="p">,</span>
        <span class="ss">&quot;command&quot;</span><span class="p">:</span> <span class="ss">&quot;extension.vim_escape&quot;</span><span class="p">,</span>
        <span class="ss">&quot;when&quot;</span><span class="p">:</span> <span class="ss">&quot;editorTextFocus &amp;&amp; vim.active &amp;&amp; !inDebugRepl&quot;</span>
    <span class="err">}</span><span class="p">,</span>
    <span class="err">{</span>
        <span class="ss">&quot;key&quot;</span><span class="p">:</span> <span class="ss">&quot;ctrl+enter&quot;</span><span class="p">,</span>
        <span class="ss">&quot;command&quot;</span><span class="p">:</span> <span class="ss">&quot;workbench.action.terminal.runSelectedText&quot;</span>
    <span class="err">}</span><span class="p">,</span>
    <span class="err">{</span> <span class="ss">&quot;key&quot;</span><span class="p">:</span> <span class="ss">&quot;alt+j&quot;</span><span class="p">,</span> <span class="ss">&quot;command&quot;</span><span class="p">:</span> <span class="ss">&quot;workbench.action.terminal.focus&quot;</span><span class="err">}</span><span class="p">,</span>
    <span class="err">{</span> <span class="ss">&quot;key&quot;</span><span class="p">:</span> <span class="ss">&quot;alt+j&quot;</span><span class="p">,</span> <span class="ss">&quot;command&quot;</span><span class="p">:</span> <span class="ss">&quot;workbench.action.focusActiveEditorGroup&quot;</span><span class="p">,</span> <span class="ss">&quot;when&quot;</span><span class="p">:</span> <span class="ss">&quot;terminalFocus&quot;</span><span class="err">}</span>
<span class="p">]</span>
</pre></div>


<p>The <code>capslock</code> block above is a workaround for <a href="https://github.com/Microsoft/vscode/issues/23991">bug #23991</a>.</p>
<p>When in i3wm, change <em>alt+j</em> to <em>alt+m</em> for avoiding shortcut confliction.</p>
<p>Add the following codes in <em>~/.config/Code/User/settings.json</em> to customize
proxy and vim extension:</p>
<div class="highlight"><pre><span></span><span class="err">{</span>
    <span class="ss">&quot;http.proxy&quot;</span><span class="p">:</span> <span class="ss">&quot;http://localhost:1080&quot;</span><span class="p">,</span>
    <span class="ss">&quot;vim.easymotion&quot;</span><span class="p">:</span> <span class="k">true</span><span class="p">,</span>
    <span class="ss">&quot;vim.useSystemClipboard&quot;</span><span class="p">:</span> <span class="k">true</span><span class="p">,</span>
    <span class="ss">&quot;vim.normalModeKeyBindingsNonRecursive&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="err">{</span>
            <span class="ss">&quot;before&quot;</span><span class="p">:</span> <span class="p">[</span><span class="ss">&quot;;&quot;</span><span class="p">],</span>
            <span class="ss">&quot;after&quot;</span><span class="p">:</span> <span class="p">[</span><span class="ss">&quot;:&quot;</span><span class="p">]</span>
        <span class="err">}</span>
    <span class="p">],</span>
    <span class="p">...</span>
<span class="err">}</span>
</pre></div>


<h1>Auto completion</h1>
<p>推荐 <a href="https://marketplace.visualstudio.com/items?itemName=Atishay-Jain.All-Autocomplete">All Autocomplete</a>
插件，翻译 FPP 过程中使用它对中英文的自动补全都很不错。</p>
<h1>Auto Switch of Input Method</h1>
<p>在Linux系统上，使用 fcitx 输入法时，首先确定是否可以用 <code>fcitx-remote -t</code>
切换输入法，若能正确切换，在输入法关闭的情况下执行 <code>fcitx-remote</code>，
得到的结果（应该是1）作为下面 "vim.autoSwitchInputMethod.defaultIM" 的值：</p>
<div class="highlight"><pre><span></span><span class="err">{</span>
    <span class="ss">&quot;vim.autoSwitchInputMethod.enable&quot;</span><span class="p">:</span> <span class="k">true</span><span class="p">,</span>
    <span class="ss">&quot;vim.autoSwitchInputMethod.defaultIM&quot;</span><span class="p">:</span> <span class="ss">&quot;1&quot;</span><span class="p">,</span>
    <span class="ss">&quot;vim.autoSwitchInputMethod.obtainIMCmd&quot;</span><span class="p">:</span> <span class="ss">&quot;/usr/bin/fcitx-remote&quot;</span><span class="p">,</span>
    <span class="ss">&quot;vim.autoSwitchInputMethod.switchIMCmd&quot;</span><span class="p">:</span> <span class="ss">&quot;/usr/bin/fcitx-remote -t {im}&quot;</span><span class="p">,</span>
    <span class="p">...</span>
<span class="err">}</span>
</pre></div>


<p>这样当使用 ESC 返回 normal 模式时，VSC 将自动关闭输入法。</p>
<p>另外 fcitx 还提供了 <code>fcitx-remote -c</code> 关闭输入法，
<code>fcitx-remote -o</code> 开启输入法，通过它们可以实现 vim 中自动切换输入法。</p>
<p>在 Windows 系统上使用 VSC 时，可以通过 <a href="https://github.com/daipeihust/im-select">im-select</a>
实现输入法自动切换，首先下载 im-select.exe 64位版本到 d:/apps/im-select目录下，
然后在 C:\Users\lee_c\AppData\Roaming\Code\User\settings.json 文件中加入如下内容：</p>
<div class="highlight"><pre><span></span><span class="err">{</span>
  <span class="p">...</span>
    <span class="ss">&quot;vim.autoSwitchInputMethod.enable&quot;</span><span class="p">:</span> <span class="k">true</span><span class="p">,</span>
    <span class="ss">&quot;vim.autoSwitchInputMethod.defaultIM&quot;</span><span class="p">:</span> <span class="ss">&quot;1033&quot;</span><span class="p">,</span>
    <span class="ss">&quot;vim.autoSwitchInputMethod.obtainIMCmd&quot;</span><span class="p">:</span> <span class="ss">&quot;d:/apps/im-select/im-select.exe&quot;</span><span class="p">,</span>
    <span class="ss">&quot;vim.autoSwitchInputMethod.switchIMCmd&quot;</span><span class="p">:</span> <span class="ss">&quot;d:/apps/im-select/im-select.exe {im}&quot;</span>
<span class="err">}</span>
</pre></div>


<p>这里 1033 是当关闭输入法时， 在 git bash （im-select 无法在 Windows cmd.exe
中运行）里执行 im-select 得到的返回值。
当中文输入法开启时，返回值为 2052.</p>
<p>详细方法参考 <a href="https://github.com/VSCodeVim/Vim#input-method">section "Input Method" in VSCodeVim</a>.</p>
<h1>Frequently Used Actions</h1>
<ul>
<li>
<p>Zoom in/out in editor: <em>Ctrl +/-</em>;</p>
</li>
<li>
<p>Show/hide terminal: Ctrl-backslash;</p>
</li>
<li>
<p>Open command palette: <em>Ctrl-Shift-p</em>, for example you can specify the Python
  interpreter via inputing <code>interpreter</code> in the command window;</p>
</li>
<li>
<p>Open a folder (as the project root): <em>Ctrl-k Ctrl-o</em>, VSC create
  a <em>.vscode</em> folder in it, and save workspace settings (for example,
  Python Interpreter path) in <em>.vscode/settings.json</em> file.</p>
</li>
<li>
<p>Jump between opened files: Ctrl-p;</p>
</li>
<li>
<p>Jump between editors in the same group: <em>Ctrl-tab</em>;</p>
</li>
<li>
<p>Jump between editor groups: <em>Ctrl-1/2/3/...</em>;</p>
</li>
<li>
<p>Find keyboard shortcuts of a command: 
  <em>Ctrl-Shift-p</em> &gt; <code>open keyboard shortcuts file</code>.
  Then the file <em>Default Keybindings</em> is opened, search in it with
  the action name, for example, <code>editorgroup\c</code> to find all command
  and corresponing shortcuts;</p>
</li>
</ul>
<h1>Markdown Preview</h1>
<p>Install extension "Markdown All in One" for VSC.
After opening a markdown file, split the window, and put it in a new editor group.
Thus when you edit the markdown file in the left window,
the preview in the right window will change accordingly.</p>
<p>Ref:</p>
<ul>
<li><a href="https://code.visualstudio.com/docs/getstarted/userinterface">User Interface</a></li>
</ul>
<h1>Define Macros</h1>
<p>In haskell repl, you need put multiline codes between <code>:{</code> and <code>:}</code>.
So I defined the following macros to automate this workflow.</p>
<p>First install <a href="https://marketplace.visualstudio.com/items?itemName=ryuta46.multi-command">multi-command</a>
pulgin. Then add the following codes into settings.json:</p>
<div class="highlight"><pre><span></span>    <span class="ss">&quot;multiCommand.commands&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="err">{</span>
            <span class="ss">&quot;command&quot;</span><span class="p">:</span> <span class="ss">&quot;multiCommand.runHaskellCode&quot;</span><span class="p">,</span>
            <span class="ss">&quot;interval&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
            <span class="ss">&quot;sequence&quot;</span><span class="p">:</span> <span class="p">[</span>
              <span class="err">{</span>
                <span class="ss">&quot;command&quot;</span><span class="p">:</span> <span class="ss">&quot;workbench.action.terminal.sendSequence&quot;</span><span class="p">,</span>
                <span class="ss">&quot;args&quot;</span><span class="p">:</span> <span class="err">{</span> <span class="ss">&quot;text&quot;</span><span class="p">:</span> <span class="ss">&quot;:{\u000d&quot;</span> <span class="err">}</span>
              <span class="err">}</span><span class="p">,</span>
              <span class="ss">&quot;workbench.action.terminal.runSelectedText&quot;</span><span class="p">,</span>
              <span class="err">{</span>
                <span class="ss">&quot;command&quot;</span><span class="p">:</span> <span class="ss">&quot;workbench.action.terminal.sendSequence&quot;</span><span class="p">,</span>
                <span class="ss">&quot;args&quot;</span><span class="p">:</span> <span class="err">{</span> <span class="ss">&quot;text&quot;</span><span class="p">:</span> <span class="ss">&quot;:}\u000d&quot;</span> <span class="err">}</span>
              <span class="err">}</span>
            <span class="p">]</span>
        <span class="err">}</span>
    <span class="p">]</span>
</pre></div>


<p>Add the following codes in keybindings.json:</p>
<div class="highlight"><pre><span></span>    <span class="err">{</span>
        <span class="ss">&quot;key&quot;</span><span class="p">:</span> <span class="ss">&quot;ctrl+enter&quot;</span><span class="p">,</span>
        <span class="ss">&quot;command&quot;</span><span class="p">:</span> <span class="ss">&quot;workbench.action.terminal.runSelectedText&quot;</span><span class="p">,</span>
        <span class="ss">&quot;when&quot;</span><span class="p">:</span> <span class="ss">&quot;editorTextFocus &amp;&amp; editorLangId != haskell&quot;</span>
    <span class="err">}</span><span class="p">,</span>
    <span class="err">{</span>
        <span class="ss">&quot;key&quot;</span><span class="p">:</span> <span class="ss">&quot;ctrl+enter&quot;</span><span class="p">,</span>
        <span class="ss">&quot;command&quot;</span><span class="p">:</span> <span class="ss">&quot;multiCommand.runHaskellCode&quot;</span><span class="p">,</span>
        <span class="ss">&quot;when&quot;</span><span class="p">:</span> <span class="ss">&quot;editorTextFocus &amp;&amp; editorLangId == haskell&quot;</span>
    <span class="err">}</span><span class="p">,</span>
</pre></div>


<p>Note <code>\u000d</code> above means the Enter key, see section <em>Send text from a keybinding</em> in
<a href="https://code.visualstudio.com/docs/editor/integrated-terminal#_send-text-from-a-keybinding">Send text from a keybinding</a>
for details.</p>
<p>There is also a <a href="https://marketplace.visualstudio.com/items?itemName=geddski.macros">macros</a>
plugin to build macros.
But it cann't <a href="https://github.com/geddski/macros/issues/41#issuecomment-430862997">keep the command sequence correctly</a>.</p>
<h1>View documention on hover for Haskell</h1>
<p>To show type information and documentation on mouse hover in VS Code,
install <a href="https://github.com/haskell/haskell-ide-engine">HIE</a> and
<a href="https://marketplace.visualstudio.com/items?itemName=alanz.vscode-hie-server">Haskell Language Server</a>:</p>
<div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">haskell</span><span class="o">/</span><span class="n">haskell</span><span class="o">-</span><span class="n">ide</span><span class="o">-</span><span class="n">engine</span> <span class="c1">--recursive</span>
<span class="n">cd</span> <span class="n">haskell</span><span class="o">-</span><span class="n">ide</span><span class="o">-</span><span class="n">engine</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">build</span><span class="o">-</span><span class="k">all</span>
</pre></div>


<p>This took 4~5 hours to finish (in the office of biot, 2018.11.7), with about 400MB contents downloaded and
some from s3.amazon.com. So you must run this command with proxy.
The final size of the folder <em>haskell-ide-engine</em> is about 6GB.
You can delete this folder after installation (there are several <code>hie-*</code> executables
in the <em>~/.local/bin</em> foler).</p>
<p>Then open VS Code, install the <em>Haskell Language Server</em> extension and reload.</p>
<p>Now you can see the documentations of any functions, types or variables
with mouse hover.</p>
            
            
            <hr/>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2018-10-01T10:02:52+08:00">Oct 1, 2018</time>

<h4>Last Updated</h4>
<time datetime="2018-11-07T17:47:37+08:00">Nov 7, 2018</time>

            <h4>Category</h4>
            <a class="category-link" href="http://leetschau.github.io/categories.html#tech-ref">Tech</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="http://leetschau.github.io/tags.html#vsc-ref">vsc
                    <span>2</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="#" title="My You can add links in your config file Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-you can add links in your config file sidebar-social-links"></i></a>
    <a href="#" title="My Another social link Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-another social link sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>