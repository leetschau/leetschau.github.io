<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Li Chao" />
        <meta name="copyright" content="Li Chao" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="hylang, python, lisp, Tech, " />

<meta property="og:title" content="Hy Notes"/>
<meta property="og:url" content="http://leetschau.github.io/hy-notes.html" />
<meta property="og:description" content="Install Hy 是一个编译为 Python 的 Lisp 方言， 类似于 Clojure 之于 JVM。 目前 conda 4.5.12 上的 Hy 版本为 0.9.12，只支持 Python 2.7， 所以需要用 pip 直接从 github 上安装： $ conda create -n hylang python=3.6 $ . activate hylang $ pip install git+https://github.com/hylang/hy.git $ hy …" />
<meta property="og:site_name" content="DarkMatter in Cyberspace" />
<meta property="og:article:author" content="Li Chao" />
<meta property="og:article:published_time" content="2019-01-15T16:04:10+08:00" />
<meta property="" content="2020-01-23T08:12:12+08:00" />
<meta name="twitter:title" content="Hy Notes">
<meta name="twitter:description" content="Install Hy 是一个编译为 Python 的 Lisp 方言， 类似于 Clojure 之于 JVM。 目前 conda 4.5.12 上的 Hy 版本为 0.9.12，只支持 Python 2.7， 所以需要用 pip 直接从 github 上安装： $ conda create -n hylang python=3.6 $ . activate hylang $ pip install git+https://github.com/hylang/hy.git $ hy …">

        <title>Hy Notes · DarkMatter in Cyberspace
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://leetschau.github.io/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://leetschau.github.io/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://leetschau.github.io/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://leetschau.github.io/theme/css/custom.css" media="screen">
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://leetschau.github.io/"><span class=site-name>DarkMatter in Cyberspace</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://leetschau.github.io">Home</a></li>
                            <li ><a href="http://leetschau.github.io/categories.html">Categories</a></li>
                            <li ><a href="http://leetschau.github.io/tags.html">Tags</a></li>
                            <li ><a href="http://leetschau.github.io/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://leetschau.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="http://leetschau.github.io/hy-notes.html"> Hy Notes </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            <hr>
<h1>Install</h1>
<p><a href="https://github.com/hylang/hy">Hy</a> 是一个编译为 Python 的 Lisp 方言，
类似于 Clojure 之于 JVM。
目前 conda 4.5.12 上的 Hy 版本为 0.9.12，只支持 Python 2.7，
所以需要用 pip 直接从 github 上安装：</p>
<div class="highlight"><pre><span></span><code>$ conda create -n hylang <span class="nv">python</span><span class="o">=</span><span class="m">3</span>.6
$ . activate hylang
$ pip install git+https://github.com/hylang/hy.git
$ hy
hy <span class="m">0</span>.15.0+64.ga42e17a using CPython<span class="o">(</span>default<span class="o">)</span> <span class="m">3</span>.6.8 on <span class="nv">Linux</span>
<span class="o">=</span>&gt; <span class="o">(</span>print <span class="s2">&quot;hello world&quot;</span><span class="o">)</span>
hello world
</code></pre></div>


<p>升级方法是再次运行 <code>pip install git+https://github.com/hylang/hy.git</code>，
不需要先卸载已经安装的包，参考
<a href="https://stackoverflow.com/questions/17710947/pip-pulling-updates-from-remote-git-repository">pip: pulling updates from remote git repository</a>.</p>
<p>更好的方法是在 IPython console 中使用 Hy
（借助 Jupyter kernel <a href="https://github.com/Calysto/calysto_hy">Calysto/calysto_hy</a>）:</p>
<div class="highlight"><pre><span></span><code><span class="err">conda create -n piphy python=3.6</span>
<span class="err">. activate piphy</span>
<span class="err">pip install jupyter</span>
<span class="err">pip install git+https://github.com/ekaschalk/jedhy.git</span>
<span class="err">pip install git+https://github.com/Calysto/calysto_hy.git</span>
<span class="err">python -m calysto_hy install --sys-prefix</span>
<span class="err">ipython console --kernel calysto_hy</span>
<span class="err">&gt;&gt;&gt; (-&gt; &quot;abc&quot; (.split &quot;b&quot;) (. [1]) (print))</span>
</code></pre></div>


<h1><code>spy</code> 模式</h1>
<p>Hy 的 <code>spy</code> 模式打印出转换后的 Python代码再执行：</p>
<div class="highlight"><pre><span></span><code>$ hy --spy
<span class="o">=</span>&gt; <span class="o">(</span>setv result <span class="o">(</span>- <span class="o">(</span>/ <span class="o">(</span>+ <span class="m">1</span> <span class="m">3</span> <span class="m">88</span><span class="o">)</span> <span class="m">2</span><span class="o">)</span> <span class="m">8</span><span class="o">))</span>
<span class="nv">result</span> <span class="o">=</span> <span class="o">(</span><span class="m">1</span> + <span class="m">3</span> + <span class="m">88</span><span class="o">)</span> / <span class="m">2</span> - <span class="m">8</span>
<span class="nv">None</span>

<span class="o">=</span>&gt; <span class="o">(</span>setv r2 <span class="o">(</span>- <span class="o">(</span>/ <span class="m">92</span> <span class="m">2</span><span class="o">)</span> <span class="m">8</span><span class="o">))</span>
<span class="nv">r2</span> <span class="o">=</span> <span class="m">92</span> / <span class="m">2</span> - <span class="m">8</span>
<span class="nv">None</span>

<span class="o">=</span>&gt; <span class="o">(</span>+ result r2<span class="o">)</span>
result + r2

<span class="m">76</span>.0
</code></pre></div>


<h1>基本语法</h1>
<p>字符串必须使用双引号，但可以包含回车符。
单引号表示 quote，即阻止求值。</p>
<p>常用数据类型写法：</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span> <span class="n">hy</span> <span class="o">--</span><span class="n">spy</span>
<span class="o">=&gt;</span> <span class="p">(</span><span class="n">setv</span> <span class="n">list1</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">])</span> <span class="p">;</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">a</span> <span class="nb">list</span>
<span class="n">list1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="bp">None</span>

<span class="o">=&gt;</span> <span class="p">(</span><span class="n">setv</span> <span class="n">dict1</span> <span class="p">{:</span><span class="n">a</span> <span class="mi">1</span> <span class="p">:</span><span class="n">b</span> <span class="mi">2</span><span class="p">})</span> <span class="p">;</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">a</span> <span class="nb">dict</span>
<span class="kn">from</span> <span class="nn">hy</span> <span class="kn">import</span> <span class="n">HyKeyword</span>
<span class="n">dict1</span> <span class="o">=</span> <span class="p">{</span><span class="n">HyKeyword</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="n">HyKeyword</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">):</span> <span class="mi">2</span><span class="p">}</span>
<span class="bp">None</span>

<span class="o">=&gt;</span> <span class="p">(</span><span class="n">setv</span> <span class="n">set1</span> <span class="c1">#{1 2 3}) ; this is a set</span>
<span class="n">set1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
<span class="bp">None</span>
</code></pre></div>


<p>访问对象的属性（缺点是属性名称只能写死）：</p>
<div class="highlight"><pre><span></span><code><span class="o">=&gt;</span> <span class="p">(.</span> <span class="n">df1</span> <span class="n">shape</span><span class="p">)</span>
<span class="n">df1</span><span class="p">.</span><span class="n">shape</span>

<span class="p">(</span><span class="mi">10980</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div>


<p>访问 DataFrame 某列：</p>
<div class="highlight"><pre><span></span><code><span class="o">=&gt;</span> <span class="p">(.</span> <span class="n">probes</span> <span class="p">[</span><span class="ss">&quot;fullDesc&quot;</span><span class="p">])</span> <span class="p">;</span> <span class="k">or</span> <span class="p">(</span><span class="k">get</span> <span class="n">probes</span> <span class="ss">&quot;fullDesc&quot;</span><span class="p">)</span>
<span class="n">probes</span><span class="p">[</span><span class="s1">&#39;fullDesc&#39;</span><span class="p">]</span>

<span class="mi">0</span>    <span class="mi">1000611</span><span class="o">-</span><span class="n">SYGD</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>
<span class="mi">1</span>    <span class="mi">1000612</span><span class="o">-</span><span class="n">SYGD</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>
<span class="mi">2</span>    <span class="mi">1000613</span><span class="o">-</span><span class="n">SYGD</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>
<span class="mi">3</span>    <span class="mi">1000614</span><span class="o">-</span><span class="n">SYGD</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>
<span class="mi">4</span>    <span class="mi">1000615</span><span class="o">-</span><span class="n">SYGD</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>
</code></pre></div>


<p>访问复合属性的一个元素：</p>
<div class="highlight"><pre><span></span><code><span class="err">=&gt; (. df loc [(&gt; (. df [0]) 2)])</span>
<span class="err">df.loc[df[0] &gt; 2]</span>
</code></pre></div>


<p>管道操作（更多细节可参考 dsnote "Pipe Operator in Functional Programming Languages"）：</p>
<div class="highlight"><pre><span></span><code><span class="o">=&gt;</span> <span class="p">(</span><span class="o">-&gt;</span> <span class="n">probes</span> <span class="p">(.</span> <span class="p">[</span><span class="ss">&quot;fullDesc&quot;</span><span class="p">])</span> <span class="p">(.</span><span class="n">head</span><span class="p">))</span>
<span class="n">probes</span><span class="p">[</span><span class="s1">&#39;fullDesc&#39;</span><span class="p">].</span><span class="n">head</span><span class="p">()</span>

<span class="mi">0</span>    <span class="mi">1000611</span><span class="o">-</span><span class="n">SYGD</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>
<span class="mi">1</span>    <span class="mi">1000612</span><span class="o">-</span><span class="n">SYGD</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>
<span class="mi">2</span>    <span class="mi">1000613</span><span class="o">-</span><span class="n">SYGD</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>
<span class="mi">3</span>    <span class="mi">1000614</span><span class="o">-</span><span class="n">SYGD</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>
<span class="mi">4</span>    <span class="mi">1000615</span><span class="o">-</span><span class="n">SYGD</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>
</code></pre></div>


<h2>slice 相关</h2>
<p>在 Hy 中使用 Pandas <code>loc</code>, <code>iloc</code> 中括号 + 冒号 语法时可参考如下转换：</p>
<p><code>df.iloc[3:, ::2]</code> 等价于 <code>(. df iloc [(, (slice 3 None) (slice None None 2))])</code></p>
<p><code>df.loc[:, "time"]</code> 等价于 <code>(. df loc [(, (slice None) "time")])</code></p>
<p><code>df.iloc[2, 0]</code> 等价于 <code>(. df iloc [(, 2 0)])</code></p>
<p><code>df[['time', 'value']]</code> 等价于 <code>(. df [["time" "value"]])</code> 或者 <code>(get df ["time" "value"])</code></p>
<p><code>df.loc[:, 'xiaoshi': 'value']</code> 等价于 <code>(. df loc [(, (slice None) (slice "xiaoshi" "value"))])</code></p>
<p><code>df.loc[df.index &gt; 2, :]</code> 等价于 <code>(. df loc [(, (&gt; (. df index) 2) (slice None))])</code>
或者 <code>(. df loc [(&gt; (. df index) 2)] [(slice None)])</code></p>
<p>转换规则包括：</p>
<ul>
<li>
<p>用 <code>[(, a b)]</code> 或者 <code>[a] [b]</code> 代替 <code>[a, b]</code>;</p>
</li>
<li>
<p>用 <code>slice</code> 函数代替冒号，可在 IPython 中通过 <code>slice?</code> 查询此函数 API；</p>
</li>
<li>
<p>用 <code>slice(None)</code> 代替单独的冒号；</p>
</li>
<li>
<p>去掉 list 中的逗号；</p>
</li>
</ul>
<h1>编译为 pyc</h1>
<div class="highlight"><pre><span></span><code><span class="nv">$</span> <span class="nv">cat</span> <span class="nv">&lt;&lt;</span> <span class="nv">EOF</span> <span class="nv">&gt;</span> <span class="nv">demo.hy</span>
<span class="nv">(setv</span> <span class="nv">people</span> <span class="p">[{</span><span class="ss">:name</span> <span class="s">&quot;Alice&quot;</span> <span class="ss">:age</span> <span class="mi">20</span><span class="p">}</span>
              <span class="p">{</span><span class="ss">:name</span> <span class="s">&quot;Bob&quot;</span> <span class="ss">:age</span> <span class="mi">25</span><span class="p">}</span>
              <span class="p">{</span><span class="ss">:name</span> <span class="s">&quot;Charlie&quot;</span> <span class="ss">:age</span> <span class="mi">50</span><span class="p">}</span>
              <span class="p">{</span><span class="ss">:name</span> <span class="s">&quot;Dave&quot;</span> <span class="ss">:age</span> <span class="mi">5</span><span class="p">}]</span><span class="nv">)</span>

<span class="nv">(defn</span> <span class="nv">display-people</span> <span class="p">[</span><span class="nv">people</span> <span class="nb">filter</span><span class="p">]</span>
  <span class="nv">(for</span> <span class="p">[</span><span class="nv">person</span> <span class="nv">people</span><span class="p">]</span> <span class="nv">(if</span> <span class="nv">(filter</span> <span class="nv">person)</span> <span class="nv">(print</span> <span class="nv">(:name</span> <span class="nv">person)))))</span>

<span class="nv">(display-people</span> <span class="nv">people</span> <span class="nv">(fn</span> <span class="p">[</span><span class="nv">person</span><span class="p">]</span> <span class="nv">(&lt;</span> <span class="nv">(:age</span> <span class="nv">person)</span> <span class="mi">25</span><span class="nv">)))</span>

<span class="nv">(defmacro</span> <span class="nv">infix</span> <span class="p">[</span><span class="nv">code</span><span class="p">]</span>
  <span class="nv">(quasiquote</span> <span class="nv">((unquote</span> <span class="nv">(get</span> <span class="nv">code</span> <span class="mi">1</span><span class="nv">))</span>
               <span class="nv">(unquote</span> <span class="nv">(get</span> <span class="nv">code</span> <span class="mi">0</span><span class="nv">))</span>
               <span class="nv">(unquote</span> <span class="nv">(get</span> <span class="nv">code</span> <span class="mi">2</span><span class="nv">)))))</span>

<span class="nv">(print</span> <span class="nv">(infix</span> <span class="nv">(3</span> <span class="nv">*</span> <span class="mi">5</span><span class="nv">)))</span>
<span class="nv">EOF</span>

<span class="nv">$</span> <span class="nv">hy</span> <span class="nv">demo.hy</span>
<span class="nv">$</span> <span class="nv">hyc</span> <span class="nv">demo.hy</span>
</code></pre></div>


<p>关于上面代码中宏定义相关的函数参考
<a href="https://docs.racket-lang.org/reference/quasiquote.html">3.20 Quasiquoting: quasiquote, unquote, and unquote-splicing</a>.</p>
<p>反编译 pyc 文件的方法见 dsnote "Encrypt Python Source Codes" 的 "反编译 pyc" 一节。</p>
<h1>Editor Setup</h1>
<h2>vim</h2>
<p>默认配置下 vim 不识别 .hy 类型文件，为了让 vim 插件在 hy 文件中工作，有以下两种方法：</p>
<ul>
<li>
<p>定义新的文件类型，要求插件对其进行渲染：优点是定义准确，
  缺点是对某些插件无效；</p>
</li>
<li>
<p>将新文件类型映射到已有的某种主流文件类型：优点是适用范围广，
  缺点是必须要有一种非常类似的主流文件类型，而且渲染是按主流语言的，
  对于新语言来说不是特别准确；</p>
</li>
</ul>
<h3>新类型方法</h3>
<p>在 $MYVIMRC 中添加：</p>
<div class="highlight"><pre><span></span><code><span class="err">&quot; Rainbow Parenthesis</span>
<span class="err">au BufRead,BufNewFile *.hy  setfiletype hy</span>
<span class="err">let g:rainbow_active = 1</span>
<span class="err">let g:rainbow_conf = {</span>
<span class="err">\ &#39;ctermfgs&#39;: [&#39;yellow&#39;, &#39;red&#39;, &#39;white&#39;, &#39;green&#39;, &#39;lightblue&#39;, &#39;lightred&#39;, &#39;lightgreen&#39;],</span>
<span class="err">\ &#39;operators&#39;: &#39;_,_&#39;,</span>
<span class="err">\ &#39;parentheses&#39;: [&#39;start=/(/ end=/)/ fold&#39;, &#39;start=/\[/ end=/\]/ fold&#39;, &#39;start=/{/ end=/}/ fold&#39;],</span>
<span class="err">\ &#39;separately&#39;: {</span>
<span class="err">\   &#39;*&#39;: {},</span>
<span class="err">\   &#39;tex&#39;: {</span>
<span class="err">\     &#39;parentheses&#39;: [&#39;start=/(/ end=/)/&#39;, &#39;start=/\[/ end=/\]/&#39;],</span>
<span class="err">\   },</span>
<span class="err">\   &#39;hy&#39;: {</span>
<span class="err">\     &#39;ctermfgs&#39;: [&#39;yellow&#39;, &#39;red&#39;, &#39;white&#39;, &#39;green&#39;, &#39;lightblue&#39;, &#39;lightred&#39;, &#39;darkgreen&#39;],</span>
<span class="err">\   },</span>
<span class="err">\   &#39;vim&#39;: {</span>
<span class="err">\     &#39;parentheses&#39;: [&#39;start=/(/ end=/)/&#39;, &#39;start=/\[/ end=/\]/&#39;, &#39;start=/{/ end=/}/ fold&#39;, &#39;start=/(/ end=/)/ containedin=vimFuncBody&#39;, &#39;start=/\[/ end=/\]/ containedin=vimFuncBody&#39;, &#39;start=/{/ end=/}/ fold containedin=vimFuncBody&#39;],</span>
<span class="err">\   },</span>
<span class="err">\   &#39;html&#39;: {</span>
<span class="err">\     &#39;parentheses&#39;: [&#39;start=/\v\&lt;((area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)[ &gt;])@!\z([-_:a-zA-Z0-9]+)(\s+[-_:a-zA-Z0-9]+(\=(&quot;[^&quot;]*&quot;|&#39;.&quot;&#39;&quot;.&#39;[^&#39;.&quot;&#39;&quot;.&#39;]*&#39;.&quot;&#39;&quot;.&#39;|[^ &#39;.&quot;&#39;&quot;.&#39;&quot;&gt;&lt;=`]*))?)*\&gt;/ end=#&lt;/\z1&gt;# fold&#39;],</span>
<span class="err">\   },</span>
<span class="err">\   &#39;css&#39;: 0,</span>
<span class="err">\ }</span>
<span class="err">\}</span>
<span class="err">Plug &#39;luochen1990/rainbow&#39;</span>
</code></pre></div>


<p>其中文件类型定义参考 <code>:h new-filetype</code>.</p>
<p><code>ctermfgs</code> 表示 Console 中 vim 的颜色定义（gvim 的颜色在 <code>guifgs</code> 中定义），
颜色名称取值来自 <code>:h cterm-colors</code>.</p>
<h4>Automatic closing brackets</h4>
<p>在 $MYVIMRC 中添加：</p>
<div class="highlight"><pre><span></span><code><span class="err">&quot; automatic closing brackets</span>
<span class="err">inoremap &quot; &quot;&quot;&lt;left&gt;</span>
<span class="err">inoremap &#39; &#39;&#39;&lt;left&gt;</span>
<span class="err">inoremap ( ()&lt;left&gt;</span>
<span class="err">inoremap [ []&lt;left&gt;</span>
<span class="err">inoremap { {}&lt;left&gt;</span>
<span class="err">inoremap {&lt;CR&gt; {&lt;CR&gt;}&lt;ESC&gt;O</span>
<span class="err">inoremap {;&lt;CR&gt; {&lt;CR&gt;};&lt;ESC&gt;O</span>
</code></pre></div>


<h3>映射类型方法</h3>
<p>有些插件（例如 <a href="https://github.com/tpope/vim-sexp-mappings-for-regular-people">tpope/vim-sexp-mappings-for-regular-people</a>）
用上面的方法指定类型后依然不生效，可能是插件内部对文件类型做了限制，
这时只能使用文件类型映射，将要处理的类型“伪装”成与它类似的另一个类型，
对于 hy 文件来说映射为 clojure 类型比较好，实现方法是在 $MYVIMRC 中添加：</p>
<div class="highlight"><pre><span></span><code><span class="err">autocmd BufRead,BufNewFile *.hy set filetype=clojure</span>
<span class="err">Plug &#39;tpope/vim-repeat&#39;</span>
<span class="err">Plug &#39;guns/vim-sexp&#39;</span>
<span class="err">Plug &#39;tpope/vim-surround&#39;</span>
<span class="err">Plug &#39;tpope/vim-sexp-mappings-for-regular-people&#39;</span>
</code></pre></div>


<p>这个插件的具体使用方法见 dsnote "Use vim as Clojure Development Environment"，
另外由于它已经包含了括号自动补全，所以上面关于自动补全的配置就不需要了。</p>
<p>上面的 <em>rainbow</em> 插件仍然需要安装。</p>
<h1><code>assoc</code> 特性</h1>
<p>Hy 的 <code>assoc</code> 与 Lisp, Clojure 中的 <code>assoc</code> 不同，<code>(assoc foo bar baz)</code> 被翻译成
<code>foo[bar] = baz</code>，直接改变 <code>foo</code> 本身，而不是保持 <code>foo</code> 不变返回一个新值。
造成这种区别的根本原因在于 Python 不坚持数据的 immutable，
关于这个函数行为的讨论见 <a href="https://github.com/hylang/hy/issues/238">issue 238</a>,
<a href="https://github.com/hylang/hy/issues/1542">Consider making Hy models immutable</a>,
以及 API doc 中 <code>assoc</code> 的 <a href="http://docs.hylang.org/en/stable/language/api.html#assoc">note</a>.</p>
<p>目前的实现虽然不够 immutalbe, 但与 Python 的兼容性比较好，
尤其在数据分析中，如果为一个 DataFrame 添加一列，必须重新生成一个新的 DataFrame，
会导致内存消耗大幅增加。</p>
<p>Ref:</p>
<ul>
<li>
<p><a href="http://docs.hylang.org/en/stable/language/api.html">API 列表</a></p>
</li>
<li>
<p><a href="http://docs.hylang.org/en/stable/style-guide.html#the-tao-of-hy">Style Guide</a></p>
</li>
<li>
<p><a href="https://blog.rescale.com/neural-networks-using-keras-on-rescale-with-hy/">Neural Networks using Keras on Rescale with Hy</a></p>
</li>
<li>
<p><a href="http://kitchingroup.cheme.cmu.edu/blog/2016/03/31/More-on-Hy-and-why-I-think-it-is-a-big-deal/">More on Hy and why I think it is a big deal</a></p>
</li>
<li>
<p><a href="https://github.com/vindarel/languages-that-compile-to-python#hask----haskell-language-features-and-standard-libraries-in-pure-python">languages-that-compile-to-python</a></p>
</li>
<li>
<p><a href="http://www.modernemacs.com/post/mile-hy/">A mile Hy - My experience with lispy Python</a></p>
</li>
</ul>
            
            
            <hr/>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2019-01-15T16:04:10+08:00">Jan 15, 2019</time>

<h4>Last Updated</h4>
<time datetime="2020-01-23T08:12:12+08:00">Jan 23, 2020</time>

            <h4>Category</h4>
            <a class="category-link" href="http://leetschau.github.io/categories.html#tech-ref">Tech</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="http://leetschau.github.io/tags.html#hylang-ref">hylang
                    <span>1</span>
</a></li>
                <li><a href="http://leetschau.github.io/tags.html#lisp-ref">lisp
                    <span>1</span>
</a></li>
                <li><a href="http://leetschau.github.io/tags.html#python-ref">python
                    <span>128</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="#" title="My You can add links in your config file Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-you can add links in your config file sidebar-social-links"></i></a>
    <a href="#" title="My Another social link Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-another social link sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>