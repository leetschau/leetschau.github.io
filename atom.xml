<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Dark Matter in Cyberspace]]></title>
  <link href="http://leetschau.github.io/atom.xml" rel="self"/>
  <link href="http://leetschau.github.io/"/>
  <updated>2015-08-11T14:12:54+08:00</updated>
  <id>http://leetschau.github.io/</id>
  <author>
    <name><![CDATA[Li Chao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Share One Users Collection Between Multiple Meteor Apps]]></title>
    <link href="http://leetschau.github.io/blog/2015/08/11/123934/"/>
    <updated>2015-08-11T12:39:34+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/08/11/123934</id>
    <content type="html"><![CDATA[<p>We are running a website and a backend data management system,
both are meteor web servers.</p>

<p>The backend needs fetch data from the website.
So they have to share one database, and the same &ldquo;users&rdquo; collection for both.
That means one can register on the website and login to the backend,
which is obviously unacceptable.</p>

<p>To distinguish users of the website and the backend,
I choose package <a href="https://github.com/alanning/meteor-roles">alanning/meteor-roles</a>.</p>

<p>All the backend users will have roles <code>['backend', 'admin']</code>,
while website users haven&rsquo;t.</p>

<p>In &ldquo;safe&rdquo; environment, backend has its own user registration entry.
Users registered there will be given above roles automatically.</p>

<p>Put the following codes into server side JavaScript files to achieve above goal
(based on examples/rolesWithAccountsUI on meteor-roles):</p>

<pre><code>var ROLE_NAME = 'editor';
var GROUP_NAME = 'backend';

Meteor.publish('mallData', function(){
  if (Roles.userIsInRole(this.userId, ROLE_NAME, GROUP_NAME)) {
    console.log('pass check');
    return Mall.find();
  } else {
    console.log('not pass check');
    this.stop();
    return;
  }
});

Meteor.startup(function () {
  Accounts.onCreateUser(function (options, user) {
    Roles.setRolesOnUserObj(user, ROLE_NAME, GROUP_NAME);
    if (options.profile) {
      user.profile = options.profile
    }
    return user;
  });
});

Roles.setRolesOnUserObj = function (users, roles, group) {
  if (!users) throw new Error ("Missing 'users' param")
  if (!roles) throw new Error ("Missing 'roles' param")
  if (group) {
    if ('string' !== typeof group)
      throw new Error ("Roles error: Invalid parameter 'group'. Expected 'string' type")
    if ('$' === group[0])
      throw new Error ("Roles error: groups can not start with '$'")

    // convert any periods to underscores
    group = group.replace(/\./g, '_')
  }

  // ensure arrays to simplify code
  if (!_.isArray(users)) users = [users]
  if (!_.isArray(roles)) roles = [roles]


  // remove invalid roles
  roles = _.reduce(roles, function (memo, role) {
    if (role
        &amp;&amp; 'string' === typeof role
        &amp;&amp; role.trim().length &gt; 0) {
      memo.push(role.trim())
    }
    return memo
  }, [])

  // if roles is empty, quit
  if (roles.length === 0) return

  // ensure all roles exist in 'roles' collection
  existingRoles = _.reduce(Meteor.roles.find({}).fetch(), function (memo, role) {
    memo[role.name] = true
    return memo
  }, {})
  _.each(roles, function (role) {
    if (!existingRoles[role]) {
      Roles.createRole(role)
    }
  })

  // ensure users is an array of objects
  _.each(users, function (user) {
    if ('object' !== typeof user) {
      throw new Error("Expected 'users' argument to be an object or array of objects")
    }
  })


  // Set the roles on the actual user object

  if (group) {

    // roles is a key/value dict object

    _.each(users, function (user) {
      user.roles = {}
      user.roles[group] = roles
    })

  } else {

    // roles is an array of strings

    _.each(users, function (user) {
      user.roles = roles
    })

  }

}
</code></pre>

<p>Now any user outside &lsquo;backend&rsquo; group, or without &lsquo;editor&rsquo; role, can&rsquo;t get any data from server.</p>

<p>Unfortunately Internet is unsafe at all.
So the registration entry has to be removed from the accounts-ui:</p>

<pre><code>Meteor.startup(function () {
  Accounts.config({
    forbidClientAccountCreation : true
  });
});
</code></pre>

<p>Now if you want give a website personnel rights to edit data through backend,
first he should register on the website,
then you define his role manually in mongo console:</p>

<pre><code>&gt; db.users.find({ "emails.0.address":"user@123.com" }, { "emails":1 })
&gt; db.users.update({_id: "PM36t6eRmuC9oELdu"}, { $set: { roles: {"backend": [ "editor" ]} } })
</code></pre>

<p>First find the id of the user (here is &ldquo;<a href="&#x6d;&#97;&#x69;&#108;&#x74;&#x6f;&#58;&#x75;&#115;&#101;&#x72;&#x40;&#x31;&#50;&#51;&#x2e;&#x63;&#111;&#109;">&#x75;&#x73;&#101;&#x72;&#64;&#x31;&#x32;&#51;&#x2e;&#99;&#x6f;&#109;</a>&rdquo;) by his email address.
Then add group and roles to the user (say the id of the user is &ldquo;PM36t6eRmuC9oELdu&rdquo;).</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Autopubsh and Insecure Package in Meteor]]></title>
    <link href="http://leetschau.github.io/blog/2015/08/07/155721/"/>
    <updated>2015-08-07T15:57:21+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/08/07/155721</id>
    <content type="html"><![CDATA[<h1>Collection definitions in root directory</h1>

<ol>
<li><p>autopublish package exists: data can be seen and updated;</p></li>
<li><p>Remove autopublish package: data can&rsquo;t be seen;</p></li>
<li><p>Add publish method in server js file, and subscribe methods in client js file:
data can be seen and updated;</p>

<pre><code> # in server:
 Meteor.publish('mallData', function(){
   return Mall.find();
 });

 # in client:
 Meteor.subscribe('mallData');
</code></pre></li>
<li><p>Remove insecure package: data can be seen, but can&rsquo;t be updated;</p></li>
<li><p>Add an allow rule in js file in root directory: only &ldquo;status&rdquo; field can be updated.</p>

<pre><code> Mall.allow({
   update: function(userId, doc, fieldNames, modifier){
     if ((fieldNames.length === 1) &amp;&amp;
         (fieldNames[0] === 'status')){
       return true;
     }
   }
 });
</code></pre>

<p> Meanwhile inserting and remvoing operations will be denied by the server.</p></li>
</ol>


<p>Ref:</p>

<p><a href="http://joshowens.me/meteor-security-101/">METEOR SECURITY 101</a> by Josh Owens.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Meteor实施案例]]></title>
    <link href="http://leetschau.github.io/blog/2015/08/05/125922/"/>
    <updated>2015-08-05T12:59:22+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/08/05/125922</id>
    <content type="html"><![CDATA[<h1>国外</h1>

<p><a href="http://blonk.co/">blonk</a>: 找工作，移动APP，iOS, Android, 双方在感兴趣的对方上点Yes，如果匹配成功开始聊天；</p>

<p><a href="https://respond.ly/">respond.ly</a>: 基于Twitter的客户服务和协作平台；</p>

<p><a href="http://www.flowkey.com/en">Flowkey</a>: 教育类，钢琴在线教学，web, iOS, Android，音频对比，反馈建议，用户量：50,000+</p>

<p><a href="http://versoapp.com/">verso</a>: 教育类，移动APP，iOS, Android，教师添加视频，学生写反馈，100多个国家的几千所学校；</p>

<p><a href="https://beta.workpop.com/">Workpop</a>: 找/应聘小时工，Web App;</p>

<p><a href="http://www.classcraft.com/">Classcraft</a>: 教学类应用，平台：Web, iOS，学习变为角色扮演，老师定义学生角色，获取经验值；</p>

<p><a href="https://lookback.io/">Lookback</a>: 移动应用用户体验反馈软件，原理：屏幕录制（记录手指位置和拖动），然后发送；平台：Web, iOS, Mac, Android；</p>

<p><a href="http://www.tuniliv.com/">Tuniliv</a>: 突尼斯货运与物流系统；</p>

<p><a href="http://www.telescopeapp.org/">Telescope</a>: 软件平台，论坛模板；</p>

<h1>国内</h1>

<p><a href="http://newfairs.com">牛展网</a>: 会展服务；</p>

<p><a href="http://maodou.io/">毛豆网</a>: 在线教育/外包；</p>

<h1>生态系统</h1>

<p>[node.js]</p>

<p>[mongodb]</p>

<p>[bootstrap]</p>

<p>[meteoric]</p>

<h1>参考资料</h1>

<p><a href="http://www.quora.com/What-are-the-larger-examples-of-Meteor">What are the larger examples of Meteor?</a></p>

<p><a href="http://www.jianshu.com/p/ps8C8N">关于Meteor的5个误解</a></p>

<p><a href="https://www.meteor.com/case-studies/build-apps-with-meteor">https://www.meteor.com/case-studies/build-apps-with-meteor</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Meteor Development Collaboration]]></title>
    <link href="http://leetschau.github.io/blog/2015/08/02/113417/"/>
    <updated>2015-08-02T11:34:17+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/08/02/113417</id>
    <content type="html"><![CDATA[<p>Meteor developer Tom and Bob are in different location.
Tom is the main coder and Bob is the mentor.
Their remote collaboration mode is:</p>

<ul>
<li><p>Voice talk through Moxtra/QQ/Skype;</p></li>
<li><p>Code and browser sharing through a VPS on Internet;</p></li>
</ul>


<h1>VPS Configuration</h1>

<p>The IP address of the VPS is 100.101.102.103.
Add a user &ldquo;nf&rdquo; as the SSH forwarding user:</p>

<pre><code>useradd -m nf
passwd nf
</code></pre>

<p>To allow remote port forwarding to bind to non-loopback addresses,
add <code>GatewayPorts yes</code> into /etc/ssh/sshd_config, and <code>service ssh reload</code>.
Without this, the listening port on VPS is bind to &ldquo;127.0.0.1&rdquo; instead of &ldquo;0.0.0.0&rdquo;.
You can find out it with <code>netstat -lnput|grep 3000</code>, when the forwarding port is 3000.</p>

<h1>Code editor sharing</h1>

<p>Tom install tmux on his Linux OS.
And start up a tmux session as the develop environment:</p>

<pre><code>tmux new -s myWebsite
</code></pre>

<p>To make Bob ssh to his laptop, Tom need run the following command on his laptop:</p>

<pre><code>ssh -g -R 10022:localhost:22 nf@100.101.102.103
</code></pre>

<p>where -g means &ldquo;Allows remote hosts to connect to local forwarded ports&rdquo;,
-R means a &ldquo;Remote&rdquo; port forwarding is created with this ssh connection
(which means when this ssh connection closed, the port forwarding will be dropped, too).
In &ldquo;10022:localhost:22&rdquo;, the first part is the port number on remote host,
the second and third is the hostname and port number of local machine.</p>

<p>So the whole command means:
Tom ssh to server 100.101.102.103 as user nf,
while creating a port forwarding.
So all connect to 10022 on remote host, will be forwarded to Tom&rsquo;s laptop on port 22.</p>

<p>After login, the forwarding tunnel is created.
On VPS, verify port 3000 is bind to public interface instead of loopback:</p>

<pre><code>netstat -lnput|grep 3000
</code></pre>

<p>Bob need run the following command to join Tom:</p>

<pre><code>ssh -p 10022 tom@100.101.102.103
tmux attch -t myWebsite
</code></pre>

<p>Notice that the user name is &ldquo;tom&rdquo; instead of &ldquo;nf&rdquo; in above command.
And the password is tom&rsquo;s on his laptop, instead of nf&rsquo;s on the VPS.</p>

<h1>Web serer sharing</h1>

<p>Tom run this command to create the tunnel:</p>

<pre><code>ssh -g -R 3000:localhost:3000 nf@100.101.102.103
</code></pre>

<p>Bob can visit the web server with url &ldquo;100.101.102.103:3000&rdquo;.</p>

<p>Ref:</p>

<p><a href="http://serverfault.com/questions/379344/selecting-interface-for-ssh-port-forwarding">http://serverfault.com/questions/379344/selecting-interface-for-ssh-port-forwarding</a></p>

<p><a href="https://juliansimioni.com/blog/howto-access-a-linux-machine-behind-a-home-router-with-ssh-tunnels/">https://juliansimioni.com/blog/howto-access-a-linux-machine-behind-a-home-router-with-ssh-tunnels/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Chinese Characters Can't Be Displayed Correctly in Git Log]]></title>
    <link href="http://leetschau.github.io/blog/2015/07/31/160627/"/>
    <updated>2015-07-31T16:06:27+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/07/31/160627</id>
    <content type="html"><![CDATA[<p>On Ubuntu 14.04, <code>cat</code> can display Chinese characters correctly.
But in <code>vi</code> and <code>less</code> Chinese characters can&rsquo;t display correctly.</p>

<p>Solution:</p>

<p>Run <code>export LC_ALL=en_US.UTF-8</code> before <code>git log</code>.</p>

<p>If it works, add this line into /etc/environment.</p>

<p>If it doesn&rsquo;t work, run <code>export LANG=en_US.UTF-8</code>.</p>

<p>If it doesn&rsquo;t work, run <code>apt-get install language-pack-en-base</code>.</p>

<p>In vim, run <code>set enc=utf-8</code>.</p>

<p>Ref:</p>

<p><a href="http://askubuntu.com/questions/162391/how-do-i-fix-my-locale-issue">http://askubuntu.com/questions/162391/how-do-i-fix-my-locale-issue</a></p>

<p><a href="http://stackoverflow.com/questions/5166652/how-to-view-utf-8-characters-in-vim-or-gvim">http://stackoverflow.com/questions/5166652/how-to-view-utf-8-characters-in-vim-or-gvim</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Development Collaboration With Pull Request]]></title>
    <link href="http://leetschau.github.io/blog/2015/07/23/121622/"/>
    <updated>2015-07-23T12:16:22+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/07/23/121622</id>
    <content type="html"><![CDATA[<p>Say your partner is Tom.</p>

<ol>
<li><p>Fork Tom&rsquo;s repository;</p></li>
<li><p>Clone your forked repository to your laptop;</p></li>
<li><p>Commit modificatioins to your laptop repository;</p></li>
<li><p>Push modifications to your forked repository;</p></li>
<li><p>Send a pull request in your forked repository on github website;</p></li>
<li><p>Tom accept your request and merges into his repository;</p></li>
<li><p>In your laptop repository, add upstream repository as a remote source;</p></li>
<li><p>Sync with the upstream repository with <code>git fetch</code> and <code>git merge</code>;</p></li>
</ol>


<p>This is a whole cycle. Repeat above steps to collaborate with Tom.</p>

<p>Ref:</p>

<p><a href="http://stackoverflow.com/questions/7244321/how-to-update-github-forked-repository">How to update GitHub forked repository?</a></p>

<p><a href="https://help.github.com/articles/pushing-to-a-remote/#pushing-a-branch">Pushing to a remote</a></p>

<p><a href="https://help.github.com/articles/syncing-a-fork/">Syncing a fork</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Running Meteor and Node App on Ubuntu 14.04 VPS]]></title>
    <link href="http://leetschau.github.io/blog/2015/07/22/082040/"/>
    <updated>2015-07-22T08:20:40+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/07/22/082040</id>
    <content type="html"><![CDATA[<h1>Setup Environment with MUP</h1>

<p>On your laptop, install mup with <code>npm install -g mup</code>.
In a new directory, create a mup project with <code>mup init</code>.
Set &ldquo;setupMongo&rdquo;, &ldquo;setupNode&rdquo; and &ldquo;setupPhantom&rdquo; to &ldquo;true&rdquo; in mup.json,
and run <code>mup setup</code>.</p>

<h1>Run Apps</h1>

<p>To install the <strong>first</strong> Meteor app, <code>mup deploy</code>.</p>

<p>To install the second (there has been a Meteor app is running) or more,
set &ldquo;setupMongo&rdquo;, &ldquo;setupNode&rdquo; and &ldquo;setupPhantom&rdquo; to &ldquo;false&rdquo; in mup.json,
change &ldquo;appname&rdquo;, &ldquo;app&rdquo; and values in &ldquo;env&rdquo; accordingly.
Finally run <code>mup deploy</code>.</p>

<p>For Node app, first get the source code with git,
then run it with forever, which is installed by mup:</p>

<pre><code>aptitude install git
git clone ... projHome
cd projHome
npm install
# confirm port number in config.js
forever start app.js  # when the main script is "app.js"
</code></pre>

<p>Get the app status with <code>forever list</code>.
If the app can&rsquo;t start, print logs with <code>forever logs 1</code>
(if the target app&rsquo;s index in <code>forever list</code> is 1).</p>

<h1>Setup Routes</h1>

<p>Note: MUP requires Node v0.10.36 or later.
So do NOT install node with <code>aptitude install nodejs</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[基于ionic的移动网页开发]]></title>
    <link href="http://leetschau.github.io/blog/2015/07/18/005622/"/>
    <updated>2015-07-18T00:56:22+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/07/18/005622</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/meteoric/meteor-ionic/blob/master/GUIDE.md">meteor-ionic Guide</a>是整体框架的说明。</p>

<p>文档中心：
<a href="http://ionicframework.com/docs/">Ionic Documentation</a>，
常用的包括界面组件<a href="http://ionicframework.com/docs/components/">CSS Components</a>和
图标库<a href="http://ionicons.com/">ionicons</a>（可以输入名称搜索对应图标，如"telephone", &ldquo;home"等）。</p>

<h1>Header, Footer字体太小问题</h1>

<p>在<head>&hellip;</head>里增加下面两行代码：</p>

<pre><code>&lt;meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"&gt;
&lt;link href='http://fonts.googleapis.com/css?family=Roboto:400,300,500' rel='stylesheet' type='text/css'&gt;
</code></pre>

<h1>Header上登录注册按钮覆盖退回按钮问题</h1>

<p>下面的代码不会出现覆盖问题：</p>

<pre><code>  &lt;div class="col text-right"&gt;
    &lt;button class="button button-clear button-stable"&gt;登录&lt;/button&gt;
    &lt;button class="button button-clear button-stable"&gt;注册&lt;/button&gt;
  &lt;/div&gt;
</code></pre>

<p>如果在<code>&lt;div class="col text-right"&gt;</code>外面加上一层<code>&lt;div class="bar bar-header bar-positive"&gt;</code>，
则会覆盖"headerButtonLeft"中定义的返回按钮。</p>

<p>另：`` 中可以添加path（返回指定route）和text（按钮说明文字）属性。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Manage Nodejs App With Forever]]></title>
    <link href="http://leetschau.github.io/blog/2015/07/10/065540/"/>
    <updated>2015-07-10T06:55:40+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/07/10/065540</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/foreverjs/forever">forever</a> is</p>

<blockquote><p>A simple CLI tool for ensuring that a given script runs continuously.</p></blockquote>

<p>For now it only supports nodejs scripts.</p>

<p>It provides functions like <code>nohup</code> in shell, but much more.</p>

<p>To start your script, run <code>forever start -w app.js</code> instead of <code>node app.js</code>.
The &ldquo;-w&rdquo; option will watch the file changes.</p>

<p>So update website is simply run <code>git pull ...</code> on your production host,
forever will find the changes in your sources and restart server
(like Meteor app in develop mode).</p>

<p>List all running forever managed scripts with <code>forever list</code>.</p>

<p>Find out their logs location with <code>forever logs</code>.
Then you can use <code>tail -f</code> to watch the log of a script in real time.</p>

<p>Print the log of a script with <code>forever logs &lt;script-index&gt;</code>,
for example:<code>forever logs 0</code>.
You get the index from the output of <code>forever logs</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Transport JavaScript Objects Between Meteor Pages via URI]]></title>
    <link href="http://leetschau.github.io/blog/2015/07/07/103347/"/>
    <updated>2015-07-07T10:33:47+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/07/07/103347</id>
    <content type="html"><![CDATA[<h1>Tips</h1>

<ul>
<li><p>object -> String -> object:
JSON.stringify -> encodeURI -> | another page | -> decodeURI -> JSON.parse</p></li>
<li><p>Use &ldquo;&amp;&rdquo; to connect multiple query items in uri;</p></li>
</ul>


<h1>Code Demo</h1>

<p>On page 1:</p>

<pre><code>var filterObj = { year: '2016', pos: '中国' };
var filterStr = JSON.stringify(filterObj);
var enc = encodeURI(filterStr);
console.log(enc);
var myRoute = "/results/2015/pages/1?type=basic&amp;filter=" + enc
Router.go(myRoute);
</code></pre>

<p>On page 2:</p>

<pre><code>var queryType = this.params.query.type;
var filterStr = this.params.query.filter;
var dec = decodeURI(filterStr);
var filterObj = JSON.parse(dec);
console.log(filterObj);
</code></pre>

<h1>Ref</h1>

<ul>
<li><p>matejkramny&rsquo;s answer in <a href="http://stackoverflow.com/questions/1086404/string-to-object-in-js">String to object in JS</a>;</p></li>
<li><p><a href="http://www.w3schools.com/jsref/jsref_decodeuri.asp">JavaScript decodeURI() Function</a>;</p></li>
<li><p>vartec&rsquo;s answer in <a href="http://stackoverflow.com/questions/724526/how-to-pass-multiple-parameters-in-a-querystring">How to pass multiple parameters in a querystring</a>;</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Learning Resources for Programming Language Theory]]></title>
    <link href="http://leetschau.github.io/blog/2015/07/04/190036/"/>
    <updated>2015-07-04T19:00:36+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/07/04/190036</id>
    <content type="html"><![CDATA[<ul>
<li><p><a href="http://www.cs.toronto.edu/~hehner/aPToP/">A practical theory of programming</a>;</p></li>
<li><p><a href="https://en.wikipedia.org/wiki/Programming_language_theory">Programming language theory on Wikipedia</a>;</p></li>
<li><p><a href="http://book.douban.com/subject/3743526/">Programming Language Pragmatics by Michael L. Scott</a>;</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Trace File Change History in Git Repository]]></title>
    <link href="http://leetschau.github.io/blog/2015/06/30/101243/"/>
    <updated>2015-06-30T10:12:43+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/06/30/101243</id>
    <content type="html"><![CDATA[<p>The website need hide some menu items under developing,
by comment out the html codes (at line 19~24 in file &ldquo;client/comTemp.html&rdquo;).
But last night we found they reappeared in the newest version.
Apparently someone used the older version (in which they were not commented out)
overwrite the latest version by error (without intention).</p>

<p>How to find out who, at which commit make this mistake?</p>

<p><strong>Step 1</strong>: get the error version.</p>

<pre><code>$ git blame -L 19,24 client/comTemp.html
dc7d385a (Tom     2015-06-26 17:39:28 +0800 19)    &lt;li&gt;
8b64184a (Bob     2015-05-04 19:32:43 +0800 20)      &lt;a href="http://leetschau.github.io/mall"&gt;Mall&lt;/a&gt;
6bb3ba70 (Franky  2015-05-04 15:45:50 +0800 21)    &lt;/li&gt;
6bb3ba70 (Franky  2015-05-04 15:45:50 +0800 22)    &lt;li&gt;
8b64184a (Bob     2015-05-04 19:32:43 +0800 23)      &lt;a href="http://leetschau.github.io/services"&gt;Services&lt;/a&gt;
dc7d385a (Tom     2015-06-26 17:39:28 +0800 24)    &lt;/li&gt;
</code></pre>

<p>Here the line 19 should be <code>&lt;!--&lt;li&gt;</code> and line 24 should be <code>&lt;/li&gt;--&gt;</code>,
to hide &ldquo;Mall&rdquo; and &ldquo;Services&rdquo;, which are under developing.</p>

<p><strong>Step 2</strong>: get the newest right version.</p>

<p>The wrong commit is &ldquo;dc7d385a&rdquo;, so we have to find the nearest change <strong>before</strong> it:</p>

<pre><code>$ git blame -L 19,24 'dc7d385a^' -- client/comTemp.html
96269db1 (Bob     2015-06-10 15:36:31 +0800 19)    &lt;!--&lt;li&gt;
8b64184a (Bob     2015-05-04 19:32:43 +0800 20)      &lt;a href="http://leetschau.github.io/mall"&gt;Mall&lt;/a&gt;
6bb3ba70 (Franky  2015-05-04 15:45:50 +0800 21)    &lt;/li&gt;
6bb3ba70 (Franky  2015-05-04 15:45:50 +0800 22)    &lt;li&gt;
8b64184a (Bob     2015-05-04 19:32:43 +0800 23)      &lt;a href="http://leetschau.github.io/services"&gt;Services&lt;/a&gt;
96269db1 (Bob     2015-06-10 15:36:31 +0800 24)    &lt;/li&gt;--&gt;
</code></pre>

<p>So we know Mall and Services were commented out at commit 96269db1, 2015-06-10,
and uncommented by error at commit dc7d385a, 2015-06-26, by Tom.</p>

<p><strong>Step 3</strong>: show code changes.</p>

<pre><code>$ git show dc7d385a -- client/comTemp.htm
...
-    &lt;!--&lt;li&gt;
+    &lt;li&gt;
       &lt;a href="http://leetschau.github.io/mall"&gt;Mall&lt;/a&gt;
     &lt;/li&gt;
     &lt;li&gt;
       &lt;a href="http://leetschau.github.io/services"&gt;Services&lt;/a&gt;
-    &lt;/li&gt;--&gt;
+    &lt;/li&gt;
...
</code></pre>

<p>It shows in commit dc7d385a,
two lines were deleted: &ldquo;<!--<li>&rdquo; and &ldquo;</li>&ndash;>&rdquo;,
while two lines were added: &ldquo;<li>&rdquo; and &ldquo;</li>&rdquo;.</p>

<p><strong>Step 4 (optional)</strong>: revert the commit</p>

<pre><code>git revert dc7d385a
</code></pre>

<p>Ref: <a href="http://stackoverflow.com/questions/14836696/delete-last-commit-in-bitbucket">http://stackoverflow.com/questions/14836696/delete-last-commit-in-bitbucket</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Control Linux Server With Tmux on Windows Client]]></title>
    <link href="http://leetschau.github.io/blog/2015/06/27/085109/"/>
    <updated>2015-06-27T08:51:09+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/06/27/085109</id>
    <content type="html"><![CDATA[<p>I&rsquo;ve tried Kitty as SSH client.
But under tmux, the right &ldquo;Alt&rdquo; key doesn&rsquo;t work,
while it works good with MobaXterm.</p>

<p>Full screen switch: F11;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Meteoric Notes]]></title>
    <link href="http://leetschau.github.io/blog/2015/06/25/102358/"/>
    <updated>2015-06-25T10:23:58+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/06/25/102358</id>
    <content type="html"><![CDATA[<p>meteor create ionicEx
cd ionicEx
meteor add iron:router fourseven:<a href="&#x6d;&#97;&#x69;&#108;&#x74;&#111;&#x3a;&#115;&#99;&#115;&#115;&#x40;&#50;&#46;&#x30;&#x2e;&#x30;">&#115;&#x63;&#x73;&#115;&#64;&#x32;&#46;&#x30;&#x2e;&#48;</a> meteoric:ionic-sass meteoric:ionicons-sass meteoric:ionic</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tails System]]></title>
    <link href="http://leetschau.github.io/blog/2015/06/19/104111/"/>
    <updated>2015-06-19T10:41:11+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/06/19/104111</id>
    <content type="html"><![CDATA[<p>Tails 1.4 can <strong>not</strong> be installed with YUMI.
It will cause a &ldquo;setup chroot failure&rdquo;.
There is a bug report on Tails for this:
<a href="https://labs.riseup.net/code/issues/9115">Chroot browsers don&rsquo;t work when Tails is manually installed with YUMI</a>.</p>

<p>After start up with USB key, press <TAB> after the &ldquo;BOOT&rdquo; prompt.
I tried all 3 options. Only &ldquo;menu_486&rdquo; could boot the system.</p>

<p>Once logged in, connect WiFi, use &ldquo;unsafe_browser&rdquo; to check the internet connection.
If it&rsquo;s OK, use Tor browser.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tmux Configurations for Unity Desktop]]></title>
    <link href="http://leetschau.github.io/blog/2015/06/18/112729/"/>
    <updated>2015-06-18T11:27:29+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/06/18/112729</id>
    <content type="html"><![CDATA[<p>Verified on Ubuntu 14.04, 2015-6-18.</p>

<h1>Prefix</h1>

<p><code>M-f</code> will activate the Unity HUB, so use <code>M-q</code> as tmux prefix:
<code>set -g prefix M-q</code>.</p>

<h1>Get Help</h1>

<ul>
<li><p>List all shortcuts: prefix ?</p></li>
<li><p>List all commands: <code>tmux list-commands</code></p></li>
</ul>


<h1>Open a new Window/Pane</h1>

<p>bind -n M-/ split-window -h
bind -n M&ndash; split-window -v
bind -n M-n new-window</p>

<h1>Resize Pane in a Window</h1>

<p>Use Ctrl- arrow key to resize pane:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bind -n -r ^Left resize-pane -L 5
</span><span class='line'>bind -n -r ^Down resize-pane -D 5
</span><span class='line'>bind -n -r ^Up resize-pane -U 5
</span><span class='line'>bind -n -r ^Right resize-pane -R 5</span></code></pre></td></tr></table></div></figure>


<p>Use <code>M-z</code> to maximize/restore a pane:
<code>bind -n M-z resize-pane -Z</code>.</p>

<h1>Rotate Panes in a Window</h1>

<p>Use default settings: prefix + Space</p>

<h1>Jump between Window and Pane</h1>

<p>Alt-(1~9): jump between windows;</p>

<p>Alt-h/j/k/l: jump between panes;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bind -n M-1 select-window -t 1
</span><span class='line'>bind -n M-2 select-window -t 2
</span><span class='line'>bind -n M-3 select-window -t 3
</span><span class='line'>bind -n M-4 select-window -t 4
</span><span class='line'>bind -n M-5 select-window -t 5
</span><span class='line'>bind -n M-6 select-window -t 6
</span><span class='line'>bind -n M-7 select-window -t 7
</span><span class='line'>bind -n M-8 select-window -t 8
</span><span class='line'>bind -n M-9 select-window -t 9
</span><span class='line'>
</span><span class='line'>bind -n M-k select-pane -U
</span><span class='line'>bind -n M-j select-pane -D
</span><span class='line'>bind -n M-h select-pane -L
</span><span class='line'>bind -n M-l select-pane -R</span></code></pre></td></tr></table></div></figure>


<h1>Move Window</h1>

<p>Moving window behaves different with i3wm.
If the target window exists, you have to use <code>join-pane</code>, otherwise <code>break-pane</code>.</p>

<p>I use <code>if-shell</code> to test if the target window exists.</p>

<p>Then add target window number provided by user (%1, which means the first user-input parameter)
after &ldquo;-t&rdquo; option of <code>join-pane</code>.
The default target format is <code>#{session_name}:#{window_index}.#{pane_index}</code>.
See <code>man tmux</code> for details.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bind -n M-i command-prompt -p "move current pane to window:" "if-shell 'tmux list-windows |grep \"^%1\":' 'join-pane -t:\"%1\"' 'break-pane'"</span></code></pre></td></tr></table></div></figure>


<h1>Other helpful resources</h1>

<p>Use <code>^A</code> to represent &ldquo;Ctrl-A&rdquo;.</p>

<p>Shutdown visual alerts:</p>

<pre><code>setw -g monitor-activity on
set -g visual-activity off
</code></pre>

<h2>Commands</h2>

<ul>
<li><code>clock-mode</code>: display a large clock on the terminal</li>
</ul>


<h2>Shortcuts</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bind -n M-a command-prompt
</span><span class='line'>bind -n M-r command-prompt -p "rename window name to:" "rename-window '%%'"
</span><span class='line'>bind r source-file ~/.tmux.conf \; display "Reloaded!"</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Video Player on Linux]]></title>
    <link href="http://leetschau.github.io/blog/2015/06/10/153142/"/>
    <updated>2015-06-10T15:31:42+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/06/10/153142</id>
    <content type="html"><![CDATA[<h1>SMPlayer</h1>

<p>9/0: volume down/up;</p>

<p>Ctrl-P: preferences;</p>

<p>Ctrl-L: toogle play list;</p>

<p>,/.: play previous/next (need modify)</p>

<p>Customize hotkeys: Options -> Preferences -> Hotkeys</p>

<h1>VLC</h1>

<p>Ctrl-P: preferences;</p>

<p>Ctrl-L: toogle play list;</p>

<p>Customize hotkeys: Preferences -> Hotkeys</p>

<p>Hotkeys:</p>

<p>f: toogle full screen;
t: show time;
m: toogle mute;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ubuntu 14.04中通过ADSL连接网络]]></title>
    <link href="http://leetschau.github.io/blog/2015/06/10/114719/"/>
    <updated>2015-06-10T11:47:19+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/06/10/114719</id>
    <content type="html"><![CDATA[<p>有时不方便使用无线网络，需要通过有线连接的方式通过ADSL上网。
下面的方法在Ubuntu 14.04上验证通过（2015年6月10日于百万庄15楼）。</p>

<h1>Unity桌面环境</h1>

<p>在Ubuntu 14.04的Unity桌面上，右上角点击网络图标，弹出菜单上点击最后一项：Edit Connections&hellip;
弹出"Network Connections"对话框，点击"Add"按钮，
&ldquo;Choose a Connection Type"中选择"Hardware -> DSL"，点击"Create"按钮，
在弹出的"Edit DSL &hellip;"对话框中，在"Connection name"里填上连接名称，比如"MyDSL"，
然后在"DSL"标签页中，"Username"和"Password"分别填上ADSL的帐号名和密码，
"Service"项留空，点击"Save"按钮。</p>

<p>确认网线已插入，点击桌面右上角网络图标，网络列表里可以看到"MyDSL"，点击之，就连接上了ADSL网络。</p>

<p>参考：<a href="https://www.youtube.com/watch?v=Dx-G-Sn6IhY">How to create DSL (PPPoE) connection on Ubuntu - YouTube</a></p>

<h1>i3wm命令行环境下</h1>

<p>首先运行<code>pppoeconf</code>（注意不是pppconfig），输入ADSL的用户名和密码，其他选型都使用默认值。
安装完成后运行<code>ip addr</code>可以看到多了一个"ppp0"网卡，用<code>plog</code>可以查询状态。
用<code>ps aux|grep ppp</code>可以看到多了一个pppd服务。</p>

<p>配置好后，再次连接ADSL网络时，
使用<code>pon dsl-provider</code>启动服务，可以在输入<code>pon</code>后使用<Tab>键列出可用的选项。
使用<code>sudo poff</code>断开ADSL网络。</p>

<p>参考：<a href="https://help.ubuntu.com/community/ADSLPPPoE">ADSLPPPoE</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MongoDB数据管理平台产品定义和选型]]></title>
    <link href="http://leetschau.github.io/blog/2015/06/08/170530/"/>
    <updated>2015-06-08T17:05:30+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/06/08/170530</id>
    <content type="html"><![CDATA[<h1>目标定位和用户定义</h1>

<p>数据管理平台是商业网站的产品数据支持系统，它的用户是企业的业务人员，没有技术背景，
无法使用MongoDB的命令行工具以及GUI客户端（如Robomongo等）操作数据。
需要通过浏览器维护产品数据，对数据进行增删改查操作，</p>

<h1>功能需求</h1>

<ul>
<li><p>数据管理平台的用户是网站数据的维护者，与商业网站的用户完全不同；</p></li>
<li><p>数据管理平台是一个Web服务;</p></li>
<li><p>每个用户有自己的权限，包括能够访问哪些collection，以及这个collection中的哪些documents；</p></li>
<li><p>目前这个系统只针对MongoDB;</p></li>
<li><p>能够通过Web界面对目标MongoDB进行数据的增删改查操作；</p></li>
</ul>


<h1>实现方法</h1>

<p>使用Meteor作为Web框架；</p>

<p>系统是一个独立的Meteor项目，而不是一个package；</p>

<h1>系统选型</h1>

<p>目前试用了两个Meteor package，两个node.js包，均不符合要求。</p>

<ul>
<li><p><a href="https://github.com/yogiben/meteor-admin">yogiben/meteor-admin</a>: 登录界面上的注册(sign-up)功能有问题，
点击"Register"按钮界面僵死;登录后版式混乱重叠；</p></li>
<li><p><a href="https://github.com/gterrono/houston">Houston</a>: 安装简单，添加包后就可以使用了，
主要问题是使用产品库的Users表，与网站用户混在了一起；
添加数据页面不能根据数据的Schema定义，只能模仿库里现有的document的结构；</p></li>
<li><p><a href="http://keystonejs.com/">KeyStoneJS</a>: Nodejs包，部署和使用相对比较方便，主要问题见<a href="http://stackoverflow.com/questions/30661456/mongodb-content-management-web-app-for-non-technical-guys">我的问题</a>;</p></li>
<li><p><a href="https://github.com/andzdroid/mongo-express">mongo-express</a>: nodejs包，启动后浏览器访问时报404错误，原因未知；</p></li>
</ul>


<h1>其他说明</h1>

<p>系统不是使用MongoDB的GUI客户端，是因为使用这些客户端需要了解MongoDB语句，不符合用户定义。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Penetrate GFW With Sshuttle]]></title>
    <link href="http://leetschau.github.io/blog/2015/05/28/102822/"/>
    <updated>2015-05-28T10:28:22+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/05/28/102822</id>
    <content type="html"><![CDATA[<p>Comparing with shadowsocks, <a href="https://github.com/apenwarr/sshuttle">sshuttle</a> is a much lightweight, open source alternative.
All you need is a ssh server outside GFW.</p>

<p>The installation is just <code>git clone</code> its repository on github.</p>

<p>To use it, only run a command on client: <code>./sshuttle --dns -r user@sshServer 0/0</code>.
Here option &ldquo;&ndash;dns&rdquo; is necessary to avoid DNS pollution inside GFW.
Add &ldquo;-v&rdquo; or &ldquo;-vv&rdquo; option ONLY for debug purpose, for it decreases connecting speed a lot.
&ldquo;-r&rdquo; means &ldquo;remote&rdquo;, so add your remote host outside GFW after it.
The last part of this command specifies which connections on client to use this proxy.
&ldquo;0/0&rdquo; means all connections, which is the most common case.</p>

<p>For convenience, add <code>alias sv="$HOME/apps/sshuttle/sshuttle --dns -r root@sshServer 0/0"</code> into ~/.bash_aliases.
Now you can use <code>sv</code> to start the vpn, Ctrl-C to stop it.</p>
]]></content>
  </entry>
  
</feed>
