<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Dark Matter in Cyberspace]]></title>
  <link href="http://leetschau.github.io/atom.xml" rel="self"/>
  <link href="http://leetschau.github.io/"/>
  <updated>2015-11-20T11:01:10+08:00</updated>
  <id>http://leetschau.github.io/</id>
  <author>
    <name><![CDATA[Li Chao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Clear Chrome DNS Cache]]></title>
    <link href="http://leetschau.github.io/blog/2015/11/20/104508/"/>
    <updated>2015-11-20T10:45:08+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/11/20/104508</id>
    <content type="html"><![CDATA[<p>Problem:
When open &ldquo;cms.nzw.com&rdquo; with Chrome, it always jump to &ldquo;localhost&rdquo;.
But open the same address in Firefox, it works good.</p>

<p>Possible reason:
Chrome cache some DNS or sockets information, which should be cleaned.</p>

<p>Solution:
Open &ldquo;chrome://net-internals/#dns&rdquo; in Chrome,
click &ldquo;Clear host cache&rdquo;.
Open &ldquo;chrome://net-internals/#sockets&rdquo;,
click &ldquo;Close idle sockets&rdquo; and &ldquo;Flush socket pools&rdquo;.
Restart Chrome.</p>

<p>Ref: <a href="http://www.howtogeek.com/197804/how-to-clear-the-google-chrome-dns-cache-on-windows/">How to Clear the Google Chrome DNS cache on Windows</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linux的图形化Git客户端]]></title>
    <link href="http://leetschau.github.io/blog/2015/11/19/103131/"/>
    <updated>2015-11-19T10:31:31+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/11/19/103131</id>
    <content type="html"><![CDATA[<p>这里的客户端不包括只有浏览功能的viewer，比如gitk, gitg等。
下面两个客户端都需要安装JRE. 不需要安装，解压后直接使用。</p>

<h1>GitEye</h1>

<p>需要在repo里增加一个.project文件，然后在.gitignore里加入这个文件，不够clean。</p>

<h1>SmartGit</h1>

<p>商业应用付费，非商业用途免费；</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Move Window Between Multiple Screens via Tmux]]></title>
    <link href="http://leetschau.github.io/blog/2015/11/02/093547/"/>
    <updated>2015-11-02T09:35:47+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/11/02/093547</id>
    <content type="html"><![CDATA[<p>When developing in terminal you often have to open several Tmux windows
at the same time:</p>

<ul>
<li><p>server: mongod, Meteor, Elasticsearch, etc&hellip;</p></li>
<li><p>client: mongo, elasticsearch, etc&hellip;</p></li>
<li><p>editor: template.html, template.js, router.js, server.js, etc&hellip;</p></li>
</ul>


<p>In most cases, you edit in editor window, save the file,
switch to server window to see the result,
switch back to editor window for editing again&hellip;</p>

<p>Now you have the second screen, say, a Windows laptop,
ssh to your Linux machine via MobaXterm or Kitty.
It will be more efficient if you can put the server window on the screen
of the Windows machine, and keep editing on your Linux machine screen,
for saving you from so many annoying switching between the screens.</p>

<p>It&rsquo;s easy for Tmux to achieve this.
Start a new session on your Linux machine, named as you like, for now, &ldquo;search&rdquo;.
Start a new session in the terminal of the second screen named <code>v</code> (&ldquo;viewer for short).
If you want to see the server and editor windows at the same time,
switch to the server window and run <code>link-window -t v</code> (see note 1 below for details).
Now you can switch back to the editor window,
while keep server window on the other screen.</p>

<p>To cancel the link between the sessions,
switch to server window and run <code>unlink-window -t v</code>.</p>

<p>Note 1:</p>

<p>If you define a &ldquo;command-prompt&rdquo; shortcut in ~/.tmux.conf:
<code>bind -n M-a command-prompt</code>,
run tmux command <code>linkw -t v</code> means:
press &ldquo;M-a&rdquo;, input <code>lin&lt;Tab&gt; -t v</code> then press <Enter>.</p>

<p>Note 2:</p>

<p><code>link-window</code> <em>shares</em> a window between multiple sessions.
To <em>move</em> a window to another session,
switch to the server window and run tmux command <code>move-window -t v</code>.
To move it back, run <code>move-window -s v:shell</code>,
where <code>v</code> is the target session name defined by <code>tmux new -s v</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Synchronize Data From MongoDB to Elasticsearch]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/31/011200/"/>
    <updated>2015-10-31T01:12:00+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/31/011200</id>
    <content type="html"><![CDATA[<p>Your mongo replica set and elasticsearch are hosted on 2 servers.
The mongo server is on &ldquo;mip:mport&rdquo;.
The ES server is on &ldquo;esip:esport&rdquo;.</p>

<p>On another server, install <a href="https://github.com/mongodb-labs/mongo-connector">mongo-connector</a>
with <code>pip install mongo-connector</code>.
If there are some errors, it may be caused by absence of gcc.
On Ubuntu, install them with <code>sudo apt-get install build-essential python-dev</code>.</p>

<pre><code>mongo-connector -m mip:mport -t esip:esport -d elastic_doc_manager --admin-username root --password rootPwd
</code></pre>

<p>That&rsquo;s it!
Now when you insert documents into MongoDB,
you can see it on elasticsearch.</p>

<p>We&rsquo;ve studied Mongo River and Mongoosatic, neither is better than this.</p>

<p>Note 1 (2015.11.15):</p>

<p>阿里云服务器上，用普通用户es启动es服务(<code>bin/elasticsearch</code>)，同一用户启动mongo-connector后，报
&ldquo;AttributeError: &lsquo;IndicesClient&rsquo; object has no attribute &lsquo;delete_mapping&rsquo;"错误，
es版本为2.0，mongo-connector版本为2.1，将es版本改为1.7，mongo-connector改为1.3后，
出现另一错误，最终解决方法是仍然用es启动es服务，但用root启动mongo-connector.</p>

<p>Note 2:</p>

<p>Use root to sync is unsafe.
We create an user with &ldquo;clusterManager&rdquo; role to do this work.
Login with root, and run:</p>

<pre><code>use admin
db.createUser(
    {
      user: "clustermgr",
      pwd: "cmpwd",
      roles: [ "clusterManager" ]
    }
)
</code></pre>

<p>But run the command
<code>mongo-connector -m 119.254.211.28:15515 -t localhost:9200 -d elastic_doc_manager --admin-username clustermgr --password cmpwd</code>
will be the error <code>OperationFailure: database error: not authorized for query on local.oplog.rs</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Elasticsearch River for MongoDB]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/30/131706/"/>
    <updated>2015-10-30T13:17:06+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/30/131706</id>
    <content type="html"><![CDATA[<p>According to <a href="https://www.elastic.co/blog/deprecating-rivers">Deprecating Rivers</a>,
river is not supported any more.</p>

<h1>Mongo River</h1>

<p><a href="http://backslash451.github.io/articles/Running-ElasticSearch-with-MongoDB-and-Kibana/">http://backslash451.github.io/articles/Running-ElasticSearch-with-MongoDB-and-Kibana/</a></p>

<p>Buy a mongodb on <a href="https://www.qingcloud.com/">QingCloud</a>.
Connect to database with
<code>mongo 119.254.211.28:15515 --authenticationDatabase admin -u root -p nodeJS@2015</code>.
and run <code>rs.status()</code> to verify the replica set is working.</p>

<h2>Setup Elasticsearch</h2>

<p>See note &ldquo;Elasticsearch Notes&rdquo;.</p>

<h2>Setup Kibana</h2>

<p>See note &ldquo;Kibana Notes&rdquo;.</p>

<h2>Install River Plugin</h2>

<p>Follow <a href="https://github.com/richardwilly98/elasticsearch-river-mongodb">ichardwilly98/elasticsearch-river-mongodb</a>.</p>

<p>Run <code>bin/plugin install com.github.richardwilly98.elasticsearch/elasticsearch-river-mongodb/2.0.9</code>
at $ES_HOME.</p>

<p>List plugins: <code>bin/plugin list</code>.
Get help: <code>bin/plugin -h</code>.</p>

<p>When install in 2.0.0, there is an error:
<code>ERROR: Could not find plugin descriptor 'plugin-descriptor.properties' in plugin zip</code>.
For now, use elasticsearch 1.7.3 with river.</p>

<p>List plugins in v1.7.3: <code>sudo /usr/share/elasticsearch/bin/plugin --list</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Session Management in Web Browser]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/29/204739/"/>
    <updated>2015-10-29T20:47:39+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/29/204739</id>
    <content type="html"><![CDATA[<p>Session is a group of tabs, which is relevant to a specific problem,
for example: how to use ElasticSearch with MongoDB,
or background information about TV show &ldquo;The Wire&rdquo;.</p>

<h1>Firefox</h1>

<p>Save: right click on the tab bar and select &ldquo;Bookmark All Tabs&rdquo; (Shift + Ctrl + D);</p>

<p>Restore: click &ldquo;Show your bookmarks&rdquo; button on toolbar,
navigate to the folder and click &ldquo;Open all Tabs&rdquo; at the bottom.</p>

<h1>Chrome</h1>

<p>Install extension &ldquo;Session Buddy&rdquo;.
It will help you to save and restore all open tabs as a &ldquo;Session&rdquo;.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[将Meteor应用完整从1.2版本降级到1.1版本]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/29/200553/"/>
    <updated>2015-10-29T20:05:53+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/29/200553</id>
    <content type="html"><![CDATA[<p>当前版本的mup不支持Meteor 1.2，对1.1支持很好。
一位开发者用<code>meteor update</code>升级了Meteor,然后push到代码库中，
其他开发者同步代码后发现无法使用mup部署，
这个问题不能简单地使用<code>meteor --releae 1.1</code>处理，
因为从1.1到1.2，Metoer很多核心包的版本发生了变化，并增删了很多包，
<code>meteor --release 1.1</code>只能还原Meteor自身版本，
无法还原核心包，必须将.meteor目录下所有文件复原。</p>

<p>使用git的patch功能可以方便地实现针对一个目录的复原。
首先找到包含正确文件（旧Meteor版本和包定义）的commit，例如 15c9f125630，
然后找到要复原的目标commit，一般是develop branch的HEAD，例如 f13b84f6c55，
做一个反向patch：<code>git diff f13b84f6c55 15c9f125630 .meteor &gt; reverseDotMeteor.patch</code>;</p>

<p>正常的<code>git diff</code>是旧版本在前，新版本在后，这样生成的patch反映的是文件内容随着时间发生的改变，
这里将新的commit放在前面，生成的patch就能起到回到过去的作用。</p>

<p>checkout目标commit并加载patch: <code>git apply reverseDotMeteor.patch</code>.</p>

<p>测试mup是否能正常工作，如果能，提交修改。</p>

<p>参考：<a href="http://stackoverflow.com/questions/1191282/how-to-see-the-changes-between-two-commits-without-commits-in-between">http://stackoverflow.com/questions/1191282/how-to-see-the-changes-between-two-commits-without-commits-in-between</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Kibana Notes]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/29/112248/"/>
    <updated>2015-10-29T11:22:48+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/29/112248</id>
    <content type="html"><![CDATA[<p>Following <a href="https://www.elastic.co/guide/en/kibana/current/getting-started.html">Getting Started with Kibana</a>.</p>

<h1>Setup Kibana</h1>

<p>Download kibana tar package file (kibana-4.2.0-linux-x64.tar.gz) and extract to $KIBANA_HOME.
Modify $KIBANA_HOME/config/kibana.yml, uncomment
<code>elasticsearch.url: "http://localhost:9200"</code> (if elasticsearch server is on localhost).
Start server with <code>bin/kibana</code>.</p>

<h1>Import Data</h1>

<p>Import accounts with <code>curl -XPOST 'localhost:9200/accounts/account/_bulk?pretty' --data-binary @accounts.json</code>
instead of <code>curl -XPOST 'localhost:9200/bank/_bulk?pretty' --data-binary @accounts.json</code>.</p>

<pre><code>curl -XPOST 'localhost:9200/accounts/account/_bulk?pretty' --data-binary @accounts.json
head -1 accounts.json
{"index":{"_id":"1"}}

curl -XPOST 'localhost:9200/shakespeare/_bulk?pretty' --data-binary @shakespeare.json
head -1 shakespeare.json
{"index":{"_index":"shakespeare","_type":"act","_id":0}}
</code></pre>

<p>So if the index and type is not defined in json file,
it should be defined when imported with curl.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Validate Data Defined by Simple-Schema]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/29/080601/"/>
    <updated>2015-10-29T08:06:01+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/29/080601</id>
    <content type="html"><![CDATA[<p>// the object need to be validate according to the schema:
var fair = { &hellip; };
var mycon = NewfairsCore.Schemas.Fair.namedContext();</p>

<p>// this method returns true if the object is valid according to the schema
// or false if it is not:
mycon.validate(fair);</p>

<p>// this method lists all invalid keys:
mycon.invalidKeys();</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Play Meteor With Elasticsearch]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/28/102957/"/>
    <updated>2015-10-28T10:29:57+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/28/102957</id>
    <content type="html"><![CDATA[<p>Install elasticsearch;</p>

<p>Follow the instructions in <a href="https://github.com/andrewreedy/meteor-elasticsearch">meteor-elasticsearch</a></p>

<p>Choose plugin version according to
<a href="https://github.com/richardwilly98/elasticsearch-river-mongodb.">https://github.com/richardwilly98/elasticsearch-river-mongodb.</a></p>

<p>Get elasticsearch version: <code>curl -XGET 'localhost:9200'</code></p>

<p>So mongo river plugin version 2.0.9 is installed:</p>

<pre><code>cd /usr/share/elasticsearch
sudo bin/plugin --install com.github.richardwilly98.elasticsearch/elasticsearch-river-mongodb/2.0.0
sudo bin/plugin --remove com.github.richardwilly98.elasticsearch/elasticsearch-river-mongodb/2.0.0
sudo bin/plugin --install com.github.richardwilly98.elasticsearch/elasticsearch-river-mongodb/2.0.9
</code></pre>

<p>Start elasticsearch server: <code>sudo /usr/share/elasticsearch/bin/elasticsearch --default.path.conf=/etc/elasticsearch/</code></p>

<p>Create a Meteor app with external mongodb connection, and verify it;</p>

<p>Add ES package: <code>meteor add bigdata:elasticsearch</code>;</p>

<p>Add the setting file &ldquo;settings.json&rdquo;;</p>

<p>Start the meteor server: <code>MONGO_URL="mongodb://user:pwd@ip:port/db" meteor --settings settings.json</code></p>

<p>Problem: the ES variable is undefined.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Customize Dell Ubuntu Laptop Turn Off Screen and Lock]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/27/120807/"/>
    <updated>2015-10-27T12:08:07+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/27/120807</id>
    <content type="html"><![CDATA[<p>In [System Settings -> Brightness &amp; Lock],
set &ldquo;Turn screen off when inactive for&rdquo; to &ldquo;Never&rdquo; and turn off &ldquo;Lock&rdquo;.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fix GUI App Start Failure With No Display Found]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/25/213630/"/>
    <updated>2015-10-25T21:36:30+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/25/213630</id>
    <content type="html"><![CDATA[<p>When running <code>gitg</code> in Ubuntu terminal, I got errors below:</p>

<blockquote><p><strong> (gitg:29283): WARNING </strong>: Could not open X display</p>

<p>(gitg:29283): Gtk-WARNING **: cannot open display: localhost:10.0</p></blockquote>

<p>Solution: check you $DISPLAY value, if it&rsquo;s not &ldquo;:0.0&rdquo;,
run <code>export DISPLAY=:0.0</code>.</p>

<p>Ref: <a href="http://askubuntu.com/questions/438451/could-not-open-display-null-error-how-can-i-fix-this">http://askubuntu.com/questions/438451/could-not-open-display-null-error-how-can-i-fix-this</a></p>

<p>To test keycode of the same key in different OS,
I ssh to my Linux laptop with Kitty on Windows.
When I run <code>xev</code>, I got an error:
<code>xev: unable to open display ''</code>.</p>

<p>If you ssh to a remote server, and</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Git Submodule]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/25/212008/"/>
    <updated>2015-10-25T21:20:08+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/25/212008</id>
    <content type="html"><![CDATA[<h1>Git submodule as Meteor package</h1>

<p>We have a parent (container) Meteor application &ldquo;niufour&rdquo;,
now we want to add a new package &ldquo;nf-search&rdquo; to niufour.</p>

<p>Make sure if <code>packages/</code> has been added into .gitignore.</p>

<p>Push the nf-search (outside of niufour folder) to remote repo,
here we use a Phabricator server, with address <remote-repo-url>.</p>

<p>Under the root of niufour, run:</p>

<pre><code>git submodule add &lt;remote-repo-url&gt; packages/nf-search
</code></pre>

<p>While &ldquo;packages/&rdquo; is always in niufour/.gitignore, you should add module with:</p>

<pre><code>git submodule add -f &lt;remote-repo-url&gt; packages/nf-search
</code></pre>

<p>The common form is: <code>git submodule add &lt;remote-repo-url&gt; &lt;local-path&gt;</code>,
where the <local-path> is where you want to put your submodule.</p>

<p>To add it into the niufour package list,
add <code>nfcommerce:nf-search</code> into file <niufour-project-root>/.meteor/packages.</p>

<p>After your partner push new codes into the repo,
run commands below to synchronize:</p>

<pre><code>git pull origin develop
git submodule update --init --recursive
</code></pre>

<p>Use <code>git submodule status</code> to list current commit of each subpackage.</p>

<h1>Keep demo state in parent project</h1>

<p>A demo need both codes and data at the exact state of the verified time.
So if your project has not submodules, use commit and tag to record the demo state.</p>

<p>Otherwise, you can use commits in parent project to record demo state.
In the example above, suppose niufour has another submodule &ldquo;nf-core&rdquo;.
In the development process, commit on &ldquo;develop&rdquo; branch in each submodule,
without commit on niufour.
Only when PM (project manager) verified the demo,
and all developers have committed and pushed in each submodule,
PM commits, tags and pushes <strong>in parent project</strong> by himself:</p>

<pre><code>cd /path/to/niufour
git add -A
git commit -m "this is for demo of 2015.11.04"
git tag "demo-2015.11.04"
git push origin develop
</code></pre>

<p>Then pm dump the database (<code>mongodump</code> for MongoDB) to a folder
with the same name of the tag name (here it&rsquo;s &ldquo;demo-2015.11.04&rdquo;).</p>

<p>At the demo day, the PM restore the data into a new database (<code>mongorestore</code> for example),
then run commands below to restore the codes for demo:</p>

<pre><code>git clone &lt;url-of-niufour&gt;
git checkout demo-2015.11.04
git submodule init
git submodule update
</code></pre>

<p>Note: To demonstrate the usage of git submodule,
use example in &ldquo;Git权威指南&rdquo;, 23.1 ~ 23.3, by 蒋鑫.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Elasticsearch Notes]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/24/115416/"/>
    <updated>2015-10-24T11:54:16+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/24/115416</id>
    <content type="html"><![CDATA[<h1>Server setup</h1>

<p>Download tar package of <a href="https://www.elastic.co/products/elasticsearch">ealsticSearch</a>
and install:</p>

<pre><code>aptitude update
aptitude install openjdk-7-jdk
wget https://download.elasticsearch.org/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.0.0/elasticsearch-2.0.0.tar.gz
tar zxf elasticsearch-2.0.0.tar.gz
cd elasticsearch-2.0.0
bin/elasticsearch
</code></pre>

<p>Or you can install it as a service with deb package</p>

<pre><code>wget https://download.elastic.co/elasticsearch/elasticsearch/elasticsearch-1.7.3.deb
sudo dpkg -i elasticsearch-1.7.3.deb
sudo /etc/init.d/elasticsearch restart
</code></pre>

<p>Start in foreground:
<code>sudo /usr/share/elasticsearch/bin/elasticsearch --default.path.conf=/etc/elasticsearch/</code>.
If you omit the option &ldquo;&ndash;default.path.conf&rdquo;,
you&rsquo;ll get an error:
<code>org.elasticsearch.ElasticsearchException: Failed to load logging configuration</code>.</p>

<p>When you want start the 2nd node in the same machine,
always start it this way with the same command above.</p>

<p>Or run it in background:
<code>/usr/share/elasticsearch/bin/elasticsearch -d --default.path.conf=/etc/elasticsearch/</code>;</p>

<h1>Data manipulation in client</h1>

<p>Create a new index:</p>

<pre><code>curl -XPUT 'localhost:9200/blogs' -d '
{
   "settings" : {
      "number_of_shards" : 3,
      "number_of_replicas" : 1
   }
}'
</code></pre>

<p>List all indexes: <code>curl 'localhost:9200/_cat/indices?v'</code>;</p>

<p>For a index named &ldquo;test&rdquo;:</p>

<p>List all data in an index: <code>curl -XGET 'http://localhost:9200/test/_search?pretty'</code>;</p>

<p>Remove an index: <code>curl -XDELETE 'http://localhost:9200/test/'</code>,
wild card can be used here: <code>curl -XDELETE 'http://localhost:9200/logstash*/'</code>,
or many indexes at once: <code>curl -XDELETE 'http://localhost:9200/website,shakes*/'</code>,
separated by comma.</p>

<p>Put the result as well-formatted json:</p>

<pre><code>npm install -g json
curl 'localhost:9200/megacorp/employee/_search?pretty' | json
</code></pre>

<h1>Notes</h1>

<p>You can use
<code>curl 'localhost:9200/megacorp/employee/_search?pretty' | python -m json.tool</code>
in command line or <code>:%!python -m json.tool</code> in vim to format json string.
But it will sort your keys, and maybe not friendly to Unicode characters.</p>

<p>Do NOT delete &ldquo;mongodb_meta&rdquo; index in ES,
or you will get an error when starting <code>mongo-connector</code>:</p>

<blockquote><p>AttributeError: &lsquo;IndicesClient&rsquo; object has no attribute &lsquo;delete_mapping&rsquo;</p></blockquote>

<p>If you had deleted it, restart ES server to rebuild this index.</p>

<p><code>?petty</code> sometimes will be invalid url.</p>

<p>Format json in vim: <code>:%!json</code>.</p>

<h1>Ref:</h1>

<p><a href="http://stackoverflow.com/questions/352098/how-can-i-pretty-print-json">http://stackoverflow.com/questions/352098/how-can-i-pretty-print-json</a></p>

<p><a href="https://pascalprecht.github.io/2014/07/10/pretty-print-json-in-vim/">https://pascalprecht.github.io/2014/07/10/pretty-print-json-in-vim/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Use Google Font Locally]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/21/133324/"/>
    <updated>2015-10-21T13:33:24+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/21/133324</id>
    <content type="html"><![CDATA[<p>For example, we want use Open Sans locally.
On <a href="https://www.google.com/fonts">Google Fonts</a>,
in &ldquo;Open Sans&rdquo;, click &ldquo;Add to Collection&rdquo;.
and click &ldquo;use&rdquo;.</p>

<p>Under &ldquo;Choose the styles you want:&rdquo;, check all items,
under &ldquo;Choose the character sets you want:&rdquo;, check &ldquo;Latin&rdquo; and &ldquo;Latin Extended&rdquo;.</p>

<p>Open the url in the 3rd step, here it is:
<code>https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,700italic,800,800italic</code>.</p>

<p>Now you get a css file, save it into $WEBSITE_HOME/client/stylesheets/font/opensans.less,
delete all sections other than &ldquo;latin&rdquo; and &ldquo;latin-ext&rdquo;,
download</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JavaScript Code Folding]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/19/090450/"/>
    <updated>2015-10-19T09:04:50+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/19/090450</id>
    <content type="html"><![CDATA[<p>Add codes below to ~/.vimrc
and run <code>vim +PluginClean +PluginInstall +qa</code>:</p>

<pre><code>" JavaScript code folding
set foldmethod=syntax
set foldlevelstart=3
let javaScript_fold=1

Plugin 'pangloss/vim-javascript'
</code></pre>

<p>Frequently used folding shortcuts:</p>

<p>zr/zm: decrease/increase the foldlevel by one;</p>

<p>zR/zM: open/close all folds;</p>

<p>zo/zc: open/close fold at cursor;</p>

<p>zO/zC: open/close all folds;</p>

<p>Ref:</p>

<p><a href="http://stackoverflow.com/questions/4789605/how-do-i-enable-automatic-folds-in-vim">http://stackoverflow.com/questions/4789605/how-do-i-enable-automatic-folds-in-vim</a>
<a href="https://www.linux.com/learn/tutorials/442438-vim-tips-folding-fun">https://www.linux.com/learn/tutorials/442438-vim-tips-folding-fun</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Vim Snippet Plugins]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/17/220931/"/>
    <updated>2015-10-17T22:09:31+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/17/220931</id>
    <content type="html"><![CDATA[<p>Add codes below into ~/.vimrc:</p>

<pre><code>let g:UltiSnipsEditSplit='vertical'

Plugin 'mattn/emmet-vim'
Plugin 'SirVer/ultisnips'
Plugin 'honza/vim-snippets'
</code></pre>

<p>Run <code>vim +PluginClean +PluginInstall +qa</code>.
The folder of UltiSnips is about 6.1MB, emmet-vim is about 1.6MB.</p>

<p>Here <a href="https://github.com/mattn/emmet-vim">emmet-vim</a> is a html editing tool.
For example open a new html file with <code>html:5</code>, and press <code>&lt;C-y&gt;,</code>,
you get a full html skeleton, which means emmet installed OK.</p>

<p><a href="https://github.com/sirver/ultisnips">UltiSnips</a> is a vim snippet engine,
while <a href="https://github.com/honza/vim-snippets">vim-snippets</a> is a bunch of
snippets definitions.</p>

<p>Use <code>UltiSnipsEdit</code> to add a new snippet.
Use <code>cl&lt;TAB&gt;</code> in a js file, to make it expand to <code>console.log(...);</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Search String Pattern in Git History]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/15/112116/"/>
    <updated>2015-10-15T11:21:16+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/15/112116</id>
    <content type="html"><![CDATA[<p><code>git log -p --all -G 'pattern'</code>: search a string in git history.</p>

<p>-G search for all editing activity with &ldquo;pattern&rdquo;,
while -S only search for creation and removal of &ldquo;pattern&rdquo;,
the results of -S is the subset of results of -G.</p>

<p>When the &ldquo;pattern&rdquo; is in the current commit,
there will be only 1 result of -S,
where the pattern is added into the texts.</p>

<p>When the &ldquo;pattern&rdquo; is removed in current commit,
there will be 2 results of -S:
the first (which is newer) is where the pattern is removed,
the second is where the pattern is added.</p>

<p>-p denotes &ndash;patch, which will print the editing details.
If you only want to know the commit name which deal with the &ldquo;pattern&rdquo;,
omit this option.</p>

<p>&ndash;all search in all branches.</p>

<p>Ref:</p>

<p><a href="http://stackoverflow.com/questions/4468361/search-all-of-git-history-for-a-string">Search all of Git history for a string?</a></p>

<p><a href="http://stackoverflow.com/questions/2839253/git-history-find-lost-line-by-keyword">Git history - find lost line by keyword</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tab and Session Management in Vim]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/14/192323/"/>
    <updated>2015-10-14T19:23:23+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/14/192323</id>
    <content type="html"><![CDATA[<p>Session management is provided by <a href="https://github.com/tpope/vim-obsession">tpope/vim-obsession</a>.
Tab rename function is provided by <a href="https://github.com/gcmt/taboo.vim">gcmt/taboo.vim</a>.</p>

<p>In ~/.vimrc:</p>

<pre><code>" Customize tabline
hi TabLineFill term=bold cterm=bold ctermbg=0
hi TabLine ctermfg=Yellow

" Taboo
set sessionoptions+=tabpages,globals
cabbrev tr TabooRename

" tab switching shortcuts
noremap &lt;leader&gt;1 1gt
noremap &lt;leader&gt;2 2gt
noremap &lt;leader&gt;3 3gt
noremap &lt;leader&gt;4 4gt
noremap &lt;leader&gt;5 5gt
noremap &lt;leader&gt;6 6gt
noremap &lt;leader&gt;7 7gt
noremap &lt;leader&gt;8 8gt
noremap &lt;leader&gt;9 9gt
noremap &lt;leader&gt;0 :tablast&lt;cr&gt;

" Add these into Vundle section
Plugin 'gcmt/taboo.vim'
Plugin 'tpope/vim-obsession'
</code></pre>

<p>Now open file in a new tab with: <code>Ctrl-P</code>, select a file and <code>Ctrl-O, t</code>.
Open file in a virtical split window with: <code>Ctrl-P</code>, select a file and <code>Ctrl-O, v</code>.
Rename tab with: <code>:tr&lt;Space&gt;new name&lt;Enter&gt;</code>.
Jump to the 3rd window with <code>,3</code>.</p>

<p>Note:</p>

<p>I also tried <a href="https://github.com/xolox/vim-session">xolox/vim-session</a>,
but it can&rsquo;t persist tab name created by Taboo.</p>

<p>For tab easy switch, I&rsquo;ve tried <code>noremap &lt;unique&gt; &lt;C-1&gt; 1gt</code> based on
<a href="http://stackoverflow.com/questions/2005214/switching-to-a-particular-tab-in-vim">Switching to a particular tab in VIM</a>,
where changes M-Num to C-Num, because M-Num is assigned to tmux window switch.
However C-Num can&rsquo;t work,
see <a href="http://stackoverflow.com/questions/15849537/vimrc-mapping-for-control-key-not-working">.vimrc mapping for control key not working</a>
for explanations.
So I adopted <code>noremap &lt;leader&gt;1 1gt</code> style based on
<a href="http://superuser.com/questions/410982/in-vim-how-can-i-quickly-switch-between-tabs">In vim, how can I quickly switch between tabs?</a>.</p>

<p>Mapping long Ex commands with <code>cabbrev</code> is a very useful for convenient.
Use <Space> instead of <Tab> to enable abbreviation in <code>cabbrev</code>.
See <code>:h :ca</code>, <a href="http://stackoverflow.com/questions/117150/can-i-re-map-commands-in-vim">Can I (re-) map commands in vim?</a>
and <a href="http://stackoverflow.com/questions/3878692/aliasing-a-command-in-vim">Aliasing a command in vim</a>
for details.</p>

<p>With <code>cabbrev tr TabooRename</code>, you can use <code>:tr&lt;Space&gt;1:tests</code> to rename current tab into &ldquo;1:tests&rdquo;.
Here you have to add tab index manually to make <code>&lt;leader&gt;&lt;number&gt;</code> style switching more convenient.</p>

<p>To make tabline more readable,
I customized the color of it.
See <a href="http://stackoverflow.com/questions/4726882/how-do-you-change-the-background-color-of-the-empty-tab-space-in-vim">How do you change the background color of the empty tab space in vim?</a>
and <a href="http://stackoverflow.com/questions/7238113/customising-the-colours-of-vims-tab-bar">Customising the colours of vim&rsquo;s tab bar</a>
for details.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reaction Notes]]></title>
    <link href="http://leetschau.github.io/blog/2015/10/06/122243/"/>
    <updated>2015-10-06T12:22:43+08:00</updated>
    <id>http://leetschau.github.io/blog/2015/10/06/122243</id>
    <content type="html"><![CDATA[<h1>Accounts</h1>

<p>reaction-core的用户存在users表和Accounts表，下面是初始化Reaction后得到的Owner用户表结构。
用户与业务有关的信息存在Accounts表中，其余的放在了users表中，
server/methods/accounts.js:Accounts.onCreateUser()可以看到
Accounts中的用户是首先clone Meteor user，然后在上面添加新属性后insert到Accounts表中。
这里users中的用户作用有两个：</p>

<ul>
<li><p>基于Meteor accounts包管理用户的注册、验证、登录等动作；</p></li>
<li><p>基于alanning/meteor-roles定义用户角色；</p></li>
</ul>


<p>下面是从数据库中得到的一组实例：</p>

<pre><code>&gt; db.users.find().pretty()
{
  "_id" : "Jyt46yndz8e5tCWgN",
  "createdAt" : ISODate("2015-10-06T03:43:17.711Z"),
  "services" : {
    "password" : {
      "bcrypt" : "$2a$10$Oj.qa9YmYdQazg3WkvqlbOf2FM2.SI5V0a6Ar8kW8qGEc.dRhzHXe"
    }
  },
  "username" : "Owner",
  "emails" : [
    {
      "address" : "asy6nklv@localhost",
      "verified" : false,
      "provides" : "default"
    }
  ],
  "roles" : {
    "8jbLoDao7BaLhmCog" : [
      "guest",
      "account/profile",
      "owner",
      "admin",
      "dashboard",
      "dashboard/settings/shop",
      "dashboard/orders",
      "createProduct",
      "dashboard/accounts",
      "core",
      "shipping",
      "reaction-shipping",
      "paypal",
      "reaction-paypal",
      "braintree",
      "reaction-braintree",
      "stripe",
      "reaction-stripe",
      "authnet",
      "reaction-auth-net",
      "social",
      "reaction-social",
      "reactionAnalytics",
      "reaction-analytics"
    ],
    "__global_roles__" : [
      "owner",
      "admin",
      "dashboard"
    ]
  }
}

&gt; db.Accounts.find().pretty()
{
  "_id" : "Jyt46yndz8e5tCWgN",
  "createdAt" : ISODate("2015-10-06T03:43:17.733Z"),
  "emails" : [
    {
      "address" : "asy6nklv@localhost",
      "verified" : false,
      "provides" : "default"
    }
  ],
  "userId" : "Jyt46yndz8e5tCWgN",
  "shopId" : "8jbLoDao7BaLhmCog",
  "acceptsMarketing" : false,
  "state" : "new"
}
</code></pre>
]]></content>
  </entry>
  
</feed>
