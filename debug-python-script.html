<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Li Chao" />
        <meta name="copyright" content="Li Chao" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="ipdb, pudb, python, ipython, Tech, " />

<meta property="og:title" content="Debug Python Script"/>
<meta property="og:url" content="http://leetschau.github.io/debug-python-script.html" />
<meta property="og:description" content="Updated for debugging technics when analyzing logistic regression script of &#34;Data Science from Scratch&#34;, chapter 16 in PyCharm 2017.3. See details in wiznote/diary/2017.12.27. Origin post: Now I want to dubug a script named filteringdata.py. PyCharm Community Edition Its editor (with IdeaVim plugin), linter and …" />
<meta property="og:site_name" content="DarkMatter in Cyberspace" />
<meta property="og:article:author" content="Li Chao" />
<meta property="og:article:published_time" content="2016-02-16T20:55:37+08:00" />
<meta property="" content="2021-03-11T11:47:57+08:00" />
<meta name="twitter:title" content="Debug Python Script">
<meta name="twitter:description" content="Updated for debugging technics when analyzing logistic regression script of &#34;Data Science from Scratch&#34;, chapter 16 in PyCharm 2017.3. See details in wiznote/diary/2017.12.27. Origin post: Now I want to dubug a script named filteringdata.py. PyCharm Community Edition Its editor (with IdeaVim plugin), linter and …">

        <title>Debug Python Script · DarkMatter in Cyberspace
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://leetschau.github.io/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://leetschau.github.io/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://leetschau.github.io/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://leetschau.github.io/theme/css/custom.css" media="screen">
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://leetschau.github.io/"><span class=site-name>DarkMatter in Cyberspace</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://leetschau.github.io">Home</a></li>
                            <li ><a href="http://leetschau.github.io/categories.html">Categories</a></li>
                            <li ><a href="http://leetschau.github.io/tags.html">Tags</a></li>
                            <li ><a href="http://leetschau.github.io/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://leetschau.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="http://leetschau.github.io/debug-python-script.html"> Debug Python Script </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            <hr>
<p>Updated for debugging technics when analyzing logistic regression script
of "Data Science from Scratch", chapter 16 in PyCharm 2017.3.
See details in wiznote/diary/2017.12.27.</p>
<p>Origin post:</p>
<p>Now I want to dubug a script named <code>filteringdata.py</code>.</p>
<h1>PyCharm Community Edition</h1>
<p>Its editor (with IdeaVim plugin), linter and debugger is
the most powerful and verbose in the 3 candidates.
But it's complicated when debugging a remote script.</p>
<p>Add the following lines into ~/.ideavimrc:</p>
<div class="highlight"><pre><span></span><code><span class="err">set nocompatible</span>
<span class="err">set clipboard=unnamedplus</span>
<span class="err">nnoremap ; :</span>
<span class="err">nnoremap : ;</span>
<span class="err">vnoremap ; :</span>
<span class="err">vnoremap : ;</span>
</code></pre></div>


<p>The code navigation shortcut "Ctrl-Alt-Left/Right" of the default keymap
"Default for XWin" (in File -&gt; Settings) is conflict with
"Switch workspace"'s shortcut key of Ubuntu Unity.
So change the "Keymaps" to "Default for GNOME", whose code navigation key
is "Alt-Shift-Left/Right".</p>
<p>In a debugging session, pause at a breakpoint set beforehand,
evaluate multiline scripts in the window created by
<em>Evaluate Expression (Alt-F8)</em> button in <em>Debugger</em> window.</p>
<h2>Editor Setup</h2>
<p>Setup editor font size:  [Font -&gt; Primary font -&gt; Size: 16]</p>
<p>Setup editor background to pure dark: [General -&gt; Text -&gt; Default text],
click the "Background" color icon, set R,G,B to 0,
click the "Foreground" color icon, set R,G,B to 255.</p>
<p>Set right margin :
[File -&gt; Settings -&gt; Editor -&gt; Code Style -&gt; General: Right margin (columns)],
set it's value to 80 instead of the default value 120.</p>
<p>Jump between editor and terminal: modify it to Alt-K (default: Alt-F12)
[File -&gt; Settings -&gt; Keymap]: search "terminal", double click "Terminal",
choose "Add Keyboard Shortcut".</p>
<h2>Some Shortcuts</h2>
<p>Toggle Project View: Alt-1</p>
<p>Split window: Ctrl-Shift-A, input "split", select "Split vertical/horizontal"</p>
<p>Jump between files: Ctrl-Shift-N</p>
<p>Jump between editor tabs and split window: Ctrl-Tab</p>
<p>Full screen: [View -&gt; Enter Full Screen]</p>
<p>Clipboard history: Ctrl-Shift-v</p>
<p>Jump to previous/next function: Alt-Up/Down</p>
<h2>Discussion</h2>
<p>You can switch easily between "Console" and "Debugger" panels.
The Console panel distinguishes stdout and stderr with different colors,
which is particularly useful when debugging some programs
with both stdout and stderr outputs.</p>
<p>Meanwhile you can evaluate an expression at the runtime in "Watches" window.</p>
<h1>pudb</h1>
<p>Comparing with ipdb, pudb needn't add stub in source script.</p>
<p>Installation: <code>conda install -c conda-forge pudb</code>.
Note: installing with conda instead of pip cooperates better with conda environment.</p>
<p>Debug Python script: <code>pudb filteringdata.py</code>,
or with additional arguments: <code>pudb uploadES.py fairs.json production Fair</code>.</p>
<p>Use <code>?</code> to list all available commands.</p>
<p>Focus code window with <code>C</code>
(which is the default window focused once you are in pudb), <code>n</code> to step over,
<code>s</code> step into , <code>f</code> finish current function (like step out), <code>c</code> continue,
<code>o</code> to see the console output (very useful!).</p>
<p>Use <code>m</code> (then the module name) to open a module,
this is useful when you want to set a breakpoint in another module.
The module name of the main script is <code>__main__</code>.</p>
<p>Focus variable window with <code>V</code>.
In this window:
use <code>w</code> to toggle line wrap,
<code>[</code>/<code>]</code> to grow/shrink relative size of the window,
<code>=</code>/<code>-</code> to grow/shrink sidebar.
<code>\</code> to expand/collapse variable result.</p>
<p>Toggle focus on command line with 'Ctrl-x'.</p>
<p>To resize the console window, press 'Ctrl-x' to focus console window,
then press Right arrow key to focus <code>&lt; Clear &gt;</code> at the bottom-right corner,
then use <code>=</code>, <code>-</code>, <code>+</code> and <code>_</code> keys to resize the window.</p>
<h1>ipdb</h1>
<h2>without stubs</h2>
<p>In IPython repl, debug any function on site with <code>%debug -b mypackage.py:23 myfunc(inp)</code>.
Here the <code>-b</code> option add a breakpoint at the place you want to stop.
Note the command after the <code>%debug</code> can only be function.
You can't write it as <code>%debug res = myfunc(inp)</code> (which is a statement).</p>
<p>If you want to just activate the debugger AFTER an exception has fired,
without having to type ‘%pdb on’ and rerunning your code,
you can use the %debug magic: <code>%debug myfunc(inp)</code>.</p>
<p>Debug a script <em>mymodule.py</em> with <code>%run -d -b26 mymodule.py</code>.
Here <code>-d</code> means <em>debug</em>, <code>-b 263</code> means <em>add breakpoint at line 263</em>.</p>
<p>Activate the debugger AFTER an exception has fired:</p>
<div class="highlight"><pre><span></span><code><span class="nf">%pdb</span> <span class="n">on</span>
<span class="n">run</span> <span class="n">mymodule</span><span class="p">.</span><span class="n">py</span>
</code></pre></div>


<p>If you want add a breakpoint <em>in</em> the ipdb session,
run <code>b 141</code> (141 is the line number of current script) or <code>b myscript.py:141</code>.
Using <code>b</code> to list all breakpoints.
To add a conditional breakpoint, for example,
only stops at line 40 when <code>j</code> equals 50:
<code>b 40, j == 50</code>.
See <a href="https://medium.com/instamojo-matters/become-a-pdb-power-user-e3fc4e2774b2">Become a pdb power-user</a>
for more details.</p>
<p>To clear the break point #3, run <code>cl 3</code> in ipdb REPL.
Clear all breakpoints with <code>cl</code> or <code>clear</code>.</p>
<p>If your app script import some other libraries, you can add breakpoints
in the imported library files with <code>%run -d -b mylib.py:26 my_app.py</code></p>
<p>There's no need to add <code>set_trace()</code> function in this mode.</p>
<h2>with stubs</h2>
<p>There are totally 3 steps when debugging a Python script with
ipdb module: install, insert stubs in source codes and debug.</p>
<p>First install with <code>sudo pip install ipdb</code>
(in Anaconda this is installed by default).</p>
<p>Then add <code>from ipdb import set_trace</code> at the head into the script,
and add <code>set_trace()</code> at the first place you want the dubugger to stop.</p>
<p>Finally start a shell and run:</p>
<div class="highlight"><pre><span></span><code>$ ipython
...
IPython <span class="m">4</span>.0.1 ...
...
In <span class="o">[</span><span class="m">1</span><span class="o">]</span>: %run filteringdata.py
&gt; /home/leo/docs/playground/pg2dm-python/ch2/filteringdata.py<span class="o">(</span><span class="m">53</span><span class="o">)</span>recommend<span class="o">()</span>
     <span class="m">52</span>     <span class="c1"># first find nearest neighbor</span>
---&gt; <span class="m">53</span>     <span class="nv">nearest</span> <span class="o">=</span> computeNearestNeighbor<span class="o">(</span>username, users<span class="o">)[</span><span class="m">0</span><span class="o">][</span><span class="m">1</span><span class="o">]</span>
     <span class="m">54</span>

ipdb&gt; h
</code></pre></div>


<h2>debug test case</h2>
<p>To debug in a unit test written with <em>unittest</em>,
for example the following test in file <em>test_app.py</em>:</p>
<div class="highlight"><pre><span></span><code><span class="err">class TrainerTest(TestCase):</span>
<span class="err">    def setUp(self):</span>
<span class="err">        self.raw = pd.read_csv(&#39;ycz6502.csv&#39;, usecols=[0, 4, 6],</span>
<span class="err">                               index_col=0).dropna()</span>
<span class="err">    def test_trainer_03(self):</span>
<span class="err">        logging.info(&#39;Thresholds between statuses:\n%s&#39; % train_thresholds(self.raw, 0.3))</span>
</code></pre></div>


<p>here the core functionality is implemented in function <code>train_thresholds</code> 
in file <em>corr_calc.py</em>, start the debugging process with:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">defaultTestLoader</span><span class="p">,</span> <span class="n">TextTestRunner</span>
<span class="o">%</span><span class="n">load</span> <span class="o">-</span><span class="n">r</span> <span class="mi">1</span><span class="p">:</span><span class="mi">153</span> <span class="n">test_app</span><span class="o">.</span><span class="n">py</span>
<span class="n">test_trainer</span> <span class="o">=</span> <span class="n">defaultTestLoader</span><span class="o">.</span><span class="n">loadTestsFromName</span><span class="p">(</span>
        <span class="s1">&#39;test_app.TrainerTest.test_trainer_08&#39;</span><span class="p">)</span>
<span class="o">%</span><span class="n">debug</span> <span class="o">-</span><span class="n">b</span> <span class="n">corr_calc</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">138</span> <span class="n">TextTestRunner</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">test_trainer</span><span class="p">)</span>
</code></pre></div>


<p>Or add the starting script like the following in <em>test_app.py</em>:</p>
<div class="highlight"><pre><span></span><code><span class="err">if __name__ == &#39;__main__&#39;:</span>
<span class="err">    test_trainer = defaultTestLoader.loadTestsFromName(</span>
<span class="err">            &#39;test_app.TrainerTest.test_trainer_08&#39;)</span>
<span class="err">    TextTestRunner(verbosity=1).run(test_trainer)</span>
</code></pre></div>


<p>Then in the IPython console, debug with <code>run -d -b corr_calc.py:130 test_app.py</code></p>
<h2>Watch variables</h2>
<p>In ipdb REPL, to <em>watch</em> interested variables, use the <code>display</code> command:
Use <code>display var1</code>, <code>display var2</code>, etc to add variables,
<code>display</code> to list all watched variables,
and <code>undisplay</code> to remove watched variables.</p>
<p>Now if the variables watched change during <code>c</code> or <code>n</code>, they will be displayed
at the console.</p>
<p>Use <code>alias</code> to convert long command short.
For example, after <code>alias ds display</code>, <code>ds</code> will list all watched variables.
Use <code>unalias</code> to remove the alias.</p>
<p>Frequently used commands include:</p>
<div class="highlight"><pre><span></span><code><span class="n">display</span><span class="o">:</span> <span class="n">add</span><span class="o">/</span><span class="n">list</span> <span class="n">watched</span> <span class="n">variables</span><span class="o">;</span>
<span class="n">a</span><span class="o">:</span> <span class="n">print</span> <span class="n">args</span> <span class="n">of</span> <span class="n">current</span> <span class="kd">function</span><span class="o">;</span>
<span class="n">b</span><span class="o">:</span> <span class="kd">set</span> <span class="n">or</span> <span class="n">list</span> <span class="k">break</span> <span class="n">points</span><span class="o">.</span> <span class="n">use</span> <span class="o">*</span><span class="n">cl</span><span class="o">*</span> <span class="n">to</span> <span class="n">clear</span> <span class="n">breakpoints</span><span class="o">;</span>
<span class="n">c</span><span class="o">:</span> <span class="k">continue</span> <span class="n">to</span> <span class="n">next</span> <span class="k">break</span> <span class="n">points</span><span class="o">;</span>
<span class="n">n</span><span class="o">:</span> <span class="n">next</span><span class="o">;</span>
<span class="n">s</span><span class="o">:</span> <span class="n">step</span><span class="o">;</span>
<span class="n">p</span> <span class="o">&amp;</span> <span class="n">pp</span><span class="o">:</span> <span class="n">evaluate</span> <span class="n">and</span> <span class="n">print</span> <span class="n">value</span> <span class="n">of</span> <span class="n">an</span> <span class="n">expression</span><span class="o">;</span>
<span class="n">pp</span> <span class="n">locals</span><span class="o">():</span> <span class="n">pretty</span><span class="o">-</span><span class="n">print</span> <span class="n">all</span> <span class="n">local</span> <span class="n">variables</span><span class="o">;</span>
<span class="n">w</span><span class="o">:</span> <span class="n">print</span> <span class="n">the</span> <span class="n">stack</span><span class="o">,</span> <span class="n">useful</span> <span class="n">during</span> <span class="n">multiple</span> <span class="kd">function</span> <span class="n">calls</span>
<span class="n">q</span><span class="o">:</span> <span class="n">quit</span><span class="o">;</span>
</code></pre></div>


<p>Use <code>h a</code> to see the help information about command <code>a</code>.</p>
<p>Watching with <code>display</code> in ipdb is more convenient than <em>watch</em> window in
pudb or PyCharm, because in repl you can see clear changed history of
the variables with interests.</p>
<p>When debug recursive functions, you have to use <em>without stubs</em> style,
because <code>set_trace()</code> function in the debugged function body will clear the
information of higher level function call in the stack.</p>
            
            
            <hr/>
            <script src="https://utteranc.es/client.js"
                    repo="leetschau/leetschau.github.io"
                    issue-term="pathname"
                    theme="github-light"
                    crossorigin="anonymous"
                    async>
            </script>
            <hr/>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2016-02-16T20:55:37+08:00">Feb 16, 2016</time>

<h4>Last Updated</h4>
<time datetime="2021-03-11T11:47:57+08:00">Mar 11, 2021</time>

            <h4>Category</h4>
            <a class="category-link" href="http://leetschau.github.io/categories.html#tech-ref">Tech</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="http://leetschau.github.io/tags.html#ipdb-ref">ipdb
                    <span>2</span>
</a></li>
                <li><a href="http://leetschau.github.io/tags.html#ipython-ref">ipython
                    <span>5</span>
</a></li>
                <li><a href="http://leetschau.github.io/tags.html#pudb-ref">pudb
                    <span>1</span>
</a></li>
                <li><a href="http://leetschau.github.io/tags.html#python-ref">python
                    <span>136</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="#" title="My You can add links in your config file Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-you can add links in your config file sidebar-social-links"></i></a>
    <a href="#" title="My Another social link Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-another social link sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>